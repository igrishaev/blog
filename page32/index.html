<!DOCTYPE html>
<html lang="ru">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Ivan Grishaev's blog</title>
  <meta name="description" content="Writing on programming, education, books and negotiations.
">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/custom.css">
  <link rel="canonical" href="https://grishaev.me/page32/">
  <link rel="alternate" type="application/rss+xml" title="Ivan Grishaev's blog" href="https://grishaev.me/feed.xml">

  <link rel="shortcut icon" type="image/x-icon" href="/assets/static/favicons/favicon.ico">

  <script type="text/javascript" src="/assets/typo.js"></script>

</head>


  <body>
    <header class="site-header">

    <div class="wrapper flex-container">

        <div>
            <a href="/">
                <img id="avatar" src="/assets/static/avatar.jpg" alt="Ivan Grishaev">
            </a>
        </div>

        <div class="flex-container-vert" style="margin-left: 15px; width: 80%">

            <div class="flex-container full-width">
                <p style="margin-bottom: 5px">Ivan Grishaev's blog</p>
                <div class="flex-huge"></div>
                <div >
<form id="search-form"
      target="_blank"
      style="display: inline"
      method="get"
      action="https://www.google.com/search">

    <input name="sitesearch"
           value="grishaev.me"
           type="hidden">

    <input type="text"
           required="required"
           name="q"
           placeholder="Google search..."
           autocomplete="off">

    <button style="border: none; background-color: transparent; cursor: pointer;"
            type="submit">&#x1f50d;</button>

</form>
</div>
            </div>

            <p><small>Writing on programming, education, books and negotiations.
</small></p>

            <div class="flex-container">
                <a class="menu-item" href="/">Home</a>
                <a class="menu-item" href="/about/">About</a>
                <a class="menu-item" href="/bookshelf/">Bookshelf</a>
                <a class="menu-item" href="/feed.xml">RSS</a>
            </div>

            <div class="flex-container">
                <a class="menu-item minor" href="/tag/clojure/">Clojure</a>
                <a class="menu-item minor" href="/tag/emacs/">Emacs</a>
                <a class="menu-item minor" href="/tag/python/">Python</a>
                <a class="menu-item minor" href="/tag/programming/">Programming</a>
                <a class="menu-item minor" href="/interview/">Interview</a>
                <a class="menu-item minor" href="/video/">Video</a>
            </div>

            <div class="flex-container">
                <a class="menu-item minor hl" href="/clojure-in-prod/">Книга «Clojure на производстве»</a>
            </div>

            <div class="flex-container">
                <a class="menu-item minor hl" href="/clojure-in-prod-2/">Книга «Clojure на производстве», второй том</a>
            </div>

        </div>
    </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="home">

    <ul class="post-list">
        
        <li>

            <h2>
                <a class="post-link" href="/read-35/">Ссылки на выходные (выпуск 35)</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2021-07-17T00:00:00+00:00">
        Jul 17, 2021
    </time>

    <a href="/tag/read/" rel="tag">read</a>, <a href="/tag/life/" rel="tag">life</a>

</div>


            <div class="entry">
                
                    <p>Давно не писал в блог. Все свободное время трачу на большую главу по базам
данных в Кложе. На какой-то период ограничимся ссылками на выходные.</p>

<p>Этот выпуск посвящаю Леониду Каганову.</p>

<ul>
  <li>
    <p>Фантастический рассказ <a href="https://lleo.me/arhive/fan2006/mne_povezet.shtml">“Мне повезет”</a></p>

    <p>Занятный рассказ, и смешно и грустно одновременно. Займет двадцать минут, не пожалеете.</p>
  </li>
  <li>
    <p><a href="https://lleo.me/dnevnik/2021/07/12">Поговорим про умный дом?</a></p>

    <p>Давно хотел написать о том, какая чушь все эти умные дома. Но Леонид сделал это раньше и лучше.</p>
  </li>
</ul>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/cron-mail/">Crontab и отправка почты</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2021-06-23T00:00:00+00:00">
        Jun 23, 2021
    </time>

    <a href="/tag/programming/" rel="tag">programming</a>, <a href="/tag/cron/" rel="tag">cron</a>, <a href="/tag/mail/" rel="tag">mail</a>

</div>


            <div class="entry">
                
                    <p>На днях столкнулся с проблемой. На моем ноуте крутится несколько
crontab-задач. Хотелось бы видеть, когда сработала каждая из них и если нет, то
почему. Какое-то время я выкручивался с помощью логов. Оба канала (stdout и
stderr) перехватываются в общий пайп, где каждая строка предваряется текущий
датой и записывается в файл. Например:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">SHELL</span><span class="o">=</span>/bin/bash

0 <span class="k">*</span>/3 <span class="k">*</span> <span class="k">*</span> <span class="k">*</span> /path/to/command &amp;&gt; <span class="o">&gt;(</span> <span class="k">while </span><span class="nb">read </span>line<span class="p">;</span> <span class="k">do </span><span class="nb">echo</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">date</span><span class="si">)</span><span class="s2">: </span><span class="k">${</span><span class="nv">line</span><span class="k">}</span><span class="s2">"</span><span class="p">;</span> <span class="k">done</span> <span class="o">&gt;&gt;</span> /Users/ivan/logs/command.log<span class="o">)</span>
</code></pre></div></div>

<p>В результате и обычный, и ошибочный выхлоп оседают в файле. Выглядит это так:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Tue Jun 22 15:58:02 MSK 2021: warning: Skipping file ...
Tue Jun 22 15:58:19 MSK 2021: Completed 0 file(s) with ...
Tue Jun 22 15:59:02 MSK 2021: warning: Skipping file /Users/ivan/...
Tue Jun 22 15:59:19 MSK 2021: Completed 0 file(s) with ...
</code></pre></div></div>

<p>Недостаток в том, что логи нужно регулярно проверять. Об этом легко забыть на
месяц, а потом выяснится, что задача не работала из-за глупой ошибки.</p>

<p>Тут я вспомнил, что крон умеет отправлять выхлоп задачи на почту. Если задана
переменная <code class="language-plaintext highlighter-rouge">MAILTO=&lt;email&gt;</code>, то на эту почту свалится выхлоп. Это значит,
отпадают логи, ведь теперь достаточно проверить почту. Проверять ее можно и с
телефона, что в разы удобней.</p>

<p>Отправка письма работает за счет утилиты <code class="language-plaintext highlighter-rouge">mail</code>. В общем виде ей пользуются так:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cat </span>something | mail <span class="nt">-s</span> <span class="s1">'subject'</span> friend@domain.com
</code></pre></div></div>

<p>Эта команда отправит письмо на сервер <code class="language-plaintext highlighter-rouge">domain.com</code>, при этом отправитель будет
выглядеть как <code class="language-plaintext highlighter-rouge">ivan@ivan.local</code>, то есть имя пользователя и текущего хоста. То
же самое можно получить командой:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>echo `whoami`@`hostname`
</code></pre></div></div>

<p>Обратите внимание на кавычки – они означают выполнить выражение в новом шелле и
подставить результат.</p>

<p>Отправленное письмо никто не получит, что потому что современные сервера
отметают письма, где айпи отправителя не совпадает с айпи его домена. Это
хорошо, иначе бы мы утонули в спаме. Будем отправлять письма с серверов Гугла. А
чтобы <code class="language-plaintext highlighter-rouge">mail</code> мог подключиться к Гуглу, сделаем три вещи.</p>

<p><strong>Первое.</strong> В файл <code class="language-plaintext highlighter-rouge">/etc/postfix/main.cf</code> дописать строки ниже. Делать это нужно
под <code class="language-plaintext highlighter-rouge">sudo</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>relayhost = [smtp.gmail.com]:587
smtp_sasl_auth_enable = yes
smtp_sasl_password_maps = hash:/etc/postfix/sasl_passwd
smtp_sasl_security_options = noanonymous
smtp_use_tls = yes
smtp_sasl_mechanism_filter = plain
</code></pre></div></div>

<p><strong>Второе.</strong> Создать файл <code class="language-plaintext highlighter-rouge">/etc/postfix/sasl_passwd</code> и вписать в него:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[smtp.gmail.com]:587 username@gmail.com:password
</code></pre></div></div>

<p>, где <code class="language-plaintext highlighter-rouge">password</code> — пароль приложения для почты. Сгенерить этот пароль можно на
специальной <a href="https://myaccount.google.com/apppasswords">странице Гугла</a>.</p>

<p>Замечу, что вместо <code class="language-plaintext highlighter-rouge">gmail.com</code> может быть ваш домен, если он нацелен на гугловые
сервера как в моем случае.</p>

<p><strong>Третье</strong> — указать <code class="language-plaintext highlighter-rouge">postfix</code> новые конфиги и перезагрузить его:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo chmod 600 /etc/postfix/sasl_passwd
sudo postmap /etc/postfix/sasl_passwd
sudo launchctl stop org.postfix.master
sudo launchctl start org.postfix.master
</code></pre></div></div>

<p>Все. Пробуем отправить письмо. Сообщим в нем содержимое домашней папки:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">ls</span> <span class="nt">-l</span> | mail <span class="nt">-s</span> <span class="s1">'my home dir'</span> ivan@grishaev.me
</code></pre></div></div>

<p>Мне пришло с первого раза. Plain text, красота.</p>

<p>Так вот, теперь когда почта работает, настроим крон. Открываем его командой
<code class="language-plaintext highlighter-rouge">crontab -e</code> и пишем сверху:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MAILTO=&lt;ваша@почта&gt;
</code></pre></div></div>

<p>Кроме того, в конец каждой команды добавляем эхо, например:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0 */3 * * * cd /some/path &amp;&amp; command --foo 42 &amp;&amp; echo OK
</code></pre></div></div>

<p>Зачем нужно эхо? Оказалось, что крон не отправляет письмо, если выхлоп задачи
пуст. А поскольку я всегда хочу знать о запуске задачи, то делаю вывод не
пустым. Вместо <code class="language-plaintext highlighter-rouge">echo OK</code> можно вывести текущую дату с помощью <code class="language-plaintext highlighter-rouge">&amp;&amp; date</code>.</p>

<p>В результате мы получим письмо, где тема — команда задачи, а тело — ее
выхлоп. Работает в том числе и для задач, которые не сработали из-за ошибки.</p>

<p>Я уж не говорю о том, что с помощью <code class="language-plaintext highlighter-rouge">mail</code> можно быстро что-то скидывать себе на
почту, организовать какие-то заметки и прочее. Что самое прекрасное — нет
интерфейса, все простое и открытое, работает везде. Чудо.</p>

<p>В следующий раз расскажу, что именно я ставлю на крон, там тоже интересные вещи.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/books-more/">И ещё немного книг</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2021-06-05T00:00:00+00:00">
        Jun 5, 2021
    </time>

    <a href="/tag/book/" rel="tag">book</a>

</div>


            <div class="entry">
                
                    <p>Выкладываю ещё несколько прочитанных книжек. Полную подборку см. <a href="/bookshelf/">на книжной
полке</a>.</p>

<div class="book-list">

    
<div class="book-item">
    <div class="book-thumb">
        <img src="/assets/static/bookshelf/chern.jpg" />
    </div>
    <div class="book-text">
        <p>
            <b>Чернобыль. История катастрофы</b>
            <br />
            <em>Хиггинботам Адам</em>
        </p>

        <p>
Полная история чернобыльских событий. Начинается задолго до взрыва, охватывает
становление Припяти и ранние опыты с атомной энергией в СССР. Подробно описаны
причины, которые привели к взрыву, в том числе организационные. Центральные
персонажи показаны правдиво и без тех прикрас, что были в сериале HBO. Книга
заканчивается развалом СССР и эпилогом. Рекомендую к прочтению.
        </p>

    </div>
</div>



<div class="book-item">
    <div class="book-thumb">
        <img src="/assets/static/bookshelf/minimal.jpg" />
    </div>
    <div class="book-text">
        <p>
            <b>Digital минимализм. Как навести порядок в цифровой среде</b>
            <br />
            <em>Рыжина Анастасия</em>
        </p>

        <p>
Книга о том, как навести порядок в файлах: на локальном компе и в облачных
хранилищах. Довольно занятно, но затянуто. Проблема в том, что материал тянет на
хорошую статью, но никак не на книгу. Отсюда дешёвые способы выйти на объём:
мудрые цитаты на разворот, письма читателей и прочий балласт. Но пробежаться
стоит.
        </p>

    </div>
</div>



<div class="book-item">
    <div class="book-thumb">
        <img src="/assets/static/bookshelf/thinkmath.jpg" />
    </div>
    <div class="book-text">
        <p>
            <b>Думай как математик. Как решать любые задачи быстрее и эффективнее</b>
            <br />
            <em>Барбара Оакли</em>
        </p>

        <p>
Автор &mdash; женщина-учёный, служила в армии США, преподавала в университете. В
книге она описывает приемы эффективного обучения. Например, заниматься
понемногу, но регулярно; не подчеркивать в книгах; мысленно пересказывать
материал. Полезно, но затянуто. Я бы сократил книгу на треть.
        </p>

    </div>
</div>



<div class="book-item">
    <div class="book-thumb">
        <img src="/assets/static/bookshelf/java-algo.jpg" />
    </div>
    <div class="book-text">
        <p>
            <b>Структуры данных и алгоритмы в Java Лафоре Роберт</b>
            <br />
            <em>Лафоре Роберт</em>
        </p>

        <p>
Прекрасная книга об алгоритмах. Столь понятного изложения я уже давно не
встречал. Все алгоритмы показаны картинками и схемами; к каждому прилагается
программа с интерфейсом для визуализации. Первая часть книги посвящена
сортировке, вторая &mdash; деревьям. Все примеры на Java версии 1.3. Пусть это
вас не пугает: никаких классов, всё на примитивах и массивах. Горячо рекомендую
книгу всем, кто хочет разобраться с коллекциями и алгоритмами.
        </p>

    </div>
</div>




<div class="book-item">
    <div class="book-thumb">
        <img src="/assets/static/bookshelf/drama.jpg" />
    </div>
    <div class="book-text">
        <p>
            <b>Уступите место драме. Как писать интересно даже на скучные темы</b>
            <br />
            <em>Сарычева Людмила</em>
        </p>

        <p>
Книга о драматургии Люды Сарычевой, соавтора "Пиши, сокращай". Не думайте, что
драматургия &mdash; это обязательно Шекспир и все умирают. Речь о том, как
сделать текст интересней с помощью персонажей и конфликтов, как обострять
акценты и чередовать ритм. Прочитал половину: начало интересное и пригодится
всем, а дальше уже только для специалистов в теме.
        </p>

    </div>
</div>



<div class="book-item">
    <div class="book-thumb">
        <img src="/assets/static/bookshelf/moving-castle.jpg" />
    </div>
    <div class="book-text">
        <p>
            <b>Ходячий замок</b>
            <br />
            <em>Джонс Диана Уинн</em>
        </p>

        <p>
Смотрел этот мульт три раза и вот добрался до книги. Ощущения смешанные: сюжеты
расходится, характеры персонажей разнятся. Книга местами затянута и её ритм
скачет. Я бы сказал, что мультфильм лучше книги, причём не в плане эффектов, а
потому что несёт больше чувств. Но прочитать стоит.
        </p>

    </div>
</div>



<div class="book-item">
    <div class="book-thumb">
        <img src="/assets/static/bookshelf/art-of-war.jpg" />
    </div>
    <div class="book-text">
        <p>
            <b>Искусство войны</b>
            <br />
            <em>Сунь-Цзы</em>
        </p>

        <p>
Тот самый трактат о войне, написанный две с половиной тысячи лет назад. Оригинал
довольно короткий, буквально дюжина керамических табличек. Поэтому современные
издания напичканы комментариями толкователей всех мастей. Это весьма раздражает:
после каждой фразы оригинала следуют пять абзацев комментариев. К самому
трактату претензий нет: он точен, ясен, в нём нет лишних деталей, он несет много
пищи для размышления. Удивительно, что человек, который занимался войной, так
много пишет о милосердии и заботе о людях.
        </p>

    </div>
</div>


</div>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/en/farseer/">Introducing Farseer: the JSON RPC server, the client and utilities</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2021-06-02T00:00:00+00:00">
        Jun 2, 2021
    </time>

    <a href="/tag/clojure/" rel="tag">clojure</a>, <a href="/tag/programming/" rel="tag">programming</a>, <a href="/tag/rpc/" rel="tag">RPC</a>

</div>


            <div class="entry">
                
                    
<p><em>(This is a copy of the readme file from the repository.)</em></p>

<p><a href="https://github.com/igrishaev/farseer">Farseer</a> is a set of modules for <a href="https://en.wikipedia.org/wiki/JSON-RPC">JSON RPC</a>. It includes a
transport-independent handler, Ring HTTP handler, Jetty server, HTTP client,
local stub, documentation, and more.</p>

<h2>

    

</h2>

<ul id="toc-item-farseer-en">
  <li><a href="#what-and-why-is-json-rpc" id="toc-item-farseer-en-what-and-why-is-json-rpc">What and Why is JSON RPC?</a>    <ul>
      <li><a href="#benefits" id="toc-item-farseer-en-benefits">Benefits</a></li>
      <li><a href="#disadvantages" id="toc-item-farseer-en-disadvantages">Disadvantages</a></li>
    </ul>
  </li>
  <li><a href="#the-structure-of-this-project" id="toc-item-farseer-en-the-structure-of-this-project">The Structure of this Project</a>    <ul>
      <li><a href="#installation" id="toc-item-farseer-en-installation">Installation</a></li>
    </ul>
  </li>
  <li><a href="#rpc-handler" id="toc-item-farseer-en-rpc-handler">RPC Handler</a>    <ul>
      <li><a href="#method-handlers" id="toc-item-farseer-en-method-handlers">Method handlers</a></li>
      <li><a href="#specs" id="toc-item-farseer-en-specs">Specs</a>        <ul>
          <li><a href="#input-spec" id="toc-item-farseer-en-input-spec">Input Spec</a></li>
          <li><a href="#output-spec" id="toc-item-farseer-en-output-spec">Output Spec</a></li>
          <li><a href="#in-production" id="toc-item-farseer-en-in-production">In Production</a></li>
        </ul>
      </li>
      <li><a href="#more-on-context" id="toc-item-farseer-en-more-on-context">More on Context</a>        <ul>
          <li><a href="#static-context" id="toc-item-farseer-en-static-context">Static Context</a></li>
          <li><a href="#dynamic-context" id="toc-item-farseer-en-dynamic-context">Dynamic Context</a></li>
        </ul>
      </li>
      <li><a href="#request--response-formats" id="toc-item-farseer-en-request--response-formats">Request &amp; Response Formats</a>        <ul>
          <li><a href="#request" id="toc-item-farseer-en-request">Request</a></li>
          <li><a href="#response" id="toc-item-farseer-en-response">Response</a></li>
          <li><a href="#error-codes" id="toc-item-farseer-en-error-codes">Error Codes</a></li>
        </ul>
      </li>
      <li><a href="#notifications" id="toc-item-farseer-en-notifications">Notifications</a></li>
      <li><a href="#batch-requests" id="toc-item-farseer-en-batch-requests">Batch Requests</a>        <ul>
          <li><a href="#note-on-parallelism" id="toc-item-farseer-en-note-on-parallelism">Note on Parallelism</a></li>
          <li><a href="#configuring--limiting-batch-requests" id="toc-item-farseer-en-configuring--limiting-batch-requests">Configuring &amp; Limiting Batch Requests</a></li>
        </ul>
      </li>
      <li><a href="#errors--exceptions" id="toc-item-farseer-en-errors--exceptions">Errors &amp; Exceptions</a>        <ul>
          <li><a href="#runtime-unexpected-errors" id="toc-item-farseer-en-runtime-unexpected-errors">Runtime (Unexpected) Errors</a></li>
          <li><a href="#rpc-expected-errors" id="toc-item-farseer-en-rpc-expected-errors">RPC (Expected) Errors</a></li>
          <li><a href="#raising-exceptions" id="toc-item-farseer-en-raising-exceptions">Raising Exceptions</a></li>
        </ul>
      </li>
      <li><a href="#configuration" id="toc-item-farseer-en-configuration">Configuration</a></li>
    </ul>
  </li>
  <li><a href="#ring-http-handler" id="toc-item-farseer-en-ring-http-handler">Ring HTTP Handler</a>    <ul>
      <li><a href="#negative-responses" id="toc-item-farseer-en-negative-responses">Negative Responses</a></li>
      <li><a href="#batch-requests-in-http" id="toc-item-farseer-en-batch-requests-in-http">Batch Requests in HTTP</a></li>
      <li><a href="#configuration-1" id="toc-item-farseer-en-configuration-1">Configuration</a></li>
      <li><a href="#middleware--authorization" id="toc-item-farseer-en-middleware--authorization">Middleware &amp; Authorization</a></li>
      <li><a href="#http-context" id="toc-item-farseer-en-http-context">HTTP Context</a></li>
    </ul>
  </li>
  <li><a href="#jetty-server" id="toc-item-farseer-en-jetty-server">Jetty Server</a>    <ul>
      <li><a href="#configuration-2" id="toc-item-farseer-en-configuration-2">Configuration</a></li>
      <li><a href="#with-server-macro" id="toc-item-farseer-en-with-server-macro">With-server macro</a></li>
      <li><a href="#component" id="toc-item-farseer-en-component">Component</a></li>
    </ul>
  </li>
  <li><a href="#http-stub" id="toc-item-farseer-en-http-stub">HTTP Stub</a>    <ul>
      <li><a href="#multiple-stub" id="toc-item-farseer-en-multiple-stub">Multiple Stub</a></li>
      <li><a href="#tests" id="toc-item-farseer-en-tests">Tests</a></li>
      <li><a href="#negative-responses-1" id="toc-item-farseer-en-negative-responses-1">Negative Responses</a></li>
    </ul>
  </li>
  <li><a href="#http-client" id="toc-item-farseer-en-http-client">HTTP Client</a>    <ul>
      <li><a href="#configuration-3" id="toc-item-farseer-en-configuration-3">Configuration</a></li>
      <li><a href="#handling-responses" id="toc-item-farseer-en-handling-responses">Handling Responses</a></li>
      <li><a href="#auth" id="toc-item-farseer-en-auth">Auth</a></li>
      <li><a href="#notifications-1" id="toc-item-farseer-en-notifications-1">Notifications</a></li>
      <li><a href="#batch-requests-1" id="toc-item-farseer-en-batch-requests-1">Batch Requests</a></li>
      <li><a href="#connection-manager-pool" id="toc-item-farseer-en-connection-manager-pool">Connection Manager (Pool)</a></li>
      <li><a href="#component-1" id="toc-item-farseer-en-component-1">Component</a></li>
    </ul>
  </li>
  <li><a href="#documentation-builder" id="toc-item-farseer-en-documentation-builder">Documentation Builder</a>    <ul>
      <li><a href="#configuration-4" id="toc-item-farseer-en-configuration-4">Configuration</a></li>
      <li><a href="#building" id="toc-item-farseer-en-building">Building</a></li>
      <li><a href="#demo" id="toc-item-farseer-en-demo">Demo</a></li>
      <li><a href="#selmer--context" id="toc-item-farseer-en-selmer--context">Selmer &amp; Context</a></li>
      <li><a href="#rendering-specs" id="toc-item-farseer-en-rendering-specs">Rendering Specs</a></li>
    </ul>
  </li>
  <li><a href="#ideas--further-development" id="toc-item-farseer-en-ideas--further-development">Ideas &amp; Further Development</a></li>
</ul>

<h2 id="what-and-why-is-json-rpc">What and Why is JSON RPC?</h2>

<p>Briefly, JSON RPC is a protocol based on HTTP &amp; JSON. When calling the server,
you specify the method (procedure) name and its parameters. The parameters could
be either a map or a vector. The server returns a JSON response with the
<code class="language-plaintext highlighter-rouge">result</code> or <code class="language-plaintext highlighter-rouge">error</code> fields. For example:</p>

<p>Request:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="nl">"jsonrpc"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2.0"</span><span class="p">,</span><span class="w"> </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sum"</span><span class="p">,</span><span class="w"> </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Response:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="nl">"jsonrpc"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2.0"</span><span class="p">,</span><span class="w"> </span><span class="nl">"result"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Pay attention: the protocol depends on neither HTTP method, nor query params,
nor HTTP headers and so on. Although looking a bit primitive, this schema
eventually appears to be robust, scalable and reliable.</p>


                    <p><a href="/en/farseer/">Read more &rarr;</a></p>
                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/dry/">Сага о DRY и зависимостях</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2021-05-21T00:00:00+00:00">
        May 21, 2021
    </time>

    <a href="/tag/programming/" rel="tag">programming</a>, <a href="/tag/life/" rel="tag">life</a>, <a href="/tag/dry/" rel="tag">dry</a>

</div>


            <div class="entry">
                
                    <p>Предположим, в вашем проекте два модуля: <code class="language-plaintext highlighter-rouge">project.foo</code> и <code class="language-plaintext highlighter-rouge">project.bar</code>. В первый
из них вы добавили служебную функцию, например поиск элемента по
предикату. Через некоторое время то же самое понадобилось во втором модуле. Как
вы поступите?</p>

<p>Варианты:</p>

<ol>
  <li>Вынесу функцию в третий модуль <code class="language-plaintext highlighter-rouge">project.utils</code> и подключу его к <code class="language-plaintext highlighter-rouge">foo</code> и
<code class="language-plaintext highlighter-rouge">bar</code>.</li>
  <li>Скопирую функцию во второй модуль.</li>
</ol>

<p>Конечно, вы и так знаете, что правильный способ — первый. <a href="https://ru.wikipedia.org/wiki/Don%E2%80%99t_repeat_yourself">DRY</a> (Don’t
Repeat Yourself), не дублируй код. Держи одну точку входа, чтобы в случае ошибки
править в одном месте. Копирование — наш враг и все такое. Я тоже тоже так думал
раньше, и вот, в тридцать пять лет, поменял мнение.</p>


                    <p><a href="/dry/">Read more &rarr;</a></p>
                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/en/clojure-zippers/">Clojure Zippers</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2021-05-20T00:00:00+00:00">
        May 20, 2021
    </time>

    <a href="/tag/clojure/" rel="tag">clojure</a>, <a href="/tag/programming/" rel="tag">programming</a>, <a href="/tag/zippers/" rel="tag">zippers</a>

</div>


            <div class="entry">
                
                    
<h2>

    

</h2>

<ul id="toc-item-clojure-zippers-en">
  <li><a href="#part-1-the-basics-of-navigation" id="toc-item-clojure-zippers-en-part-1-the-basics-of-navigation">Part 1. The Basics of Navigation</a></li>
  <li><a href="#part-2-automatic-navigation" id="toc-item-clojure-zippers-en-part-2-automatic-navigation">Part 2. Automatic navigation</a></li>
  <li><a href="#part-3-xml-zippers" id="toc-item-clojure-zippers-en-part-3-xml-zippers">Part 3. XML zippers</a></li>
  <li><a href="#part-4-xml-search" id="toc-item-clojure-zippers-en-part-4-xml-search">Part 4. XML search</a></li>
  <li><a href="#part-5-editing" id="toc-item-clojure-zippers-en-part-5-editing">Part 5. Editing</a>    <ul>
      <li><a href="#multiple-change" id="toc-item-clojure-zippers-en-multiple-change">Multiple change</a></li>
      <li><a href="#prices-in-xml" id="toc-item-clojure-zippers-en-prices-in-xml">Prices in XML</a></li>
    </ul>
  </li>
  <li><a href="#part-6-virtual-trees-currency-exchange" id="toc-item-clojure-zippers-en-part-6-virtual-trees-currency-exchange">Part 6. Virtual Trees. Currency Exchange</a></li>
  <li><a href="#part-7-breadth-first-traversal-improved-currency-exchange" id="toc-item-clojure-zippers-en-part-7-breadth-first-traversal-improved-currency-exchange">Part 7. Breadth-First Traversal. Improved Currency Exchange</a></li>
  <li><a href="#part-8-summary" id="toc-item-clojure-zippers-en-part-8-summary">Part 8. Summary</a>    <ul>
      <li><a href="#html" id="toc-item-clojure-zippers-en-html">HTML</a></li>
      <li><a href="#data-and-serialization" id="toc-item-clojure-zippers-en-data-and-serialization">Data and Serialization</a></li>
      <li><a href="#other-uses" id="toc-item-clojure-zippers-en-other-uses">Other Uses</a></li>
      <li><a href="#third-party-libraries" id="toc-item-clojure-zippers-en-third-party-libraries">Third-party Libraries</a></li>
      <li><a href="#summary" id="toc-item-clojure-zippers-en-summary">Summary</a></li>
    </ul>
  </li>
</ul>

<h2 id="part-1-the-basics-of-navigation">Part 1. The Basics of Navigation</h2>

<p><em>In this article, we will discuss zippers in the Clojure language. These are an unusual way
to work with collections. Using a zipper, you can traverse a data structure arbitrarily and modify its content as well as search in it. A zipper is a powerful abstraction that pays off over time. However, it is not as straightforward as regular tools and requires training to deal with.</em></p>

<p>Let’s talk about a zipper in simple terms. It is a wrapper that offers a variety of data manipulations. Let’s list the main ones:</p>

<ul>
  <li>moving vertically: down to children or up to a parent;</li>
  <li>moving horizontally: left or right among children;</li>
  <li>traversal of the entire data structure;</li>
  <li>adding, editing and deleting nodes.</li>
</ul>


                    <p><a href="/en/clojure-zippers/">Read more &rarr;</a></p>
                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/read-34/">Ссылки на выходные (выпуск 34)</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2021-05-07T00:00:00+00:00">
        May 7, 2021
    </time>

    <a href="/tag/read/" rel="tag">read</a>, <a href="/tag/life/" rel="tag">life</a>

</div>


            <div class="entry">
                
                    
<p>Советую посвятить выходные новому изданию <a href="https://kinzhal.media/">“Кинжал”</a>. Ребята пишут
небольшие заметки о работе и жизни. Получается супер. Каждая заметка — острая и
хлесткая, как настоящий кинжал. Никакой воды, только по сути. Эти вещи вы читали
у других и у меня, но в “Кинжале” написано лучше.</p>

<p>То, что зацепило:</p>

<ul>
  <li>
    <p><a href="https://kinzhal.media/why-so-efficient/">Зачем тебе быть эффективным?</a></p>
  </li>
  <li>
    <p><a href="https://kinzhal.media/ne-prodal/">Продаёте себя на собеседовании? Не надо</a></p>
  </li>
  <li>
    <p><a href="https://kinzhal.media/insta-fake/">Почти всё, что вам показывают в Инстаграме, — ложь</a></p>
  </li>
  <li>
    <p><a href="https://kinzhal.media/nezhno/">К себе нежно</a></p>
  </li>
  <li>
    <p><a href="https://kinzhal.media/just-say-no/">Как нормально отказать боссу</a></p>
  </li>
  <li>
    <p><a href="https://kinzhal.media/sovmestil/">Почему сложно совмещать работу и хобби</a></p>
  </li>
  <li>
    <p><a href="https://kinzhal.media/read-less/">Как эффективно читать книги</a></p>
  </li>
</ul>

<p>И так далее, на сайте еще.</p>

<p>А вот Максим Ильяхов (он там редачит) <a href="http://maximilyahov.ru/blog/all/le-kinzhal/">рассказывает об издании</a>.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/en/clj-book-config/">Configuration in Clojure</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2021-05-06T00:00:00+00:00">
        May 6, 2021
    </time>

    <a href="/tag/clojure/" rel="tag">clojure</a>, <a href="/tag/book/" rel="tag">book</a>, <a href="/tag/programming/" rel="tag">programming</a>, <a href="/tag/configuration/" rel="tag">configuration</a>

</div>


            <div class="entry">
                
                    <p><strong>Clojure in Production</strong></p>

<ul>
  <li>Chapter 1. Web development</li>
  <li>Chapter 2. Clojure.spec</li>
  <li><a href="/en/clj-book-exceptions/">Chapter 3. Exceptions</a></li>
  <li>Chapter 4. Mutability</li>
  <li><a href="/en/clj-book-config/">Chapter 5. Configuration</a></li>
  <li><a href="/en/clj-book-systems/">Chapter 6. Systems in Clojure</a></li>
  <li>Chapter 7. Tests</li>
</ul>

<h2>

    In This Chapter

</h2>

<ul id="toc-item-clj-book-exceptions-en">
  <li><a href="#configuration" id="toc-item-clj-book-exceptions-en-configuration">Configuration</a>    <ul>
      <li><a href="#formulation-of-the-problem" id="toc-item-clj-book-exceptions-en-formulation-of-the-problem">Formulation of the Problem</a></li>
      <li><a href="#semantics" id="toc-item-clj-book-exceptions-en-semantics">Semantics</a></li>
      <li><a href="#configuration-cycle" id="toc-item-clj-book-exceptions-en-configuration-cycle">Configuration Cycle</a></li>
      <li><a href="#config-errors" id="toc-item-clj-book-exceptions-en-config-errors">Config Errors</a></li>
      <li><a href="#configuration-loader" id="toc-item-clj-book-exceptions-en-configuration-loader">Configuration Loader</a>        <ul>
          <li><a href="#improvements" id="toc-item-clj-book-exceptions-en-improvements">Improvements</a></li>
        </ul>
      </li>
      <li><a href="#more-on-environment-variables" id="toc-item-clj-book-exceptions-en-more-on-environment-variables">More on Environment Variables</a>        <ul>
          <li><a href="#local-and-global-variables" id="toc-item-clj-book-exceptions-en-local-and-global-variables">Local and Global Variables</a></li>
        </ul>
      </li>
      <li><a href="#config-in-the-environment" id="toc-item-clj-book-exceptions-en-config-in-the-environment">Config in the Environment</a></li>
      <li><a href="#disadvantages-of-the-environment" id="toc-item-clj-book-exceptions-en-disadvantages-of-the-environment">Disadvantages of the Environment</a>        <ul>
          <li><a href="#env-files" id="toc-item-clj-book-exceptions-en-env-files">Env Files</a></li>
        </ul>
      </li>
      <li><a href="#environment-variables-in-clojure" id="toc-item-clj-book-exceptions-en-environment-variables-in-clojure">Environment Variables in Clojure</a>        <ul>
          <li><a href="#extra-keys-problem" id="toc-item-clj-book-exceptions-en-extra-keys-problem">Extra Keys Problem</a></li>
          <li><a href="#environment-loader" id="toc-item-clj-book-exceptions-en-environment-loader">Environment Loader</a></li>
          <li><a href="#inference-of-structure" id="toc-item-clj-book-exceptions-en-inference-of-structure">Inference of Structure</a></li>
        </ul>
      </li>
      <li><a href="#simple-configuration-manager" id="toc-item-clj-book-exceptions-en-simple-configuration-manager">Simple configuration manager</a></li>
      <li><a href="#reading-the-environment-from-config" id="toc-item-clj-book-exceptions-en-reading-the-environment-from-config">Reading the Environment from Config</a></li>
      <li><a href="#overview-of-formats" id="toc-item-clj-book-exceptions-en-overview-of-formats">Overview of Formats</a>        <ul>
          <li><a href="#json" id="toc-item-clj-book-exceptions-en-json">JSON</a></li>
          <li><a href="#yaml" id="toc-item-clj-book-exceptions-en-yaml">YAML</a></li>
          <li><a href="#edn" id="toc-item-clj-book-exceptions-en-edn">EDN</a></li>
        </ul>
      </li>
      <li><a href="#industrial-solutions" id="toc-item-clj-book-exceptions-en-industrial-solutions">Industrial Solutions</a>        <ul>
          <li><a href="#cprop" id="toc-item-clj-book-exceptions-en-cprop">Cprop</a></li>
          <li><a href="#aero" id="toc-item-clj-book-exceptions-en-aero">Aero</a></li>
          <li><a href="#yummy" id="toc-item-clj-book-exceptions-en-yummy">Yummy</a></li>
        </ul>
      </li>
      <li><a href="#summary" id="toc-item-clj-book-exceptions-en-summary">Summary</a></li>
    </ul>
  </li>
</ul>

<h1 id="configuration">Configuration</h1>

<p><em>In this chapter, we will discuss how to make a Clojure project easy to configure. We’ll take a look at the basics of config: file formats, environment variables, libraries, and their pros and cons.</em></p>

<h2 id="formulation-of-the-problem">Formulation of the Problem</h2>

<p>In materials on Clojure, there are such examples:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">def</span><span class="w"> </span><span class="n">server</span><span class="w">
  </span><span class="p">(</span><span class="nf">jetty/run-jetty</span><span class="w"> </span><span class="n">app</span><span class="w"> </span><span class="p">{</span><span class="no">:port</span><span class="w"> </span><span class="mi">8080</span><span class="p">}))</span><span class="w">

</span><span class="p">(</span><span class="k">def</span><span class="w"> </span><span class="n">db</span><span class="w"> </span><span class="p">{</span><span class="no">:dbtype</span><span class="w">   </span><span class="s">"postgres"</span><span class="w">
         </span><span class="no">:dbname</span><span class="w">   </span><span class="s">"test"</span><span class="w">
         </span><span class="no">:user</span><span class="w">     </span><span class="s">"ivan"</span><span class="w">
         </span><span class="no">:password</span><span class="w"> </span><span class="s">"test"</span><span class="p">})</span><span class="w">
</span></code></pre></div></div>

<p>These are the server on port 8080 and the parameters for connecting to the database. The examples are useful because you can execute them in the REPL and check their result: open a page in a browser or perform a SQL query.</p>

<p>In practice, we should write code so that it does not carry concrete numbers and strings. Explicitly setting a port number to a server is considered bad practice. That is fine for documentation and examples, but not for the production launch.</p>

<p>Port 8080 and other combinations of zeros and eights are popular with programmers. There is a good chance that the port is occupied by another server. This happens when instead of running one service, you start a bunch of them at once during development or testing.</p>

<p>The code written by a programmer goes through several stages. These stages may differ between companies, but in general, they are development, testing, staging/pre-production, and production.</p>

<p>At each stage, the application runs alongside other projects. The assumption that port 8080 is free anytime is fanciful. In developer slang, the situation is called “hardcode” or “nailed down.” If there are nailed-down values in the code, they introduce problems into its life cycle. You cannot run two projects in parallel which declare port 8080 in their code.</p>

<p>The application does not need to know the server port – information about this comes from the outside. In a simple case, this source is the config file. The program reads the port from it and starts the server exactly as it needs to do on a specific machine.</p>

<p>In more complex scenarios, the file is not compiled by a person but a special program – a configuration manager. The manager stores information about network topology, machine addresses, and database access parameters. On request, it generate a config file for a specific machine or network segment.</p>

<p>The process of passing parameters to an application and accepting them is called configuration. This step in software development deserves close attention. When it is done well, the project easily goes through all the stages of production.</p>


                    <p><a href="/en/clj-book-config/">Read more &rarr;</a></p>
                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/snatch/">Можно ударить по голове</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2021-05-04T00:00:00+00:00">
        May 4, 2021
    </time>

    <a href="/tag/life/" rel="tag">life</a>, <a href="/tag/movies/" rel="tag">movies</a>

</div>


            <div class="entry">
                
                    <p>Недавно я употребил в блоге фразу: если не выстрелит, ей можно ударить по голове
(речь о <a href="/clj-2nd-edition/">втором издании книги</a>). Это отсылка к фильму Snatch,
в русском переводе “Большой куш”. Вспомнил, как мы с приятелем будучи
подростками смотрели гоблинский перевод и ржали над матами. А ещё вспомнил, что
даже тогда заметил одну деталь, связанную с этой фразой.</p>

<p>Напомню, её несколько раз произносит торговец оружием Борис. Он толкает
покупателям откровенный хлам. Покупатель взвешивает оружие и замечает — что-то
тяжеловато. На что Борис отвечает: тяжесть — это надёжность. Если не выстрелит,
им можно ударить по голове.</p>

<p><img src="/assets/static/aws/snatch/boris.png" /></p>

<p>Фраза звучит несколько раз, и очевидно, в какой-то момент она должна
сыграть. Поскольку мы в комедии, нелепый тезис должен сработать при нелепых
обстоятельствах. Другими словами, повторяя некую фразу, режиссер подводит
зрителя к ситуации. И тут нас ждёт разочарование — в случае “не выстрелит”
режиссер не уделил шутке внимания.</p>

<p><img src="/assets/static/aws/snatch/tommy.png" /></p>

<p>Томми, партнер главного героя, покупает нерабочий пистолет. Позже он испытывает
его из окна машины, и оружие дает осечку. Но в момент, когда Турецкого готовы
убить, Томми наставляет пистолет на бандитов и тем спасает Турецкого. Таким
образом выполняется только первая часть шутки — не выстрелит.</p>

<p><img src="/assets/static/aws/snatch/aiming.png" /></p>

<p>Ещё подростком я понял, что надо было обыграть фразу по-другому. Во-первых,
когда Турецкий предлагает выстрелить из машины, Томми должен был
отказаться. Якобы потому, что Борис — надёжный продавец как и его товар, поэтому
сомневаться нет смысла. На самом деле Томми боится оружия, и это только бы
усилило ожидание шутки.</p>

<p>Когда на Турецкого нападают бандиты, один из них душит его. Томми пытается
выстрелить, но пистолет не работает. В глазах Турецкого ужас — пропала последняя
надежда, ведь на физические способности Томми рассчитывать не приходится. Томми
мечется, его взгляд падает на нерабочий пистолет. Он вспоминает напутствие
продавца, берет пистолет за ствол и бьет бандита по голове. Тот сползает с
Турецкого. Оба героя переводят дух, молча смотрят на оружие и кивают. В их
глазах проскальзывает “действительно, им можно ударить по голове”.</p>

<p>Так сбывается нелепое пророчество. В этом варианте раскрыты обе части шутки, и
согласитесь, это было бы смешнее (в рамках криминальной комедии). Конечно, на
словах звучит слегка коряво, но режиссёр на то и нужен, чтобы всё это обыграть
камерой, мимикой, диалогами.</p>

<p>Морали нет, просто наблюдение. Уже давно замечаю за собой, что после фильма
обдумываю отдельные сцены, чтобы найти более удачные повороты сюжета, диалоги
или черты персонажей. Эта заметка — попытка зафиксировать одну из таких идей.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/key-remap/">Переназначение клавиш на Маке</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2021-04-24T00:00:00+00:00">
        Apr 24, 2021
    </time>

    <a href="/tag/life/" rel="tag">life</a>, <a href="/tag/keyboard/" rel="tag">keyboard</a>, <a href="/tag/mac/" rel="tag">mac</a>

</div>


            <div class="entry">
                
                    <p>В этой статье я бы хотел поговорить об изменении клавиш на клавиатуре. Сперва
это была короткая заметка, но со временем текст вырос во что-то
большее. Оказалось, есть что сказать по теме.</p>

<p>Вообще, я не стремлюсь менять клавиши и затачивать программы под
себя. Разработчики предлагают удобные схемы, и в целом удобно, когда вы
работаете на стандартных настройках. Всё же, годы за клавиатурой подталкивают к
некоторым изменениям.</p>

<p>Главный довод в пользу изменения клавиш — физиология. У людей разная форма
кистей и длина пальцев. Невозможно выпустить клавиатуру, которая подошла бы всем
людям. Именно физиология и чуткое внимание к ощущениям подсказывают, что менять
что-то нужно, иначе — боль в суставах.</p>

<p>Одно время я увлекался эргономичными клавиатурами, но быстро разочаровался в
них. За огромные деньги мы получим поделие Франкенштейна: огромных размеров,
тяжелое, неудобное. Такая клавиатура полностью меняет рабочее пространство,
заставляет кое-что купить в довесок. Её не возьмешь в командировку или на дачу,
словом — нет.</p>

<p>Типичные пациенты:</p>

<p><img src="/assets/static/aws/remapping/ergo1.jpg" /></p>

<p><img src="/assets/static/aws/remapping/ergo2.jpg" /></p>

<p><img src="/assets/static/aws/remapping/ergo3.jpg" /></p>

<p>На последней картинке – Microsoft Sculpt. Я пользовался ей полгода, но страшно
заболела левая рука.</p>


                    <p><a href="/key-remap/">Read more &rarr;</a></p>
                
            </div>

        </li>
        
    </ul>

    <h4>
        
        <a href="/page31" class="previous">&larr;</a>
        
        <span class="page_number ">Страница 32 из 84</span>
        
        <a href="/page33" class="next">&rarr;</a>
        
    </h4>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>Ivan Grishaev's blog</li>
          <li><a href="mailto:ivan@grishaev.me">ivan@grishaev.me</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
            <li><a href="https://github.com/igrishaev">GitHub</a></li>
            <li><a href="https://t.me/igrishaev_blog">Telegram</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>Writing on programming, education, books and negotiations.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
