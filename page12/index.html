<!DOCTYPE html>
<html lang="ru">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Ivan Grishaev's blog</title>
  <meta name="description" content="Writing on programming, education, books and negotiations.
">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/custom.css">
  <link rel="canonical" href="https://grishaev.me/page12/">
  <link rel="alternate" type="application/rss+xml" title="Ivan Grishaev's blog" href="https://grishaev.me/feed.xml">

  <link rel="shortcut icon" type="image/x-icon" href="/assets/static/favicons/favicon.ico">

  <script type="text/javascript" src="/assets/typo.js"></script>

</head>


  <body>
    <header class="site-header">

    <div class="wrapper flex-container">

        <div>
            <a href="/">
                <img id="avatar" src="/assets/static/avatar.jpg" alt="Ivan Grishaev">
            </a>
        </div>

        <div class="flex-container-vert" style="margin-left: 15px; width: 80%">

            <div class="flex-container full-width">
                <p style="margin-bottom: 5px"><a href="/">Ivan Grishaev's blog</a></p>
                <div class="flex-huge"></div>
                <div >
<form id="search-form"
      target="_blank"
      style="display: inline"
      method="get"
      action="https://www.google.com/search">

    <input name="sitesearch"
           value="grishaev.me"
           type="hidden">

    <input type="text"
           required="required"
           name="q"
           placeholder="Google search..."
           autocomplete="off">

    <button style="border: none; background-color: transparent; cursor: pointer;"
            type="submit">&#x1f50d;</button>

</form>
</div>
            </div>

            <p><small>Writing on programming, education, books and negotiations.
</small></p>

            <div class="flex-container">
                <a class="menu-item" href="/">Home</a>
                <a class="menu-item" href="/about/">About</a>
                <a class="menu-item" href="/open-source/">Open Source</a>
                <a class="menu-item" href="/bookshelf/">Bookshelf</a>
                <a class="menu-item" href="/feed.xml">RSS</a>
            </div>

            <div class="flex-container">
                <a class="menu-item minor" href="/tag/clojure/">Clojure</a>
                <a class="menu-item minor" href="/tag/emacs/">Emacs</a>
                <a class="menu-item minor" href="/tag/python/">Python</a>
                <a class="menu-item minor" href="/tag/programming/">Programming</a>
                <a class="menu-item minor" href="/interview/">Interview</a>
                <a class="menu-item minor" href="/video/">Video</a>
            </div>

            <div class="flex-container">
                <a class="menu-item minor hl" href="/clojure-in-prod/">Книга «Clojure на производстве»</a>
            </div>

            <div class="flex-container">
                <a class="menu-item minor hl" href="/clojure-in-prod-2/">Книга «Clojure на производстве», второй том</a>
            </div>

        </div>
    </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="home">

    <ul class="post-list">
        
        <li>

            <h2>
                <a class="post-link" href="/the-fuck/">The Fuck</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2025-01-24T00:00:00+00:00">
        Jan 24, 2025
    </time>

    <a href="/tag/programming/" rel="tag">programming</a>, <a href="/tag/python/" rel="tag">python</a>, <a href="/tag/fuck/" rel="tag">fuck</a>

</div>


            <div class="entry">
                
                    
<p>Может быть, вы не знали, но есть программа с выразительным названием <a href="https://github.com/nvbn/thefuck">The
Fuck</a>. Написана на Питоне, 90 тысяч звезд, работает следующим образом.</p>

<p>Предположим, вы запустили что-то в терминале, но получили ошибку. Не указан
такой-то флаг, это депрекейтед, то-се. Если ввести <code class="language-plaintext highlighter-rouge">fuck</code>, то программа считает
предыдущую команду и повторит ее, но на этот раз правильно.</p>

<p>Звучит непонятно, так что рассмотрим пример. Скажем, я сделал новую ветку и хочу
запушить ее на сервер:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git checkout -b ssl-no-validation
git add .
git commit -m "some changes"
git push
</code></pre></div></div>

<p>Вот что я получу:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>fatal: The current branch ssl-no-validation has no upstream branch.
To push the current branch and set the remote as upstream, use

    git push --set-upstream origin ssl-no-validation
</code></pre></div></div>

<p>Гит прекрасно понял, что я имел в виду, но предлагает ввести команду
повторно. Если же ввести <code class="language-plaintext highlighter-rouge">fuck</code>, то утилита считает bash_history и выполнит то,
что нравится Гиту.</p>

<p>В последнем Гите это починили: теперь <code class="language-plaintext highlighter-rouge">git push</code> делает апстрим
самостоятельно. Однако долгое время меня выручал fuck.</p>

<p>Сегодня я им не пользуюсь, но вспомнил вот почему. Программа хорошо расширяется
регулярками, и народ собрал целую кладезь fuck-рецептов. Получилась своего рода
энциклопедия бредовых случаев. Мне кажется, они достойны изучения просто затем,
чтобы знать, как делать не надо. Если же ваша программа оказалась среди рецептов
– это нужно быстро исправить.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/postgres-csv/">Постгрес и отчеты</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2025-01-24T00:00:00+00:00">
        Jan 24, 2025
    </time>

    <a href="/tag/postgres/" rel="tag">postgres</a>, <a href="/tag/sql/" rel="tag">sql</a>, <a href="/tag/csv/" rel="tag">csv</a>

</div>


            <div class="entry">
                
                    <p>В очередной раз выручил Постгрес.</p>

<p>По работе я много занимаюсь отчетностью: генерю CSV и эксельки со всякими
цифрами. Дело это не хитрое, но много нюансов: нужно собрать данные из десяти
источников, очистить, переколбасить, построить прямые и обратные индексы. В
идеале распараллелить. Потом пробежаться по коллекциям и записать итоговый
документ.</p>

<p>Поскольку дело происходит в лямбде, я очень стеснен в ресурсах и
времени. Процессор медленный, памяти и диска немного, а на выполнение дается не
более 15 минут. Это только кажется много, а на самом деле первые 7 минут уходят
только на то, чтобы скачать архивы.</p>

<p>Из последнего: в папке S3 лежит огромный CSV на 10 миллионов записей. Нужно
выбрать из него одно подмножество, затем второе, а потом склеить их по id =
parent_id.</p>

<p>Написал на Кложе черновик — работает, занимает 11 минут. Можно плюнуть и
оставить, но 11 минут — это уже близко к 15 минутам, а значит, можно получить
таймаут. Переписал с параллельной обработкой — стало 5 минут, волноваться не о
чем.</p>

<p>А потом смотрю и думаю: ты же, дурачок, написал ровно то, что делает база
данных. Только раз в десять медленней и костыльней. Убери быдлокод, загони CSV в
базу и выполни запрос — получишь то же самое.</p>

<p>Так и сделал: получаю из Амазона стрим с CSV-содержимым. Не скачивая его на
диск, направляю прямиком в Постгрес во временную таблицу (апишка COPY FROM
STDIN). Тот загружает 10 миллионов записей за 40 секунд. Потом посылаю SQL с
двумя подзапросами и джоином — результат готов за 15 секунд. Его даже не нужно
писать в CSV самому. Вызываешь COPY TO STDOUT — и Постгрес сам записывает CSV на
диск. Точнее, в стрим, который я направляю в файл.</p>

<p>Минус два экрана быдлокода, быстрее почти на порядок — все довольны, все
смеются. Сразу после этой доработки мне написал один человек — мол, репорт
хороший, только надо еще одну табличку заджойнить. Да не вопрос.</p>

<p>Отсюда мораль — если что-то можно поручить базе, поручайте базе. Постгрес уже 20
лет делает джоины и проекции таблиц. Вероятность того, что вы сделаете быстрее,
стремится к нулю.</p>

<p>Ради интереса глянул на SQLite — зачем брать серверный Постгрес, если можно
локально справиться? Оказалось, SQLite не умеет импортировать CSV. Такая команда
есть в интерактивном шелле, а в протоколе обмена — нет. А в Постгресе есть
потоковый COPY, поэтому выбора не остается.</p>

<p>Есть у нас сервис, который пилят другие люди. Там логика крутится вокруг CSV и
пакетного импорта в другие сервисы. Посмотрел и ужаснулся: километры кложурного
быдлокода можно заменить импортом в базу и парой-тройкой запросов. Дай бог
доберусь, переделаю.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/lol-1c/">Код на русском</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2025-01-24T00:00:00+00:00">
        Jan 24, 2025
    </time>

    <a href="/tag/1c/" rel="tag">1c</a>, <a href="/tag/life/" rel="tag">life</a>

</div>


            <div class="entry">
                
                    <p>Я как-то рассказывал про феномен: показываешь человеку код на Лиспе, и он
начинает хихикать, хрюкать, постить смайлики, словом, теряет всякое
лицо. Примерно как школьник, принесший в класс эротический журнал.</p>

<p>Заметил, что такая же ерунда с кодом на 1С. Если где-то всплывет код на русском,
начинаются крики, эмоции… ужасно.</p>

<p><img src="/assets/static/aws/lol-1c/1.jpeg" /></p>

<p>Я писал на 1С три с половиной года в Чите, в славном Энергосбыте. У нас были две
жирные программы: одна на Дельфях, вторая на 1С. Я поддеживал обе, и до сих пор
нежно люблю эти платформы.</p>

<p>Так вот, торжественно заявляю: код на русском поддерживается точно так же, как и
на английском. Разницы нет. Когда читаешь код, то воспринимаешь его как
структурированный набор команд. Никто не читает по буквам
“Если…То… Конец”. Глаз выделяет структуру, операторы, циклы, словом, все как
в обычном языке.</p>

<p>Да, у 1С свои проблемы. Во-первых, язык не отличается врожденной красотой, а
во-вторых, у 1С радикально низкий порог входа. Хотя то же самое можно сказать о
раннем PHP. Еще одна косвенная проблема – 1С стоит особняком от других
технологий, и в результате типичный 1С-программист ничего не знает о протоколах,
безопасности и алгоритмах.</p>

<p>Эти проблемы я признаю и готов обсуждать. Но когда очередной клоун смеется над
кодом с русскими буквами, боюсь, он получит только мое презрение.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/grumping/">Дети в телефонах</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2025-01-24T00:00:00+00:00">
        Jan 24, 2025
    </time>

    <a href="/tag/life/" rel="tag">life</a>, <a href="/tag/phones/" rel="tag">phones</a>

</div>


            <div class="entry">
                
                    <p>Разговаривал с пожилым человеком, и он выдал следующую мысль. Цитирую
максимально близко.</p>

<blockquote>
  <p>Мы, старики, часто бухтим, что дети сидят в телефонах. А разве пожилые люди
чем-то лучше? Еду в поезде — книги нет ни у кого, все от мала до велика в
телефонах и планшетах. Даже старики, которых в свое время приучали читать. На
работе у нас пять чатов в Вацапе: младшая группа, старшая, родители, педсовет,
бухгалтерия. И все туда пишут, отвечают, спорят. Постят картинки а-ля “с
добрым утром”. Набрасывают политические новости, уже на втором сообщении
переходят на личности. Бывает, три человека стоят в метре друг от друга и
пишут в один чат. Чем они отличаются от детей, которых мы ругаем? Если сами не
можем себя контролировать и каждую минуту открываем телефон, то что требовать
от детей? Они повторяют за нами.</p>
</blockquote>

<p>И я подумал: эту мысль стоит разместить здесь.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/get-money/">Получить деньги</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2025-01-24T00:00:00+00:00">
        Jan 24, 2025
    </time>

    <a href="/tag/life/" rel="tag">life</a>, <a href="/tag/money/" rel="tag">money</a>

</div>


            <div class="entry">
                
                    <p>Если вы работаете вне штата (контрактор, ИП, самозанятый), то получить даньги с
закачика — ваша работа. Получение денег может быть трудным и долгим, и обычно о
нем не говорят. Но чем раньше вы примите тезис из первого предложения, тем
скорее на вас снизойдет благодать.</p>

<p>Когда вы работаете в штате, волноваться не о чем: зарплата сама падает на
карточку. Даже до карт выдача зарплаты была регламентирована. В назначенный день
бухгалтер вызывает в кабинет и дает деньги под роспись. Все строго, пропускать
нельзя.</p>

<p>Некоторые думают, что у ИП и контракторов то же самое: поработал — получил
деньги. Это не так: сотрудник должен заполнить часы, посчитать зарплату,
выпустить квитанцию и отправить ее нужным людям. Потом ждать и пинать тех, кто
отправляет деньги. Потом пройти валютный контроль в банке: предоставить
документы, контракт, квитанцию, в сотый раз доказать, что все законно. Если
затупить на любом этапе, деньги не придут, и заказчик лишь пожмет плечами: сам
виноват.</p>

<p>Штатные сотрудники полагают, что бухгалтер переводит им зарплату по доброте
душевной. На самом деле бухгалтер делает это из страха перед государством. Дело
вот в чем: с каждой зарплаты фирма платит налог. В России мало об этом думают,
потому что получают зарплату уже после вычета налогов. Но если кому-то не
выплатили зарплату, то и налог с нее тоже не заплатили. Если государство узнает,
что Иванову удержали зарплату, оно накажет фирму — но не за то, что Иванову
нечего есть, а за то, что не уплачен налог.</p>

<p>Получается, что у штатного работника есть “крыша” в виде государства, которая,
разумеется, оказывает свои услуги за ренту. А поскольку ИП платит налоги
по-другому, то волноваться о том, получил он деньги или нет, не нужно. Точнее,
нужно, но в другом ключе: от кого и за какие услуги.</p>

<p>Поэтому напоминаю тем, кто выходит со штатной работы на удаленку: выбивание
денег ложится на ваши плечи. Лучше сразу принять это как данность, чем потом
обвинять всех вокруг.</p>

<p>Понимаю, что заметка немного опоздала из-за, как сейчас пишут, “изменившегося
контекста”. Этот “контекст” нынче такой, что удаленщики возвращаются в штат. Но
лучше поздно, чем никогда. А чтобы заметка не выглядела сухой, расскажу кулстори
о том, как выколачивал деньги.</p>

<p>Все началось хорошо: американский стартап с командой в Европе. Технический
руководитель очень компетентный, полное понимание. Проходит месяц, жду
зарплату. А девушка бухгалтер говорит: не могу отправить платеж, система не
позволяет, то-се. Период оплаты прошел, программа закрыла бюджет, теперь в
следующий раз.</p>

<p>Проходит месяц, девушка выходит замуж и улетает в свадебное
путешествие. Программа автоматом рассылает деньги всем, кроме меня. Жду.</p>

<p>Девушка прилетает через пять недель, раскачивается еще неделю. Договариваемся на
звонок. Разница 12 часов, она шарит экран, я подсказываю, куда какие реквизиты
вводить. Вроде бы норм, деньги должны уйти, но в назначенный день не
уходят. Девушка звонит в свой банк, ей объясняют, как правильно заполнить форму.</p>

<p>Чтобы не томить — на пятый раз деньги ушли и потом приходили стабильно. Но вот
курьез: мне не выплатили четыре зарплаты и делают вид, что все хорошо. Начинаю
осторожные переговоры: мол, заплатите мне эти деньги тоже. А мне говорят: ты не
волнуйся. Когда будешь увольняться, мы тебе все разом выплатим. Нет, говорю,
лучше добавляйте к каждой зарплате бонус, пока не закроем прошлые выплаты. Они
очень неохотно, но согласились.</p>

<p>Возникли вопросы у налоговой: в контракте указано N тысяч фантиков, а приходит
на четверть больше. Как так? Пришлось выставлять квитанции якобы за переработки
и допуслуги.</p>

<p>Но дело шло: мало-помалу долг закрывался. Вот и первую зарплату погасили,
вторую, третью… а потом случилась банальная для стартапа история. Не прошли
очередной раунд ивестиций — и все, денег нет. Собрали звонок и говорят: мы не
будем возражать, если найдете другую работу. Можете работать на нас, но без
каких-либо гарантий выплат.</p>

<p>Я пишу, что за вами осталась одна непогашенная зарплата, на что отвечают —
держись, денег нет. Я решил, что ничего не поделать и был рад хотя бы тому, что
выбил три зарплаты — ведь если бы ничего не делал, то попал бы на все четыре. Но
неожиданно за меня вступился технический руководитель, и последнюю зарплату
все-таки выплатили. Буквально за день или два до того, как банк перестал
принимать платежи из-за границы.</p>

<p>Увы, не все были столь удачливы. Одному коллеге были должны пять зарплат, но за
него никто вступился. Он долго переписывался с финальным боссом, а когда
упомянул про суд, получил примерно такой ответ: делай визу, прилетай в
Калифорнию, нанимай юриста и мы с тобой с радостью посудимся.</p>

<p>Нет смысла повторять тезисы из начала статьи, надеюсь, они понятны. Добавлю, что
о ваших деньгах никто лучше вас не позаботится — вот такая простая мысль.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/telegram-markup/">Разметка в Телеграме</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2025-01-20T00:00:00+00:00">
        Jan 20, 2025
    </time>

    <a href="/tag/telegram/" rel="tag">telegram</a>, <a href="/tag/ui/" rel="tag">ui</a>

</div>


            <div class="entry">
                
                    <p>Наверняка вы замечали баг в Телеграме. Написал сообщение, поправил разметку, а
она поехала (см. картинку). Выделил болдом одно, а оказалось помечено другое. То
же самое с моноширинным текстом. Ну а самая печаль — разметка кода. Иногда так
плывет, что проще удалить сообщение и разместить по-новой.</p>

<p><img src="/assets/static/aws/telegram-markup/1.jpeg" /></p>

<p>Дело в том, как передается разметка в Телеграме. Многие полагают, что в нем
маркдаун, но на самом деле это не так. Телеграм может принимать маркдаун от
ботов, но разметка приводится ко внутреннему виду, примерно такому:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{:message "Welcome back, Ivan Grishaev!",
 :entities
 [{:type :text_mention,
   :offset 14,
   :length 13,
   :user {:id 100500 :nickname "igrishaev"}}]}
</code></pre></div></div>

<p>Смысл в том, что есть сообщение и набор размеченных зон. Каждая зона знает
смещение в символах и длину (поля offset и length). У зоны есть тип и
дополнительные параметры, которые влияют на рендер. В примере выше слова “Ivan
Grishaev” будут выглядеть как ссылка на пользователя с нужными атрибутами.</p>

<p>У этой системы следствие: если поправить текст, смещения зон должны быть
скорректированы. Например, я поменял Welcome back на просто Welcome. Пропали
пять символов, и смещения всех зон должны уменьшится на 5. На простых случаях
это работает, но когда зон много (болды, италики и прочее), что-то идет не
так. Возможно, виноват многострочный код: он как-то оптимизируется, а смещения
зон не принимают его во внимание.</p>

<p>Если бы в Телеграме была система тегов вроде markdown или xml/html, такой
проблемы бы не было. Братьям Дуровым, конечно, виднее, но я тоже могу
высказаться.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/prop-more/">Еще о пропаганде</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2025-01-20T00:00:00+00:00">
        Jan 20, 2025
    </time>

    <a href="/tag/life/" rel="tag">life</a>, <a href="/tag/propaganda/" rel="tag">propaganda</a>

</div>


            <div class="entry">
                
                    <p>Я уже писал, как видит Россию западный человек. Для него Россия — это воплощение
повести 1984. На каждом углу висит телевизор, из каждого утюга призывают брать
Берлин.</p>

<p>При этом условного американца не смущает, что владелец Твиттера — первой в мире
площадке обмена мнениями — открыто топит за своего кандидата и подкручивает
алгоритм ленты.</p>

<p>Никого не смущают признания Цукерберга насчет ковидной истерии. Согласно им,
любой анти-ковидный контент опускался в выдаче настолько, что его нельзя было
найти.</p>

<p>Фактически это значит следующее. Если у человека нет долгой истории предпочтений
(игры, котики, гаджеты, etc), то чтение ленты — это и есть потребление
пропаганды. Но для западного человека “это другое”.</p>

<p>Попался текст, который процитирую частично:</p>

<blockquote>
  <p>Европейцы понятия не имеют о России. Российская пропаганда даже внутри страны
вызывает у значительной части населения буквально рвотные рефлексы, если не
брать во внимание психически нездоровую часть общества, крайне нуждающуюся в
ежедневной порции агрессии и ненависти. Но эта часть всегда невелика даже в
среде, которую искусственно разогревают самыми отвратительными
эмоциями. Психика - это такая штука, которая не способна постоянно находиться
в возбужденном состоянии, а пропаганда отрабатывает только один номер
последние пять лет, из которых последние три - на форсаже. Если вас каждый
день на протяжении долгого времени кормить даже самыми вкусными пельменями -
вы скоро их будете буквально ненавидеть. Что уж говорить про пельмени от
российской пропаганды…</p>
</blockquote>

<p>О чем я и говорил. Европеец считает, что россиянин после работы весь вечер
смотрит пропаганду. А на самом деле россиянин смотрит тупые шоу и сериалы. В
мессаджере у него не военкоры, а рекламное говно вроде “как унизить собеседника
одной фразой”, арбитраж крипты, микродозинг, сибирский кузнец, кующий настоящие
ножи.</p>

<p>Кое-что из личных наблюдений. Я вожу дочь в музыкальную школу и порой жду ее в
фойе. Там стоит телевизор, и был упоротый охранник, который смотрел военные
передачи: на сколько километров продвинулись, сколько убили бандеровцев, как
будем делить Украину. К нему всегда подходили родители и просили
выключить. Когда охранника наконец заменили другим, телевизор больше не
включают. Стоит для мебели.</p>

<p>Уже несколько лет хожу в тренажерный зал. Что обсуждают между подходами? Фильмы,
кроссовки, выступления знаменитых качков, телефоны, машины, бухло. Все то, что
интересует обычного мужчину (почему-то ни слова про секс и женщин). Политика
относится к той же области, что и религия: все понимают, что тема чувствительная
и стараются замять, если всплыло. Неадекватов просят помолчать.</p>

<p>Поэтому повторю тезис: кто рассуждает об ужасах чужой пропаганды, пересказывают
свою.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/java-obj-create/">Объекты в Джаве</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2025-01-20T00:00:00+00:00">
        Jan 20, 2025
    </time>

    <a href="/tag/programming/" rel="tag">programming</a>, <a href="/tag/java/" rel="tag">java</a>, <a href="/tag/oop/" rel="tag">oop</a>

</div>


            <div class="entry">
                
                    <p>Когда-то давно я знал Джаву плохо, и у меня была проблема. Я открывал Джавадок и
понимал в целом, как пользоваться объектом, но не понимал, как создать
его. Сегодня я знаю Джаву лучше, но проблема никуда не ушла.</p>

<p>Дело вот в чем: в ранней Джаве любой класс создавался конструктором, например</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Kokoko</span> <span class="n">kokoko</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Kokoko</span><span class="o">(</span><span class="s">"Ko"</span><span class="o">);</span>
</code></pre></div></div>

<p>Пришел Джошуа Блох и сказал, что это неправильно: конструктор должен быть скрыт
(или protected), а потребителям давать статичные методы, скажем <code class="language-plaintext highlighter-rouge">.parse</code>,
<code class="language-plaintext highlighter-rouge">.fromString</code>, <code class="language-plaintext highlighter-rouge">.of</code> и так далее:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Kokoko</span> <span class="n">kokoko</span> <span class="o">=</span> <span class="nc">Kokoko</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"Kokoko"</span><span class="o">)</span>
<span class="nc">Kokoko</span> <span class="n">kokoko</span> <span class="o">=</span> <span class="nc">Kokoko</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="nc">Sounds</span><span class="o">.</span><span class="na">KOKOKO</span><span class="o">)</span>
</code></pre></div></div>

<p>Беда в том, что в списке методов не видно, какой из них отвечает за создание
экземпляра. Он может быть первым в списке, двадцатым, сорок вторым. Ты должен
знать, что где-то на третьем экране есть метод <code class="language-plaintext highlighter-rouge">.parse</code>, который делает то, что
нужно.</p>

<p>Более веселые вещи: иные экземпляры нельзя создать в принципе. При запуске JVM
порождается скрытый синглтон, и статический метод .getInstance возвращает ссылку
на его. Считается, что ты прочитал все методы и понял, что нужно так:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Kokoko</span> <span class="n">kokoko</span> <span class="o">=</span> <span class="nc">Kokoko</span><span class="o">.</span><span class="na">getInstance</span><span class="o">();</span>
<span class="n">kokoko</span><span class="o">.</span><span class="na">processKokoko</span><span class="o">(</span><span class="s">"Kwish"</span><span class="o">)</span>
</code></pre></div></div>

<p>Бывает, даже когда прочитал все методы, все равно неясно, как создать
объект. Оказывается, это такой дизайн: класс можно создать только из билдера —
другого класса:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">KokoBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="nc">KokoBuilder</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">with</span><span class="o">(</span><span class="s">"Kwhish"</span><span class="o">);</span>
<span class="nc">Kokoko</span> <span class="n">kokoko</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">build</span><span class="o">();</span>
</code></pre></div></div>

<p>Еще бывают фабрики, но по-моему, это то же самое, что и билдер, только менее
замшелое. Блох пишет про билдеры, а про фабрики — ничего.</p>

<p>Бывают статичные классы—агрегаторы. На деле это пачка функций, которые строят
объекты других классов, например:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Kokoko</span> <span class="n">kokoko</span> <span class="o">=</span> <span class="nc">KokoManager</span><span class="o">.</span><span class="na">newSingleThreadKokoko</span><span class="o">(</span><span class="s">"Kwesh"</span><span class="o">);</span>
</code></pre></div></div>

<p>Обо всем этом нужно знать, брать во внимание.</p>

<p>Нам рассказывали, что с ООП наступит пони и радуга. Будем строить программы из
одинаковых блоков, все системно и предсказуемо. На деле Джавные классы — это не
блоки, а паззлы. С виду одинаковые, но каждая дырка и пупырка своей формы и
длины, и отыскать совпадение — большая удача.</p>

<p>Разнообразие в классах можно списать на долгую историю Джавы. Но сегодня нет ни
одной качественной переработки ООП, и происходит откат к привычным
“структура-функция”. Мне запомнился только Егор с его Элегантными
объектами. Книга интересная, но когда я увидел “элегантный” код, мне немножко
поплохело.</p>

<p>Я считаю две вещи. Первая: к объектам нужно переходить, только когда процедурный
подход уже не справляется. Запас прочности у него огромный, хватит на
десятилетия (см. Postgres). Вторая: над концепцией классов нужно хорошенько
подумать. На мой взгляд, она не завершена.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/harry-potter-money/">Гарри Поттер и деньги</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2025-01-20T00:00:00+00:00">
        Jan 20, 2025
    </time>

    <a href="/tag/books/" rel="tag">books</a>, <a href="/tag/harry-potter/" rel="tag">harry-potter</a>, <a href="/tag/money/" rel="tag">money</a>

</div>


            <div class="entry">
                
                    <p>Читаю дочке на ночь Гарри Поттера. Она уже читала, но со мной переспрашивает
многие моменты. Я в свое время пропустил Поттера, и теперь догоняю.</p>

<p>Среди прочего заметил вот что: в волшебной стране интересная мера
денег. Процитирую Огрида:</p>

<blockquote>
  <p>— Золотые — это галлеоны, — пояснил он. — Один галлеон — это семнадцать
серебряных сиклей, а один сикль — двадцать девять кнатов, это просто, да?</p>
</blockquote>

<p>Интересно, что оба числа — 17 и 29 — простые. Это значит, ни сикль, ни кнат
нельзя разделить поровну между участниками. Скажем, если в группе три-четыре
человека, делить 5 сиклей 11 кнатов будет, мягко говоря, трудновато.</p>

<p>У простых чисел следствие: их произведение делится только на исходные
множители. На этом основана вся криптография. Это хорошо понимали древние греки:
они выбрали число 60 в качестве меры, потому что у него много делителей. Позже
его заменило число 100, у которого делителей еще больше.</p>

<p>Система денег с простыми числами максимально неудобна для расчетов. А потому
вопрос: Джоан Роулинг выбрала их с умыслом или случайно? Понимает ли она
особенность простых чисел? Выдумала сама или кто-то подсказал?</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/avito-2025/">Авито 2025</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2025-01-20T00:00:00+00:00">
        Jan 20, 2025
    </time>

    <a href="/tag/avito/" rel="tag">avito</a>, <a href="/tag/js/" rel="tag">js</a>, <a href="/tag/ui/" rel="tag">ui</a>, <a href="/tag/idiots/" rel="tag">idiots</a>

</div>


            <div class="entry">
                
                    <p>Заметка из серии “Иван зашел на Авито”. Приходится делать это раз в год, что
поделать.</p>

<p>Ничего особо не изменилось: всюду спиннеры, спиннеры, спиннеры. По-прежнему
огромные баннеры, которые занимают до половины экрана на ноутбуке.</p>

<p>Страница Messages заработала с третьего раза, до этого что-то шло не
так. Выделяю все сообщения, жму “отметить прочитанными” — они не отмечаются. В
заголовке по-прежнему мигает колокольчик.</p>

<p>Публикую объявление, оплачиваю в Сбере. Авито не реагирует на платеж, страница
не обновляется. Перехожу в объявление, жму “Опубликовать”. Написано, что уже
опубликовано, но пока на модерации. Зачем тогда показывать кнопку
“Опубликовать”?</p>

<p>Смотрю консоль — все залито кровью. Десятки обращений к Sentry и внутреннему
трекеру. Ставлю фильтр на JS, вижу запросы к файлам:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>runtime.17ee57e8c945aab7.js
babel.56c763c5da678bfa.js
react.dfd1d111f8ede875.js
core-js.afc06ee845ff2534.js
sentry.92aa5077131b46e2.js
react-dom.b2b03dba79dd7e0e.js
react-router.70c77e8819d4a40e.js
react-router-dom.952fcbce71c8c0eb.js
main.085d7b253d7b4fc3.js
classnames.8bdb4ca7d18147c3.js
axios.531715197964b964.js
react-helmet-async.08c35d15407bd540.js
clickstream.9d25519cca31a2b9.js
desktop-header.08bc7205e5d97c1c.js
desktop-error-boundary.60b97a6749bfdf5d.js
bootstrap.a567aae79d5d83f3.js
popperjs.23534e9c89ee28ca.js
redux.812bd211f67f512a.js
desktop-navigation.e3664b256e3d71c5.js
navigation.054020057401a579.js
PhoneActualizationPopup.0710bcce593318a7.js
AuthProfileConfirmForm.61b7e0d361eaeba6.js
react-redux.8146e991e20c5797.js
profile-messenger.3520407fc648a850.js
fingerprint.ce96eef5e5724e1b.js
remoteEntry.faea46d9e2064abc.js
Auth.d430faf2d81cfc87.js
remoteEntry.6825f5efeccb47cc.js
WwwProfileMessenger.dda85a70f5fec4e4.js
</code></pre></div></div>

<p>…и другие.</p>

<p>Так и хочется сказать: молодцы, собрали всю коллекцию. Реакт, редукс, бутстрап,
роутер и всякие плагины. Наконец-то можно показать пять сообщений.</p>

<p>Повторюсь, современных фронтендеров нужно не учить, а лечить. Это какой-то
особый сорт нелюдей. Я искренне не понимаю, как можно выкладывать такое в
прод. Не понимаю, как людей не тошнит от настолько плохой работы и собственной
неэффективности. Но похоже, им это ок. Человек ко всему привыкает.</p>

<p>Современный Авито напоминает творчество Лавкрафта: открыл на миг, ужаснулся и
скорей закрыл, чтобы не вспоминать. Но преследовать будет долго.</p>

                
            </div>

        </li>
        
    </ul>

    <h4>
        
        <a href="/page11" class="previous">&larr;</a>
        
        <span class="page_number ">Страница 12 из 100</span>
        
        <a href="/page13" class="next">&rarr;</a>
        
    </h4>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>Ivan Grishaev's blog</li>
          <li><a href="mailto:ivan@grishaev.me">ivan@grishaev.me</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
            <li><a href="https://github.com/igrishaev">GitHub</a></li>
            <li><a href="https://t.me/igrishaev_blog">Telegram</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>Writing on programming, education, books and negotiations.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
