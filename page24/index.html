<!DOCTYPE html>
<html lang="ru">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Ivan Grishaev's blog</title>
  <meta name="description" content="Writing on programming, education, books and negotiations.
">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/custom.css">
  <link rel="canonical" href="https://grishaev.me/page24/">
  <link rel="alternate" type="application/rss+xml" title="Ivan Grishaev's blog" href="https://grishaev.me/feed.xml">

  <link rel="shortcut icon" type="image/x-icon" href="/assets/static/favicons/favicon.ico">

  <script type="text/javascript" src="/assets/typo.js"></script>

</head>


  <body>
    <header class="site-header">

    <div class="wrapper flex-container">

        <div>
            <a href="/">
                <img id="avatar" src="/assets/static/avatar.jpg" alt="Ivan Grishaev">
            </a>
        </div>

        <div class="flex-container-vert" style="margin-left: 15px; width: 80%">

            <div class="flex-container full-width">
                <p style="margin-bottom: 5px">Ivan Grishaev's blog</p>
                <div class="flex-huge"></div>
                <div >
<form id="search-form"
      target="_blank"
      style="display: inline"
      method="get"
      action="https://www.google.com/search">

    <input name="sitesearch"
           value="grishaev.me"
           type="hidden">

    <input type="text"
           required="required"
           name="q"
           placeholder="Google search..."
           autocomplete="off">

    <button style="border: none; background-color: transparent; cursor: pointer;"
            type="submit">&#x1f50d;</button>

</form>
</div>
            </div>

            <p><small>Writing on programming, education, books and negotiations.
</small></p>

            <div class="flex-container">
                <a class="menu-item" href="/">Home</a>
                <a class="menu-item" href="/about/">About</a>
                <a class="menu-item" href="/bookshelf/">Bookshelf</a>
                <a class="menu-item" href="/feed.xml">RSS</a>
            </div>

            <div class="flex-container">
                <a class="menu-item minor" href="/tag/clojure/">Clojure</a>
                <a class="menu-item minor" href="/tag/emacs/">Emacs</a>
                <a class="menu-item minor" href="/tag/python/">Python</a>
                <a class="menu-item minor" href="/tag/programming/">Programming</a>
                <a class="menu-item minor" href="/interview/">Interview</a>
                <a class="menu-item minor" href="/video/">Video</a>
            </div>

            <div class="flex-container">
                <a class="menu-item minor hl" href="/clojure-in-prod/">Книга «Clojure на производстве»</a>
            </div>

            <div class="flex-container">
                <a class="menu-item minor hl" href="/clojure-in-prod-2/">Книга «Clojure на производстве», второй том</a>
            </div>

        </div>
    </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="home">

    <ul class="post-list">
        
        <li>

            <h2>
                <a class="post-link" href="/en/farseer/">Introducing Farseer: the JSON RPC server, the client and utilities</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2021-06-02T00:00:00+00:00">
        Jun 2, 2021
    </time>

    <a href="/tag/clojure/" rel="tag">clojure</a>, <a href="/tag/programming/" rel="tag">programming</a>, <a href="/tag/rpc/" rel="tag">RPC</a>

</div>


            <div class="entry">
                
                    
<p><em>(This is a copy of the readme file from the repository.)</em></p>

<p><a href="https://github.com/igrishaev/farseer">Farseer</a> is a set of modules for <a href="https://en.wikipedia.org/wiki/JSON-RPC">JSON RPC</a>. It includes a
transport-independent handler, Ring HTTP handler, Jetty server, HTTP client,
local stub, documentation, and more.</p>

<h2>

    

</h2>

<ul id="toc-item-farseer-en">
  <li><a href="#what-and-why-is-json-rpc" id="toc-item-farseer-en-what-and-why-is-json-rpc">What and Why is JSON RPC?</a>    <ul>
      <li><a href="#benefits" id="toc-item-farseer-en-benefits">Benefits</a></li>
      <li><a href="#disadvantages" id="toc-item-farseer-en-disadvantages">Disadvantages</a></li>
    </ul>
  </li>
  <li><a href="#the-structure-of-this-project" id="toc-item-farseer-en-the-structure-of-this-project">The Structure of this Project</a>    <ul>
      <li><a href="#installation" id="toc-item-farseer-en-installation">Installation</a></li>
    </ul>
  </li>
  <li><a href="#rpc-handler" id="toc-item-farseer-en-rpc-handler">RPC Handler</a>    <ul>
      <li><a href="#method-handlers" id="toc-item-farseer-en-method-handlers">Method handlers</a></li>
      <li><a href="#specs" id="toc-item-farseer-en-specs">Specs</a>        <ul>
          <li><a href="#input-spec" id="toc-item-farseer-en-input-spec">Input Spec</a></li>
          <li><a href="#output-spec" id="toc-item-farseer-en-output-spec">Output Spec</a></li>
          <li><a href="#in-production" id="toc-item-farseer-en-in-production">In Production</a></li>
        </ul>
      </li>
      <li><a href="#more-on-context" id="toc-item-farseer-en-more-on-context">More on Context</a>        <ul>
          <li><a href="#static-context" id="toc-item-farseer-en-static-context">Static Context</a></li>
          <li><a href="#dynamic-context" id="toc-item-farseer-en-dynamic-context">Dynamic Context</a></li>
        </ul>
      </li>
      <li><a href="#request--response-formats" id="toc-item-farseer-en-request--response-formats">Request &amp; Response Formats</a>        <ul>
          <li><a href="#request" id="toc-item-farseer-en-request">Request</a></li>
          <li><a href="#response" id="toc-item-farseer-en-response">Response</a></li>
          <li><a href="#error-codes" id="toc-item-farseer-en-error-codes">Error Codes</a></li>
        </ul>
      </li>
      <li><a href="#notifications" id="toc-item-farseer-en-notifications">Notifications</a></li>
      <li><a href="#batch-requests" id="toc-item-farseer-en-batch-requests">Batch Requests</a>        <ul>
          <li><a href="#note-on-parallelism" id="toc-item-farseer-en-note-on-parallelism">Note on Parallelism</a></li>
          <li><a href="#configuring--limiting-batch-requests" id="toc-item-farseer-en-configuring--limiting-batch-requests">Configuring &amp; Limiting Batch Requests</a></li>
        </ul>
      </li>
      <li><a href="#errors--exceptions" id="toc-item-farseer-en-errors--exceptions">Errors &amp; Exceptions</a>        <ul>
          <li><a href="#runtime-unexpected-errors" id="toc-item-farseer-en-runtime-unexpected-errors">Runtime (Unexpected) Errors</a></li>
          <li><a href="#rpc-expected-errors" id="toc-item-farseer-en-rpc-expected-errors">RPC (Expected) Errors</a></li>
          <li><a href="#raising-exceptions" id="toc-item-farseer-en-raising-exceptions">Raising Exceptions</a></li>
        </ul>
      </li>
      <li><a href="#configuration" id="toc-item-farseer-en-configuration">Configuration</a></li>
    </ul>
  </li>
  <li><a href="#ring-http-handler" id="toc-item-farseer-en-ring-http-handler">Ring HTTP Handler</a>    <ul>
      <li><a href="#negative-responses" id="toc-item-farseer-en-negative-responses">Negative Responses</a></li>
      <li><a href="#batch-requests-in-http" id="toc-item-farseer-en-batch-requests-in-http">Batch Requests in HTTP</a></li>
      <li><a href="#configuration-1" id="toc-item-farseer-en-configuration-1">Configuration</a></li>
      <li><a href="#middleware--authorization" id="toc-item-farseer-en-middleware--authorization">Middleware &amp; Authorization</a></li>
      <li><a href="#http-context" id="toc-item-farseer-en-http-context">HTTP Context</a></li>
    </ul>
  </li>
  <li><a href="#jetty-server" id="toc-item-farseer-en-jetty-server">Jetty Server</a>    <ul>
      <li><a href="#configuration-2" id="toc-item-farseer-en-configuration-2">Configuration</a></li>
      <li><a href="#with-server-macro" id="toc-item-farseer-en-with-server-macro">With-server macro</a></li>
      <li><a href="#component" id="toc-item-farseer-en-component">Component</a></li>
    </ul>
  </li>
  <li><a href="#http-stub" id="toc-item-farseer-en-http-stub">HTTP Stub</a>    <ul>
      <li><a href="#multiple-stub" id="toc-item-farseer-en-multiple-stub">Multiple Stub</a></li>
      <li><a href="#tests" id="toc-item-farseer-en-tests">Tests</a></li>
      <li><a href="#negative-responses-1" id="toc-item-farseer-en-negative-responses-1">Negative Responses</a></li>
    </ul>
  </li>
  <li><a href="#http-client" id="toc-item-farseer-en-http-client">HTTP Client</a>    <ul>
      <li><a href="#configuration-3" id="toc-item-farseer-en-configuration-3">Configuration</a></li>
      <li><a href="#handling-responses" id="toc-item-farseer-en-handling-responses">Handling Responses</a></li>
      <li><a href="#auth" id="toc-item-farseer-en-auth">Auth</a></li>
      <li><a href="#notifications-1" id="toc-item-farseer-en-notifications-1">Notifications</a></li>
      <li><a href="#batch-requests-1" id="toc-item-farseer-en-batch-requests-1">Batch Requests</a></li>
      <li><a href="#connection-manager-pool" id="toc-item-farseer-en-connection-manager-pool">Connection Manager (Pool)</a></li>
      <li><a href="#component-1" id="toc-item-farseer-en-component-1">Component</a></li>
    </ul>
  </li>
  <li><a href="#documentation-builder" id="toc-item-farseer-en-documentation-builder">Documentation Builder</a>    <ul>
      <li><a href="#configuration-4" id="toc-item-farseer-en-configuration-4">Configuration</a></li>
      <li><a href="#building" id="toc-item-farseer-en-building">Building</a></li>
      <li><a href="#demo" id="toc-item-farseer-en-demo">Demo</a></li>
      <li><a href="#selmer--context" id="toc-item-farseer-en-selmer--context">Selmer &amp; Context</a></li>
      <li><a href="#rendering-specs" id="toc-item-farseer-en-rendering-specs">Rendering Specs</a></li>
    </ul>
  </li>
  <li><a href="#ideas--further-development" id="toc-item-farseer-en-ideas--further-development">Ideas &amp; Further Development</a></li>
</ul>

<h2 id="what-and-why-is-json-rpc">What and Why is JSON RPC?</h2>

<p>Briefly, JSON RPC is a protocol based on HTTP &amp; JSON. When calling the server,
you specify the method (procedure) name and its parameters. The parameters could
be either a map or a vector. The server returns a JSON response with the
<code class="language-plaintext highlighter-rouge">result</code> or <code class="language-plaintext highlighter-rouge">error</code> fields. For example:</p>

<p>Request:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="nl">"jsonrpc"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2.0"</span><span class="p">,</span><span class="w"> </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sum"</span><span class="p">,</span><span class="w"> </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Response:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="nl">"jsonrpc"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2.0"</span><span class="p">,</span><span class="w"> </span><span class="nl">"result"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Pay attention: the protocol depends on neither HTTP method, nor query params,
nor HTTP headers and so on. Although looking a bit primitive, this schema
eventually appears to be robust, scalable and reliable.</p>


                    <p><a href="/en/farseer/">Read more &rarr;</a></p>
                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/dry/">Сага о DRY и зависимостях</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2021-05-21T00:00:00+00:00">
        May 21, 2021
    </time>

    <a href="/tag/programming/" rel="tag">programming</a>, <a href="/tag/life/" rel="tag">life</a>, <a href="/tag/dry/" rel="tag">dry</a>

</div>


            <div class="entry">
                
                    <p>Предположим, в вашем проекте два модуля: <code class="language-plaintext highlighter-rouge">project.foo</code> и <code class="language-plaintext highlighter-rouge">project.bar</code>. В первый
из них вы добавили служебную функцию, например поиск элемента по
предикату. Через некоторое время то же самое понадобилось во втором модуле. Как
вы поступите?</p>

<p>Варианты:</p>

<ol>
  <li>Вынесу функцию в третий модуль <code class="language-plaintext highlighter-rouge">project.utils</code> и подключу его к <code class="language-plaintext highlighter-rouge">foo</code> и
<code class="language-plaintext highlighter-rouge">bar</code>.</li>
  <li>Скопирую функцию во второй модуль.</li>
</ol>

<p>Конечно, вы и так знаете, что правильный способ — первый. <a href="https://ru.wikipedia.org/wiki/Don%E2%80%99t_repeat_yourself">DRY</a> (Don’t
Repeat Yourself), не дублируй код. Держи одну точку входа, чтобы в случае ошибки
править в одном месте. Копирование — наш враг и все такое. Я тоже тоже так думал
раньше, и вот, в тридцать пять лет, поменял мнение.</p>


                    <p><a href="/dry/">Read more &rarr;</a></p>
                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/en/clojure-zippers/">Clojure Zippers</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2021-05-20T00:00:00+00:00">
        May 20, 2021
    </time>

    <a href="/tag/clojure/" rel="tag">clojure</a>, <a href="/tag/programming/" rel="tag">programming</a>, <a href="/tag/zippers/" rel="tag">zippers</a>

</div>


            <div class="entry">
                
                    
<h2>

    

</h2>

<ul id="toc-item-clojure-zippers-en">
  <li><a href="#part-1-the-basics-of-navigation" id="toc-item-clojure-zippers-en-part-1-the-basics-of-navigation">Part 1. The Basics of Navigation</a></li>
  <li><a href="#part-2-automatic-navigation" id="toc-item-clojure-zippers-en-part-2-automatic-navigation">Part 2. Automatic navigation</a></li>
  <li><a href="#part-3-xml-zippers" id="toc-item-clojure-zippers-en-part-3-xml-zippers">Part 3. XML zippers</a></li>
  <li><a href="#part-4-xml-search" id="toc-item-clojure-zippers-en-part-4-xml-search">Part 4. XML search</a></li>
  <li><a href="#part-5-editing" id="toc-item-clojure-zippers-en-part-5-editing">Part 5. Editing</a>    <ul>
      <li><a href="#multiple-change" id="toc-item-clojure-zippers-en-multiple-change">Multiple change</a></li>
      <li><a href="#prices-in-xml" id="toc-item-clojure-zippers-en-prices-in-xml">Prices in XML</a></li>
    </ul>
  </li>
  <li><a href="#part-6-virtual-trees-currency-exchange" id="toc-item-clojure-zippers-en-part-6-virtual-trees-currency-exchange">Part 6. Virtual Trees. Currency Exchange</a></li>
  <li><a href="#part-7-breadth-first-traversal-improved-currency-exchange" id="toc-item-clojure-zippers-en-part-7-breadth-first-traversal-improved-currency-exchange">Part 7. Breadth-First Traversal. Improved Currency Exchange</a></li>
  <li><a href="#part-8-summary" id="toc-item-clojure-zippers-en-part-8-summary">Part 8. Summary</a>    <ul>
      <li><a href="#html" id="toc-item-clojure-zippers-en-html">HTML</a></li>
      <li><a href="#data-and-serialization" id="toc-item-clojure-zippers-en-data-and-serialization">Data and Serialization</a></li>
      <li><a href="#other-uses" id="toc-item-clojure-zippers-en-other-uses">Other Uses</a></li>
      <li><a href="#third-party-libraries" id="toc-item-clojure-zippers-en-third-party-libraries">Third-party Libraries</a></li>
      <li><a href="#summary" id="toc-item-clojure-zippers-en-summary">Summary</a></li>
    </ul>
  </li>
</ul>

<h2 id="part-1-the-basics-of-navigation">Part 1. The Basics of Navigation</h2>

<p><em>In this article, we will discuss zippers in the Clojure language. These are an unusual way
to work with collections. Using a zipper, you can traverse a data structure arbitrarily and modify its content as well as search in it. A zipper is a powerful abstraction that pays off over time. However, it is not as straightforward as regular tools and requires training to deal with.</em></p>

<p>Let’s talk about a zipper in simple terms. It is a wrapper that offers a variety of data manipulations. Let’s list the main ones:</p>

<ul>
  <li>moving vertically: down to children or up to a parent;</li>
  <li>moving horizontally: left or right among children;</li>
  <li>traversal of the entire data structure;</li>
  <li>adding, editing and deleting nodes.</li>
</ul>


                    <p><a href="/en/clojure-zippers/">Read more &rarr;</a></p>
                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/read-34/">Ссылки на выходные (выпуск 34)</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2021-05-07T00:00:00+00:00">
        May 7, 2021
    </time>

    <a href="/tag/read/" rel="tag">read</a>, <a href="/tag/life/" rel="tag">life</a>

</div>


            <div class="entry">
                
                    
<p>Советую посвятить выходные новому изданию <a href="https://kinzhal.media/">“Кинжал”</a>. Ребята пишут
небольшие заметки о работе и жизни. Получается супер. Каждая заметка — острая и
хлесткая, как настоящий кинжал. Никакой воды, только по сути. Эти вещи вы читали
у других и у меня, но в “Кинжале” написано лучше.</p>

<p>То, что зацепило:</p>

<ul>
  <li>
    <p><a href="https://kinzhal.media/why-so-efficient/">Зачем тебе быть эффективным?</a></p>
  </li>
  <li>
    <p><a href="https://kinzhal.media/ne-prodal/">Продаёте себя на собеседовании? Не надо</a></p>
  </li>
  <li>
    <p><a href="https://kinzhal.media/insta-fake/">Почти всё, что вам показывают в Инстаграме, — ложь</a></p>
  </li>
  <li>
    <p><a href="https://kinzhal.media/nezhno/">К себе нежно</a></p>
  </li>
  <li>
    <p><a href="https://kinzhal.media/just-say-no/">Как нормально отказать боссу</a></p>
  </li>
  <li>
    <p><a href="https://kinzhal.media/sovmestil/">Почему сложно совмещать работу и хобби</a></p>
  </li>
  <li>
    <p><a href="https://kinzhal.media/read-less/">Как эффективно читать книги</a></p>
  </li>
</ul>

<p>И так далее, на сайте еще.</p>

<p>А вот Максим Ильяхов (он там редачит) <a href="http://maximilyahov.ru/blog/all/le-kinzhal/">рассказывает об издании</a>.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/en/clj-book-config/">Configuration in Clojure</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2021-05-06T00:00:00+00:00">
        May 6, 2021
    </time>

    <a href="/tag/clojure/" rel="tag">clojure</a>, <a href="/tag/book/" rel="tag">book</a>, <a href="/tag/programming/" rel="tag">programming</a>, <a href="/tag/configuration/" rel="tag">configuration</a>

</div>


            <div class="entry">
                
                    <p><strong>Clojure in Production</strong></p>

<ul>
  <li>Chapter 1. Web development</li>
  <li>Chapter 2. Clojure.spec</li>
  <li><a href="/en/clj-book-exceptions/">Chapter 3. Exceptions</a></li>
  <li>Chapter 4. Mutability</li>
  <li><a href="/en/clj-book-config/">Chapter 5. Configuration</a></li>
  <li><a href="/en/clj-book-systems/">Chapter 6. Systems in Clojure</a></li>
  <li>Chapter 7. Tests</li>
</ul>

<h2>

    In This Chapter

</h2>

<ul id="toc-item-clj-book-exceptions-en">
  <li><a href="#configuration" id="toc-item-clj-book-exceptions-en-configuration">Configuration</a>    <ul>
      <li><a href="#formulation-of-the-problem" id="toc-item-clj-book-exceptions-en-formulation-of-the-problem">Formulation of the Problem</a></li>
      <li><a href="#semantics" id="toc-item-clj-book-exceptions-en-semantics">Semantics</a></li>
      <li><a href="#configuration-cycle" id="toc-item-clj-book-exceptions-en-configuration-cycle">Configuration Cycle</a></li>
      <li><a href="#config-errors" id="toc-item-clj-book-exceptions-en-config-errors">Config Errors</a></li>
      <li><a href="#configuration-loader" id="toc-item-clj-book-exceptions-en-configuration-loader">Configuration Loader</a>        <ul>
          <li><a href="#improvements" id="toc-item-clj-book-exceptions-en-improvements">Improvements</a></li>
        </ul>
      </li>
      <li><a href="#more-on-environment-variables" id="toc-item-clj-book-exceptions-en-more-on-environment-variables">More on Environment Variables</a>        <ul>
          <li><a href="#local-and-global-variables" id="toc-item-clj-book-exceptions-en-local-and-global-variables">Local and Global Variables</a></li>
        </ul>
      </li>
      <li><a href="#config-in-the-environment" id="toc-item-clj-book-exceptions-en-config-in-the-environment">Config in the Environment</a></li>
      <li><a href="#disadvantages-of-the-environment" id="toc-item-clj-book-exceptions-en-disadvantages-of-the-environment">Disadvantages of the Environment</a>        <ul>
          <li><a href="#env-files" id="toc-item-clj-book-exceptions-en-env-files">Env Files</a></li>
        </ul>
      </li>
      <li><a href="#environment-variables-in-clojure" id="toc-item-clj-book-exceptions-en-environment-variables-in-clojure">Environment Variables in Clojure</a>        <ul>
          <li><a href="#extra-keys-problem" id="toc-item-clj-book-exceptions-en-extra-keys-problem">Extra Keys Problem</a></li>
          <li><a href="#environment-loader" id="toc-item-clj-book-exceptions-en-environment-loader">Environment Loader</a></li>
          <li><a href="#inference-of-structure" id="toc-item-clj-book-exceptions-en-inference-of-structure">Inference of Structure</a></li>
        </ul>
      </li>
      <li><a href="#simple-configuration-manager" id="toc-item-clj-book-exceptions-en-simple-configuration-manager">Simple configuration manager</a></li>
      <li><a href="#reading-the-environment-from-config" id="toc-item-clj-book-exceptions-en-reading-the-environment-from-config">Reading the Environment from Config</a></li>
      <li><a href="#overview-of-formats" id="toc-item-clj-book-exceptions-en-overview-of-formats">Overview of Formats</a>        <ul>
          <li><a href="#json" id="toc-item-clj-book-exceptions-en-json">JSON</a></li>
          <li><a href="#yaml" id="toc-item-clj-book-exceptions-en-yaml">YAML</a></li>
          <li><a href="#edn" id="toc-item-clj-book-exceptions-en-edn">EDN</a></li>
        </ul>
      </li>
      <li><a href="#industrial-solutions" id="toc-item-clj-book-exceptions-en-industrial-solutions">Industrial Solutions</a>        <ul>
          <li><a href="#cprop" id="toc-item-clj-book-exceptions-en-cprop">Cprop</a></li>
          <li><a href="#aero" id="toc-item-clj-book-exceptions-en-aero">Aero</a></li>
          <li><a href="#yummy" id="toc-item-clj-book-exceptions-en-yummy">Yummy</a></li>
        </ul>
      </li>
      <li><a href="#summary" id="toc-item-clj-book-exceptions-en-summary">Summary</a></li>
    </ul>
  </li>
</ul>

<h1 id="configuration">Configuration</h1>

<p><em>In this chapter, we will discuss how to make a Clojure project easy to configure. We’ll take a look at the basics of config: file formats, environment variables, libraries, and their pros and cons.</em></p>

<h2 id="formulation-of-the-problem">Formulation of the Problem</h2>

<p>In materials on Clojure, there are such examples:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">def</span><span class="w"> </span><span class="n">server</span><span class="w">
  </span><span class="p">(</span><span class="nf">jetty/run-jetty</span><span class="w"> </span><span class="n">app</span><span class="w"> </span><span class="p">{</span><span class="no">:port</span><span class="w"> </span><span class="mi">8080</span><span class="p">}))</span><span class="w">

</span><span class="p">(</span><span class="k">def</span><span class="w"> </span><span class="n">db</span><span class="w"> </span><span class="p">{</span><span class="no">:dbtype</span><span class="w">   </span><span class="s">"postgres"</span><span class="w">
         </span><span class="no">:dbname</span><span class="w">   </span><span class="s">"test"</span><span class="w">
         </span><span class="no">:user</span><span class="w">     </span><span class="s">"ivan"</span><span class="w">
         </span><span class="no">:password</span><span class="w"> </span><span class="s">"test"</span><span class="p">})</span><span class="w">
</span></code></pre></div></div>

<p>These are the server on port 8080 and the parameters for connecting to the database. The examples are useful because you can execute them in the REPL and check their result: open a page in a browser or perform a SQL query.</p>

<p>In practice, we should write code so that it does not carry concrete numbers and strings. Explicitly setting a port number to a server is considered bad practice. That is fine for documentation and examples, but not for the production launch.</p>

<p>Port 8080 and other combinations of zeros and eights are popular with programmers. There is a good chance that the port is occupied by another server. This happens when instead of running one service, you start a bunch of them at once during development or testing.</p>

<p>The code written by a programmer goes through several stages. These stages may differ between companies, but in general, they are development, testing, staging/pre-production, and production.</p>

<p>At each stage, the application runs alongside other projects. The assumption that port 8080 is free anytime is fanciful. In developer slang, the situation is called “hardcode” or “nailed down.” If there are nailed-down values in the code, they introduce problems into its life cycle. You cannot run two projects in parallel which declare port 8080 in their code.</p>

<p>The application does not need to know the server port – information about this comes from the outside. In a simple case, this source is the config file. The program reads the port from it and starts the server exactly as it needs to do on a specific machine.</p>

<p>In more complex scenarios, the file is not compiled by a person but a special program – a configuration manager. The manager stores information about network topology, machine addresses, and database access parameters. On request, it generate a config file for a specific machine or network segment.</p>

<p>The process of passing parameters to an application and accepting them is called configuration. This step in software development deserves close attention. When it is done well, the project easily goes through all the stages of production.</p>


                    <p><a href="/en/clj-book-config/">Read more &rarr;</a></p>
                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/snatch/">Можно ударить по голове</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2021-05-04T00:00:00+00:00">
        May 4, 2021
    </time>

    <a href="/tag/life/" rel="tag">life</a>, <a href="/tag/movies/" rel="tag">movies</a>

</div>


            <div class="entry">
                
                    <p>Недавно я употребил в блоге фразу: если не выстрелит, ей можно ударить по голове
(речь о <a href="/clj-2nd-edition/">втором издании книги</a>). Это отсылка к фильму Snatch,
в русском переводе “Большой куш”. Вспомнил, как мы с приятелем будучи
подростками смотрели гоблинский перевод и ржали над матами. А ещё вспомнил, что
даже тогда заметил одну деталь, связанную с этой фразой.</p>

<p>Напомню, её несколько раз произносит торговец оружием Борис. Он толкает
покупателям откровенный хлам. Покупатель взвешивает оружие и замечает — что-то
тяжеловато. На что Борис отвечает: тяжесть — это надёжность. Если не выстрелит,
им можно ударить по голове.</p>

<p><img src="/assets/static/aws/snatch/boris.png" /></p>

<p>Фраза звучит несколько раз, и очевидно, в какой-то момент она должна
сыграть. Поскольку мы в комедии, нелепый тезис должен сработать при нелепых
обстоятельствах. Другими словами, повторяя некую фразу, режиссер подводит
зрителя к ситуации. И тут нас ждёт разочарование — в случае “не выстрелит”
режиссер не уделил шутке внимания.</p>

<p><img src="/assets/static/aws/snatch/tommy.png" /></p>

<p>Томми, партнер главного героя, покупает нерабочий пистолет. Позже он испытывает
его из окна машины, и оружие дает осечку. Но в момент, когда Турецкого готовы
убить, Томми наставляет пистолет на бандитов и тем спасает Турецкого. Таким
образом выполняется только первая часть шутки — не выстрелит.</p>

<p><img src="/assets/static/aws/snatch/aiming.png" /></p>

<p>Ещё подростком я понял, что надо было обыграть фразу по-другому. Во-первых,
когда Турецкий предлагает выстрелить из машины, Томми должен был
отказаться. Якобы потому, что Борис — надёжный продавец как и его товар, поэтому
сомневаться нет смысла. На самом деле Томми боится оружия, и это только бы
усилило ожидание шутки.</p>

<p>Когда на Турецкого нападают бандиты, один из них душит его. Томми пытается
выстрелить, но пистолет не работает. В глазах Турецкого ужас — пропала последняя
надежда, ведь на физические способности Томми рассчитывать не приходится. Томми
мечется, его взгляд падает на нерабочий пистолет. Он вспоминает напутствие
продавца, берет пистолет за ствол и бьет бандита по голове. Тот сползает с
Турецкого. Оба героя переводят дух, молча смотрят на оружие и кивают. В их
глазах проскальзывает “действительно, им можно ударить по голове”.</p>

<p>Так сбывается нелепое пророчество. В этом варианте раскрыты обе части шутки, и
согласитесь, это было бы смешнее (в рамках криминальной комедии). Конечно, на
словах звучит слегка коряво, но режиссёр на то и нужен, чтобы всё это обыграть
камерой, мимикой, диалогами.</p>

<p>Морали нет, просто наблюдение. Уже давно замечаю за собой, что после фильма
обдумываю отдельные сцены, чтобы найти более удачные повороты сюжета, диалоги
или черты персонажей. Эта заметка — попытка зафиксировать одну из таких идей.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/key-remap/">Переназначение клавиш на Маке</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2021-04-24T00:00:00+00:00">
        Apr 24, 2021
    </time>

    <a href="/tag/life/" rel="tag">life</a>, <a href="/tag/keyboard/" rel="tag">keyboard</a>, <a href="/tag/mac/" rel="tag">mac</a>

</div>


            <div class="entry">
                
                    <p>В этой статье я бы хотел поговорить об изменении клавиш на клавиатуре. Сперва
это была короткая заметка, но со временем текст вырос во что-то
большее. Оказалось, есть что сказать по теме.</p>

<p>Вообще, я не стремлюсь менять клавиши и затачивать программы под
себя. Разработчики предлагают удобные схемы, и в целом удобно, когда вы
работаете на стандартных настройках. Всё же, годы за клавиатурой подталкивают к
некоторым изменениям.</p>

<p>Главный довод в пользу изменения клавиш — физиология. У людей разная форма
кистей и длина пальцев. Невозможно выпустить клавиатуру, которая подошла бы всем
людям. Именно физиология и чуткое внимание к ощущениям подсказывают, что менять
что-то нужно, иначе — боль в суставах.</p>

<p>Одно время я увлекался эргономичными клавиатурами, но быстро разочаровался в
них. За огромные деньги мы получим поделие Франкенштейна: огромных размеров,
тяжелое, неудобное. Такая клавиатура полностью меняет рабочее пространство,
заставляет кое-что купить в довесок. Её не возьмешь в командировку или на дачу,
словом — нет.</p>

<p>Типичные пациенты:</p>

<p><img src="/assets/static/aws/remapping/ergo1.jpg" /></p>

<p><img src="/assets/static/aws/remapping/ergo2.jpg" /></p>

<p><img src="/assets/static/aws/remapping/ergo3.jpg" /></p>

<p>На последней картинке – Microsoft Sculpt. Я пользовался ей полгода, но страшно
заболела левая рука.</p>


                    <p><a href="/key-remap/">Read more &rarr;</a></p>
                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/whats-wrong/">Что не так</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2021-04-22T00:00:00+00:00">
        Apr 22, 2021
    </time>

    <a href="/tag/life/" rel="tag">life</a>

</div>


            <div class="entry">
                
                    <p>Один из самых дурацких вопросов — “что не так с X”. Примеры:</p>

<ul>
  <li>Мы в редакции не используем букву ё.</li>
  <li>
    <p>Что не так с ё?</p>
  </li>
  <li>Мы перешли с Node.js на Python.</li>
  <li>
    <p>Что не так с Нодой?</p>
  </li>
  <li>Новый ролик я монтировал в Final Cut, а не Premiere.</li>
  <li>Что не так с Премьером?</li>
</ul>

<p>Беда вот в чём. Ни одно из утверждений не говорит о том, что с буквой ё,
программой или языком что-то не так. От них отказались по каким-то причинам, а с
самим предметом всё в порядке. Поэтому вопрос задан неправильно — следовало
спросить, почему вы решили; почему отказались; что вынудило и так далее.</p>

<p>Но собеседник переложил работу на меня. Я понимаю, что он имел в виду, но тогда
мой ответ звучит слабо. С буквой ё все в порядке, просто мы…, программа
хорошая, но я… Получается ерунда.</p>

<p>Заметил, что подобный вопросы задают тролли, которым нужна подобная
интонация. Либо человек, которым движет вера. Что бы вы ни сказали, он будет
гнуть свою линию. Отсюда эта лёгкая дерзость: во фразе “что не так с X” уже
слышится претензия.</p>

<p>Подобные вещи я либо игнорирую, либо прошу задать вопрос правильно. Что ты
имеешь в виду? Я не говорил, что с X что-то не так. Объясни, чего хочешь.</p>

<p>Кидайте эту заметку тем, кто злоупотребляет “что не так с X”.</p>

<p>См. также <a href="https://ru.wikipedia.org/wiki/Whataboutism">Whataboutism</a>.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/clj-2nd-edition/">Второе издание</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2021-04-16T00:00:00+00:00">
        Apr 16, 2021
    </time>

    <a href="/tag/life/" rel="tag">life</a>

</div>


            <div class="entry">
                
                    
<p>У меня большая радость — выпустил второе издание книги <a href="/clojure-in-prod/">“Clojure на
производстве”</a>. Сел за него спустя полгода после первой
публикации. Процесс занял четыре месяца, и вот — готово.</p>

<p>Исправил опечатки и неточности, о которых сообщили читатели. Низкий поклон всем,
кто их прислал.</p>

<p>Некоторые разделы урезал, другие, наоборот, дополнил. Так, в главе про спеку мне
показался слабым пример, где парсим конфигурацию через <code class="language-plaintext highlighter-rouge">s/conform</code>. Опыт
подсказывает, что так не делают в проде, поэтому удалил эту часть. Заменил ее на
парсинг структур данных — задачу, которую решал в либе <a href="https://github.com/igrishaev/etaoin">Etaoin</a>.</p>

<p>То же самое относится к другим главам — нашлись смысловые неточности, которые
пришлось проверить и допилить.</p>

<p>Самое важное — в книге наконец-то шрифт нормального размера. Вы будете смеяться,
но в первом издании на титульном листе был незакрытый тег <code class="language-plaintext highlighter-rouge">\small</code>, из-за
которого остальной текст был на один пункт меньше. Глаз замылился, и я заметил
это уже когда сдал макет в печать. Позже получил несколько писем о том, что
шрифт маловат. Теперь это исправлено, но и книга потолстела — с 360 до 444
страниц, то есть на четверть.</p>

<p>Купить книгу можно все теми же способами:</p>

<ul>
  <li><a href="https://ridero.ru/books/clojure_na_proizvodstve/">в издательстве</a>,</li>
  <li><a href="https://www.chitai-gorod.ru/catalog/book/1267534/">в Читай-городе</a>,</li>
  <li><a href="https://www.ozon.ru/product/clojure-na-proizvodstve-179829229/">на Озоне</a>,</li>
  <li><a href="https://www.bookvoed.ru/book?id=10490030">в Буквоеде</a>,</li>
  <li><a href="https://dmkpress.com/catalog/computer/programming/functional/978-5-93700-055-2/">в ДМК-Пресс</a>,</li>
  <li><a href="https://aliexpress.ru/item/1005002322504648.html">на Али-Экспрессе</a>.</li>
</ul>

<p>Почти все магазины обновили обложку, но если вы видите старую, не страшно:
напечатают всё равно второе издание.</p>

<p>Электронная версия <a href="https://gum.co/clojure-in-prod">на Gumroad</a>. Если вы уже покупали, то сервис
позволит вам скачать новые файлы бесплатно. Я обновляю их с каждой найденной
опечаткой, которые, увы, все еще попадаются.</p>

<p>Ну и самое важное — провел эксперимент. Отпечатал двадцать пробных книжек
формата B5 в твердой обложке. Это нечто среднее между А5 и А4. После первого
издания книга смотрится неприлично большой. Даже если не выстрелит, ей можно
ударить по голове ©. Зато очень легко читать и листать.</p>

<p>Несколько фотографий. В мягкой глянцевой обложке, обычный формат А5:</p>


                    <p><a href="/clj-2nd-edition/">Read more &rarr;</a></p>
                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/pomidor/">Помидор</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2021-04-13T00:00:00+00:00">
        Apr 13, 2021
    </time>

    <a href="/tag/life/" rel="tag">life</a>, <a href="/tag/pomidor/" rel="tag">pomidor</a>

</div>


            <div class="entry">
                
                    <p>Скажу банальность, но всё-таки — техника помидора работает. Долго не мог ей
следовать, но освоился, и теперь даже получаю удовольствие.</p>

<p>Помидор — это когда вы работаете интервалами по 20-25 минут с перерывами по пять
минут. Отвлекаться на что-то, не связанное с задачей, нельзя. Сюда входит почта
(вдруг что-то пришло), Телеграм (вдруг написали важное), Ютуб и левые
сайты. После четырёх помидоров положен долгий отдых в 20 минут. Идеальный случай
— сделать восемь помидоров за день.</p>

<p>Сперва кажется, что это мало — всего-то 8 * 20 = 160 минут, или 2.5 часа. Это
ошибка, которую допускают те, кто не пробовал. Два с половиной часа чистой,
ничем не разбавленной работы — <em>это офигеть как много</em>. Учтите, что сюда не входят
звонки, обед, походы в туалет и за чаем, офисные разговоры и Ютуб. Всё это
занимает три часа и больше. Добавим сюда те якобы жалкие два часа работы, и вот
он, ваш рабочий день.</p>

<p>Да что там, с недавнего времени я понял: даже час напряженной работы над чем-то
стоит всего дня. Получилось утром посидеть над книгой — день прожит не зря,
дальнейшее меня уже не интересует. Не получилось — буду злиться, что день
потерян. В теории, нагнать потерянный утром час можно и после обеда, но это
случается редко: и голова не та, и взгляд не тот.</p>

<p>Так вот, помидор. Он сто раз описан в книгах, нет смысла повторяться. Перечислю
то, что зашло лично мне.</p>

<ul>
  <li>
    <p>Мобильные приложения ужасны: сплошная реклама и подписки. Приложения тупят:
иные из них, если вырубить экран, засыпают и не сигналят. А если не вырубить,
то садят батарею. Короче, все приложения говно. Может, и есть достойное, но
проверять каждое лень.</p>
  </li>
  <li>
    <p>Не рассматривал физический таймер. Это мило, но лишняя вещь на столе, плюс он
тикает (спираль, шестеренки), а мне это не нравится. Если же электронный
вариант, то он будет такой же ужасный, как мобильное приложение.</p>
  </li>
</ul>

<ul>
  <li>Под мак нашлось настольное приложение <a href="https://pomidorko.ru/apps/">pomidorko</a>
(см. картинку). Выше всяких похвал: минимальное, одна кнопка, пара опций. И
плевать, что чего-то не умеет: лучше меньше, да лучше. Поддержите автора
деньгами, в подвале сайта ссылки.</li>
</ul>

<p><img src="/assets/static/aws/pomidor/sample.png" /></p>

<ul>
  <li>
    <p>Цикл помидора выставляю на 20 минут. Сначала кажется, что это мало, и порой
сигнал звучит в тот момент, когда только разогнался. Тут главное не посчитать
себя суперменом и не выставить на 30 и больше, иначе
<a href="/antiburn/"><del>выгоришь</del></a> устанешь.</p>
  </li>
  <li>
    <p>Во время отдыха надо встать и подвигаться. Я всегда иду в туалет — не потому,
что хочется, а чтобы размять булки и плеснуть в лицо холодной воды. Во время
долгого перерыва можно полежать на диване.</p>
  </li>
  <li>
    <p>К помидору трудно привыкнуть. Начинается классическая ломка: хочу Ютуб, а
нельзя. Хочу Телеграмчик, а тоже нельзя. Всё это заставляет задуматься: что же
это за работа, если постоянно тянет отвлечься? Неужели так трудно хранить
фокус двадцать минут? Но потом ломка проходит, и с каждым помидором
испытываешь гордость за самоконтроль.</p>
  </li>
  <li>
    <p>Если 20 минут для вас много — выставляйте на 15 или даже 10, никто не вправе
вас за это стыдить. Главное — следовать основному правилу (не отвлекаться) и
не обманывать себя. Других вы обманите запросто, а себя — нет.</p>
  </li>
  <li>
    <p>Для начала делайте два помидора в день, то есть почти час чистого рабочего
времени. Серьёзно. Вы очень удивитесь, когда узнаете, <em>сколько</em> можно сделать за
этот час.</p>
  </li>
</ul>

                
            </div>

        </li>
        
    </ul>

    <h4>
        
        <a href="/page23" class="previous">&larr;</a>
        
        <span class="page_number ">Страница 24 из 76</span>
        
        <a href="/page25" class="next">&rarr;</a>
        
    </h4>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>Ivan Grishaev's blog</li>
          <li><a href="mailto:ivan@grishaev.me">ivan@grishaev.me</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
            <li><a href="https://github.com/igrishaev">GitHub</a></li>
            <li><a href="tg://resolve?domain=igrishaev_blog">Telegram</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>Writing on programming, education, books and negotiations.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
