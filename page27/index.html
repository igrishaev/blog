<!DOCTYPE html>
<html lang="ru">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Ivan Grishaev's blog</title>
  <meta name="description" content="Writing on programming, education, books and negotiations.
">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/custom.css">
  <link rel="canonical" href="https://grishaev.me/page27/">
  <link rel="alternate" type="application/rss+xml" title="Ivan Grishaev's blog" href="https://grishaev.me/feed.xml">

  <link rel="shortcut icon" type="image/x-icon" href="/assets/static/favicons/favicon.ico">

  <script type="text/javascript" src="/assets/typo.js"></script>

</head>


  <body>
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-33533163-2', 'auto');
    ga('send', 'pageview');

</script>

    <header class="site-header">

    <div class="wrapper flex-container">

        <div>
            <a href="/">
                <img src="/assets/static/photo-round-small.png" alt="Ivan Grishaev">
            </a>
        </div>

        <div class="flex-container-vert" style="margin-left: 15px; width: 80%">

            <div class="flex-container full-width">
                <p style="margin-bottom: 5px">Ivan Grishaev's blog</p>
                <div class="flex-huge"></div>
                <div >
<form id="search-form"
      target="_blank"
      style="display: inline"
      method="get"
      action="https://www.google.com/search">

    <input name="sitesearch"
           value="grishaev.me"
           type="hidden">

    <input type="text"
           required="required"
           name="q"
           placeholder="Google search..."
           autocomplete="off">

    <button style="border: none; background-color: transparent; cursor: pointer;"
            type="submit">&#x1f50d;</button>

</form>
</div>
            </div>

            <p><small>Writing on programming, education, books and negotiations.
</small></p>

            <div class="flex-container">
                <a class="menu-item" href="/">Home</a>
                <a class="menu-item" href="/about/">About</a>
                <a class="menu-item" href="/bookshelf/">Bookshelf</a>
                <a class="menu-item" href="/feed.xml">RSS</a>
            </div>

            <div class="flex-container">
                <a class="menu-item minor" href="/tag/clojure/">Clojure</a>
                <a class="menu-item minor" href="/tag/emacs/">Emacs</a>
                <a class="menu-item minor" href="/tag/python/">Python</a>
                <a class="menu-item minor" href="/tag/programming/">Programming</a>
                <a class="menu-item minor" href="/interview/">Interview</a>
                <a class="menu-item minor" href="/video/">Video</a>
            </div>

            <div class="flex-container">
                <a class="menu-item minor hl" href="/clojure-in-prod/">Книга «Clojure на производстве»</a>
            </div>

        </div>
    </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="home">

    <ul class="post-list">
        
        <li>

            <h2>
                <a class="post-link" href="/read-25/">Weekly links #25</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2017-06-25T00:00:00+00:00">
        Jun 25, 2017
    </time>

    <a href="/tag/read/" rel="tag">read</a>, <a href="/tag/life/" rel="tag">life</a>

</div>


            <div class="entry">
                
                    <p>Пишу вам из Турции. Держитесь, всего одно платье осталось!</p>

<ul>
  <li>
    <p><a href="http://www.yegor256.com/2017/06/22/object-oriented-input-output-in-cactoos.html">Object-Oriented Declarative Input/Output in Cactoos</a></p>

    <blockquote>
      <p>Instead of calling static procedures we want to use objects, the way they
are supposed to be used.</p>
    </blockquote>
  </li>
  <li>
    <p><a href="http://tonsky.livejournal.com/312123.html">Принципиальный недостаток Git CLI</a></p>

    <p>Эмоциональный обзор недостатоков Гита.</p>
  </li>
  <li>
    <p><a href="https://snob.ru/profile/9723/blog/126187">Мода на медленный секс</a></p>

    <blockquote>
      <p>«Медленный» секс — это как бы не горячо. Поэтому большинство людей и
пытается оторвать своим любовникам пенис или клитор — им кажется, что это
очень страстно, даже если их партнерам это не слишком приятно.</p>
    </blockquote>
  </li>
  <li>
    <p><a href="https://snob.ru/profile/9723/blog/125888">Ренессанс содержанки</a></p>

    <blockquote>
      <p>…ты будешь бедной лет до тридцати самое меньшее. Гарвард? Никого не
волнует. Работы нет.</p>
    </blockquote>
  </li>
  <li>
    <p><a href="https://journal.tinkoff.ru/investing/">Инвестиции на бирже: популярные заблуждения</a></p>

    <p>Азы инвестирования. Горячо рекомендую к прочтению.</p>
  </li>
</ul>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/en/clj-args/">On Clojure arguments</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2017-06-23T00:00:00+00:00">
        Jun 23, 2017
    </time>

    <a href="/tag/clojure/" rel="tag">clojure</a>, <a href="/tag/programming/" rel="tag">programming</a>, <a href="/tag/arguments/" rel="tag">arguments</a>

</div>


            <div class="entry">
                
                    <p>Sometimes, a function that we are working on needs to take lots of
parameters. Not just one or two but a decade or even more. I used to face with
such a problem many times. I’m not sure solutions made by me were always good
enough.</p>

<p>You might be brave enough to say you will never face such an error. It’s
probably a weird architecture. A function should accept at least five
arguments. You will refactor such a code for sure.</p>

<p>But look at this:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">max_length</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">db_index</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">rel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">NOT_PROVIDED</span><span class="p">,</span> <span class="n">editable</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                 <span class="n">serialize</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">unique_for_date</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">unique_for_month</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">unique_for_year</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s">''</span><span class="p">,</span> <span class="n">db_column</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">db_tablespace</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">auto_created</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">validators</span><span class="o">=</span><span class="p">(),</span>
                 <span class="n">error_messages</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
</code></pre></div></div>

<p>It is <a href="https://github.com/django/django/blob/master/django/db/models/fields/__init__.py#L134">from Django</a>, the world-wide spreaded framework to build robust
web applications. Except <code class="language-plaintext highlighter-rouge">self</code>, the constructor takes 22 optional
arguments. Saying more, it is just a basic abstract class. Its descendants
require their own arguments in addition to default ones.</p>

<p>Common languages such as Python, Ruby or Java give only one standard way to deal
with lots of parameters. In fact, using them you cannot be mistaken since you
have no other choice. The question here is how to make you code less ugly than
it is now.</p>

<p>People who are new in Clojure, especially if they came from classical
Python/Puby/PHP, face troubles when passing lots of arguments into a
function. Since it’s Clojure, there are several ways to do that. This article
highlights some on them, their benefits and disadvantages.</p>

<h3 id="multi-arity">Multi-arity</h3>

<p>Any function in Clojure may have more than one body with its own
signature. That’s normal for any functional language, but sounds surprisingly to
former Python/Ruby adepts. An interpreter dispatches that bodies by a form of
arguments. The first found body is called. When no body is found, an exception
is raised.</p>

<p>For example, the same function could be called with either two or three
arguments if we declare it in such way:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">foo</span><span class="w">
 </span><span class="p">([</span><span class="n">x</span><span class="w"> </span><span class="n">y</span><span class="p">]</span><span class="w">
  </span><span class="p">(</span><span class="nb">println</span><span class="w"> </span><span class="s">"two arguments"</span><span class="p">)</span><span class="w">
  </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">y</span><span class="p">))</span><span class="w">
 </span><span class="p">([</span><span class="n">x</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="n">z</span><span class="p">]</span><span class="w">
  </span><span class="p">(</span><span class="nb">println</span><span class="w"> </span><span class="s">"three arguments!"</span><span class="p">)</span><span class="w">
  </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="n">z</span><span class="p">)))</span><span class="w">

</span><span class="p">(</span><span class="nf">foo</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w">
</span><span class="mi">3</span><span class="w"> </span><span class="c1">;; prints `two arguments`</span><span class="w">

</span><span class="p">(</span><span class="nf">foo</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w">
</span><span class="mi">6</span><span class="w"> </span><span class="c1">;; prints `three arguments!`</span><span class="w">
</span></code></pre></div></div>

<p>Calling a function with zero, one or ten arguments will raise an
exception. Depending on your application’s logic, it could be both good or bad
behaviour.</p>

<p>To fallback to default body that deals with any set of arguments, add one more
implementation:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">foo</span><span class="w">
 </span><span class="p">([</span><span class="n">x</span><span class="w"> </span><span class="n">y</span><span class="p">]</span><span class="w">
   </span><span class="n">...</span><span class="w">
  </span><span class="p">)</span><span class="w">
 </span><span class="p">([</span><span class="n">x</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="n">z</span><span class="p">]</span><span class="w">
  </span><span class="n">...</span><span class="w">
  </span><span class="p">)</span><span class="w">
 </span><span class="p">([</span><span class="o">&amp;</span><span class="w"> </span><span class="n">args</span><span class="p">]</span><span class="w">
  </span><span class="p">(</span><span class="nb">reduce</span><span class="w"> </span><span class="nb">+</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">args</span><span class="p">)))</span><span class="w">
</span></code></pre></div></div>

<p>Now, you may add any arguments set together:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">foo</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w">
</span><span class="mi">10</span><span class="w">

</span><span class="p">(</span><span class="nf">foo</span><span class="p">)</span><span class="w">
</span><span class="mi">0</span><span class="w">
</span></code></pre></div></div>

<p>The order of bodies is important. If you put <code class="language-plaintext highlighter-rouge">[&amp; args]</code> clause on the top, it
will cover all the possible function calls. So you will never reach <code class="language-plaintext highlighter-rouge">[x y]</code> or
<code class="language-plaintext highlighter-rouge">[x y z]</code> implementations.</p>

<p>One interesting feature is you may redirect function call inside a body just
calling the same function with another argument set. For example:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="nb">test</span><span class="w">
  </span><span class="p">([</span><span class="n">x</span><span class="w"> </span><span class="n">y</span><span class="p">]</span><span class="w">
   </span><span class="p">(</span><span class="nb">test</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="n">nil</span><span class="p">))</span><span class="w"> </span><span class="c1">;; redirects to the second body</span><span class="w">
  </span><span class="p">([</span><span class="n">x</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="n">z</span><span class="p">]</span><span class="w">
   </span><span class="p">(</span><span class="nf">do-some-stuff</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="n">z</span><span class="p">)))</span><span class="w">
</span></code></pre></div></div>

<p>Clojure dispatches a proper body quite fast. It is a key feature of Clojure’s
runtime. There are lots of core functions that declare two, three or even five
bodies regarding to performance issues. It’s much faster then having a single
body with multiple <code class="language-plaintext highlighter-rouge">if</code>s, <code class="language-plaintext highlighter-rouge">case</code> or <code class="language-plaintext highlighter-rouge">cond</code>clauses.</p>

<p>A quick copy-paste from <a href="https://github.com/clojure/clojure/blob/master/src/clj/clojure/core.clj#L2556">Clojure sources</a>:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">juxt</span><span class="w">
  </span><span class="s">"..."</span><span class="w">
  </span><span class="p">([</span><span class="n">f</span><span class="p">]</span><span class="w"> </span><span class="n">...</span><span class="p">)</span><span class="w">
  </span><span class="p">([</span><span class="n">f</span><span class="w"> </span><span class="n">g</span><span class="p">]</span><span class="w"> </span><span class="n">...</span><span class="p">)</span><span class="w">
  </span><span class="p">([</span><span class="n">f</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="n">h</span><span class="p">]</span><span class="w"> </span><span class="n">...</span><span class="p">)</span><span class="w">
  </span><span class="p">([</span><span class="n">f</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">fs</span><span class="p">]</span><span class="w"> </span><span class="n">...</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p>Multi-arity is great when you already have a function that takes a couple of
scalar parameters and then you need to add some extra one ASAP. Usually, the
most needed function is called in thousand places so adding an extra parameter
everywhere would be a mess.</p>

<p>In Java or Python world, it is named “refactoring”. You need a robust commercial
IDE to scan the project and change each call of a function. In Clojure, you just
do:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">;; old</span><span class="w">
</span><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="nb">test</span><span class="w">
  </span><span class="p">[</span><span class="n">x</span><span class="w"> </span><span class="n">y</span><span class="p">]</span><span class="w">
  </span><span class="p">(</span><span class="nf">do-old-stuff</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">y</span><span class="p">))</span><span class="w">

</span><span class="c1">;; new</span><span class="w">
</span><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="nb">test</span><span class="w">
  </span><span class="p">([</span><span class="n">x</span><span class="w"> </span><span class="n">y</span><span class="p">]</span><span class="w">
   </span><span class="p">(</span><span class="nf">do-old-stuff</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">y</span><span class="p">))</span><span class="w">
  </span><span class="p">([</span><span class="n">x</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="n">z</span><span class="p">]</span><span class="w">
   </span><span class="p">(</span><span class="nf">do-new-stuff</span><span class="w"> </span><span class="n">z</span><span class="p">)</span><span class="w">
   </span><span class="p">(</span><span class="nf">do-old-stuff</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">y</span><span class="p">)))</span><span class="w">
</span></code></pre></div></div>

<p>Now you can keep the old calls without changing your code. And pass the new
argument only where you need.</p>

<h3 id="maps">Maps</h3>

<p>Your function may need lots of additional arguments. For example, boolean flags,
extra options for HTTP connection, timeouts, headers, error messages.</p>

<p>A good way to solve the problem is to join them into a single map. Thus, your
function accepts only a couple of required parameters and the rest are put into
an optional map. Say, you pass a hostname and a method name and a map with
<code class="language-plaintext highlighter-rouge">:timeout</code>, <code class="language-plaintext highlighter-rouge">:headers</code> keys on so on.</p>

<p>Inside a function, you either take optional arguments one by one:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">foo</span><span class="w"> </span><span class="p">[</span><span class="n">hostname</span><span class="w"> </span><span class="n">port</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="p">[</span><span class="n">opt</span><span class="p">]]</span><span class="w">
  </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">[</span><span class="n">timeout</span><span class="w"> </span><span class="p">(</span><span class="no">:timeout</span><span class="w"> </span><span class="n">opt</span><span class="p">)</span><span class="w">
        </span><span class="n">headers</span><span class="w"> </span><span class="p">(</span><span class="no">:headers</span><span class="w"> </span><span class="n">opt</span><span class="p">]</span><span class="w">
    </span><span class="p">(</span><span class="nf">http-request</span><span class="w"> </span><span class="n">hostname</span><span class="w"> </span><span class="n">port</span><span class="w"> </span><span class="n">timeout</span><span class="w"> </span><span class="n">headers</span><span class="p">)</span><span class="w">
    </span><span class="n">...</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>or decompose a map on separated variables at once:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">foo</span><span class="w"> </span><span class="p">[</span><span class="n">hostname</span><span class="w"> </span><span class="n">port</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="p">[</span><span class="n">opt</span><span class="p">]]</span><span class="w">
  </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">[{</span><span class="no">:keys</span><span class="w"> </span><span class="p">[</span><span class="n">timeout</span><span class="w">
                </span><span class="n">headers</span><span class="p">]}</span><span class="w"> </span><span class="n">opt</span><span class="p">]</span><span class="w">
    </span><span class="p">(</span><span class="nf">http-request</span><span class="w"> </span><span class="n">hostname</span><span class="w"> </span><span class="n">port</span><span class="w"> </span><span class="n">timeout</span><span class="w"> </span><span class="n">headers</span><span class="p">)</span><span class="w">
    </span><span class="n">...</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p>Decomposition works as well on the signature level. I do not like this method
though since it brings some noise in the code:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">foo</span><span class="w"> </span><span class="p">[</span><span class="n">hostname</span><span class="w"> </span><span class="n">port</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="p">[{</span><span class="n">timeout</span><span class="w"> </span><span class="no">:timeout</span><span class="w">
                             </span><span class="n">headers</span><span class="w"> </span><span class="no">:headers</span><span class="p">}]]</span><span class="w">
  </span><span class="p">(</span><span class="nf">http-request</span><span class="w"> </span><span class="n">hostname</span><span class="w"> </span><span class="n">port</span><span class="w"> </span><span class="n">timeout</span><span class="w"> </span><span class="n">headers</span><span class="p">)</span><span class="w">
  </span><span class="n">...</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>A good point there is you may keep a default map somewhere and merge it with the
passed ones to fallback to default values:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">
</span><span class="p">(</span><span class="k">def</span><span class="w"> </span><span class="n">foo-defaults</span><span class="w">
  </span><span class="p">{</span><span class="no">:timeout</span><span class="w"> </span><span class="mi">5</span><span class="w">
   </span><span class="no">:headers</span><span class="w"> </span><span class="p">{</span><span class="no">:user-agent</span><span class="w"> </span><span class="s">"Internet Explorer 6.0"</span><span class="p">}})</span><span class="w">

</span><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">foo</span><span class="w"> </span><span class="p">[</span><span class="n">hostname</span><span class="w"> </span><span class="n">port</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="p">[</span><span class="n">opt</span><span class="p">]]</span><span class="w">
  </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">[{</span><span class="no">:keys</span><span class="w"> </span><span class="p">[</span><span class="n">timeout</span><span class="w">
                </span><span class="n">headers</span><span class="p">]}</span><span class="w"> </span><span class="p">(</span><span class="nb">merge</span><span class="w"> </span><span class="n">foo-defaults</span><span class="w"> </span><span class="n">opt</span><span class="p">)]</span><span class="w">
    </span><span class="c1">;; now timeout is always 5 when not passed</span><span class="w">
    </span><span class="n">...</span><span class="w">
    </span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p>This way of passing a map is widely-spreaded across Clojure libraries. It even
considered as the standard one because of its simplicity and transparency. If
you have just started with Clojure and need a function with multiple arguments,
use a map.</p>

<h3 id="rest-arguments-as-a-map">Rest arguments as a map</h3>

<p>There is another way to deal with multiple arguments. Do you remember the <code class="language-plaintext highlighter-rouge">rest</code>
arguments prepended with <code class="language-plaintext highlighter-rouge">&amp;</code> in a function signature? Something like that:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">foo</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="w"> </span><span class="n">args</span><span class="p">]</span><span class="w">
  </span><span class="c1">;; args is a list)</span><span class="w">

</span><span class="p">(</span><span class="nf">foo</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="c1">;; args is (1 2 3 4)</span><span class="w">
</span></code></pre></div></div>

<p>Starting with Clojure 1.5 (or 1.6, I don’t remember exactly) you may turn the
rest arguments into a map. The syntax is:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">foo</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="w"> </span><span class="p">{</span><span class="no">:as</span><span class="w"> </span><span class="n">args</span><span class="p">}]</span><span class="w">
  </span><span class="c1">;; now, args is a map!</span><span class="w">
  </span><span class="n">args</span><span class="p">)</span><span class="w">

</span><span class="p">(</span><span class="nf">foo</span><span class="w"> </span><span class="no">:foo</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="no">:bar</span><span class="w"> </span><span class="mi">42</span><span class="p">)</span><span class="w">
</span><span class="p">{</span><span class="no">:bar</span><span class="w"> </span><span class="mi">42</span><span class="n">,</span><span class="w"> </span><span class="no">:foo</span><span class="w"> </span><span class="mi">1</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Pass extra arguments remembering some simple rules:</p>

<ol>
  <li>there must be even number of rest arguments, otherwise you will get an error;</li>
  <li>each odd argument (usually a keyword) is a key;</li>
  <li>each even argument is a value;</li>
  <li>you cannot duplicate key items.</li>
</ol>

<p>Turning rest arguments into a map is also used oftenly in Clojure. You may
choose that method over a map as well when developing with Clojure.</p>

<h3 id="pure-map-vs-rest-args">Pure map vs rest args</h3>

<p>Each of two method described above has its own benefits and disadvantages. Let’s
highlight some of them:</p>

<ol>
  <li>
    <p>Using a map is good when you don’t know exactly what arguments you will pass
into a function. It’s a common situation when the final set of options is
unknown for the last moment. It might depend on user input, environment
variables or any conditions. Usually, you compose a map step by step, validate
it with somehow and pass into a function. With sequences, it’s more difficult
to compose a set of arguments.</p>
  </li>
  <li>
    <p>Passing a map into a function with the <code class="language-plaintext highlighter-rouge">&amp; rest</code> signature requires some
additional steps. You should flatten you map into a vector or sequence and
then apply it to a function:</p>

    <div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">def</span><span class="w"> </span><span class="n">opt</span><span class="w"> </span><span class="p">{</span><span class="no">:foo</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="no">:bar</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span><span class="p">]})</span><span class="w"> </span><span class="c1">;; your options map</span><span class="w">

</span><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">foo</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="w"> </span><span class="p">{</span><span class="no">:as</span><span class="w"> </span><span class="n">args</span><span class="p">}]</span><span class="w"> </span><span class="n">...</span><span class="p">)</span><span class="w"> </span><span class="c1">;; but the function accepts rest arguments</span><span class="w">

</span><span class="c1">;; turns opt to a seq of (key1 val1 key2 val2)</span><span class="w">
</span><span class="c1">;; then apply it to the function</span><span class="w">
</span><span class="p">(</span><span class="nb">apply</span><span class="w"> </span><span class="n">foo</span><span class="w"> </span><span class="p">(</span><span class="nb">mapcat</span><span class="w"> </span><span class="nb">identity</span><span class="w"> </span><span class="n">opt</span><span class="p">))</span><span class="w">
</span></code></pre></div>    </div>

    <p>Note how long is the code. Probably, you’d better to modify the function to
accept just map.</p>
  </li>
  <li>
    <p>With the rest arguments, <code class="language-plaintext highlighter-rouge">partial</code> works like a charm. Say, we have a
function that returns a set of rows from the database. The first argument is
a table name, and the rest are a sequence with each odd argument as a column
name and even argument as a value:</p>

    <div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">db-query</span><span class="w"> </span><span class="no">:users</span><span class="w"> </span><span class="no">:active</span><span class="w"> </span><span class="n">true</span><span class="w"> </span><span class="no">:staff</span><span class="w"> </span><span class="n">true</span><span class="w"> </span><span class="no">:name</span><span class="w"> </span><span class="s">"Ivan"</span><span class="p">)</span><span class="w">
</span><span class="c1">;; performs a query like:</span><span class="w">
</span><span class="c1">;; select *</span><span class="w">
</span><span class="c1">;;   from "users"</span><span class="w">
</span><span class="c1">;; where</span><span class="w">
</span><span class="c1">;;   active</span><span class="w">
</span><span class="c1">;;   and staff</span><span class="w">
</span><span class="c1">;;   and name = "Ivan"</span><span class="w">
</span></code></pre></div>    </div>

    <p>Some of our users could be blocked. We may forget passing <code class="language-plaintext highlighter-rouge">:active false</code>
clause every time you query for users. To prevent returning blocked ones to
the frontend, it’s better to have a special function for that:</p>

    <div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">def</span><span class="w"> </span><span class="n">active-users</span><span class="w"> </span><span class="p">(</span><span class="nb">partial</span><span class="w"> </span><span class="n">db-query</span><span class="w"> </span><span class="no">:users</span><span class="w"> </span><span class="no">:active</span><span class="w"> </span><span class="n">true</span><span class="p">))</span><span class="w">
</span></code></pre></div>    </div>

    <p>In addition to this constraint, we might be interested in only staff
users. Let’s extend our function with another partial application:</p>

    <div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">def</span><span class="w"> </span><span class="n">staff-active-users</span><span class="w"> </span><span class="p">(</span><span class="nb">partial</span><span class="w"> </span><span class="n">active-users</span><span class="w"> </span><span class="no">:staff</span><span class="w"> </span><span class="n">true</span><span class="p">))</span><span class="w">
</span></code></pre></div>    </div>

    <p>Finally, we may select all the non-blocked staff users whose name is Ivan:</p>

    <div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">staff-active-users</span><span class="w"> </span><span class="no">:name</span><span class="w"> </span><span class="s">"Ivan"</span><span class="p">)</span><span class="w">
</span><span class="c1">;; [{:id 1 :name "Ivan" :surname "Petrov"}</span><span class="w">
</span><span class="c1">;;  {:id 1 :name "Ivan" :surname "Sidorov"}]</span><span class="w">
</span></code></pre></div>    </div>
  </li>
  <li>
    <p>Instead, with maps you cannot declare a partial function. You need to invent
your own <code class="language-plaintext highlighter-rouge">partial-map</code> implementation:</p>

    <div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">
</span><span class="c1">;; let `foo` is a function that accepts a map</span><span class="w">
</span><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">foo</span><span class="w"> </span><span class="p">[</span><span class="n">opt</span><span class="p">]</span><span class="w">
  </span><span class="n">opt</span><span class="p">)</span><span class="w">

</span><span class="c1">;; our own `partial`</span><span class="w">
</span><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">partial-map</span><span class="w"> </span><span class="p">[</span><span class="n">f</span><span class="w"> </span><span class="n">defaults</span><span class="p">]</span><span class="w">
  </span><span class="p">(</span><span class="k">fn</span><span class="w"> </span><span class="p">[</span><span class="n">opt</span><span class="p">]</span><span class="w">
    </span><span class="p">(</span><span class="nf">f</span><span class="w"> </span><span class="p">(</span><span class="nb">merge</span><span class="w"> </span><span class="n">defaults</span><span class="w"> </span><span class="n">opt</span><span class="p">))))</span><span class="w">

</span><span class="c1">;; example:</span><span class="w">
</span><span class="p">(</span><span class="k">def</span><span class="w"> </span><span class="n">foo-timeout</span><span class="w"> </span><span class="p">(</span><span class="nf">partial-map</span><span class="w"> </span><span class="n">foo</span><span class="w"> </span><span class="p">{</span><span class="no">:timeout</span><span class="w"> </span><span class="mi">5</span><span class="p">}))</span><span class="w">

</span><span class="p">(</span><span class="nf">foo-timeout</span><span class="w"> </span><span class="p">{</span><span class="no">:bar</span><span class="w"> </span><span class="mi">42</span><span class="p">})</span><span class="w">
</span><span class="p">{</span><span class="no">:bar</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="no">:timeout</span><span class="w"> </span><span class="mi">5</span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>
  </li>
</ol>

<h3 id="conclusion">Conclusion</h3>

<p>The examples above show there are more then one way to deal with multiple
arguments in Clojure. These are multi-arity, maps and rest arguments. All of
them cover you common requirements as well.</p>

<p>Remember, you are not limited with the only three those ones. With macroses, you
can implement you own arguments system: Common Lisp-wise or any other. The only
limit there is your imagination.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/not-love/">Нелюбовь</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2017-06-15T00:00:00+00:00">
        Jun 15, 2017
    </time>

    <a href="/tag/movies/" rel="tag">movies</a>

</div>


            <div class="entry">
                
                    
<p><img src="http://ic.pics.livejournal.com/dolboeb/53631/1354853/1354853_original.jpg" alt="cover" /></p>

<p>Посмотрел Звягинцева.</p>

<p>Переполняют чувства, но писать рецензии как <a href="http://dolboeb.livejournal.com/3154585.html">Носик</a> я не умею, поэтому
буду краток.</p>

<p>Великое кино. Шедевр от вступительных титров до последнего кадра.</p>

<p>Поражает невероятная точность, натуральность сцен, поведения, реплик. Кажется,
ни одна деталь реальности не ушла от режиссера, в том числе интимные
подробности. Но они не перетягивают на себя лишнее внимание. Напротив, еще
сильнее утверждают правдивость происходящего.</p>

<p>Очень реалистичны персонажи, фразы, поведение. Приемы, к которым они прибегают,
чтобы обманывать себя и окружающих. Ощущение, что смотришь в микроскоп, только
вместо капли воды – московская семья, средневзвешенный элемент российского
общества.</p>

<p>Бывает, мы говорим: это было как в кино. То есть волшебно, непонятно, не так как
мы привыкли. А у Звягинцева – как в жизни. И это пугает, потому что понимаешь,
что все происходящее может завтра случиться с тобой.</p>

<p>Так же столкнешься с бездействием ментов, произволом на всех уровнях, офисным
рабством, пасьянсом “косынка” в ожидании обеда. Православным начальстом, греющим
руки на строительстве храма.</p>

<p>И конечно, недостатком внимания к тем, кто рядом и заслуживает этого.</p>

<p>Каждую сцену можно просматривать бесконечно: включается латентный
вуайерист. Словно подглядываешь за чьей-то жизнью, и все фейлы, измены видны, как
день.</p>

<p>Сцена с Киселевым и Украиной следует за сценой с моргом. Обе они дают декартово
произведение ужаса и тоски. В тот момент в кинотеатре я почуствовал, будто в
сердце что-то воткнули.</p>

<p>После просмотра я точно понял, чего хочу в широком смысле. Быть счастливым. В
нелюбви и в несчастье нет дна.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/en/read-24/">What to read #24</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2017-06-11T00:00:00+00:00">
        Jun 11, 2017
    </time>

    <a href="/tag/read/" rel="tag">read</a>, <a href="/tag/life/" rel="tag">life</a>

</div>


            <div class="entry">
                
                    <ul>
  <li>
    <p><a href="http://tonsky.me/blog/readable-clojure/">Readable Clojure</a></p>

    <p>Interesting notes on how to improve your Clojure code.</p>
  </li>
  <li>
    <p><a href="http://deathbypassivevoice.com/all/resource/">Writing on Resource</a></p>

    <blockquote>
      <p>I never write when I get a good idea. I only try to write when I find
suitable resource to illustrate that idea.</p>
    </blockquote>
  </li>
  <li>
    <p><a href="http://gigasquidsoftware.com/blog/2017/05/27/self-publishing-for-the-creative-coder/">Self Publishing for the Creative Coder</a></p>

    <blockquote>
      <p>So, you have an idea for a fiction book. First, let me tell you that it’s a
good idea and it’s a great thing that you are a coder.</p>
    </blockquote>
  </li>
  <li>
    <p><a href="http://varlamov.ru/2416234.html">Жизнь в гробу</a></p>

    <p>Фотографии гонконгских квартир-клеток.</p>
  </li>
  <li>
    <p><a href="http://sergeykorol.ru/blog/discriminatory-discrimination/">Бесправная дискриминация</a></p>

    <p>Сергей Король о гендере и пр.</p>

    <blockquote>
      <p>Ну и вообще готовьтесь. Кажется, общество скоро будет прилично штормить
из-за этой фигни.</p>
    </blockquote>
  </li>
  <li>
    <p><a href="https://www.youtube.com/watch?v=_l0LVFRuHMk">Noize MC - Чайлдфри (feat. монеточка)</a></p>

    <p>Прекрасный клип.</p>
  </li>
</ul>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/en/bugs/">Does any program really have an unlimited number of bugs?</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2017-06-03T00:00:00+00:00">
        Jun 3, 2017
    </time>

    <a href="/tag/bugs/" rel="tag">bugs</a>, <a href="/tag/yegor256/" rel="tag">yegor256</a>

</div>


            <div class="entry">
                
                    
<p>I really enjoy reading <a href="http://www.yegor256.com/">Yegor’s blog</a>. He brings quite interesting
ideas regarding programming and business. But sometimes, the thoughts he shares
there look a bit strange to me. I’m talking about one of the latest posts
titled <a href="http://www.yegor256.com/2017/05/23/unlimited-number-of-bugs.html">“Any Program Has an Unlimited Number of Bugs”</a>.</p>

<p>I’m writing this in reply to Yegor’s points mentioned there. Please read them
first. To focus on the key notes, let me quote the most sensitive part:</p>

<blockquote>
  <p>Let’s take this simple Java method that calculates a sum of two integers as an
example:</p>
</blockquote>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">sum</span><span class="o">(</span><span class="kt">int</span> <span class="n">a</span><span class="o">,</span> <span class="kt">int</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<blockquote>
  <p>How about these bugs:</p>

  <ul>
    <li>It doesn’t handle overflows</li>
    <li>It doesn’t have any user documentation</li>
    <li>Its design is not object-oriented</li>
    <li>It doesn’t sum three or more numbers</li>
    <li>It doesn’t sum double numbers</li>
    <li>It doesn’t cast long to int automatically</li>
    <li>It doesn’t skip execution if one argument is zero</li>
    <li>It doesn’t cache results of previous calculations</li>
    <li>There is no logging</li>
    <li>Checkstyle would complain since arguments are not final</li>
  </ul>
</blockquote>

<p>Well, the points highlighted above make me really uncertain about what really
Yegor meant. And since he didn’t answer me in the commentary section, I will put
my thoughts on that in my own blog.</p>

<p>Let’s look closer at some of them.</p>

<p><strong>It doesn’t have any user documentation</strong></p>

<p>The question is, do you really think we need documentation for <code class="language-plaintext highlighter-rouge">sum</code> function?
What will you put there? I cannot guess nothing other than <code class="language-plaintext highlighter-rouge">It adds two
integers</code>. So what the reason for having it in our code?</p>

<p>In a previous project, I had a teammate who was a fan of docstrings. Every
module, a class or a method should have a docstring, he said. The code he wrote
looked like a school composition. You could not ship your code without his
comments something like “add docs here and there plz”.</p>

<p>Since our product was developing rapidly, we had to change the code all the
time. Surely, we used to forget to update those docstrings because it took extra
time. It was even worse because the docstrings didn’t tell the truth
anymore. Nobody believed them as a result.</p>

<p>What we need <code class="language-plaintext highlighter-rouge">sum</code> documentation for? How should it look like? Who will read
this documentation? A user? I doubt it. A programmer? Even programmers need not
a machinery-generated HTML made of docstrings, but human-written manuals with
examples and snippets.</p>

<p>When you open a particular GitHub project, what do you do first? Reading the
code? No, you scroll down for <code class="language-plaintext highlighter-rouge">README</code> or click on <code class="language-plaintext highlighter-rouge">Wiki</code> link. Digging the
source code is the last thing you would make if something works not well.</p>

<p>Let’s recall what <a href="http://kotaku.com/5975610/the-exceptional-beauty-of-doom-3s-source-code">does one say</a> on DOOM III source code and ID Software
code standards in general:</p>

<blockquote>
  <p>Code should be self-documenting. Comments should be avoided whenever
possible. Comments duplicate work when both writing and reading code. If you
need to comment something to make it understandable it should probably be
rewritten.</p>
</blockquote>

<p><strong>Its design is not object-oriented</strong></p>

<p>We all know Yegor is passionate by OOP. But really, naming a function buggy just
because it’s non-OOP designed is not fair.</p>

<p>What would happen if we had an OOP version of <code class="language-plaintext highlighter-rouge">sum</code> function? I can imagine
something messy like this:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Adder</span> <span class="n">adder</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Adder</span><span class="o">();</span>
<span class="n">adder</span><span class="o">.</span><span class="na">setA</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
<span class="n">adder</span><span class="o">.</span><span class="na">setB</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
<span class="nc">Integer</span> <span class="n">result</span> <span class="o">=</span> <span class="n">adder</span><span class="o">.</span><span class="na">getResult</span><span class="o">()</span> <span class="c1">// 3</span>
</code></pre></div></div>

<p>We’ve got lot more problems here. The number of lines grew up from 1 to 4
(compare to <code class="language-plaintext highlighter-rouge">add(1, 2)</code>). In addition, now <code class="language-plaintext highlighter-rouge">adder</code> object also keeps it’s own
state. How may I track whether <code class="language-plaintext highlighter-rouge">.setA</code> was called or not? What will happen if I
forget to put <code class="language-plaintext highlighter-rouge">.setB</code> in my code? Will it get a <code class="language-plaintext highlighter-rouge">Null</code> value or an exception
raised?</p>

<p>What will happen if I share <code class="language-plaintext highlighter-rouge">adder</code> object across multiple threads so they call
<code class="language-plaintext highlighter-rouge">setA</code>, <code class="language-plaintext highlighter-rouge">setB</code> and <code class="language-plaintext highlighter-rouge">getResult</code> simultaneously? Nobody would predict the result.</p>

<p>Functional programming teaches us to avoid having state and keep the things
simple. Having a small function without any state rather than manipulating with
objects will pay off for sure.</p>

<p><strong>It doesn’t sum three or more numbers</strong></p>

<p>Surely, if you a Java programmer, you’ve got a problem. Because there is nothing
you can do without rewriting the code. But if you are aware of FP-style and you
have your <code class="language-plaintext highlighter-rouge">add</code> function, you simply do:</p>

<div class="language-lisp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nb">reduce</span> <span class="nf">#'</span><span class="nv">add</span> <span class="p">(</span><span class="nb">list</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)</span> <span class="ss">:initial-value</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">;; common lisp</span>
<span class="p">(</span><span class="nb">reduce</span> <span class="nv">add</span> <span class="mi">0</span> <span class="nv">[1</span> <span class="mi">2</span> <span class="nv">3]</span><span class="p">)</span>                       <span class="c1">;; clojure</span>
</code></pre></div></div>

<p>or, in Python:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">reduce</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
</code></pre></div></div>

<p>This is definitely the right way with <code class="language-plaintext highlighter-rouge">reduce</code> also known as <code class="language-plaintext highlighter-rouge">fold</code>. You don’t
need to write a function that adds million of integers. Instead, you add just
two! And <code class="language-plaintext highlighter-rouge">reduce</code> will care of how to spread it across a sequence of data.</p>

<p>That’s normal to focus on simplest cases and primitive operations first. Then
you build abstractions with high-order functions based on primitives. It makes
the code easier to understand and debug.</p>

<p><strong>It doesn’t sum double numbers</strong> and <strong>It doesn’t cast long to int
automatically</strong></p>

<p>I don’t know if it is really a bug. On the one hand, it would be great to have a
function that adds everything. Again, within any Lisp dialect or Python I may
have it easily. Instead, with static typing you have to write more code.</p>

<p>But on the other hand, having exact <code class="language-plaintext highlighter-rouge">integer</code> types might be some kind of
specific requirement made by design. It could be an utility function that adds
to years or any numbers that do not exceed a couple of thousands. So it’s
difficult to judge without a full context (I’ll say more on that below).</p>

<p><strong>It doesn’t skip execution if one argument is zero</strong></p>

<p>I really doubt it will increase the performance. Adding zero to an integer costs
really nothing on modern hardware. The compilers are smart enough to deal with
such cases. But putting an extra <code class="language-plaintext highlighter-rouge">if</code> clause will definitely increase the number
of instructions because now your program makes a comparison step.</p>

<p>This is exactly what did Knuth say about preliminary optimization. You don’t
even have any metrics about what runs faster: adding zero of extra <code class="language-plaintext highlighter-rouge">if</code>
statement. You even don’t now how frequently your function will be called with
zero argument. I might be 1 time per 100k calls so your trick is made in vain in
that case.</p>

<p>It does not worth it, after all.</p>

<p><strong>It doesn’t cache results of previous calculations</strong></p>

<p>I’m sure any cache system brings as many problems as it solves. First, where
would you store that cache? In application’s memory? In Memcache? User’s
cookies?</p>

<p>Then, you program could sum million of numbers per second. Every cache call
needs al least <code class="language-plaintext highlighter-rouge">O(C)</code> or <code class="language-plaintext highlighter-rouge">O(logN)</code> time to lookup a value. You will slow down
your program dramatically with such approach when caching small functions.</p>

<p><strong>There is no logging</strong></p>

<p>The same claims are here: what exactly are you going to log? Who will read that
logs and how often? For what purpose you want to store such kind of logs? Where
would you store such amount of logs? Did you estimate the slowdown that you will
bring to your system by adding logging? What if some of Ops team would
misconfigure logging system and add email handler to that logger? Or sending SMS
message?</p>

<p>Finally, this function is taken <strong>completely out of the scope</strong> so it’s
impossible to judge on its quality. We should never examine a single function
but only their composition instead. Every function has its own weaknesses and
strengths. Linked together properly they build a system. In such a system,
weakness of any specific function is supported by another function that
validates data, filters input params, cleans up system symbols and so forth.</p>

<p>What I want exactly to say is there is nothing criminal in such a function that
adds to integers. If it’s surrounded with another function that ensures that
both numbers are really integers, there is no need to do all that validations
again when adding them. In our projects, we usually separate our application on
several levels. On the top level of the application, threre is one that
validates the input data. If they are fine, functions on the next level operate
on them as well.</p>

<p><strong>In conclusion</strong>, please avoid using word “bug” when you talk about lack of
logging or caching. Probably you don’t need that stuff. Keep functions free of
having state and producing side effects. When you afraid of the data you use may
be incorrect (Nulls, overflows), don’t rush into adding nested <code class="language-plaintext highlighter-rouge">if</code>s. You’d
rather update your validation logic first.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/copyright/">Об авторском праве</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2017-05-29T00:00:00+00:00">
        May 29, 2017
    </time>

    <a href="/tag/copyright/" rel="tag">copyright</a>

</div>


            <div class="entry">
                
                    <p>Коллеги заспорили о проблемах копирайта: можно ли качать торренты или нельзя,
воруешь ли ты при этом или нет и так далее. А я решил сесть и записать все, что
думаю по этому поводу.</p>

<p>Главная проблема авторского права состоит в том, что до недавнего времени люди
мерили собственность и богатство материальными единицами. Долларами, квадратными
метрами, тоннами. В классическом предствалении богач – это тот, у кого чего-то
много. Это самое “много” легко представить или изобразить. У богатого человека
большой дом, огромная фабрика, мощный параход.</p>

<p>В материальном мире одна и та же вещь не может существовать дважды. Поэтому у
каждой вещи только один владелец. Если у человека забрать что-то материальное,
это сразу станет заметно. Так ввели понятие кражи, определили институты закона и
суда. Человек додумался до этого еще несколько тысяч лет назад. Базовые нормы
общества вроде “не укради” опираются на аналоги, разработанные в Древнем Риме.</p>

<p>Цифровые технологии изменили восприятие собственности. Впервые человек
столкнулся с тем, что определенный тип материи может быть скопирован практически
бесплатно. Это вкорне противоречит привычной модели материальных благ. Чтобы
скопировать устройство, например, зарубежный фотоаппарат, подводную лодку или
атомную бомбу, нужны ресурсы, намного превышающие затраты на постройку
оригинала.</p>

<p>Индустрия не была готова к такому феномену и до сих пор пребывает в фазе
медленного перехода к чему-то осмысленному. Этим объясняются случаи нарушения
прав человека, баснословные штрафы, судебные тяжбы.</p>

<p>Мысль о бесплатном копировании чего угодно пугает неопределенностью. Мы
привыкли, что любой ресурс конечен. Среднестатический человек тратит четверть
жизни на обучение, чтобы устроиться на работу и поддерживать материальное
состояние. Тысячи людей по всему миру живут только затем, чтобы к вечеру
заработать на еду.</p>

<p>Идея неограниченного копирования сродни идеи о бессмертии или полете. Никто не
знает, что станет с человечеством, если подобное случится. Но нетрудно
предположить, что мир кардинально изменится, причем не в лучшую сторону для тех,
кто сейчас в выигрышном положении.</p>

<p>Рассуждая об объектах авторского права, стоит признать, что принцип дешевого
копирования заложен в них изначально. Примерно как метод половинного деления
заложен в живой клетке, но не автомобиле. В рассуждениях об авторском праве
нельзя ссылаться или приводить аналогии на материальные ценности: колбасу,
золото и т.д.</p>

<p>Регулярно возникают случаи нарушения авторских прав, и я хотел бы поговорить об
этом подробней. Некоторые аспекты копирайтинга мне кажутся спорными. Да, они
утверждены законом, но только одно это не мотивирует их соблюдать, поскольку
закон относителен. Одно и то же может быть нормой в одной стране и преступлением
в другой. Скажем, ловля покемонов в храме или съемка порнографии.</p>

<p>Прежде всего, я ставлю под сомнение законность передачи авторского права по
наследству или в дар. Оно не должно автоматически переходить в собственность
родственников: детей, внуков. Это вредит всем участникам. Наследник получает
актив, к которому он не прикладывал ни малейших усилий. Отношение к нему
соответствующее: пусть лежит и приносит деньги. Поскольку юридические владельцы
не наследуют таланты первичного автора, развитием продукта они не занимаются.</p>

<p>Что касается игр, здесь ситуация однозначно меняется к лучшему. Еще 10 лет назад
было нормально качать торренты, переписывать игры на болванки, искать кряки и
серийные номера. А сегодня есть Стим, который свел пиратство игр на
нет. Благодаря Стиму среди моих знакомых не осталось никого, кто бы ставил игры
из неофицальных источников.</p>

<p>К сожалению, ситуация с фильмами не развивается столь же положительно. В
киноиндустрии бытует ошибочное мнение, что если фильм утечет в сеть, зрители
посмотрят его дома и не пойдут в кинотеатры. Это не отвечает реальности. Поход в
кинотеатр отличается от домашнего просмотра атмосферой. Впечатления от большого
экрана мощнее, а поход в кино – отдельное событие. Хороший повод разнообразить
отдых, сходить на свидание, собраться друзьями – да мало ли что еще.</p>

<p>С момента изобретения кино некоторые эксперты пророчили смерть театрам. Зачем
ехать в вечернее время в центр города, наряжаться, соблюдать этикет? С
изобретением телевидения даже потребность в кино отпадает, утверждали
эксперты. Все можно посмотреть дома. И тем не менее, театры востребованы. У кого
есть дети, знают, что брать билеты на спектакли нужно за месяц вперед: раскупают
мгновенно.</p>

<p>Аналогично с концертами и фестивалями. Если предложить фанату вернуть билет на
выступление любимой группы с предложением посмотреть на экране, он просто
покрутит пальцем у виска.</p>

<p>Невозможно сейчас вспомнить фильм, чей кассовый сбор значительно бы пострадал от
утечки в сеть. Сразу же после премьер в кинотеатрах торрент-трекеры наводняют
кам-рипы – снятые на скрытые камеры копии. Опять же, нет никаких показателей,
как это влияет на прибыльность фильма. По моему опыту, камрип – это вынужденная
мера, когда достать более достойную версию физически невозможно. Но в наше время
это уже не актуально.</p>

<p>Поиск фильма по фразе “смотреть онайн бесплатно” перебрасывает человека на
сайты, увешанные баннерами и виджетами. Экран застилают предложения что-то
увеличить. Подобным сайтам, в общем-то, все равно, что пользователь
уходит. Главное – скормить ему максимум рекламного трафика. В следующий раз
пользователь все равно прилетит из Гугла на этот же сайт или его зеркало в
поисках другого фильма.</p>

<p>Как бы ни был безграмотен в компьютерном плане пользователь, он догадывается,
что такое положение дел неправильно. Это как будто закрылись магазины, и ты
ходишь по барыгам.</p>

<p>Вопрос, почему полулегальные сайты стоят в выдаче поисковика выше официальных?
Неужели у поборников авторских прав нет денег на раскрутку?</p>

<p>Да, некоторые фильмы можно легально просмотреть на Ютубе, купить в магазинах
Эппла и Гугла. Но опять же, новинки попадают туда с опозданием. Другой минус
состоит в том, что покупая там, пользователь очень стеснен в выборе и правах.</p>

<p>В онлайн-магазине вы не можете выбрать языковую дорожку. Ваш аккаунт намертво
привязан к стране и правовым нормам, которые запрещают купить фильм в
оригинальной озвучке, если вы, например, из России. Только дубляж. Никому не
интересно, что ты учишь английский или французский. Я помню, лет 15 назал
покупатели массово требовали русский язык в пиратских релизах. Сегодня,
наоборот, чтобы скачать английскую версию, пользовтель вынужден серфить
торренты.</p>

<p>Я в корне не согласен с тем, что нельзя выбирать локализацию продукта.</p>

<p>Защитники авторских прав утверждают, что терпят колоссальные убытки от пиратства
и торрентов. Называют колоссальные цифры, рассказывают, кто из музыкантов
сколько недополучил. Подвох кроется в том, что ни в одном отчете не сказано, как
именно считались убыки и как они структурированы в принципе.</p>

<p>Помните, как считали потери в Микрософте? Брали число школьников, у которых дома
пиратская Винда’98 и умножали на стоимость лицензии. Получали дутые суммы, в то
время как никаких убытков не было. Напротив, именно пиратские версии заполонили
компьютеры пользователей. Со временем пользователи легализировались. Люди
взрослеют, у них заводятся деньги, и с какого-то момента человеку становится
проще купить коробку и вбить номер с нее, чем лазить по левым сайтам в поисках
ключа.</p>

<p>Статисты с маниакальной тщательностью подсчитывают убытки от нелегальных копий,
но игнорируют вопрос: купил ли бы продукт пользователь, если бы действительно не
имел доступа к пиратскому контенту? Вспоминая детство, однозначно отвечаю нет.</p>

<p>Не учитывается факт, что сегодня, при наличии быстрого интернета и свободного
места на дисках, много фильмов, музыки и игр скачивается просто так. Синдром
Плюшкина: скачаю, а потом, может быть, послушаю-посмотрю. У каждого из нас есть
на компьютере папочка с пиратскими книгами и фильмами, до которых мы никогда не
доберемся из-за нехватки времени. Книга качается 10 секунд, а читать ее нужно
месяц. Игра установлена, но некогда даже посмотреть вступительный ролик. Поэтому
умножать стоимость фильма на число скачиваний просто нелепо.</p>

<p>Поборники авторских прав проникли в современные облачные технологии. Поскольку
каждое устройство подключено к сети и непрерывно держит связь с сервером, любой
купленный продукт может быть отозван, а устрйство – заблокировано. Описаны
случаи, когда при пересечении границы Гугл удалял с планшетов электронные
книги. Вам нельзя читать их на территории этой страны. Извините, лицензионное
соглашение. Вот вернетесь – скачаются заново.</p>

<p>Идея о том, что нельзя что-то читать, слушать или смотреть при перемещении на
несколько сотен киломентров, кажется мне сошедшей со страниц 1984.</p>

<p>В какой-то момент Айтюнс удалил с моего телефона честно купленный альбом. Не
было ни писем, ни смс. Эппл не посчитал нужным сообщать о причинах
проишествия. Ссылки на альбом ведут в никуда. Конечно, через 15 минут я скачал
торрент.</p>

<p>Игроки-пользователи Стима и Близзарда отмечают схожее поведение компаний при
переезде в другие страны. Как только россиянин входит в Стим из США, аккаунт
блокируется. Начинается долгая тяжба по его восстановлению. Формально это
объясняется проверками на взлом, но, по неофициальным данным, реальная причина
связана с правовыми нормами и лицензионными соглашениями.</p>

<p>Права на игру, выпущенные в одном регионе, не тождественны правам на ту же игру
в другом регионе. В теории, они могу быть равны, но чтобы точно убедиться, нужны
человеческие ресурсы, помощь юристов. Чем больше игр купил пользователь, тем
сложней ситуация. В случае ошибки засудят на крупные суммы. Поэтому фирмы
затягивают восстановление аккаунта и неформально подталкивают пользователя к
регистрации нового с повторной покупкой тех же игр, но уже изданных в США.</p>

<p>Нужно понимать, что любой продукт, даже самый коммерческий, со сременем
становится частью культуры, в рамках которой он создается. Любая человеческая
мысль, сюжет или персонаж является компиляцией чужих идей и образов. Например,
писатель находит вдохновение в прогулках по парку. Обязан ли он платить фирме,
занимающейся содержанием парка? Или автор написал интересную книгу. Как быть с
тем фактом, что другие люди прочли ее, сформировали мнение, поделились эмоциями,
посоветовали друзьям ее купить?</p>

<p>Эти процессы невозможно отследить, посчитать и выразить в национальной
валюте. Правообладателям выгодней о них забыть. Использовать их в дискуссии
невозможно.</p>

<p>Представьте себе, что внезапно ожили древние римляне и потребовали выплат за
использование имен богов в названиях космических кораблей и студий
красоты. Кирилл и Мефодий запросли авторские отчисления за кириллицу. А чтобы
выплатить гонорар изобретателю колеса за каждый факт его применения, у
человечества не хватило бы суммарных денег.</p>

<p>Поскольку широкая аудитория есть главный потребитель фильмов, игр, книг, с ней
нужно считаться. В этом смысле толпа ведет себя как жидкость: если сжимать в
одном месте, давление передастся в другое. Иначе говоря, систематически
расстраивая потребителя ограничениями и штрафами, поборники авторских прав
подталкиваю его к пиратскому контенту.</p>

<p>Копирайтеры, возможно, видят мир немного иным, где каждый озадачен проблемой
легальности. Перед просмотром фильма или кликом по ссылке пользователь
взвешивает: не нарушаю ли я права, а если да, то чьи и на какую сумму. В
реальности потребитель бесхитростен и совершенно безграмотен в этом
вопросе. Если браузер показывает, значит, смотреть можно – вот его аргументы.</p>

<p>Возможно, кто-то догадывается, что качать фильмы с сайтов с рекламой казино
нелегально. Но обычно у людей нет на это времени. У них работа, дети, вечный
завал. Проблемы нарушения авторских прав не в их мире. В онлайн магазине форма
регистрации занимает два экрана, а тут бесплатно.</p>

<p>Задача индустрии в том, чтобы сделать качественные сервисы с удобной навигацией
и оплатой. Чтобы они всплывали в поисковиках раньше полулегальных сайтов. В
идеале, последние вообще должны исчезнуть с первых страниц выдачи Гугла и
Яндекса и стать уделом маргиналов.</p>

<p>Легко видеть, что проблема не имеет однозначного решения. Даже на то, чтобы
связно выразить точку зрения, ушло несколько дней. Не называйте ворами тех, кто
качает торренты, умерьте пыл. Возможно, прямо сейчас вы нарушаете дюжину
лицензионных соглашений, которые промотали в момент установки, а там было
анальное рабство.</p>

<p>Правильное решение придет со временем.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/en/read-23/">What to read #23</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2017-05-21T00:00:00+00:00">
        May 21, 2017
    </time>

    <a href="/tag/read/" rel="tag">read</a>, <a href="/tag/life/" rel="tag">life</a>

</div>


            <div class="entry">
                
                    <p>The last time I had to skip the rubric. Here are a couple of more links to
compensate that:</p>

<ul>
  <li>
    <p><a href="http://softwaremaniacs.org/blog/2017/05/13/http-status-codes-strings/">Treat Http Status Codes As Strings</a></p>

    <p>An interesting advise from Ivan Sagalaev. Makes sense, but honestly I prefer
boolean <code class="language-plaintext highlighter-rouge">ok</code> flag that represents whether your HTTP request has finished with
2xx status.</p>
  </li>
  <li>
    <p><a href="http://www.yegor256.com/2017/05/02/remote-slaves.html">A Remote Slave Is Still a Slave</a></p>

    <p>As a remote worker, I could not pass through without sharing a link.</p>
  </li>
  <li>
    <p><a href="http://wiki.c2.com/?BenefitsOfDynamicTyping">Benefits Of Dynamic Typing</a></p>

    <p>A long paper full of random thoughts on dynamic typing. Don’t even remember
how I managed to find this link, but it worth reading it.</p>
  </li>
  <li>
    <p><a href="http://www.gigamonkeys.com/book/introduction-why-lisp.html">Why Lisp?</a></p>

    <p>An introduction to the legendary Practical Common Lisp book.</p>
  </li>
  <li>
    <p><a href="https://snob.ru/selected/entry/124326">10 цитат из Моэма, за которые вас посадят</a></p>

    <p>Да в общем-то, ничего криминального.</p>
  </li>
  <li>
    <p><a href="http://kompotique.ru/useful-comments/">Полезные комментарии</a></p>

    <p>Ознакомьтесь, если все-таки решили написать комент с соцсети.</p>
  </li>
  <li>
    <p><a href="http://artgorbunov.ru/bb/soviet/20170423/">К двум вопросам возвращаюсь постоянно</a></p>

    <p>Работа, деньги, переговоры.</p>
  </li>
  <li>
    <p><a href="https://sexynotes.quora.com/">Sexy Notes</a></p>

    <p>An interesting blog of Susan James, a sexual researcher.</p>
  </li>
</ul>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/en/dos-and-donts/">Do's and Don'ts</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2017-05-12T00:00:00+00:00">
        May 12, 2017
    </time>

    <a href="/tag/english/" rel="tag">english</a>, <a href="/tag/dos-and-donts/" rel="tag">dos-and-donts</a>

</div>


            <div class="entry">
                
                    <p>Here is a short list of rules I try to follow when working:</p>

<h3 id="database">Database</h3>

<ul>
  <li>
    <p>Avoid using nullable fields in your DB. Put <code class="language-plaintext highlighter-rouge">not null</code> everywhere you can when
defining a table. Assign a default blank value if submitting a field is not
necessary:</p>

    <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">create</span> <span class="k">table</span> <span class="n">foo</span> <span class="p">(</span>
  <span class="p">...</span>
  <span class="k">comment</span> <span class="nb">text</span> <span class="k">not</span> <span class="k">null</span> <span class="k">default</span> <span class="s1">''</span><span class="p">,</span>
  <span class="k">count</span> <span class="nb">integer</span> <span class="k">not</span> <span class="k">null</span> <span class="k">default</span> <span class="mi">0</span>
<span class="p">);</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Keep your database migrations in raw <code class="language-plaintext highlighter-rouge">*.sql</code> files. Wrap each migration into
transaction explicitly putting <code class="language-plaintext highlighter-rouge">begin;</code> and at the top of file and <code class="language-plaintext highlighter-rouge">commit;</code>
at the bottom:</p>

    <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">--</span>
<span class="c1">-- A short comment about what this migration does.</span>
<span class="c1">--</span>
<span class="k">begin</span><span class="p">;</span>

<span class="k">update</span> <span class="n">foo</span> <span class="k">set</span> <span class="n">bar</span> <span class="o">=</span> <span class="mi">42</span> <span class="k">where</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">100500</span><span class="p">;</span>

<span class="k">alter</span> <span class="k">table</span> <span class="n">baz</span> <span class="k">drop</span> <span class="k">column</span> <span class="n">test</span><span class="p">;</span>

<span class="k">commit</span><span class="p">;</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Don’t delete anything from your DB. Add <code class="language-plaintext highlighter-rouge">deleted</code> boolean flag that is false
by default and put <code class="language-plaintext highlighter-rouge">AND NOT mytable.deleted</code> in <code class="language-plaintext highlighter-rouge">WHERE</code> or <code class="language-plaintext highlighter-rouge">JOIN</code> statements:</p>

    <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">foo</span> <span class="k">where</span> <span class="k">not</span> <span class="n">deleted</span><span class="p">;</span>
</code></pre></div>    </div>

    <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">select</span> <span class="o">*</span><span class="p">.</span><span class="n">f</span><span class="p">,</span> <span class="o">*</span><span class="p">.</span><span class="n">b</span>
<span class="k">from</span> <span class="n">foo</span> <span class="n">f</span>
<span class="k">left</span> <span class="k">join</span> <span class="n">bar</span> <span class="n">b</span> <span class="k">on</span> <span class="n">foo</span><span class="p">.</span><span class="n">bar_id</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="n">id</span> <span class="k">and</span> <span class="k">not</span> <span class="n">b</span><span class="p">.</span><span class="n">deleted</span><span class="p">;</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>For each table, add <code class="language-plaintext highlighter-rouge">created_at</code> that fixates creation time automatically:</p>

    <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">create</span> <span class="k">table</span> <span class="n">foo</span> <span class="p">(</span>
  <span class="p">...</span>
  <span class="n">created_at</span> <span class="nb">timestamp</span> <span class="k">not</span> <span class="k">null</span> <span class="k">default</span> <span class="k">current_timestamp</span><span class="p">;</span>
<span class="p">);</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Once you’ve got any geographical data (locations, areas, routes), install
PostGIS extension without inventing your own “smart” algorithms. They will let
you down one Friday evening.</p>
  </li>
  <li>
    <p>Postgres is great for full-text searching. Try to deal with standard
PostgreSQL capabilities before installing Elastic, Sphinx and related stuff.</p>
  </li>
  <li>
    <p>Avoid using ORMs. A small wrapper that parses <code class="language-plaintext highlighter-rouge">*.sql</code> files and creates plain
functions would be enough.</p>
  </li>
  <li>
    <p>Don’t use triggers to implement business logic. Such behaviour is quite
implicit and difficult to maintain. And business rules change all the time.</p>
  </li>
</ul>

<h3 id="code">Code</h3>

<ul>
  <li>
    <p>Don’t align you code with spaces like it’s shown below. Use one space only.</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">foo</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s">"short"</span><span class="p">:</span>              <span class="mi">1</span><span class="p">,</span>
  <span class="s">"a-bit-longer"</span><span class="p">:</span>       <span class="mi">2</span><span class="p">,</span>
  <span class="s">"very-very-long-one"</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Write unit tests for both server and UI sides immediately once you’ve started
a new project.</p>
  </li>
  <li>
    <p>Classes are not data. Prefer plain data structures like lists and maps over
classes. Usually, structures are fast and covers the most of requirements.</p>
  </li>
  <li>
    <p>Try to follow functional approach when develop a program. Avoid keeping state
where it can be skipped. Separate IO from code that does pure calculations.</p>
  </li>
</ul>

<h3 id="frontend">Frontend</h3>

<ul>
  <li>
    <p>Don’t use vanilla Javascript. Use such modern technologies as ClojureScript,
TypeScrip or Elm to develop without pain in the ass. Consider JS as necessary
evil running under the hood to ship your application.</p>
  </li>
  <li>
    <p>Don’t make SAPs (single page applications). Usually they work poorly, the
layout leaks, you cannot open a link in a new window and they break W3C
standards.</p>
  </li>
  <li>
    <p>Even with Javascript turned off, your client must see important information on
their screen.</p>
  </li>
  <li>
    <p>Don’t make you own widgets to substitute standard ones (inputs, drop-downs,
etc).</p>
  </li>
  <li>
    <p>Never interrupt a user with alerts, pop-ups, splashes.</p>
  </li>
  <li>
    <p>Never claim on Ad-Block enabled. It’s so ridiculous. It’s users choice what
software to use when browsing the Internet.</p>
  </li>
</ul>

<h3 id="architecture">Architecture</h3>

<ul>
  <li>
    <p>Don’t make micro-services. Try to keep the whole codebase within. Run
different domains of your application in separate threads as components.</p>
  </li>
  <li>
    <p>Queues might help a lot. Don’t invent your own message queue facility. Use
Rabbit, ZeroMQ or even Redis.</p>
  </li>
  <li>
    <p>For message processing, use text format but not binary one. You are not Google
with their proto-bufs invented to break down network limitations.</p>
  </li>
  <li>
    <p>Writing logs in a file and <code class="language-plaintext highlighter-rouge">tail</code>ing them via SSH is a mess. Write all the
logs into (remote) syslog, either your own one or any third-party one. Syslog
brings huge capabilities with logs processing.</p>
  </li>
  <li>
    <p>Never commit to master branch directly (set that option in your Git
config). Use the simplest Git pipeline you can imagine:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>master -&gt; feature-branch -&gt; commits -&gt; pull request -&gt; review -&gt; merge
</code></pre></div>    </div>
  </li>
  <li>
    <p>JSON is bad when configuring software: lots of braces, no comments. Take YAML.</p>
  </li>
</ul>

<h3 id="programming-languages">Programming languages</h3>

<ul>
  <li>
    <p>Prefer those languages that could give you a single compiled file as a result
of you effort (both binary or bytecode). C-family, Go, Rust, Haskell,
Java-family are OK. PHP, Python, Ruby, Perl, JavaScript are less OK.</p>
  </li>
  <li>
    <p>Take a look at functional languages even you don’t have intentions using them
in your daily work.</p>
  </li>
  <li>
    <p>You’d better try not modern languages but rather old ones. Smalltalk, Lisp,
OCaml would be a great choice.</p>
  </li>
</ul>

<h3 id="workspace">Workspace</h3>

<ul>
  <li>
    <p>Keep you desktop free from unused items.</p>
  </li>
  <li>
    <p>The more gadgets you need having around the less you are productive. Ideally,
you only need your Mac connected to the Internet.</p>
  </li>
  <li>
    <p>Use messagers on mobile only except those you need to communicate with your
customer. On my desktop, I have only Slask running with my customer’s
room. Leave Telegram, Skype, WhatsApp or whatever else on you phone and check
them rarely.</p>
  </li>
  <li>
    <p>Turn off all the notifications on you phone/desktop.</p>
  </li>
  <li>
    <p>Try to keep you developing tools simple. Choose text editor like Vim or Emacs
over IDE. Work with Git from a command line.</p>
  </li>
  <li>
    <p>Don’t work in open-space. A room with 3-4 people around is OK.</p>
  </li>
  <li>
    <p>Don’t read the news. Your friends will warn you if something really important
happens.</p>
  </li>
</ul>

<h3 id="communication">Communication</h3>

<ul>
  <li>
    <p>Don’t argue on Vim vs Emacs, Python vs Ruby and so on. It looks quite
unprofessional.</p>
  </li>
  <li>
    <p>If you full of thoughts you want to share with the world, open a blog or write
a book. But never argue on them in social networks or messagers.</p>
  </li>
  <li>
    <p>Even you are a remote worker, say Hi and Bye every time you’ve started or
finished your work day. Your team should know whether are you at the desk or
not.</p>
  </li>
  <li>
    <p>Be always polite.</p>
  </li>
  <li>
    <p>When you don’t know what to say, keep silence.</p>
  </li>
  <li>
    <p>Never afraid saying No.</p>
  </li>
  <li>
    <p>Read about negotiations.</p>
  </li>
  <li>
    <p>Invest time and money in improving your English skills.</p>
  </li>
</ul>

<p>This post is a snapshot of my <a href="https://github.com/igrishaev/dos-and-donts">Do’s And Don’ts</a> repository. You may always
find updates there.</p>


                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/en/english/">English</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2017-05-10T00:00:00+00:00">
        May 10, 2017
    </time>

    <a href="/tag/english/" rel="tag">english</a>, <a href="/tag/learn/" rel="tag">learn</a>, <a href="/tag/education/" rel="tag">education</a>

</div>


            <div class="entry">
                
                    <p><em>Disclaimer: this post just shapes my opinion on how to become better in
English. I’m not forcing anyone to follow the way I describe here. There are no
links, promo-codes, Skype contacts, etc to share. I believe you may google them
by yourself. The text given below is rather random advise that I consider to be
useful. I admit it could look a bit weird to you or even wrong, but I don’t
care.</em></p>

<p>You may notice I’ve been blogging in English for the last two month. That is not
because I’m so good at it. I’m really far away from reckoning myself as a
confident English speaker. The auditory of this blog are native Russian speakers
in most. So why switching then?</p>

<p>Well, I consider writing in English as additional effort to learn it.</p>

<p>Switching to another language also shifts something in your mind, I bet. It’s
not as simple as I wish, though. When write English posts, I often feel I sound
unnatural and the sentence looks artificial. Sometimes, I cannot find a proper
word to ship the idea with all its details.</p>

<p>In that post, I’m going to share a set of advise for those who just started
learning English. I’d like somebody gave me a hand several years ago. These are
just my opinion, though. Following them is up to you.</p>

<p>First, you agree that English is quite important. All the new materials nowadays
appear in English-speaking communities first. Blog posts, articles,
documentation, talks… It would take a long time before they come into Russian-
or any other Cyrillic-speaking group being translated poorly. Why wait for such
long?</p>

<p>Books? I’m feeling sad saying this, but I’ve stopped buying Russian IT books for
now. Usually they are outdated: up to decade of years might pass since the
original edition was issued. It’s OK though when you are interested in
particular academic knowledge or algorithms, O-complexity and everything that
has not been altered for years. For example, there are some quite good books on
C and Pascal in Russian.</p>

<p>But usually our books are made of extremely bad quality. They are issued with
lots of typos and missing spaces in the text. Even MS Word auto-correction could
indicate most of them. The page layout is terrible: thin margins, weird font,
large gaps or tunnels in paragraphs. Paperback’s quality is low. Opening such a
book twice breaks it in the middle on two half. Agrrr!</p>

<p>For the last year, I’ve been reading SICP in Russian edition. It suffers from
all the issues I covered above. I’m finishing it on Kindle nowadays.</p>

<p>Working with foreign customers brings more income. It also makes you more
independent and opens world-wide opportunities. Read my previous post on
<a href="/remote">remote working</a>.</p>

<p>I’m sure I was convincing on telling the reasons you should learn English. Now
we may focus on steps required.</p>

<p>Start with something simple: <strong>enable English language whenever you can.</strong> In
your phone, computer or a tablet. Choose English over your mother tongue in
video games or series. It is really a pleasure to listen to the original voices
rather than localized ones, even made with high quality.</p>

<p><strong>Attend to English class at work.</strong> I’ve been learning English in a small group
of 6 at my previous job and it was a great experience. Small groups are great
and the learning process is quite effective. Having few people around means you
may count on having enough time to perform over the group.</p>

<p>No English group in you office? You could always organize it by yourself. I
believe you may find colleagues who also want to learn it. All together, come to
your head department and discuss an option to hire an English teacher at your
office. Don’t expect your boss will agree at once. Be ready to share the price
within all the members. It’s for your interests all in all, not for your
boss. There is only one man interested in your career. You are.</p>

<p>There is a wide-spreaded myth that <strong>only a native speaker could be a good
teacher. That’s totally wrong.</strong> I’ve been thinking the same way for a long
time. I confess it could prevent you from meeting a really good teacher.</p>

<p>Remember, even a great pronunciation does not make a person a good tutor. A
good one is interested in correcting your mistakes and giving useful
advise. Instead, a good native-speaker who does not have any teaching experience
is not interested in correcting your English. You may say something with
terrible mistakes, but your teacher will just reply “Wow cool!”. Such a way of
having lessons does not give a result.</p>

<p>I used to take some lessons from a USA girl. She was a great native English
speaker, no claims to her pronunciation nor accent. But she was talking all the
time. I’ve been spending my time listening to her bobbing my head and adding “Oh
really?” or “That’s cool”. That learning period went quite ineffective.</p>

<p>Nowadays, there are lots of cheaters who pretend being a good teacher. Don’t let
them fool you. A good teacher asks you about the reason of education first. What
skills do you want to improve? Reading, grammar, speaking, listening? Or prepare
for exams maybe?</p>

<p>A good teacher always asks you to share you thoughts on every fact you
discuss. It’s not because he or she is so interested in your opinion. It’s to
develop your mind. Matt, my current teacher, asks me all the time regarding
everything we talk about: what do you think on this? What would you do in such a
situation? And even a particular question sounds naive, it could become a
challenge to compose a good answer and share your opinion in a clear strict way.</p>

<p>When learning new words, there is a good trick to remember them. <strong>Open a
exercise book subdivided on thematic sections:</strong> food, cars, computer, home
etc. Then put a particular word you want to fixate in your memory in a proper
section. “Gear” into “cars”, “towel” into “house”, “ceiling” into “buildings”
and so on. To find a proper word, don’t open a translation program
immediately. Try to find out for something from you exercise book first. Write
icons near the words you remember less. But never scribe a translation on your
native language beneath.</p>

<p>When you are at your English class, <strong>do not switch at Russian at all</strong>, even
you need to rest for a minute or say something that is not related to your
class. Even if one is asking “What does the word X mean?”, don’t give a quick
Russian meaning. Try to compose a phrase that reflects the subject in English
words that you know. It is difficult sometimes, especially with such abstract
terms as truthiness, honor and others. But you ought to try.</p>

<p><strong>Do not drill English Tense Chart.</strong> One consider that chart as a formula: mix
together “have”, “been” and the third form of a verb to get a proper
result. They even pass class tests with such approach. It does not work in real
life, though.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>have + been + V(3) = profit!
</code></pre></div></div>

<p>Instead of drilling the whole table, I recommend you to focus on three main
tenses: just past simple, present simple and future simple. That fits your mind
because we also have three terms in Russian as well. For the beginning, try to
explain your thoughts within these three tenses. Keep your phrases simple. It’s
always miserable to hear somebody trying to compose a complicated sentence but
stops in a middle of it, breaks the whole line and starts from the
beginning… Please avoid doing that.</p>

<p>You’ll definitely need to use more tenses once you have become better in
English. You’ll use them to bring additional details into your narrative; to
fixate time boundaries more precisely.</p>

<p>For example, you spent some time on a task and still continue working on it. On
a daily call, you might say: I’ve been working on that task for 2 days. That’s
great because it brings the whole context of what’s going on. If you are not
ready for using such a tricky tense, you say: I was working on the task for 2
days. This form is less precise but nevertheless acceptable. Finally, you may
say: I worked on that task yesterday and still continue today. Past simple plus
present simple. A bit redundant but also works.</p>

<p><strong>What you really should drill is irregular verbs.</strong> A funny fact: there seems
to be more irregular verbs then regular ones. In English, my school teacher used
to joke, for each rule you’ve got more exceptions then ordinary cases.</p>

<p>A minimal table of irregular verbs takes about three pages of A4 size. The most
used verbs in our daily and business life are irregular ones. Say, write, read,
go, do, make, pay, eat, grow, raise… you will need all of them talking to your
teammates, customers or friends. Just decorate your wall with printed table and
drill. No life-hacks here.</p>

<p>I used to take advise on improving listening skills in my previous post about
remote work. <strong>Start with listening to VOA Learning English videos</strong> on
YouTube. They speak grotesquely slowly and clear and subtitles are rolling
below. Chose any video you like and do the following action in series:</p>

<ol>
  <li>watch it reading subtitles.</li>
  <li>Watch again without reading them (scroll the page a bit down); you should
recognize all the words clearly.</li>
  <li>Increase the speed of video to 1.25 (Put a gear button, then “Speed”). Ensure
you still may recognize all the words.</li>
  <li>Again, but at 1.5 speed.</li>
  <li>Finally, but at 2.0 speed. Return back to 1.5 or 1.25 if you miss the
meaning.</li>
</ol>

<p>A note: speed change works only in Google Chrome on desktop. Tablets and phones
won’t work unfortunately.</p>

<p>The whole process takes usually 15 minutes per a single video. Even less then
you spend on Twitter or being smoking. Do it every morning before starting your
daily job. This exercise is quite productive, I may assure you. Even a week
enough to start recognizing words in English songs. A month later you can
understand most of spoken English as well.</p>

<p><strong>Read classical English literature. Indeed, not technical.</strong> Classical
literature keeps its own secret: the language there is quite complicated and
well structured. For example, after reading SICP I switched to 1984 by George
Orwell. That is totally different English that I have never seen before! The
phrases composed in a such precise way. The text is full of adjectives and nouns
that bring particular meaning.</p>

<p>But the main benefit here you start filling the structure of the
language. Reading classical books brings huge advantages. Matt, my English
teacher, highly appreciates my choice.</p>

<p>When you finish your English classes, you might still have troubles speaking to
your customers. Don’t think you have wasted your time though. In a middle of
your daily calls, <strong>try to find a chance to practice your communication
skills</strong>. Personal English teacher would be a great option. As for me, I have 30
minutes lesson every week with Matt. He grew in London and than moved to China
to teach English there. Usually, we discuss various themes such as politics,
art, literature, hobbies and so on.</p>

<p>Finally, don’t think one day you’ll know English as completely so you may
stop. <strong>You should never stop trying to learn more about English.</strong> Remember at
school, you’ve been learnt Russian for ten years right? And you still make
mistakes for sure. It’s the same with English. Once you started with it, it will
become better and better, but you never should stop. It would be a catastrophe.</p>

<p>Learning English is the same as any learning process in general. Your life has
just expanded to keep and grow a new knowledge. Like programming, math or
something else. The good things never end.</p>

<p>But finally, this article has got ended for now.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/read-22/">Что почитать №22</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2017-05-06T00:00:00+00:00">
        May 6, 2017
    </time>

    <a href="/tag/read/" rel="tag">read</a>, <a href="/tag/life/" rel="tag">life</a>

</div>


            <div class="entry">
                
                    <p>На этот раз все ссылки на русском, так что не буду выпендриваться.</p>

<ul>
  <li>
    <p><a href="http://www.rulit.me/books/9-maya-ili-vojna-kak-travma-read-174744-1.html">9 мая или Война как травма</a></p>

    <p>Глубокий анализ войны, ее последствий и нашего восприятия. Выжимка в
<a href="http://a-nikonov.livejournal.com/2744344.html">блоге у Никонова</a>.</p>
  </li>
  <li>
    <p><a href="http://a-nikonov.livejournal.com/2742098.html">Обращение к русским</a></p>

    <p>Никонов. Обращение к аудитории после съемок на ТВ.</p>
  </li>
  <li>
    <p><a href="http://tema.livejournal.com/2492990.html">Как успевать делать много дел?</a></p>

    <p>Отвечает Артемий Лебедев.</p>
  </li>
  <li>
    <p><a href="http://ksoftware.livejournal.com/366660.html">Идеальный транспорт для комьюта</a></p>

    <p>На чем лучше добираться до работы.</p>
  </li>
</ul>

                
            </div>

        </li>
        
    </ul>

    <h4>
        
        <a href="/page26" class="previous">&larr;</a>
        
        <span class="page_number ">Страница 27 из 57</span>
        
        <a href="/page28" class="next">&rarr;</a>
        
    </h4>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>Ivan Grishaev's blog</li>
          <li><a href="mailto:ivan@grishaev.me">ivan@grishaev.me</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
            <li><a href="https://github.com/igrishaev">GitHub</a></li>
            <li><a href="tg://resolve?domain=igrishaev_blog">Telegram</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>Writing on programming, education, books and negotiations.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
