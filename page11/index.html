<!DOCTYPE html>
<html lang="ru">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Ivan Grishaev's blog</title>
  <meta name="description" content="Writing on programming, education, books and negotiations.
">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/custom.css">
  <link rel="canonical" href="https://grishaev.me/page11/">
  <link rel="alternate" type="application/rss+xml" title="Ivan Grishaev's blog" href="https://grishaev.me/feed.xml">

  <link rel="shortcut icon" type="image/x-icon" href="/assets/static/favicons/favicon.ico">

  <script type="text/javascript" src="/assets/typo.js"></script>

</head>


  <body>
    <header class="site-header">

    <div class="wrapper flex-container">

        <div>
            <a href="/">
                <img id="avatar" src="/assets/static/avatar.jpg" alt="Ivan Grishaev">
            </a>
        </div>

        <div class="flex-container-vert" style="margin-left: 15px; width: 80%">

            <div class="flex-container full-width">
                <p style="margin-bottom: 5px"><a href="/">Ivan Grishaev's blog</a></p>
                <div class="flex-huge"></div>
                <div >
<form id="search-form"
      target="_blank"
      style="display: inline"
      method="get"
      action="https://www.google.com/search">

    <input name="sitesearch"
           value="grishaev.me"
           type="hidden">

    <input type="text"
           required="required"
           name="q"
           placeholder="Google search..."
           autocomplete="off">

    <button style="border: none; background-color: transparent; cursor: pointer;"
            type="submit">&#x1f50d;</button>

</form>
</div>
            </div>

            <p><small>Writing on programming, education, books and negotiations.
</small></p>

            <div class="flex-container">
                <a class="menu-item" href="/">Home</a>
                <a class="menu-item" href="/about/">About</a>
                <a class="menu-item" href="/open-source/">Open Source</a>
                <a class="menu-item" href="/bookshelf/">Bookshelf</a>
                <a class="menu-item" href="/feed.xml">RSS</a>
            </div>

            <div class="flex-container">
                <a class="menu-item minor" href="/tag/clojure/">Clojure</a>
                <a class="menu-item minor" href="/tag/emacs/">Emacs</a>
                <a class="menu-item minor" href="/tag/python/">Python</a>
                <a class="menu-item minor" href="/tag/programming/">Programming</a>
                <a class="menu-item minor" href="/interview/">Interview</a>
                <a class="menu-item minor" href="/video/">Video</a>
            </div>

            <div class="flex-container">
                <a class="menu-item minor hl" href="/clojure-in-prod/">Книга «Clojure на производстве»</a>
            </div>

            <div class="flex-container">
                <a class="menu-item minor hl" href="/clojure-in-prod-2/">Книга «Clojure на производстве», второй том</a>
            </div>

        </div>
    </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="home">

    <ul class="post-list">
        
        <li>

            <h2>
                <a class="post-link" href="/new-mac/">Новый макбук</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2025-03-06T00:00:00+00:00">
        Mar 6, 2025
    </time>

    <a href="/tag/apple/" rel="tag">apple</a>, <a href="/tag/macbook/" rel="tag">macbook</a>, <a href="/tag/nanotexture/" rel="tag">nanotexture</a>

</div>


            <div class="entry">
                
                    <p>Похвастаюсь, что ли, обновкой — прикупил новый макбук! Хоть старый и откачали,
решил воспользоваться поводом: давненько хотел обновить железку.</p>

<p>Скажу сразу, что обзорщик железа из меня — примерно как бьюти-блогер. Не будет
картинок и “продакшена”. Этот пост — попытка сказать о маках то, что мне кажется
важным.</p>

<p>Новый мак интересен тем, что он кастомный: у него экран с нанотекстурой. Дело в
том, что мне нравятся матовые экраны. Дело вкуса, и я за это не топлю, просто
нравится. Кто-то гонится за герцовкой, кто-то за матрицей, а мне нужен матовый
экран.</p>

<p>Мой первый ноут Thinkpad x220i потому и покорил мое сердце, что был матовым. Я
искренне не понимаю, как можно смотреть в экран, который на две трети отражает
все вокруг. Я хочу экран, а не зеркало.</p>

<p>Конечно, везде написано “антибликовое покрытие”, но это ерунда — оно бликует и
отражает.</p>

<p>Эпл так сильно любит пользователей, что не оставляет им выбора. На всех маках
стабильно был глянец, но лет пять назад ситуация поменялась. Эплы выпустили
огромный 6К-монитор за пять косарей; за лишний косарь можно было сделать
поверхность матовой за счет нанотекстуры (а за еще один косарь — купить
ногу-подставку).</p>

<p>Что это за нанотекстура такая? Прежде чем ответить, вспомним, как устроен
матовый экран. Это обычный глянцевый экран, на который наклеена шершавая
пленка. Из-за неровности она рассеивает свет, и получается матовый
эффект. Пленка немного скрадывает яркость и угол обзора; ее можно отодрать и
получить обычный глянцевый экран.</p>

<p>Эпл добился того же эффекта, но более сложным путем. С помощью лазера на стекле
выжигают миниатюрные дорожки, которые рассеивают свет. Расчет на то, что
поскольку нет пленки, угол обзора и яркость не пострадают.</p>

<p>Я как-то видел 6К-монитор с нанотекстурой в московском ЦУМе. Продавец даже
позволил подключить к нему макбук! Но ничего особого я не заметил: обычный
матовый экран. За что платить такие деньги?</p>

<p>Я думал, что эксперименты Эпла с текстурой на этом закончатся, но
нет. Постепенно ее добавили в другие устройства, например iMac (дополнительной
опцией). И вот недавно выкатили в айпадах и макбуках. Устройства с текстурой
относятся к категории “кастомных”: их собирают не массово, а на заказ, из-за
чего вы не найдете их в розничной продаже. У “кастомок” свои заморочки, о
которых я напишу ниже, а пока что вернется к экрану.</p>

<p>Итак, матовый экран — это сказка. Он ничего не отражает, он мягкий, щадит
глаза. Светишь на него фонариком — почти все рассеивается. Если сфотографировать
экран, вы увидите его содержимое, а не селфи с телефоном. Не заметил, чтобы
яркость, угол или рендер шрифтов как-то страдали. Все отлично читается.</p>

<p>Видел картинки шрифтов, сделанные микроскопом с разных экранов. На матовом
четкость букв чуть меньше, да, но обычному глазу это незаметно.</p>

<p>Экран с текстурой нежный, легче пачкается. К нему прилагается особая тряпка, и
она очень хорошо счищает грязь. Другие тряпки Эпл не одобряет.</p>

<p>Архитектура ARM — это, конечно, полная победа Эпла. После Интела ощущение такое,
что спали невидимые гири — настолько все быстро. Ноут больше не закипает при
запуске Докера. Программы выскакивают почти мгновенно. Батарея живет ощутимо
дольше, раза в два точно.</p>

<p>У меня уже была машина на M1, и даже она после Интела казалась прорывом. А чипы
M3-M4 просто творят чудеса. Самое важное: подсознательно чувствуется, что это не
ARM в разы быстрее, а Интел что-то делал не так. Иначе откуда такой буст в
производительности?</p>

<p>С софтом ситуация не такая радостная. Насколько я понял, всех толковых разрабов
забрали в айфон, и десктоп пилят по остаточному принципу. Накопил десятки
скринов со всякими нелепостями.</p>

<p>Если вы все еще на Интеле, горячо советую перейти на чипы M1-M4. Это буквально
вложить деньги в себя, в свою продуктивность.</p>

<p>Теперь о том, что такое “кастомки”. Есть стандартные конфигурации макбуков,
которые массово клепают на заводах Китая и Индии. Именно их вы видите в
магазинах. А есть частные конфигурации, доступные на сайте Эпла. Такие модели
собирают в США, и это сказывается на доставке: долго и дорого. Кастомки ввозят в
соотношении 1 к 10 относительно стандартных конфигураций, потому что на них
меньше покупателей. Вероятность того, что у продавца найдется именно та
кастомка, которую хочется вам, низкая.</p>

<p>Немного о грустном. Не все так хорошо, кое-где я просчитался, а именно в
клавиатуре. Есть два широких стандарта клавиш: европейский и США. У Европы
следующие особенности:</p>

<ul>
  <li>кнопка Enter вертикальная</li>
  <li>обратный слэш слева от него</li>
  <li>тильда и обратный тик слева от левого шифта</li>
</ul>

<p>У раскладки США все не так:</p>

<ul>
  <li>Enter горизонтальный</li>
  <li>обратный слэш сверху</li>
  <li>тильда и обратный тик слева от единицы</li>
</ul>

<p>Много лет я сидел на европейском стандарте: как на самом ноуте, так и на внешней
клавиатуре. А поскольку кастомки собирают в США, то положение клавиш у них тоже
по стандарту США. И насколько я знаю, на это нельзя повлиять. Заказал кастомку —
получи раскладку США. В конфигураторе можно выбрать дополнительный язык клавиш,
но это всего лишь гравировка. Макет клавиатуры не поменяется.</p>

<p>Получаются боль и слезы. В сотый раз нажимаю Enter и попадаю в обратный
слэш. Жму тильду – а там растянутый шифт. Только сейчас понял, насколько важна
тильда: она часто встречается в кложурных макросах. Она нужна в маркдауне, а
маркдаун нынче везде: в Телеграме, в Слаке, в Гитхабе и так далее.</p>

<p>Ясно, что когда-нибудь переучусь, но подгорает порой знатно.</p>

<p>Вот что я хотел рассказать вам про маки и Эплы.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/hashtable-bathroom/">Bathroom model</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2025-03-06T00:00:00+00:00">
        Mar 6, 2025
    </time>

    <a href="/tag/programming/" rel="tag">programming</a>, <a href="/tag/hashtable/" rel="tag">hashtable</a>, <a href="/tag/python/" rel="tag">python</a>

</div>


            <div class="entry">
                
                    
<p>Интересное чтиво на выходные. Некие чуваки <a href="https://arxiv.org/html/2502.10977v1">написали пейпер</a> о новом
методе поиска свободных ячеек в хеш-таблице (по-другому называется
пробирование). Метод называется Bathroom model и является отсылкой к тому, как
ищется пустая кабинка в общественном туалете. Не припомню, когда в последний раз
искал кабинку по этой схеме, но спорить не буду. Прилагаются сравнение с тремя
другими способами: случайным, по экспоненте и воронкой.</p>

<p>В некоторых случаях Bathroom быстрее конкурентов, но. Код на гитхабе довольно
скромный, и хотелось бы больше замеров. На мой взгляд, говорить о прорыве рано,
но повозиться интересно. <a href="https://github.com/Qiantongwang/Hash_Table_Bathroom/blob/main/Bath_Hash_Table.py">Код и замеры</a> авторов.</p>

<p><strong>UPD:</strong> на проверку оказалось ерундой.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/euro-officials/">О еврочиновниках</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2025-03-06T00:00:00+00:00">
        Mar 6, 2025
    </time>

    <a href="/tag/cookies/" rel="tag">cookies</a>, <a href="/tag/euroofficials/" rel="tag">euroofficials</a>, <a href="/tag/web/" rel="tag">web</a>

</div>


            <div class="entry">
                
                    <p>Я как-то писал о проблеме, что каждый сайт показывает выпадашку с куками. В
конце обещал рассказать о еврочиновниках, которые все это устроили. Эта заметка
– о них.</p>

<p>В широком смысле еврочиновник не отличается от российского или американского
чиновника. Их главная черта – реактивный стиль управления. “Реактивный”
означает не “быстрый”, а от слова “реакция”. Сперва чиновник реагирует самым
глупым образом, а потом (и если вообще) думает, нужно ли было реагировать.</p>

<p>Пример: если с крыши падает лед, поставим таблички “осторожно, падает лед”. Если
кто-то следит за пользователем при помощи кук, поставим плашку “этот сайт
использует куки”. В обоих случаях главное – выполнить KPI, отчитаться и пойти
дальше. О последствиях чиновник не думает, ему не до таких мелочей.</p>

<p>В результате 99 сайтов из 100 показывают плашки, что сайт исползует куки. Уже
одно оформление говорит о полной неразберихе. На одном сайте это полоска внизу
экрана, а на другом – модалка во весь экран. Где-то одно предложение, где-то
графомания, которая не вмещается по высоте. Кто-то блюрит контент, пока не
нажмешь кнопку.</p>

<p>На фоне неразберихи появляются сервисы, которые берут часть проблем на
себя. Например, Cookiehub внедряет виджет выбора кук. Их клиентов можно понять:
проще платить двадцать евро в месяц, чем попасть по доносу конкурентов на 30
тысяч евро (реальный случай).</p>

<p>Грамотность чиновников, которые принимали закон, сводится к урокам информатики в
школе. Учитель заставлял их открыть сайт в Интернет-Эксплорере, найти файлы
куки, удалить их и убедиться, что сайт не узнает пользователя. Все мы делали это
в школе, и наши европейские сверстники не исключение. Беда в том, что в 40 лет
их компьютерная грамотность осталась на том же уровне. Отслеживать пользователя
можно сотней способов, но у чиновника в голове одно: куки.</p>

<p>Когда смотришь, во что превратился интернет, разве не очевидно следующее? Если
каждый сайт уведомляет о технологии X, это значит, она повсеместна и уведомлять
о ней бессмысленно. Бесконечные плашки превращаются в шум, люди закрывают их
инстиктивно. Блокировщики рекламы уже включают функцию удаления плашек. На одном
конце провода эти плашки продуцируются, на другом – удаляются. Жгутся такты
процессора, выделяется тепло. Зачем? Какая цель?</p>

<p>Давайте пойдем дальше: когда клиент садится в такси, уведомим его, что машина
работает на бензине, а бензин опасен. Когда человек входит в бизнес-центр,
потребудем согласие на то, что в здании используется газ и электричество – тоже
опасные вещи. Пользователь предупрежден, свою задачу мы выполнили.</p>

<p>Почему бы не подвергнуть закон пересмотру? Найти чиновников и спросить: что
хорошего принесли уведомления о куках? Стало ли меньше трекинга и преступлений?
Стал ли интернет безопасней? Было ли хоть раз так, что человек заходит на сайт и
такой: опачки, здесь куки, пойду-ка я на другой сайт? Это просто смешно.</p>

<p>Поэтому я считаю, что любой закон должен приниматься только на определенный
срок. Годен до, так сказать. Когда срок истек, чиновники собираются и решают –
продлить как есть или что-то поменять. Ключевой момент в том, что это будут уже
другие чиновники. Кто-то из прежних перейдет в другие отделы, кто-то в бизнес,
женщины – в декрет. Придут новые ребята и, возможно, поправят бред, принятый по
ошибке десять лет назад. Это даст шанс, что ошибка продлится только несколько
лет, а не сотню-другую.</p>

<p>Искренне не понимаю, почему в Европе не нашлось энтузиастов, которые положили бы
этому конец? Я имею в виду группу экспертов: программистов, опенсорщиков, членов
всяких комитетов. Они бы собрали материалы и факты, организовали бы встречу с
чиновниками и популярно объяснили им, что они натворили. Добились бы частичной
отмены и точных формулировок. Но ничего подобного не видно: все послушно лепят
плашки на сайтах, словно овцы, которых ведут на убой. Всякие Греты Тунберг и
другие отбитые личности собирают толпы, когда речь о борьбе с климатом и
ковиде. А когда что-то важное, то тишина: это для нашей безопасности.</p>

<p>Верю, что плашки с куками не навсегда. Найдутся те, кто скажут: задолбало, мы
этот закон не писали, мы его не уважаем, ставить плашку не будем (я уже
нашелся). Этот бред нужно перетерпеть. Не исключено, что дальше будет хуже, но я
смотрю в будущее с оптимизмом.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/analog-school/">Аналоговое образование</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2025-03-06T00:00:00+00:00">
        Mar 6, 2025
    </time>

    <a href="/tag/school/" rel="tag">school</a>, <a href="/tag/education/" rel="tag">education</a>, <a href="/tag/it/" rel="tag">it</a>

</div>


            <div class="entry">
                
                    <p>Не помню, чтобы кто-нибудь высказывал следующую мысль. Школьное образование
должно быть исключительно аналоговым. Никаких электронных учебников, платформ,
мессаджеров, онлайн-дневников и прочего. Странно, что это мало кто понимает.</p>

<p>Теперь длинно. Российское айти развивается довольно неплохо, и верный признак
этого – компании собирают деньги там, где раньше не могли, а именно в
образовательном секторе. Исторически считалось, что школы бедные и с них нечего
взять. Однако оплату повесили на родителей, и дело пошло. Напоминает фирмы,
которые продают товары детям – аудитории, у которой нет денег – но за них
платят родители.</p>

<p>В образовании айтишный элемент является чистым наркотиком. Это бесплатная первая
доза, когда платформу внедряют якобы бескорыстно, а потом выясняется, что нужно
купить тарифный план. Сайт платформы работает бесплатно только на
десктопе. Мобильное приложение показывает только часть данных, а если хочешь все
– оформляй подписку.</p>

<p>Любая платформа предполагает, что у ребенка есть телефон, электронная почта и
логин. Все эти данные сливаются партнерам в целях рекламы. Я не поленился и
прочитал политику обработки ПД одной из платформ: там указаны восемь фирм,
включая Яндекс.</p>

<p>Некоторые платформы делают вход через другие. Например, чтобы попасть в Я.Класс,
нужно войти через электронный дневник, а вход в него работает через
Госуслуги. Представили длину этой цепи? Сто редиректов, попапы, токены… Как
это можно объяснить ребенку?</p>

<p>Гаджеты и платформы плохо влияют на учителей, они деградируют в профессиональном
плане. Во время ковидной истерии все родители познали дно этой деградации. Ни
один учитель не мог достойно организовать удаленное образование. Ни у кого нет
материалов для распечатки, контрольных, типовых заданий. Учитель не может
составить задание ученикам. Каждое домашнее задание – это ссылка на какую-то
говно-платформу, где нужно регистрироваться и подтверждать учетку телефоном, и
которая работает только в Хроме на винде.</p>

<p>Учителя и школы оказались голыми. Нет никакой базы знаний: офлайн-лекций,
методичек, контрольных работ, которые распечатал и готово. Я как отец трех детей
(двое учатся в школе) просто ох…ал с этого, простите. Когда училка опять
кидает ссылку на образовательный портал, хотелось лупить ее линейкой со словами:
ты учитель или кто? Сядь и составь задание для детей, это же час работы. Тебе же
самой пригодится в дальнейшем. Какого хрена ты тащишь детей в очередной стартап?</p>

<p>Я вообще считаю, что учитель без личной базы лекций, заданий и методичек – это
не учитель. И на проверку большинство учителей оказались такими.</p>

<p>Мне повезло: я учился у преподавателей, которые готовили матералы сами. Конечно,
они опирались на учебник, но изложение было авторское. Исписанный листочек в
руках препода – очень хороший признак. В университете прогульщики искупляли
грехи тем, что набирали эти листочки и печатали методички, которые позже ходили
по рукам.</p>

<p>Айти-компании, которые сегодня захватывают образование, прикрываются благими
целями. Разумеется, все это ложь. Компании важна прибыль, а качество образования
ее нисколько не интересует. Это слишком долгосрочная цель, за это время или
фирмы не останется, или руководство уйдет в другое место. Об образовании должно
думать правительство, но у него другие приоритеты. Вся надежда на родителей.</p>

<p>Классика: все онлайн-штучки на проверку оказываются эфемерны. Что-то лагает, тут
недоступно, сессия истекла, зайдите через сервис Х, браузер не поддерживается, у
вас блокировщик рекламы, введите логин, который ребенок придумал год
назад… словом, привычное нам айтишное дерьмо. Я стерплю, не вопрос, но причем
тут мои дети?</p>

<p>Образовательные платформы, электронные учебники, дневники, видео-курсы, что там
еще… все это замечательно, но не имеет отношения к образованию. Кому-то
нравится – ради бога, пользуйтесь, платите. Но школа должна быть в стороне от
этого. У ребенка должна быть книга, тетрадь, ручка и учитель – вот все, что
нужно для хорошего обучения.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/what-is-disruptor/">Что такое Disruptor?</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2025-03-04T00:00:00+00:00">
        Mar 4, 2025
    </time>

    <a href="/tag/programming/" rel="tag">programming</a>, <a href="/tag/java/" rel="tag">java</a>, <a href="/tag/disruptor/" rel="tag">disruptor</a>

</div>


            <div class="entry">
                
                    <p><img src="/assets/static/aws/what-is-disruptor/1.jpeg" /></p>

<p>Графомания бывает не только в русском, но и в английском языке. Хороший пример —
страница <a href="https://lmax-exchange.github.io/disruptor/">проекта Disruptor</a>.</p>

<p>Вижу большой заголовок “What is Disruptor?”, но ни один параграф не отвечает на
вопрос, что это такое.</p>

<p>Первый параграф о том, что в такой-то фирме борются за перформанс.</p>

<p>Второй параграф о том, что Disruptor — это результат исследований и тестов. Мы
тестировали кеши процессора и ядра и сделали дружественный к железу фреймворк.</p>

<p>Третий параграф — это не специализированное решение, подойдет всем.</p>

<p>Четвертый параграф — он работает не так как вы привыкли, может быть непривычно.</p>

<p>Далее ссылки и документация, а еще нас залайкал известный чел.</p>

<p><strong>Внимание, вопрос — что такое Disruptor?</strong></p>

<p>Вижу такое постоянно. Автор пишет заголовок, а дальше Остапа понесло: мы
работали, исследовали, у фирмы долгая история, а вот был случай…</p>

<p>Не надо так. Отвечайте на заголовок, который сами же написали.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/macbook-reset/">Вырезалки на Маке</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2025-03-04T00:00:00+00:00">
        Mar 4, 2025
    </time>

    <a href="/tag/mac/" rel="tag">mac</a>, <a href="/tag/web/" rel="tag">web</a>, <a href="/tag/lulu/" rel="tag">lulu</a>

</div>


            <div class="entry">
                
                    <p>У меня тут накладки: вышел из строя личный ноут. Ставить Телеграм и прочие
штучки на рабочий ноут я не рискую, поэтому пару дней потратил вот на что:
достал с антресолей стренький мак 2014 года. Мой первый мак, в котором, как в
греческом корабле, давно заменены все детали. Но я считаю его тем самым маком.</p>

<p>Переустановил ось, накатил софт, и в процессе пришла в голову эта заметка.</p>

<p>На том маке, что сейчас в отключке, я работаю четыре года. Там настроено все:
блокировщик рекламы и вырезалка плашек с куками; отключены все нотификации;
много правил для фаервола Lulu, чтобы программы не лезли в интернет за
обновлениями; Фаерфокс работает с полиси, чтобы не показывать модалки и все
остальное.</p>

<p>В один момент я всего этого лишился. Ощущения ужасные.</p>

<p>Начнем с того, что каждая программа после запуска хочет показывать
нотификации. Неважно какая, неважно зачем. Даже терминал! Уведомления нельзя
отключить всем приложениям сразу и позже настроить исключения. Нужно прокликать
“нет” для каждой приложеньки.</p>

<p>Про то, что каждое приложение лезет в сеть за обновлениями и показывает модалку,
я писал много раз. Приходиться ставить Lulu и затыкать софт.</p>

<p>У меня в системе английский язык, и если заходишь на русскоязычный сайт, во всех
браузерах всплывает модалка с предложением перевести. Нужно везде прокликать
отказ.</p>

<p>Сюда же Телеграм: если в системе английский язык, предлагает перевести русские
каналы. Если русский, то стоит кому-то скопипастить английскую Википедию, как
сразу выпадашка с переводом.</p>

<p>Каждый сайт встречает плашкой о том, что использует куки. Каждый без
исключения. На StackExchage и StackOverflow плашки размером с могильные
плиты. Они не умещаются по высоте, нужно скроллить.</p>

<p>Кроме кук всплывают: выбор города, подписка на емейл-рассылку, телеграм-канал,
вход через гугл-аккаунт. Все это нужно прокликивать или вырезать.</p>

<p>Ну и банальная реклама. Я специально поставил ее на последнее место, потому что
реклама уже не вызывает таких проблем: крутится слева баннер, ну и пусть
крутится. А выпадашки всех мастей закрывают контент и не дают пользоваться
сайтом.</p>

<p>В общем, посмотрел я на современный веб и обалдел. Не представляю, как
пользуются им обычные люди без блокировщиков, вырезалки кук и фаервола. Куда ни
зайди, на тебя кричат уведомлениями и плашками: сделай то, зайди сюда, обновись,
купи премиум, подпишись, установи, оцени товар. И не только веб, но и настольные
приложения и даже операционка.</p>

<p>Вырезаю все это по-новой и думаю: что будет через десять лет?</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/json-scale/">Схемы JSON</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2025-03-04T00:00:00+00:00">
        Mar 4, 2025
    </time>

    <a href="/tag/json/" rel="tag">json</a>, <a href="/tag/ui/" rel="tag">ui</a>

</div>


            <div class="entry">
                
                    
<p>Официальный сайт <a href="https://json.org">json.org</a> удивляет. В масштабе 30% схемы становятся
огромны и заливают весь экран. В масштабе 300% правый бар наезжает на основную
часть, сжимает ее в мышиный хвост, отчего схемы тоже уменьшаются.</p>

<p><img src="/assets/static/aws/json-scale/2.jpeg" /></p>

<p>В результате схема в масштабе 30% процентов выглядит крупнее, чем в
300%. Разница, на минуточку, целый порядок. Такой вот забавный факт.</p>

<p><img src="/assets/static/aws/json-scale/1.jpeg" /></p>

<p>У этих выкрутасов есть объяснения: верстка, плавающие дивы, стили,
пятое-десятое. Но можно сказать проще: это фронтенд.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/emoji-reply/">Ответ с эмодзи</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2025-03-04T00:00:00+00:00">
        Mar 4, 2025
    </time>

    <a href="/tag/life/" rel="tag">life</a>, <a href="/tag/email/" rel="tag">email</a>, <a href="/tag/outlook/" rel="tag">outlook</a>

</div>


            <div class="entry">
                
                    <p>Важная новость: в Microsoft Outlook появились реакции к емейлам. Работает так:
вы написали письмо, отправили, а под ним появляются пальчики, сердечки и
прочее. Пошарить скриншот не могу, поверьте на слово.</p>

<p>Интересно, как это работает? Особая апишка в протоколе Outlook? Или пустое
письмо с заголовком? Или какой-то особый пейлоад? Или если в письме только
эмодзи, оно показывается по-другому?</p>

<p>В любом случае, шлю лучи добра пользователям Аутлука.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/corp-update/">Корпоративные обновления</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2025-03-04T00:00:00+00:00">
        Mar 4, 2025
    </time>

    <a href="/tag/update/" rel="tag">update</a>, <a href="/tag/macos/" rel="tag">macos</a>, <a href="/tag/apple/" rel="tag">apple</a>

</div>


            <div class="entry">
                
                    <p>Когда работаешь на корпоративном ноуте, постигаешь всю беспощадность
обновлений. Ничего нельзя отключить, в фоне работают программы, которые следят
за обновлениями. Раз в несколько дней обновится то Хром, то Idea, и начинаются
выпадашки: Иван, чтобы защитить себя от угроз, поставь обновление! Откладывать
можно фиксированное число раз, и в какой-то момент обновление ставится силой —
конечно, перед релизом или звонком. Поэтому со временем я стал накатывать
обновления на выходных.</p>

<p>Так вот, в который раз попадаюсь на дурацкое поведение Эпла. Вылазит выпадашка:
обновись до Секвойи, тянуть больше нельзя. И кнопочка “Install update”. Я
закрываю все программы, все реплы, докеры и остаюсь с выпадашкой наедине. Жму
кнопку и вижу: отлично, загружаю обновление, осталось 3 часа. Три часа, Карл! Я
мог бы ничего не закрывать и работать чуть ли не полдня, пока качается
обновление!</p>

<p>Нажимая “Install update”, я рассчитываю, что оно уже загружено и я в шаге от
того, чтобы начать установку. А загрузка даже не начиналась! И качать там не три
мегабайта, а 5-7 гигов.</p>

<p>Спрашивается, что мешало скачать обновление в фоне? Если от него нельзя
отделаться, так скачай сам, зачем парить мне мозги?</p>

<p>Дизайнер тоже хорош: если кнопка запускает загрузку обновления, ее нужно назвать
“Download &amp; Install update”. Я ведь хочу самую малость: чтобы на кнопке было
написано то, что она делает на самом деле.</p>

<p>Сюда же относится виджет обновления Эппловских программ. Вылазит окошко поверх
всего, и там кнопка “Обновить”. Нажимаешь, оно начинает загрузку, а потом сто
раз перехватывает форус. Почему нельзя скачать в фоне? Почему нельзя поставить
его в фоне? Зачем тыкать в лицо модалки?</p>

<p>Та же самое с Саблаймом. Поработав минут 20, он начинает показывать модалку с
прогрессбаром: загружаю обновление. Тупица, что мешает скачать обновление в
фоне? Зачем ты показываешь прогресс-бар? Чтобы пользователь смотрел на него?
Других дел у пользователя нет?</p>

<p>В общем, сегодня каждая программа обновляется как не в себя, только нормальные
обновления так и не сделали. На ум приходит только одно исключение — Хром,
который обновляется полностью незаметно. Все остальное — обычные модалки с
прогрес-баром.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/clj-taggie/">Taggie</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2025-02-08T00:00:00+00:00">
        Feb 8, 2025
    </time>

    <a href="/tag/programming/" rel="tag">programming</a>, <a href="/tag/clojure/" rel="tag">clojure</a>, <a href="/tag/tags/" rel="tag">tags</a>

</div>


            <div class="entry">
                
                    
<p><a href="https://github.com/igrishaev/taggie">Taggie</a> is an experimental library trying find an answer for a strange
question: is it possible to benefit from Clojure tags and readers, and how?</p>

<p>Taggie extends printing methods such that types that could not be read from
their representation now <strong>can</strong> be read. A quick example: if you print an atom,
you’ll get a weird string:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">atom</span><span class="w"> </span><span class="mi">42</span><span class="p">)</span><span class="w">
</span><span class="o">#</span><span class="n">&lt;Atom</span><span class="o">@</span><span class="mi">7</span><span class="n">fea5978</span><span class="err">:</span><span class="w"> </span><span class="mi">42</span><span class="nb">&gt;</span><span class="w">
</span></code></pre></div></div>

<p>Run that string, and REPL won’t understand you:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">#</span><span class="n">&lt;Atom</span><span class="o">@</span><span class="mi">7</span><span class="n">fea5978</span><span class="err">:</span><span class="w"> </span><span class="mi">42</span><span class="nb">&gt;</span><span class="w">
</span><span class="n">Syntax</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">reading</span><span class="w"> </span><span class="n">source</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="p">(</span><span class="nf">REPL</span><span class="no">:962:5</span><span class="p">)</span><span class="nb">.</span><span class="w">
</span><span class="n">Unreadable</span><span class="w"> </span><span class="n">form</span><span class="w">
</span></code></pre></div></div>

<p>But with Taggie, it goes this way:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">atom</span><span class="w"> </span><span class="mi">42</span><span class="p">)</span><span class="w">
</span><span class="o">#</span><span class="n">atom</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="c1">;; represented with a tag</span><span class="w">
</span></code></pre></div></div>

<p>And vice versa:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">#</span><span class="n">atom</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="c1">;; run it in repl</span><span class="w">
</span><span class="o">#</span><span class="n">atom</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="c1">;; the result</span><span class="w">
</span></code></pre></div></div>

<p>The value is an atom indeed, you can check it:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nb">deref</span><span class="w"> </span><span class="o">#</span><span class="n">atom</span><span class="w"> </span><span class="mi">42</span><span class="p">)</span><span class="w">
</span><span class="mi">42</span><span class="w">
</span></code></pre></div></div>

<p>Tags can be nested. Let’s try some madness:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">def</span><span class="w"> </span><span class="n">omg</span><span class="w"> </span><span class="o">#</span><span class="n">atom</span><span class="w"> </span><span class="o">#</span><span class="n">atom</span><span class="w"> </span><span class="o">#</span><span class="n">atom</span><span class="w"> </span><span class="o">#</span><span class="n">atom</span><span class="w"> </span><span class="o">#</span><span class="n">atom</span><span class="w"> </span><span class="o">#</span><span class="n">atom</span><span class="w"> </span><span class="mi">42</span><span class="p">)</span><span class="w">

</span><span class="p">(</span><span class="nb">println</span><span class="w"> </span><span class="n">omg</span><span class="p">)</span><span class="w">
</span><span class="o">#</span><span class="n">atom</span><span class="w"> </span><span class="o">#</span><span class="n">atom</span><span class="w"> </span><span class="o">#</span><span class="n">atom</span><span class="w"> </span><span class="o">#</span><span class="n">atom</span><span class="w"> </span><span class="o">#</span><span class="n">atom</span><span class="w"> </span><span class="o">#</span><span class="n">atom</span><span class="w"> </span><span class="mi">42</span><span class="w">

</span><span class="o">@@@@@@</span><span class="n">omg</span><span class="w">
</span><span class="mi">42</span><span class="w">
</span></code></pre></div></div>

<p>But this is not only about atoms! Taggie extends many types, e.g. refs, native
Java arrays, <code class="language-plaintext highlighter-rouge">File</code>, <code class="language-plaintext highlighter-rouge">URI</code>, <code class="language-plaintext highlighter-rouge">URL</code>, <code class="language-plaintext highlighter-rouge">Date</code>, <code class="language-plaintext highlighter-rouge">java.time.*</code> classes, and something
else. See the corresponding section below.</p>

<h2 id="installation-and-usage">Installation and Usage</h2>

<p>Add this to your project:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">;; lein</span><span class="w">
</span><span class="p">[</span><span class="n">com.github.igrishaev/taggie</span><span class="w"> </span><span class="s">"0.1.0"</span><span class="p">]</span><span class="w">

</span><span class="c1">;; deps</span><span class="w">
</span><span class="n">com.github.igrishaev/taggie</span><span class="w"> </span><span class="p">{</span><span class="no">:mvn/version</span><span class="w"> </span><span class="s">"0.1.0"</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Then import the core namespace:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">ns</span><span class="w"> </span><span class="n">com.acme.server</span><span class="w">
  </span><span class="p">(</span><span class="no">:require</span><span class="w">
    </span><span class="n">taggie.core</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p>Now type in the repl any of these:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">#</span><span class="n">LocalDate</span><span class="w"> </span><span class="s">"2025-01-01"</span><span class="w">
</span><span class="o">#</span><span class="n">Instant</span><span class="w"> </span><span class="s">"2025-01-01T23:59:59Z"</span><span class="w">
</span><span class="o">#</span><span class="n">File</span><span class="w"> </span><span class="s">"/path/to/a/file.txt"</span><span class="w">
</span><span class="o">#</span><span class="n">URL</span><span class="w"> </span><span class="s">"https://clojure.org"</span><span class="w">
</span><span class="o">#</span><span class="n">bytes</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="n">x00</span><span class="w"> </span><span class="mi">0</span><span class="n">xff</span><span class="p">]</span><span class="w">
</span><span class="o">#</span><span class="n">ints</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span><span class="p">]</span><span class="w">
</span><span class="o">#</span><span class="n">floats</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span><span class="p">]</span><span class="w">
</span><span class="o">#</span><span class="n">ByteBuffer</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="mi">4</span><span class="p">]</span><span class="w">
</span><span class="n">...</span><span class="w">
</span></code></pre></div></div>

<p>Each expression gives an instance of a corresponding type: a <code class="language-plaintext highlighter-rouge">LocalDate</code>, an
<code class="language-plaintext highlighter-rouge">Instane</code>, a <code class="language-plaintext highlighter-rouge">File</code>, etc… <code class="language-plaintext highlighter-rouge">#bytes</code>, <code class="language-plaintext highlighter-rouge">#ints</code> and similar produce native Java
arrays.</p>

<p>You can pass tagged values into functions as usual:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nb">deref</span><span class="w"> </span><span class="o">#</span><span class="n">atom</span><span class="w"> </span><span class="mi">42</span><span class="p">)</span><span class="w">
</span><span class="mi">42</span><span class="w">

</span><span class="p">(</span><span class="nb">alength</span><span class="w"> </span><span class="o">#</span><span class="n">longs</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span><span class="p">])</span><span class="w">
</span><span class="mi">3</span><span class="w">
</span></code></pre></div></div>

<p>To observe what happends under the hood, prepend your expression with a
backtick:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">`</span><span class="p">(</span><span class="nb">alength</span><span class="w"> </span><span class="o">#</span><span class="n">longs</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span><span class="p">])</span><span class="w">

</span><span class="p">(</span><span class="nf">clojure.core/alength</span><span class="w"> </span><span class="p">(</span><span class="nf">taggie.readers/__reader-longs-edn</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span><span class="p">]))</span><span class="w">
</span></code></pre></div></div>

<p>Internally, all tags expand into an invocation of an EDN reader. Namely, <code class="language-plaintext highlighter-rouge">#longs
items</code> becomes <code class="language-plaintext highlighter-rouge">(taggie.readers/__reader-longs-edn items)</code>, and when evaluated,
it returs a native array of longs.</p>

<h2 id="edn-support">EDN Support</h2>

<p>Taggie provides functions to read and write EDN with tags. They live in the
<code class="language-plaintext highlighter-rouge">taggie.edn</code> namespace. Use it as follows:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">def</span><span class="w"> </span><span class="n">edn-dump</span><span class="w">
  </span><span class="p">(</span><span class="nf">taggie.edn/write-string</span><span class="w"> </span><span class="o">#</span><span class="n">atom</span><span class="w"> </span><span class="p">{</span><span class="no">:test</span><span class="w"> </span><span class="mi">1</span><span class="w">
                                  </span><span class="no">:values</span><span class="w"> </span><span class="o">#</span><span class="n">longs</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span><span class="p">]</span><span class="w">
                                  </span><span class="no">:created-at</span><span class="w"> </span><span class="o">#</span><span class="n">LocalDate</span><span class="w"> </span><span class="s">"2025-01-01"</span><span class="p">}))</span><span class="w">

</span><span class="p">(</span><span class="nb">println</span><span class="w"> </span><span class="n">edn-dump</span><span class="p">)</span><span class="w">

</span><span class="c1">;; #atom {:test 1,</span><span class="w">
</span><span class="c1">;;        :values #longs [1, 2, 3],</span><span class="w">
</span><span class="c1">;;        :created-at #LocalDate "2025-01-01"}</span><span class="w">
</span></code></pre></div></div>

<p>It produces a string with custom tags and data being pretty printed. Let’s read
it back:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">taggie.edn/read-string</span><span class="w"> </span><span class="n">edn-dump</span><span class="p">)</span><span class="w">

</span><span class="o">#</span><span class="n">atom</span><span class="w"> </span><span class="p">{</span><span class="no">:test</span><span class="w"> </span><span class="mi">1</span><span class="n">,</span><span class="w">
       </span><span class="no">:values</span><span class="w"> </span><span class="o">#</span><span class="n">longs</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="n">,</span><span class="w"> </span><span class="mi">2</span><span class="n">,</span><span class="w"> </span><span class="mi">3</span><span class="p">]</span><span class="n">,</span><span class="w">
       </span><span class="no">:created-at</span><span class="w"> </span><span class="o">#</span><span class="n">LocalDate</span><span class="w"> </span><span class="s">"2025-01-01"</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">write</code> function writes EDN into a destination which might be a file path, a
file, an output stream, a writer, etc:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">taggie.edn/write</span><span class="w"> </span><span class="p">(</span><span class="nf">clojure.java.io/file</span><span class="w"> </span><span class="s">"data.edn"</span><span class="p">)</span><span class="w">
                  </span><span class="p">{</span><span class="no">:test</span><span class="w"> </span><span class="p">(</span><span class="nf">atom</span><span class="w"> </span><span class="p">(</span><span class="nb">ref</span><span class="w"> </span><span class="p">(</span><span class="nf">atom</span><span class="w"> </span><span class="no">:secret</span><span class="p">)))})</span><span class="w">
</span></code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">read</code> function reads EDN from any kind of source: a file path, a file, in
input stream, a reader, etc. Internally, a source is transformed into the
<code class="language-plaintext highlighter-rouge">PushbackReader</code> instance:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">taggie.edn/read</span><span class="w"> </span><span class="p">(</span><span class="nf">clojure.java.io/file</span><span class="w"> </span><span class="s">"data.edn"</span><span class="p">))</span><span class="w">

</span><span class="p">{</span><span class="no">:test</span><span class="w"> </span><span class="o">#</span><span class="n">atom</span><span class="w"> </span><span class="o">#</span><span class="nb">ref</span><span class="w"> </span><span class="o">#</span><span class="n">atom</span><span class="w"> </span><span class="no">:secret</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Both <code class="language-plaintext highlighter-rouge">read</code> and <code class="language-plaintext highlighter-rouge">read-string</code> accept standard <code class="language-plaintext highlighter-rouge">clojure.edn/read</code> options,
e.g. <code class="language-plaintext highlighter-rouge">:readers</code>, <code class="language-plaintext highlighter-rouge">:eof</code>, etc. The <code class="language-plaintext highlighter-rouge">:readers</code> map gets merged with a global map
of custom tags.</p>

<h2 id="motivation">Motivation</h2>

<p>Aside from jokes, this library might save your day. I often see people dump data
into .edn files, and the data has atoms, regular expressions, exceptions, and
other unreadable types:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">spit</span><span class="w"> </span><span class="s">"data.edn"</span><span class="w">
      </span><span class="p">(</span><span class="nb">with-out-str</span><span class="w">
        </span><span class="p">(</span><span class="nf">clojure.pprint/pprint</span><span class="w">
          </span><span class="p">{</span><span class="no">:regex</span><span class="w"> </span><span class="o">#</span><span class="s">"foobar"</span><span class="w">
           </span><span class="no">:atom</span><span class="w"> </span><span class="p">(</span><span class="nf">atom</span><span class="w"> </span><span class="mi">42</span><span class="p">)</span><span class="w">
           </span><span class="no">:error</span><span class="w"> </span><span class="p">(</span><span class="nf">ex-info</span><span class="w"> </span><span class="s">"boom"</span><span class="w"> </span><span class="p">{</span><span class="no">:test</span><span class="w"> </span><span class="mi">1</span><span class="p">})})))</span><span class="w">

</span><span class="p">(</span><span class="nb">println</span><span class="w"> </span><span class="p">(</span><span class="nb">slurp</span><span class="w"> </span><span class="s">"data.edn"</span><span class="p">))</span><span class="w">

</span><span class="p">{</span><span class="no">:regex</span><span class="w"> </span><span class="o">#</span><span class="s">"foobar"</span><span class="n">,</span><span class="w"> </span><span class="no">:atom</span><span class="w"> </span><span class="o">#</span><span class="n">&lt;Atom</span><span class="o">@</span><span class="mi">4</span><span class="n">f7aa8aa</span><span class="err">:</span><span class="w"> </span><span class="mi">42</span><span class="n">&gt;,</span><span class="w"> </span><span class="no">:error</span><span class="w"> </span><span class="o">#</span><span class="n">error</span><span class="w"> </span><span class="p">{</span><span class="w">
 </span><span class="no">:cause</span><span class="w"> </span><span class="s">"boom"</span><span class="w">
 </span><span class="no">:data</span><span class="w"> </span><span class="p">{</span><span class="no">:test</span><span class="w"> </span><span class="mi">1</span><span class="p">}</span><span class="w">
 </span><span class="no">:via</span><span class="w">
 </span><span class="p">[{</span><span class="no">:type</span><span class="w"> </span><span class="n">clojure.lang.ExceptionInfo</span><span class="w">
   </span><span class="no">:message</span><span class="w"> </span><span class="s">"boom"</span><span class="w">
   </span><span class="no">:data</span><span class="w"> </span><span class="p">{</span><span class="no">:test</span><span class="w"> </span><span class="mi">1</span><span class="p">}</span><span class="w">
   </span><span class="no">:at</span><span class="w"> </span><span class="p">[</span><span class="n">user$eval43373$fn__43374</span><span class="w"> </span><span class="n">invoke</span><span class="w"> </span><span class="s">"form-init6283045849674730121.clj"</span><span class="w"> </span><span class="mi">2248</span><span class="p">]}]</span><span class="w">
 </span><span class="no">:trace</span><span class="w">
 </span><span class="p">[[</span><span class="n">user$eval43373$fn__43374</span><span class="w"> </span><span class="n">invoke</span><span class="w"> </span><span class="s">"form-init6283045849674730121.clj"</span><span class="w"> </span><span class="mi">2248</span><span class="p">]</span><span class="w">
  </span><span class="p">[</span><span class="n">user$eval43373</span><span class="w"> </span><span class="n">invokeStatic</span><span class="w"> </span><span class="s">"form-init6283045849674730121.clj"</span><span class="w"> </span><span class="mi">2244</span><span class="p">]</span><span class="w">
  </span><span class="c1">;; truncated</span><span class="w">
  </span><span class="p">[</span><span class="n">clojure.lang.AFn</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="s">"AFn.java"</span><span class="w"> </span><span class="mi">22</span><span class="p">]</span><span class="w">
  </span><span class="p">[</span><span class="n">java.lang.Thread</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="s">"Thread.java"</span><span class="w"> </span><span class="mi">833</span><span class="p">]]}}</span><span class="w">
</span></code></pre></div></div>

<p>This dump cannot be read back due to:</p>

<ol>
  <li>unknown <code class="language-plaintext highlighter-rouge">#"foobar"</code> tag (EDN doesn’t support regex);</li>
  <li>broken <code class="language-plaintext highlighter-rouge">#&lt;Atom@4f7aa8aa: 42&gt;</code> expression;</li>
  <li>unknown <code class="language-plaintext highlighter-rouge">#error</code> tag.</li>
</ol>

<p>But with Taggie, the same data produces tagged fields that <strong>can</strong> be read back.</p>

<h2 id="supported-types">Supported Types</h2>

<p>In alphabetic order:</p>

<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Example</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">java.nio.ByteBuffer</code></td>
      <td><code class="language-plaintext highlighter-rouge">#ByteBuffer [0 1 2]</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">java.util.Date</code></td>
      <td><code class="language-plaintext highlighter-rouge">#Date "2025-01-06T14:03:23.819Z"</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">java.time.Duration</code></td>
      <td><code class="language-plaintext highlighter-rouge">#Duration "PT72H"</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">java.io.File</code></td>
      <td><code class="language-plaintext highlighter-rouge">#File "/path/to/file.txt"</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">java.time.Instant</code></td>
      <td><code class="language-plaintext highlighter-rouge">#Instant "2025-01-06T14:03:23.819994Z"</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">java.time.LocalDate</code></td>
      <td><code class="language-plaintext highlighter-rouge">#LocalDate "2034-01-30"</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">java.time.LocalDateTime</code></td>
      <td><code class="language-plaintext highlighter-rouge">#LocalDateTime "2025-01-08T11:08:13.232516"</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">java.time.LocalTime</code></td>
      <td><code class="language-plaintext highlighter-rouge">#LocalTime "20:30:56.928424"</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">java.time.MonthDay</code></td>
      <td><code class="language-plaintext highlighter-rouge">#MonthDay "--02-07"</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">java.time.OffsetDateTime</code></td>
      <td><code class="language-plaintext highlighter-rouge">#OffsetDateTime "2025-02-07T20:31:22.513785+04:00"</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">java.time.OffsetTime</code></td>
      <td><code class="language-plaintext highlighter-rouge">#OffsetTime "20:31:39.516036+03:00"</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">java.time.Period</code></td>
      <td><code class="language-plaintext highlighter-rouge">#Period "P1Y2M3D"</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">java.net.URI</code></td>
      <td><code class="language-plaintext highlighter-rouge">#URI "foobar://test.com/path?foo=1"</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">java.net.URL</code></td>
      <td><code class="language-plaintext highlighter-rouge">#URL "https://clojure.org"</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">java.time.Year</code></td>
      <td><code class="language-plaintext highlighter-rouge">#Year "2025"</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">java.time.YearMonth</code></td>
      <td><code class="language-plaintext highlighter-rouge">#YearMonth "2025-02"</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">java.time.ZoneId</code></td>
      <td><code class="language-plaintext highlighter-rouge">#ZoneId "Europe/Paris"</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">java.time.ZoneOffset</code></td>
      <td><code class="language-plaintext highlighter-rouge">#ZoneOffset "-08:00"</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">java.time.ZonedDateTime</code></td>
      <td><code class="language-plaintext highlighter-rouge">#ZonedDateTime "2025-02-07T20:32:33.309294+01:00[Europe/Paris]"</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">clojure.lang.Atom</code></td>
      <td><code class="language-plaintext highlighter-rouge">#atom {:inner 'state}</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">boolean[]</code></td>
      <td><code class="language-plaintext highlighter-rouge">#booleans [true false]</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">byte[]</code></td>
      <td><code class="language-plaintext highlighter-rouge">#bytes [1 2 3]</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">char[]</code></td>
      <td><code class="language-plaintext highlighter-rouge">#chars [\a \b \c]</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">double[]</code></td>
      <td><code class="language-plaintext highlighter-rouge">#doubles [1.1 2.2 3.3]</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">Throwable-&gt;map</code></td>
      <td><code class="language-plaintext highlighter-rouge">#error &lt;result of Throwable-&gt;map&gt;</code> (see below)</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">float[]</code></td>
      <td><code class="language-plaintext highlighter-rouge">#floats [1.1 2.2 3.3]</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">int[]</code></td>
      <td><code class="language-plaintext highlighter-rouge">#ints [1 2 3]</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">long[]</code></td>
      <td><code class="language-plaintext highlighter-rouge">#longs [1 2 3]</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">Object[]</code></td>
      <td><code class="language-plaintext highlighter-rouge">#objects ["test" :foo 42 #atom false]</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">clojure.lang.Ref</code></td>
      <td><code class="language-plaintext highlighter-rouge">#ref {:test true}</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">java.util.regex.Pattern</code></td>
      <td><code class="language-plaintext highlighter-rouge">#regex "vesion: \d+"</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">java.sql.Timestamp</code></td>
      <td><code class="language-plaintext highlighter-rouge">#sql/Timestamp "2025-01-06T14:03:23.819Z"</code></td>
    </tr>
  </tbody>
</table>

<p>The <code class="language-plaintext highlighter-rouge">#error</code> tag is a bit special: it returns a value with no parsing. It
prevents an error when reading the result of printing of an exception:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nb">println</span><span class="w"> </span><span class="p">(</span><span class="nf">ex-info</span><span class="w"> </span><span class="s">"boom"</span><span class="w"> </span><span class="p">{</span><span class="no">:test</span><span class="w"> </span><span class="mi">123</span><span class="p">}))</span><span class="w">

</span><span class="o">#</span><span class="n">error</span><span class="w"> </span><span class="p">{</span><span class="w">
 </span><span class="no">:cause</span><span class="w"> </span><span class="n">boom</span><span class="w">
 </span><span class="no">:data</span><span class="w"> </span><span class="p">{</span><span class="no">:test</span><span class="w"> </span><span class="mi">123</span><span class="p">}</span><span class="w">
 </span><span class="no">:via</span><span class="w">
 </span><span class="p">[{</span><span class="no">:type</span><span class="w"> </span><span class="n">clojure.lang.ExceptionInfo</span><span class="w">
   </span><span class="no">:message</span><span class="w"> </span><span class="n">boom</span><span class="w">
   </span><span class="no">:data</span><span class="w"> </span><span class="p">{</span><span class="no">:test</span><span class="w"> </span><span class="mi">123</span><span class="p">}</span><span class="w">
   </span><span class="no">:at</span><span class="w"> </span><span class="p">[</span><span class="n">taggie.edn$eval9263</span><span class="w"> </span><span class="n">invokeStatic</span><span class="w"> </span><span class="n">form-init2367470449524935680.clj</span><span class="w"> </span><span class="mi">97</span><span class="p">]}]</span><span class="w">
 </span><span class="no">:trace</span><span class="w">
 </span><span class="p">[[</span><span class="n">taggie.edn$eval9263</span><span class="w"> </span><span class="n">invokeStatic</span><span class="w"> </span><span class="n">form-init2367470449524935680.clj</span><span class="w"> </span><span class="mi">97</span><span class="p">]</span><span class="w">
  </span><span class="p">[</span><span class="n">taggie.edn$eval9263</span><span class="w"> </span><span class="n">invoke</span><span class="w"> </span><span class="n">form-init2367470449524935680.clj</span><span class="w"> </span><span class="mi">97</span><span class="p">]</span><span class="w">
  </span><span class="c1">;; truncated</span><span class="w">
  </span><span class="p">[</span><span class="n">java.lang.Thread</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">Thread.java</span><span class="w"> </span><span class="mi">833</span><span class="p">]]}</span><span class="w">
</span></code></pre></div></div>

<p>When reading such data from EDN with Taggie, you’ll get a regular map.</p>

<h2 id="adding-your-types">Adding Your Types</h2>

<p>Imagine you have a custom type and you want Taggie to hande it:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">deftype</span><span class="w"> </span><span class="n">SomeType</span><span class="w"> </span><span class="p">[</span><span class="n">a</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="n">c</span><span class="p">])</span><span class="w">

</span><span class="p">(</span><span class="k">def</span><span class="w"> </span><span class="n">some-type</span><span class="w">
  </span><span class="p">(</span><span class="nb">new</span><span class="w"> </span><span class="n">SomeType</span><span class="w"> </span><span class="p">(</span><span class="nf">atom</span><span class="w"> </span><span class="no">:test</span><span class="p">)</span><span class="w">
                </span><span class="p">(</span><span class="nf">LocalDate/parse</span><span class="w"> </span><span class="s">"2023-01-03"</span><span class="p">)</span><span class="w">
                </span><span class="p">(</span><span class="nf">long-array</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span><span class="p">])))</span><span class="w">
</span></code></pre></div></div>

<p>To override the way it gets printed, run the <code class="language-plaintext highlighter-rouge">defprint</code> macro:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">taggie.print/defprint</span><span class="w"> </span><span class="n">SomeType</span><span class="w"> </span><span class="o">^</span><span class="n">SomeType</span><span class="w"> </span><span class="n">some-type</span><span class="w"> </span><span class="n">writer</span><span class="w">
  </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">[</span><span class="n">a</span><span class="w"> </span><span class="p">(</span><span class="nf">.-a</span><span class="w"> </span><span class="n">some-type</span><span class="p">)</span><span class="w">
        </span><span class="n">b</span><span class="w"> </span><span class="p">(</span><span class="nf">.-b</span><span class="w"> </span><span class="n">some-type</span><span class="p">)</span><span class="w">
        </span><span class="n">c</span><span class="w"> </span><span class="p">(</span><span class="nf">.-c</span><span class="w"> </span><span class="n">some-type</span><span class="p">)]</span><span class="w">
    </span><span class="p">(</span><span class="nf">.write</span><span class="w"> </span><span class="n">writer</span><span class="w"> </span><span class="s">"#SomeType "</span><span class="p">)</span><span class="w">
    </span><span class="p">(</span><span class="nf">print-method</span><span class="w"> </span><span class="p">[</span><span class="n">a</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="n">c</span><span class="p">]</span><span class="w"> </span><span class="n">writer</span><span class="p">)))</span><span class="w">
</span></code></pre></div></div>

<p>The first argument is a symbol bound to a class. The second is a symbol bound to
the instance of this class (in some cases you’ll need a type hint). The third
symbol is bound to the <code class="language-plaintext highlighter-rouge">Writer</code> instance. Inside the macro, you <code class="language-plaintext highlighter-rouge">.write</code> certain
values into the writer. Avobe, we write the leading <code class="language-plaintext highlighter-rouge">"#SomeType "</code> string, and a
vector of fields <code class="language-plaintext highlighter-rouge">a</code>, <code class="language-plaintext highlighter-rouge">b</code> and <code class="language-plaintext highlighter-rouge">c</code>. Calling <code class="language-plaintext highlighter-rouge">print-method</code> guarantees that all
nested data will be written with their custom tags.</p>

<p>Now if you print <code class="language-plaintext highlighter-rouge">some-type</code> or dump it into EDN, you’ll get:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">#</span><span class="n">SomeType</span><span class="w"> </span><span class="p">[</span><span class="o">#</span><span class="n">atom</span><span class="w"> </span><span class="no">:test</span><span class="w"> </span><span class="o">#</span><span class="n">LocalDate</span><span class="w"> </span><span class="s">"2023-01-03"</span><span class="w"> </span><span class="o">#</span><span class="n">longs</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span><span class="p">]]</span><span class="w">
</span></code></pre></div></div>

<p>The opposite step: define readers for <code class="language-plaintext highlighter-rouge">SomeType</code> class:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">taggie.readers/defreader</span><span class="w"> </span><span class="n">SomeType</span><span class="w"> </span><span class="p">[</span><span class="n">vect</span><span class="p">]</span><span class="w">
  </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">[[</span><span class="n">a</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="n">c</span><span class="p">]</span><span class="w"> </span><span class="n">vect</span><span class="p">]</span><span class="w">
    </span><span class="p">(</span><span class="nb">new</span><span class="w"> </span><span class="n">SomeType</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="n">c</span><span class="p">)))</span><span class="w">
</span></code></pre></div></div>

<p>It’s quite simple: the vector of fields is already parsed, so you only need to
split it and pass fields into the constructor.</p>

<p>The <code class="language-plaintext highlighter-rouge">defreader</code> mutates a global map of EDN readers. When you read an EDN
string, the <code class="language-plaintext highlighter-rouge">SomeType</code> will be held. But it won’t work in REPL: for example,
running <code class="language-plaintext highlighter-rouge">#SomeType [...]</code> in REPL will throw an error. The thing is, REPL
readers cannot be overriden in runtime.</p>

<p>But you can declare your own readers: in <code class="language-plaintext highlighter-rouge">src</code> directory, create a file called
<code class="language-plaintext highlighter-rouge">data_readers.clj</code> with a map:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="n">SomeType</span><span class="w"> </span><span class="n">some.namespace/__reader-SomeType-clj</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Restart the REPL, and now the tag will be available.</p>

<p>As you might have guessed, the <code class="language-plaintext highlighter-rouge">defreader</code> macro creates two functions:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">__reader-&lt;tag&gt;-clj</code> for a REPL reader;</li>
  <li><code class="language-plaintext highlighter-rouge">__reader-&lt;tag&gt;-edn</code> for an EDN reader.</li>
</ul>

<p>Each <code class="language-plaintext highlighter-rouge">-clj</code> reader relies on a corresponding <code class="language-plaintext highlighter-rouge">-edn</code> reader internally.</p>

<p><strong>Emacs &amp; Cider caveat:</strong> I noticed that <code class="language-plaintext highlighter-rouge">M-x cider-ns-refresh</code> command ruins
loading REPL tags. After this command being run, any attempt to execute
something like <code class="language-plaintext highlighter-rouge">#LocalDate "..."</code> ends up with an error saying “unbound
function”. Thus, if you use Emacs and Cider, avoid this command.</p>

                
            </div>

        </li>
        
    </ul>

    <h4>
        
        <a href="/page10" class="previous">&larr;</a>
        
        <span class="page_number ">Страница 11 из 100</span>
        
        <a href="/page12" class="next">&rarr;</a>
        
    </h4>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>Ivan Grishaev's blog</li>
          <li><a href="mailto:ivan@grishaev.me">ivan@grishaev.me</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
            <li><a href="https://github.com/igrishaev">GitHub</a></li>
            <li><a href="https://t.me/igrishaev_blog">Telegram</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>Writing on programming, education, books and negotiations.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
