<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>PG docs, part 4. Arrays</title>
  <meta name="description" content="">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/custom.css">
  <link rel="canonical" href="https://grishaev.me/en/pg-docs/04/">
  <link rel="alternate" type="application/rss+xml" title="Ivan Grishaev's blog" href="https://grishaev.me/feed.xml">

  <link rel="shortcut icon" type="image/x-icon" href="/assets/static/favicons/favicon.ico">

  <script type="text/javascript" src="/assets/typo.js"></script>

</head>


  <body>
    <header class="site-header">

    <div class="wrapper flex-container">

        <div>
            <a href="/">
                <img id="avatar" src="/assets/static/avatar.jpg" alt="Ivan Grishaev">
            </a>
        </div>

        <div class="flex-container-vert" style="margin-left: 15px; width: 80%">

            <div class="flex-container full-width">
                <p style="margin-bottom: 5px">Ivan Grishaev's blog</p>
                <div class="flex-huge"></div>
                <div >
<form id="search-form"
      target="_blank"
      style="display: inline"
      method="get"
      action="https://www.google.com/search">

    <input name="sitesearch"
           value="grishaev.me"
           type="hidden">

    <input type="text"
           required="required"
           name="q"
           placeholder="Google search..."
           autocomplete="off">

    <button style="border: none; background-color: transparent; cursor: pointer;"
            type="submit">&#x1f50d;</button>

</form>
</div>
            </div>

            <p><small>Writing on programming, education, books and negotiations.
</small></p>

            <div class="flex-container">
                <a class="menu-item" href="/">Home</a>
                <a class="menu-item" href="/about/">About</a>
                <a class="menu-item" href="/bookshelf/">Bookshelf</a>
                <a class="menu-item" href="/feed.xml">RSS</a>
            </div>

            <div class="flex-container">
                <a class="menu-item minor" href="/tag/clojure/">Clojure</a>
                <a class="menu-item minor" href="/tag/emacs/">Emacs</a>
                <a class="menu-item minor" href="/tag/python/">Python</a>
                <a class="menu-item minor" href="/tag/programming/">Programming</a>
                <a class="menu-item minor" href="/interview/">Interview</a>
                <a class="menu-item minor" href="/video/">Video</a>
            </div>

            <div class="flex-container">
                <a class="menu-item minor hl" href="/clojure-in-prod/">Книга «Clojure на производстве»</a>
            </div>

            <div class="flex-container">
                <a class="menu-item minor hl" href="/clojure-in-prod-2/">Книга «Clojure на производстве», второй том</a>
            </div>

        </div>
    </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">

    <h1 class="post-title" itemprop="name headline">PG docs, part 4. Arrays</h1>

    
<div class="post-meta">

    <time class="post-time"
          datetime="2023-09-12T00:00:00+00:00">
        Sep 12, 2023
    </time>

    <a href="/tag/clojure/" rel="tag">clojure</a>, <a href="/tag/programming/" rel="tag">programming</a>, <a href="/tag/postgres/" rel="tag">postgres</a>, <a href="/tag/sql/" rel="tag">sql</a>, <a href="/tag/arrays/" rel="tag">arrays</a>

</div>


  </header>

  <div class="post-content" itemprop="articleBody">
    
<p><em>(This is a new documentation chapter from the <a href="https://github.com/igrishaev/pg">PG project</a>.)</em></p>

<p><strong>ToC</strong></p>

<ul>
  <li><a href="/en/pg-docs/01/">About &amp; Installation</a></li>
  <li><a href="/en/pg-docs/02/">The Client</a></li>
  <li><a href="/en/pg-docs/03/">Connection Pool</a></li>
  <li><a href="/en/pg-docs/04/">Arrays</a></li>
  <li><a href="/en/pg-docs/05/">Notifications</a></li>
  <li><a href="/en/pg-docs/06/">SSL</a></li>
  <li><a href="/en/pg-docs/07/">COPY</a></li>
  <li><a href="/en/pg-docs/08/">HoneySQL</a></li>
</ul>

<p>In JDBC, arrays have always been a pain. Every time you want to pass an array to
the database or read it back, you’ve got to wrap your data with various Java
classes, extend protocols, and multimethods. We do it in each project, and it
doesn’t have to be like this.</p>

<p>The recent release of PG ships a significant feature: arrays. You can pass an
array to a query and read it back as easily as they were native Clojure
vectors. No more ceremonies with classes, manual parsing, etc.</p>

<!-- more -->

<h2 id="usage">Usage</h2>

<p>Reading a trivial array of integers:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">pg/execute</span><span class="w"> </span><span class="n">conn</span><span class="w"> </span><span class="s">"select '{1,2,3}'::int[] as array"</span><span class="p">)</span><span class="w">

</span><span class="c1">;; [{:array [1 2 3]}]</span><span class="w">
</span></code></pre></div></div>

<p>Reading an array of strings. Pay attention that the second item is NULL:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">pg/execute</span><span class="w"> </span><span class="n">conn</span><span class="w"> </span><span class="s">"select '{foo,null,baz}'::text[] as array"</span><span class="p">)</span><span class="w">

</span><span class="p">[{</span><span class="no">:array</span><span class="w"> </span><span class="p">[</span><span class="s">"foo"</span><span class="w"> </span><span class="n">nil</span><span class="w"> </span><span class="s">"baz"</span><span class="p">]}]</span><span class="w">
</span></code></pre></div></div>

<p>Multi-dimensional arrays of any sub-type work as well. Below, we read a 2x2
array of dates:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">pg/execute</span><span class="w"> </span><span class="n">conn</span><span class="w"> </span><span class="s">"select '{{2020-01-01,2021-12-31},{2099-11-03,1301-01-23}}'::date[][] as array"</span><span class="p">)</span><span class="w">
</span><span class="p">[{</span><span class="no">:array</span><span class="w">
  </span><span class="p">[[</span><span class="o">#</span><span class="n">.j.t.LocalDate</span><span class="w"> </span><span class="s">"2020-01-01"</span><span class="w">
    </span><span class="o">#</span><span class="n">.j.t.LocalDate</span><span class="w"> </span><span class="s">"2021-12-31"</span><span class="p">]</span><span class="w">
   </span><span class="p">[</span><span class="o">#</span><span class="n">.j.t.LocalDate</span><span class="w"> </span><span class="s">"2099-11-03"</span><span class="w">
    </span><span class="o">#</span><span class="n">.j.t.LocalDate</span><span class="w"> </span><span class="s">"1301-01-23"</span><span class="p">]]}]</span><span class="w">
</span></code></pre></div></div>

<p>The same 2x2 array of UUIDs:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">pg/execute</span><span class="w"> </span><span class="n">conn</span><span class="w"> </span><span class="s">"select '{{887dfa2b-ab88-47d6-ab2f-83b66685063e,9ae401db-95ee-4612-880c-011ad15cdacf},{2f15d54b-836d-426a-9389-b878f6b0aa18,88991362-20ff-4217-96d5-20bd70166916}}'::uuid[][] as array"</span><span class="p">)</span><span class="w">

</span><span class="p">[{</span><span class="no">:array</span><span class="w">
  </span><span class="p">[[</span><span class="o">#</span><span class="n">uuid</span><span class="w"> </span><span class="s">"887dfa2b-ab88-47d6-ab2f-83b66685063e"</span><span class="w">
    </span><span class="o">#</span><span class="n">uuid</span><span class="w"> </span><span class="s">"9ae401db-95ee-4612-880c-011ad15cdacf"</span><span class="p">]</span><span class="w">
   </span><span class="p">[</span><span class="o">#</span><span class="n">uuid</span><span class="w"> </span><span class="s">"2f15d54b-836d-426a-9389-b878f6b0aa18"</span><span class="w">
    </span><span class="o">#</span><span class="n">uuid</span><span class="w"> </span><span class="s">"88991362-20ff-4217-96d5-20bd70166916"</span><span class="p">]]}]</span><span class="w">
</span></code></pre></div></div>

<p>To pass an array into a query, use a plain vector, a list, or a sequence:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">pg/execute</span><span class="w"> </span><span class="n">conn</span><span class="w"> </span><span class="s">"select 2 = ANY ($1) as in_array"</span><span class="w"> </span><span class="p">[[</span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span><span class="p">]])</span><span class="w">
</span><span class="p">[{</span><span class="no">:in_array</span><span class="w"> </span><span class="n">true</span><span class="p">}]</span><span class="w">
</span></code></pre></div></div>

<h2 id="details">Details</h2>

<ul>
  <li>
    <p>In both reading and writing, arrays are represented with vectors. If more
precisely, encoding logic relies on the <code class="language-plaintext highlighter-rouge">clojure.lang.Sequential</code>
interface. It means lists, sets, and lazy sequences are supported as well. You
can pass into a vector the result of <code class="language-plaintext highlighter-rouge">map</code>, <code class="language-plaintext highlighter-rouge">filter</code>, etc.</p>
  </li>
  <li>
    <p>Arrays might be multidimensional. Nested arrays are represented with
vectors/lists as well.</p>
  </li>
  <li>
    <p>Arrays support both binary and text Postgres Wire protocols.</p>
  </li>
  <li>
    <p>Unlike JDBC, arrays might be of any type: timestamp(tz), UUID, numeric, text.</p>
  </li>
</ul>

    
<div class="prev-next">

    <div class="prev-next-left">
    
        <p><small><a href="/en/pg-docs/03/">&larr; PG docs, part 3</a></small></p>
    
    </div>

    <div class="prev-next-mid">
    </div>

    <div class="prev-next-right">
    
        <p><small><a href="/en/pg-docs/05/">PG docs, part 5. Notifications &rarr;</a></small></p>
    
    </div>

</div>

  </div>

</article>

<center>
    <p>
        <small>Нашли ошибку? Выделите мышкой и нажмите Ctrl/&#8984;+Enter</small>
    </p>
</center>





<center>
    
    Комментариев пока нет
    
    
</center>









<form id="comment-form" method="POST" action="https://functions.yandexcloud.net/d4ehfuf08fjfjr59ivnf">

    <div class="block">
        <p class="comment-form-label"><small>Your name</small></p>
        <input required id="comment-form-author" name="author" type="text">
    </div>

    <div class="block">
        <p class="comment-form-label"><small>Comment (markdown syntax)</small></p>
        <textarea required id="comment-form-comment" name="comment"></textarea>
    </div>

    <input required name="path" type="hidden" value="/en/pg-docs/04/">
    <input required name="captcha" type="hidden" value="5 &#215; 5">

    <div class="block">
        <span class="comment-form-label"><small>5 &#215; 5 = </small></span>
        <input required id="comment-form-solution" name="solution" type="text">
    </div>

    <div class="block">
        <button id="comment-form-send" type="submit">Send</button>
    </div>

</form>


      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>Ivan Grishaev's blog</li>
          <li><a href="mailto:ivan@grishaev.me">ivan@grishaev.me</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
            <li><a href="https://github.com/igrishaev">GitHub</a></li>
            <li><a href="https://t.me/igrishaev_blog">Telegram</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>Writing on programming, education, books and negotiations.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
