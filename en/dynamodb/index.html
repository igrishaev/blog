<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>The DynamoDB library for Clojure</title>
  <meta name="description" content="(This is a copy of the readme file from the repository.)">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/custom.css">
  <link rel="canonical" href="https://grishaev.me/en/dynamodb/">
  <link rel="alternate" type="application/rss+xml" title="Ivan Grishaev's blog" href="https://grishaev.me/feed.xml">

  <link rel="shortcut icon" type="image/x-icon" href="/assets/static/favicons/favicon.ico">

  <script type="text/javascript" src="/assets/typo.js"></script>

</head>


  <body>
    <header class="site-header">

    <div class="wrapper flex-container">

        <div>
            <a href="/">
                <img id="avatar" src="/assets/static/avatar.jpg" alt="Ivan Grishaev">
            </a>
        </div>

        <div class="flex-container-vert" style="margin-left: 15px; width: 80%">

            <div class="flex-container full-width">
                <p style="margin-bottom: 5px"><a href="/">Ivan Grishaev's blog</a></p>
                <div class="flex-huge"></div>
                <div >
<form id="search-form"
      target="_blank"
      style="display: inline"
      method="get"
      action="https://www.google.com/search">

    <input name="sitesearch"
           value="grishaev.me"
           type="hidden">

    <input type="text"
           required="required"
           name="q"
           placeholder="Google search..."
           autocomplete="off">

    <button style="border: none; background-color: transparent; cursor: pointer;"
            type="submit">&#x1f50d;</button>

</form>
</div>
            </div>

            <p><small>Writing on programming, education, books and negotiations.
</small></p>

            <div class="flex-container">
                <a class="menu-item" href="/">Home</a>
                <a class="menu-item" href="/about/">About</a>
                <a class="menu-item" href="/open-source/">Open Source</a>
                <a class="menu-item" href="/bookshelf/">Bookshelf</a>
                <a class="menu-item" href="/feed.xml">RSS</a>
            </div>

            <div class="flex-container">
                <a class="menu-item minor" href="/tag/clojure/">Clojure</a>
                <a class="menu-item minor" href="/tag/emacs/">Emacs</a>
                <a class="menu-item minor" href="/tag/python/">Python</a>
                <a class="menu-item minor" href="/tag/programming/">Programming</a>
                <a class="menu-item minor" href="/interview/">Interview</a>
                <a class="menu-item minor" href="/video/">Video</a>
            </div>

            <div class="flex-container">
                <a class="menu-item minor hl" href="/clojure-in-prod/">Книга «Clojure на производстве»</a>
            </div>

            <div class="flex-container">
                <a class="menu-item minor hl" href="/clojure-in-prod-2/">Книга «Clojure на производстве», второй том</a>
            </div>

        </div>
    </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">

    <h1 class="post-title" itemprop="name headline">The DynamoDB library for Clojure</h1>

    
<div class="post-meta">

    <time class="post-time"
          datetime="2023-02-15T00:00:00+00:00">
        Feb 15, 2023
    </time>

    <a href="/tag/clojure/" rel="tag">clojure</a>, <a href="/tag/programming/" rel="tag">programming</a>

</div>


  </header>

  <div class="post-content" itemprop="articleBody">
    <p><em>(This is a copy of the readme file from the repository.)</em></p>

<p><a href="https://github.com/igrishaev/dynamodb">This library</a> is a driver for <a href="https://aws.amazon.com/dynamodb/">DynamoDB</a> written in pure
Clojure. No AWS SDK, lightweight dependencies, GraalVM-friendly.</p>

<h3 id="benefits">Benefits</h3>

<ul>
  <li>Free from AWS SDK. Everything is implemented with pure JSON + HTTP.</li>
  <li>Quite narrow dependencies: just <a href="https://github.com/http-kit/http-kit">HTTP Kit</a> and <a href="https://github.com/dakrone/cheshire">Cheshire</a>.</li>
  <li>Compatible with <a href="https://www.graalvm.org/22.0/reference-manual/native-image/">Native Image</a>! Thus, easy to use as a binary
file in AWS Lambda.</li>
  <li>Clojure-friendly: supports fully qualified keyword attributes and handles
properly them in SQL expressions.</li>
  <li>Both encoding &amp; decoding are extendable with protocols &amp; multimethods.</li>
  <li>Raw API access for special cases.</li>
  <li>Specs for better input validation.</li>
  <li>Compatible with <a href="https://cloud.yandex.com/en-ru/services/ydb">Yandex DB</a>.</li>
</ul>

<!-- more -->

<h3 id="installation">Installation</h3>

<p>Leiningen/Boot:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[com.github.igrishaev/dynamodb "0.1.2"]
</code></pre></div></div>

<p>Clojure CLI/deps.edn:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>com.github.igrishaev/dynamodb {:mvn/version "0.1.2"}
</code></pre></div></div>

<h3 id="documentation">Documentation</h3>

<p><a href="https://cljdoc.org/d/com.github.igrishaev/dynamodb/0.1.3/doc/readme">At cljdoc.org</a> (automatic build).</p>

<h3 id="api-implemented">API Implemented</h3>

<p>At the moment, only the most important <a href="https://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API_Operations_Amazon_DynamoDB.html">API targets</a> are
implemented. The rest of them is a matter of time and copy-paste. Let me know if
you need something missing in the table below.</p>

<table>
  <thead>
    <tr>
      <th>Target</th>
      <th>Done?</th>
      <th>Comment</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>BatchExecuteStatement</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>BatchGetItem</td>
      <td>+</td>
      <td> </td>
    </tr>
    <tr>
      <td>BatchWriteItem</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>CreateBackup</td>
      <td>+</td>
      <td> </td>
    </tr>
    <tr>
      <td>CreateGlobalTable</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>CreateTable</td>
      <td>+</td>
      <td> </td>
    </tr>
    <tr>
      <td>DeleteBackup</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>DeleteItem</td>
      <td>+</td>
      <td> </td>
    </tr>
    <tr>
      <td>DeleteTable</td>
      <td>+</td>
      <td> </td>
    </tr>
    <tr>
      <td>DescribeBackup</td>
      <td>+</td>
      <td> </td>
    </tr>
    <tr>
      <td>DescribeContinuousBackups</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>DescribeContributorInsights</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>DescribeEndpoints</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>DescribeExport</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>DescribeGlobalTable</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>DescribeGlobalTableSettings</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>DescribeImport</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>DescribeKinesisStreamingDestination</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>DescribeLimits</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>DescribeTable</td>
      <td>+</td>
      <td> </td>
    </tr>
    <tr>
      <td>DescribeTableReplicaAutoScaling</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>DescribeTimeToLive</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>DisableKinesisStreamingDestination</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>EnableKinesisStreamingDestination</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>ExecuteStatement</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>ExecuteTransaction</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>ExportTableToPointInTime</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>GetItem</td>
      <td>+</td>
      <td> </td>
    </tr>
    <tr>
      <td>ImportTable</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>ListBackups</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>ListContributorInsights</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>ListExports</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>ListGlobalTables</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>ListImports</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>ListTables</td>
      <td>+</td>
      <td> </td>
    </tr>
    <tr>
      <td>ListTagsOfResource</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>PutItem</td>
      <td>+</td>
      <td> </td>
    </tr>
    <tr>
      <td>Query</td>
      <td>+</td>
      <td> </td>
    </tr>
    <tr>
      <td>RestoreTableFromBackup</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>RestoreTableToPointInTime</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>Scan</td>
      <td>+</td>
      <td> </td>
    </tr>
    <tr>
      <td>TagResource</td>
      <td>+</td>
      <td> </td>
    </tr>
    <tr>
      <td>TransactGetItems</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>TransactWriteItems</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>UntagResource</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>UpdateContinuousBackups</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>UpdateContributorInsights</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>UpdateGlobalTable</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>UpdateGlobalTableSettings</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>UpdateItem</td>
      <td>+</td>
      <td> </td>
    </tr>
    <tr>
      <td>UpdateTable</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>UpdateTableReplicaAutoScaling</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>UpdateTimeToLive</td>
      <td> </td>
      <td> </td>
    </tr>
  </tbody>
</table>

<h3 id="who-uses-it">Who Uses It</h3>

<p>DynamoDB is a part of <a href="https://github.com/igrishaev/teleward">Teleward</a> — a Telegram captcha bot. The bot is
hosted in Yandex Cloud as a binary file compiled with GraalVM. It uses the
library to track the state in Yandex DB. In turn, Yandex DB is a cloud database
that mimics DynamoDB and serves a subset of its HTTP API.</p>

<h3 id="usage">Usage</h3>

<p>First, import the library:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">require</span><span class="w"> </span><span class="o">'</span><span class="p">[</span><span class="n">dynamodb.api</span><span class="w"> </span><span class="no">:as</span><span class="w"> </span><span class="n">api</span><span class="p">])</span><span class="w">
</span><span class="p">(</span><span class="nf">require</span><span class="w"> </span><span class="o">'</span><span class="p">[</span><span class="n">dynamodb.constant</span><span class="w"> </span><span class="no">:as</span><span class="w"> </span><span class="n">const</span><span class="p">])</span><span class="w">
</span></code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">constant</code> module is needed sometimes to refer to common DynamoDB values
like <code class="language-plaintext highlighter-rouge">"PAY_PER_REQUEST"</code>, <code class="language-plaintext highlighter-rouge">"PROVISIONED"</code> and so on.</p>

<h4 id="the-client">The Client</h4>

<p>Prepare a client object. The first four parameters are mandatory:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">def</span><span class="w"> </span><span class="n">CLIENT</span><span class="w">
  </span><span class="p">(</span><span class="nf">api/make-client</span><span class="w"> </span><span class="s">"aws-public-key"</span><span class="w">
                   </span><span class="s">"aws-secret-key"</span><span class="w">
                   </span><span class="s">"https://aws.dynamodb.endpoint.com/some/path"</span><span class="w">
                   </span><span class="s">"aws-region"</span><span class="w">
                   </span><span class="p">{</span><span class="n">...</span><span class="p">}))</span><span class="w">
</span></code></pre></div></div>

<p>For Yandex DB, the region is something like “ru-central1”.</p>

<p>Both public and secret AWS keys are masked with a special wrapper that prevents
them from being logged or printed.</p>

<p>The fifth parameter is a map of options to override:</p>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">:throw?</code></td>
      <td><code class="language-plaintext highlighter-rouge">true</code></td>
      <td>Whether to throw a negative DynamoDB response.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">:version</code></td>
      <td><code class="language-plaintext highlighter-rouge">"20120810"</code></td>
      <td>DynamoDB API version.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">:http-opt</code></td>
      <td>(see below)</td>
      <td>A map of HTTP Kit default settings.</td>
    </tr>
  </tbody>
</table>

<p>The default HTTP settings are:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="no">:user-agent</span><span class="w"> </span><span class="s">"com.github.igrishaev/dynamodb"</span><span class="w">
 </span><span class="no">:keepalive</span><span class="w"> </span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="mi">1000</span><span class="p">)</span><span class="w">
 </span><span class="no">:insecure?</span><span class="w"> </span><span class="n">true</span><span class="w">
 </span><span class="no">:follow-redirects</span><span class="w"> </span><span class="n">false</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h4 id="create-a-table">Create a Table</h4>

<p>To create a new table, pass its name, the schema map, and the primary key
mapping:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">api/create-table</span><span class="w"> </span><span class="n">CLIENT</span><span class="w">
                  </span><span class="s">"SomeTable"</span><span class="w">
                  </span><span class="p">{</span><span class="no">:user/id</span><span class="w"> </span><span class="no">:N</span><span class="w">
                   </span><span class="no">:user/name</span><span class="w"> </span><span class="no">:S</span><span class="p">}</span><span class="w">
                  </span><span class="p">{</span><span class="no">:user/id</span><span class="w"> </span><span class="n">const/key-type-hash</span><span class="w">
                   </span><span class="no">:user/name</span><span class="w"> </span><span class="n">const/key-type-range</span><span class="p">}</span><span class="w">
                  </span><span class="p">{</span><span class="no">:tags</span><span class="w"> </span><span class="p">{</span><span class="no">:foo</span><span class="w"> </span><span class="s">"hello"</span><span class="p">}</span><span class="w">
                   </span><span class="no">:table-class</span><span class="w"> </span><span class="n">const/table-class-standard</span><span class="w">
                   </span><span class="no">:billing-mode</span><span class="w"> </span><span class="n">const/billing-mode-pay-per-request</span><span class="p">})</span><span class="w">
</span></code></pre></div></div>

<h4 id="list-tables">List Tables</h4>

<p>Tables can be listed by pages. The default page size is 100. Once you’ve reached
the limit, check out the <code class="language-plaintext highlighter-rouge">LastEvaluatedTableName</code> field. Pass it to the
<code class="language-plaintext highlighter-rouge">:start-table</code> optional argument to propagate to the next page:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">def</span><span class="w"> </span><span class="n">resp1</span><span class="w">
  </span><span class="p">(</span><span class="nf">api/list-tables</span><span class="w"> </span><span class="n">CLIENT</span><span class="w"> </span><span class="p">{</span><span class="no">:limit</span><span class="w"> </span><span class="mi">10</span><span class="p">}))</span><span class="w">

</span><span class="p">(</span><span class="k">def</span><span class="w"> </span><span class="n">last-table</span><span class="w">
  </span><span class="p">(</span><span class="no">:LastEvaluatedTableName</span><span class="w"> </span><span class="n">resp1</span><span class="p">))</span><span class="w">

</span><span class="p">(</span><span class="k">def</span><span class="w"> </span><span class="n">resp2</span><span class="w">
  </span><span class="p">(</span><span class="nf">api/list-tables</span><span class="w"> </span><span class="n">CLIENT</span><span class="w">
                   </span><span class="p">{</span><span class="no">:limit</span><span class="w"> </span><span class="mi">10</span><span class="w">
                    </span><span class="no">:start-table</span><span class="w"> </span><span class="n">last-table</span><span class="p">}))</span><span class="w">
</span></code></pre></div></div>

<h4 id="put-item">Put Item</h4>

<p>To upsert an item, pass a map that contains the primary attributes:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">api/put-item</span><span class="w"> </span><span class="n">CLIENT</span><span class="w">
              </span><span class="s">"SomeTable"</span><span class="w">
              </span><span class="p">{</span><span class="no">:user/id</span><span class="w"> </span><span class="mi">1</span><span class="w">
               </span><span class="no">:user/name</span><span class="w"> </span><span class="s">"Ivan"</span><span class="w">
               </span><span class="no">:user/foo</span><span class="w"> </span><span class="mi">1</span><span class="p">}</span><span class="w">
              </span><span class="p">{</span><span class="no">:return-values</span><span class="w"> </span><span class="n">const/return-values-none</span><span class="p">})</span><span class="w">
</span></code></pre></div></div>

<p>Pass <code class="language-plaintext highlighter-rouge">:sql-condition</code> to make the operation conditional. In the example above,
the <code class="language-plaintext highlighter-rouge">:user/foo</code> attribute is 1. The second upsert operation checks if
<code class="language-plaintext highlighter-rouge">:user/foo</code> is either 1, 2, or 3, which is true. Thus, it will fail:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">api/put-item</span><span class="w"> </span><span class="n">CLIENT</span><span class="w">
              </span><span class="s">"SomeTable"</span><span class="w">
              </span><span class="p">{</span><span class="no">:user/id</span><span class="w"> </span><span class="mi">1</span><span class="w">
               </span><span class="no">:user/name</span><span class="w"> </span><span class="s">"Ivan"</span><span class="w">
               </span><span class="no">:user/test</span><span class="w"> </span><span class="mi">3</span><span class="p">}</span><span class="w">
              </span><span class="p">{</span><span class="no">:sql-condition</span><span class="w"> </span><span class="s">"#foo in (:one, :two, :three)"</span><span class="w">
               </span><span class="no">:attr-names</span><span class="w"> </span><span class="p">{</span><span class="s">"#foo"</span><span class="w"> </span><span class="no">:user/foo</span><span class="p">}</span><span class="w">
               </span><span class="no">:attr-values</span><span class="w"> </span><span class="p">{</span><span class="s">":one"</span><span class="w"> </span><span class="mi">1</span><span class="w">
                             </span><span class="s">":two"</span><span class="w"> </span><span class="mi">2</span><span class="w">
                             </span><span class="s">":three"</span><span class="w"> </span><span class="mi">3</span><span class="p">}</span><span class="w">
               </span><span class="no">:return-values</span><span class="w"> </span><span class="n">const/return-values-all-old</span><span class="p">})</span><span class="w">
</span></code></pre></div></div>

<h4 id="get-item">Get Item</h4>

<p>To get an item, provide its primary key:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">api/get-item</span><span class="w"> </span><span class="n">CLIENT</span><span class="w">
              </span><span class="s">"SomeTable"</span><span class="w">
              </span><span class="p">{</span><span class="no">:user/id</span><span class="w"> </span><span class="mi">1</span><span class="w">
               </span><span class="no">:user/name</span><span class="w"> </span><span class="s">"Ivan"</span><span class="p">})</span><span class="w">

</span><span class="p">{</span><span class="no">:Item</span><span class="w"> </span><span class="o">#</span><span class="no">:user</span><span class="p">{</span><span class="no">:id</span><span class="w"> </span><span class="mi">1</span><span class="w">
              </span><span class="no">:name</span><span class="w"> </span><span class="s">"Ivan"</span><span class="w">
              </span><span class="no">:foo</span><span class="w"> </span><span class="mi">1</span><span class="p">}}</span><span class="w">
</span></code></pre></div></div>

<p>There is an option to get only the attributes you need or even sub-attributes
for nested maps or lists:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">;; put some complex values</span><span class="w">
</span><span class="p">(</span><span class="nf">api/put-item</span><span class="w"> </span><span class="n">CLIENT</span><span class="w">
              </span><span class="s">"SomeTable"</span><span class="w">
              </span><span class="p">{</span><span class="no">:user/id</span><span class="w"> </span><span class="mi">1</span><span class="w">
               </span><span class="no">:user/name</span><span class="w"> </span><span class="s">"Ivan"</span><span class="w">
               </span><span class="no">:test/kek</span><span class="w"> </span><span class="s">"123"</span><span class="w">
               </span><span class="no">:test/foo</span><span class="w"> </span><span class="mi">1</span><span class="w">
               </span><span class="no">:abc</span><span class="w"> </span><span class="n">nil</span><span class="w">
               </span><span class="no">:foo</span><span class="w"> </span><span class="s">"lol"</span><span class="w">
               </span><span class="no">:bar</span><span class="w"> </span><span class="p">{</span><span class="no">:baz</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span><span class="p">]}})</span><span class="w">

</span><span class="c1">;; pass a list of attributes/paths into the `:attrs-get` param</span><span class="w">
</span><span class="p">(</span><span class="nf">api/get-item</span><span class="w"> </span><span class="n">CLIENT</span><span class="w">
              </span><span class="s">"SomeTable"</span><span class="w">
              </span><span class="p">{</span><span class="no">:user/id</span><span class="w"> </span><span class="mi">1</span><span class="w">
               </span><span class="no">:user/name</span><span class="w"> </span><span class="s">"Ivan"</span><span class="p">}</span><span class="w">
              </span><span class="p">{</span><span class="no">:attrs-get</span><span class="w"> </span><span class="p">[</span><span class="no">:test/kek</span><span class="w"> </span><span class="s">"bar.baz[1]"</span><span class="w"> </span><span class="s">"abc"</span><span class="w"> </span><span class="s">"foo"</span><span class="p">]})</span><span class="w">

</span><span class="c1">;; the result:</span><span class="w">
</span><span class="p">{</span><span class="no">:Item</span><span class="w"> </span><span class="p">{</span><span class="no">:test/kek</span><span class="w"> </span><span class="s">"123"</span><span class="w">
        </span><span class="no">:bar</span><span class="w"> </span><span class="p">{</span><span class="no">:baz</span><span class="w"> </span><span class="p">[</span><span class="mi">2</span><span class="p">]}</span><span class="w">
        </span><span class="no">:abc</span><span class="w"> </span><span class="n">nil</span><span class="w">
        </span><span class="no">:foo</span><span class="w"> </span><span class="s">"lol"</span><span class="p">}}</span><span class="w">
</span></code></pre></div></div>

<h4 id="update-item">Update Item</h4>

<p>This operation is the most complex. In AWS SDK or <a href="https://github.com/Taoensso/faraday">Faraday</a>, to update
an item’s secondary attributes, one should manually build a SQL expression that
involves string formatting, concatenation and similar boring stuff.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SET</span> <span class="n">username</span> <span class="o">=</span> <span class="p">:</span><span class="n">username</span><span class="p">,</span> <span class="n">email</span> <span class="o">=</span> <span class="p">:</span><span class="n">email</span><span class="p">,</span> <span class="p">...</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">ADD</code>, <code class="language-plaintext highlighter-rouge">DELETE</code>, and <code class="language-plaintext highlighter-rouge">REMOVE</code> expressions require manual work as well.</p>

<p>The present library solves this problem for you. The <code class="language-plaintext highlighter-rouge">update-item</code> function
accepts <code class="language-plaintext highlighter-rouge">:add</code>, <code class="language-plaintext highlighter-rouge">:set</code>, <code class="language-plaintext highlighter-rouge">:delete</code>, and <code class="language-plaintext highlighter-rouge">:remove</code> parameters, either maps or
vectors.</p>

<p>The <code class="language-plaintext highlighter-rouge">:sql-condition</code> argument accepts a plain SQL expression. Should it
evaluates as falseness, the item won’t be affected and you’ll get a negative
response.</p>

<h5 id="set-attributes">Set Attributes</h5>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">api/update-item</span><span class="w"> </span><span class="n">CLIENT</span><span class="w">
                 </span><span class="n">table</span><span class="w">
                 </span><span class="p">{</span><span class="no">:user/id</span><span class="w"> </span><span class="mi">1</span><span class="w">
                  </span><span class="no">:user/name</span><span class="w"> </span><span class="s">"Ivan"</span><span class="p">}</span><span class="w">
                 </span><span class="p">{</span><span class="no">:attr-names</span><span class="w"> </span><span class="p">{</span><span class="s">"#counter"</span><span class="w"> </span><span class="no">:test/counter</span><span class="p">}</span><span class="w">
                  </span><span class="no">:attr-values</span><span class="w"> </span><span class="p">{</span><span class="s">":one"</span><span class="w"> </span><span class="mi">1</span><span class="p">}</span><span class="w">
                  </span><span class="no">:set</span><span class="w"> </span><span class="p">{</span><span class="s">"Foobar"</span><span class="w"> </span><span class="mi">123</span><span class="w">
                        </span><span class="no">:user/email</span><span class="w"> </span><span class="s">"test@test.com"</span><span class="w">
                        </span><span class="s">"#counter"</span><span class="w"> </span><span class="p">(</span><span class="nf">api/sql</span><span class="w"> </span><span class="s">"#counter + :one"</span><span class="p">)}})</span><span class="w">
</span></code></pre></div></div>

<p>The example above covers three various options for the <code class="language-plaintext highlighter-rouge">:set</code> argument. Namely:</p>

<ol>
  <li>The attribute is a plain string <code class="language-plaintext highlighter-rouge">("Foobar")</code>, and the value is plain as well.</li>
  <li>The attribute is a complex keyword (<code class="language-plaintext highlighter-rouge">:user/email</code>) which cannot be placed in
a SQL expression directly. Under the hood, the library produces an alias for
it and injects it into <code class="language-plaintext highlighter-rouge">ExpressionAttributeNames</code>.</li>
  <li>The attribute is an alias, and the value is a raw expression. To distinguish
an expression from a regular string (e.g. email), there is a wrapper
<code class="language-plaintext highlighter-rouge">api/sql</code>. The alias <code class="language-plaintext highlighter-rouge">#counter</code> should be declared in the <code class="language-plaintext highlighter-rouge">:attr-names</code> map.</li>
</ol>

<h5 id="add-attributes">Add Attributes</h5>

<p>The <code class="language-plaintext highlighter-rouge">:add</code> parameter accepts a map of an attribute or an alias to a
value. Imagine you have the following item in the db:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="no">:user/id</span><span class="w"> </span><span class="mi">1</span><span class="w">
 </span><span class="no">:user/name</span><span class="w"> </span><span class="s">"Ivan"</span><span class="w">
 </span><span class="no">:amount</span><span class="w"> </span><span class="mi">3</span><span class="w">
 </span><span class="no">:test/colors</span><span class="w"> </span><span class="o">#</span><span class="p">{</span><span class="s">"r"</span><span class="w"> </span><span class="s">"g"</span><span class="p">}}</span><span class="w">
</span></code></pre></div></div>

<p>To increase the amount and add a new color into the colors set, perfrom:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">api/update-item</span><span class="w"> </span><span class="n">CLIENT</span><span class="w">
                 </span><span class="n">table</span><span class="w">
                 </span><span class="p">{</span><span class="no">:user/id</span><span class="w"> </span><span class="mi">1</span><span class="w">
                  </span><span class="no">:user/name</span><span class="w"> </span><span class="s">"Ivan"</span><span class="p">}</span><span class="w">
                 </span><span class="p">{</span><span class="no">:add</span><span class="w"> </span><span class="p">{</span><span class="s">"amount"</span><span class="w"> </span><span class="mi">1</span><span class="w">
                        </span><span class="no">:test/colors</span><span class="w"> </span><span class="o">#</span><span class="p">{</span><span class="s">"b"</span><span class="p">}}})</span><span class="w">
</span></code></pre></div></div>

<p>Result:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="no">:Item</span><span class="w">
 </span><span class="p">{</span><span class="no">:amount</span><span class="w"> </span><span class="mi">4</span><span class="w">
  </span><span class="no">:user/id</span><span class="w"> </span><span class="mi">1</span><span class="w">
  </span><span class="no">:test/colors</span><span class="w"> </span><span class="o">#</span><span class="p">{</span><span class="s">"b"</span><span class="w"> </span><span class="s">"r"</span><span class="w"> </span><span class="s">"g"</span><span class="p">}</span><span class="w">
  </span><span class="no">:user/name</span><span class="w"> </span><span class="s">"Ivan"</span><span class="p">}}</span><span class="w">
</span></code></pre></div></div>

<h5 id="remove-attributes">Remove Attributes</h5>

<p>To remove an attribute, pass the <code class="language-plaintext highlighter-rouge">:remove</code> vector. Each item of that vector is
either a keyword attribute, a raw string expression, or an alias.</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">api/update-item</span><span class="w"> </span><span class="n">CLIENT</span><span class="w">
                 </span><span class="n">table</span><span class="w">
                 </span><span class="p">{</span><span class="no">:user/id</span><span class="w"> </span><span class="mi">1</span><span class="w">
                  </span><span class="no">:user/name</span><span class="w"> </span><span class="s">"Ivan"</span><span class="p">}</span><span class="w">
                 </span><span class="p">{</span><span class="no">:attr-names</span><span class="w"> </span><span class="p">{</span><span class="s">"#kek"</span><span class="w"> </span><span class="no">:test/kek</span><span class="p">}</span><span class="w">
                  </span><span class="no">:remove</span><span class="w"> </span><span class="p">[</span><span class="s">"#kek"</span><span class="w"> </span><span class="s">"abc"</span><span class="w"> </span><span class="no">:test/lol</span><span class="p">]})</span><span class="w">
</span></code></pre></div></div>

<p>To remove an item from a list, pass a string like this:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">;; item in the databalse</span><span class="w">
</span><span class="p">{</span><span class="no">:tags</span><span class="w"> </span><span class="p">[</span><span class="s">"foo"</span><span class="w"> </span><span class="s">"bar"</span><span class="w"> </span><span class="s">"baz"</span><span class="p">]}</span><span class="w">

</span><span class="p">{</span><span class="no">:remove</span><span class="w"> </span><span class="p">[</span><span class="s">"tags[1]"</span><span class="p">]}</span><span class="w">
</span></code></pre></div></div>

<p>Use an alias when the attribute is a keyword with a namespace:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">api/update-item</span><span class="w"> </span><span class="n">CLIENT</span><span class="w">
                 </span><span class="n">table</span><span class="w">
                 </span><span class="p">{</span><span class="no">:user/id</span><span class="w"> </span><span class="mi">1</span><span class="w">
                  </span><span class="no">:user/name</span><span class="w"> </span><span class="s">"Ivan"</span><span class="p">}</span><span class="w">
                 </span><span class="p">{</span><span class="no">:attr-names</span><span class="w"> </span><span class="p">{</span><span class="s">"#tags"</span><span class="w"> </span><span class="no">:user/tags</span><span class="p">}</span><span class="w">
                  </span><span class="no">:remove</span><span class="w"> </span><span class="p">[</span><span class="s">"#tags[1]"</span><span class="p">]})</span><span class="w">
</span></code></pre></div></div>

<h5 id="delete-attributes">Delete Attributes</h5>

<p>In DynamoDB, the <code class="language-plaintext highlighter-rouge">DELETE</code> clause is used to remove items from sets. The
<code class="language-plaintext highlighter-rouge">update-item</code> function accepts the <code class="language-plaintext highlighter-rouge">:delete</code> argument which is a map. The key is
either a keyword or a string alias. The value is always a set:</p>

<p>The item:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="no">:user/id</span><span class="w"> </span><span class="mi">1</span><span class="w">
 </span><span class="no">:user/name</span><span class="w"> </span><span class="s">"Ivan"</span><span class="w">
 </span><span class="no">:user/colors</span><span class="w"> </span><span class="o">#</span><span class="p">{</span><span class="s">"r"</span><span class="w"> </span><span class="s">"g"</span><span class="w"> </span><span class="s">"b"</span><span class="p">}}</span><span class="w">
</span></code></pre></div></div>

<p>API call:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">api/update-item</span><span class="w"> </span><span class="n">CLIENT</span><span class="w">
                 </span><span class="n">table</span><span class="w">
                 </span><span class="p">{</span><span class="no">:user/id</span><span class="w"> </span><span class="mi">1</span><span class="w">
                  </span><span class="no">:user/name</span><span class="w"> </span><span class="s">"Ivan"</span><span class="p">}</span><span class="w">
                 </span><span class="p">{</span><span class="no">:delete</span><span class="w"> </span><span class="p">{</span><span class="no">:user/colors</span><span class="w"> </span><span class="o">#</span><span class="p">{</span><span class="s">"r"</span><span class="w"> </span><span class="s">"b"</span><span class="p">}}})</span><span class="w">
</span></code></pre></div></div>

<p>Result:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="no">:Item</span><span class="w"> </span><span class="o">#</span><span class="no">:user</span><span class="p">{</span><span class="no">:colors</span><span class="w"> </span><span class="o">#</span><span class="p">{</span><span class="s">"g"</span><span class="p">}</span><span class="w"> </span><span class="no">:id</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="no">:name</span><span class="w"> </span><span class="s">"Ivan"</span><span class="p">}}</span><span class="w">
</span></code></pre></div></div>

<h4 id="delete-item">Delete Item</h4>

<p>Simple deletion of an item:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">api/delete-item</span><span class="w"> </span><span class="n">CLIENT</span><span class="w">
                 </span><span class="n">table</span><span class="w">
                 </span><span class="p">{</span><span class="no">:user/id</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="no">:user/name</span><span class="w"> </span><span class="s">"Ivan"</span><span class="p">})</span><span class="w">
</span></code></pre></div></div>

<p>Conditional deletion: throws an exception when the expression fails.</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">api/put-item</span><span class="w"> </span><span class="n">CLIENT</span><span class="w">
              </span><span class="n">table</span><span class="w">
              </span><span class="p">{</span><span class="no">:user/id</span><span class="w"> </span><span class="mi">1</span><span class="w">
               </span><span class="no">:user/name</span><span class="w"> </span><span class="s">"Ivan"</span><span class="w">
               </span><span class="no">:test/kek</span><span class="w"> </span><span class="mi">99</span><span class="p">})</span><span class="w">

</span><span class="p">(</span><span class="nf">api/delete-item</span><span class="w"> </span><span class="n">CLIENT</span><span class="w">
                 </span><span class="n">table</span><span class="w">
                 </span><span class="p">{</span><span class="no">:user/id</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="no">:user/name</span><span class="w"> </span><span class="s">"Ivan"</span><span class="p">}</span><span class="w">
                 </span><span class="p">{</span><span class="no">:sql-condition</span><span class="w"> </span><span class="s">"#kek in (:foo, :bar, :baz)"</span><span class="w">
                  </span><span class="no">:attr-names</span><span class="w"> </span><span class="p">{</span><span class="s">"#kek"</span><span class="w"> </span><span class="no">:test/kek</span><span class="p">}</span><span class="w">
                  </span><span class="no">:attr-values</span><span class="w"> </span><span class="p">{</span><span class="s">":foo"</span><span class="w"> </span><span class="mi">1</span><span class="w">
                                </span><span class="s">":bar"</span><span class="w"> </span><span class="mi">2</span><span class="w">
                                </span><span class="s">":baz"</span><span class="w"> </span><span class="mi">3</span><span class="p">}})</span><span class="w">
</span></code></pre></div></div>

<p>In the example above, the <code class="language-plaintext highlighter-rouge">"#kek in (:foo, :bar, :baz)"</code> expression fails as the
<code class="language-plaintext highlighter-rouge">:test/kek</code> attribute is of value 99. The item stays in the database, and you’ll
get an exception with ex-info:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="no">:error?</span><span class="w"> </span><span class="n">true</span><span class="w">
 </span><span class="no">:status</span><span class="w"> </span><span class="mi">400</span><span class="w">
 </span><span class="no">:path</span><span class="w"> </span><span class="s">"com.amazonaws.dynamodb.v20120810"</span><span class="w">
 </span><span class="no">:exception</span><span class="w"> </span><span class="s">"ConditionalCheckFailedException"</span><span class="w">
 </span><span class="no">:message</span><span class="w"> </span><span class="s">"The conditional request failed"</span><span class="w">
 </span><span class="no">:payload</span><span class="w">
 </span><span class="p">{</span><span class="no">:TableName</span><span class="w"> </span><span class="n">table</span><span class="w">
  </span><span class="no">:Key</span><span class="w"> </span><span class="o">#</span><span class="no">:user</span><span class="p">{</span><span class="no">:id</span><span class="w"> </span><span class="p">{</span><span class="no">:N</span><span class="w"> </span><span class="s">"1"</span><span class="p">}</span><span class="w"> </span><span class="no">:name</span><span class="w"> </span><span class="p">{</span><span class="no">:S</span><span class="w"> </span><span class="s">"Ivan"</span><span class="p">}}</span><span class="w">
  </span><span class="no">:ConditionExpression</span><span class="w"> </span><span class="s">"#kek in (:foo, :bar, :baz)"</span><span class="w">
  </span><span class="no">:ExpressionAttributeNames</span><span class="w"> </span><span class="p">{</span><span class="s">"#kek"</span><span class="w"> </span><span class="no">:test/kek</span><span class="p">}</span><span class="w">
  </span><span class="no">:ExpressionAttributeValues</span><span class="w">
  </span><span class="p">{</span><span class="s">":foo"</span><span class="w"> </span><span class="p">{</span><span class="no">:N</span><span class="w"> </span><span class="s">"1"</span><span class="p">}</span><span class="w"> </span><span class="s">":bar"</span><span class="w"> </span><span class="p">{</span><span class="no">:N</span><span class="w"> </span><span class="s">"2"</span><span class="p">}</span><span class="w"> </span><span class="s">":baz"</span><span class="w"> </span><span class="p">{</span><span class="no">:N</span><span class="w"> </span><span class="s">"3"</span><span class="p">}}}</span><span class="w">
 </span><span class="no">:target</span><span class="w"> </span><span class="s">"DeleteItem"</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h4 id="query">Query</h4>

<p>The Query target allows searching items that match a primary key partially or
match some range. Imagine the primary key of a table is <code class="language-plaintext highlighter-rouge">:user/id :HASH</code> and
<code class="language-plaintext highlighter-rouge">:user/name :RANGE</code>. Here is what you have in the database:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="no">:user/id</span><span class="w"> </span><span class="mi">1</span><span class="w">
 </span><span class="no">:user/name</span><span class="w"> </span><span class="s">"Ivan"</span><span class="w">
 </span><span class="no">:test/foo</span><span class="w"> </span><span class="mi">1</span><span class="p">}</span><span class="w">

</span><span class="p">{</span><span class="no">:user/id</span><span class="w"> </span><span class="mi">1</span><span class="w">
 </span><span class="no">:user/name</span><span class="w"> </span><span class="s">"Juan"</span><span class="w">
 </span><span class="no">:test/foo</span><span class="w"> </span><span class="mi">2</span><span class="p">}</span><span class="w">

</span><span class="p">{</span><span class="no">:user/id</span><span class="w"> </span><span class="mi">2</span><span class="w">
 </span><span class="no">:user/name</span><span class="w"> </span><span class="s">"Huan"</span><span class="w">
 </span><span class="no">:test/foo</span><span class="w"> </span><span class="mi">3</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Now, to find the items whose <code class="language-plaintext highlighter-rouge">:user/id</code> is 1, execute:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">api/query</span><span class="w"> </span><span class="n">CLIENT</span><span class="w">
           </span><span class="n">table</span><span class="w">
           </span><span class="p">{</span><span class="no">:sql-key</span><span class="w"> </span><span class="s">"#id = :one"</span><span class="w">
            </span><span class="no">:attr-names</span><span class="w"> </span><span class="p">{</span><span class="s">"#id"</span><span class="w"> </span><span class="no">:user/id</span><span class="p">}</span><span class="w">
            </span><span class="no">:attr-values</span><span class="w"> </span><span class="p">{</span><span class="s">":one"</span><span class="w"> </span><span class="mi">1</span><span class="p">}</span><span class="w">
            </span><span class="no">:limit</span><span class="w"> </span><span class="mi">1</span><span class="p">})</span><span class="w">
</span></code></pre></div></div>

<p>Result:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{:Items [{:user/id 1
          :test/foo 1
          :user/name "Ivan"}]
 :Count 1
 :ScannedCount 1
 :LastEvaluatedKey #:user{:id 1
                          :name "Ivan"}}
</code></pre></div></div>

<p>To propagate to the next page, fetch the <code class="language-plaintext highlighter-rouge">LastEvaluatedKey</code> field from the
result and pass it into the <code class="language-plaintext highlighter-rouge">:start-key</code> Query parameter.</p>

<h4 id="scan">Scan</h4>

<p>The Scan API goes through the whole table collecting the items that match an
expression. This is not optimal yet required sometimes.</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">api/scan</span><span class="w"> </span><span class="n">CLIENT</span><span class="w">
          </span><span class="n">table</span><span class="w">
          </span><span class="p">{</span><span class="no">:sql-filter</span><span class="w"> </span><span class="s">"#foo = :two"</span><span class="w">
           </span><span class="no">:attrs-get</span><span class="w"> </span><span class="p">[</span><span class="no">:test/foo</span><span class="w"> </span><span class="s">"#name"</span><span class="p">]</span><span class="w">
           </span><span class="no">:attr-names</span><span class="w"> </span><span class="p">{</span><span class="s">"#foo"</span><span class="w"> </span><span class="no">:test/foo</span><span class="w">
                        </span><span class="s">"#name"</span><span class="w"> </span><span class="no">:user/name</span><span class="p">}</span><span class="w">
           </span><span class="no">:attr-values</span><span class="w"> </span><span class="p">{</span><span class="s">":two"</span><span class="w"> </span><span class="mi">2</span><span class="p">}</span><span class="w">
           </span><span class="no">:limit</span><span class="w"> </span><span class="mi">2</span><span class="p">})</span><span class="w">
</span></code></pre></div></div>

<p>Result:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{:Items [{:test/foo 2
          :user/name "Ivan"}]
 :Count 1
 :ScannedCount 2
 :LastEvaluatedKey #:user{:id 1
                          :name "Ivan"}}
</code></pre></div></div>

<p>Both <code class="language-plaintext highlighter-rouge">LastEvaluatedKey</code> and <code class="language-plaintext highlighter-rouge">:start-key</code> parameters work as described above.</p>

<h4 id="other-api">Other API</h4>

<p>See the tests, specs, and <code class="language-plaintext highlighter-rouge">dynamodb.api</code> module for more information.</p>

<h3 id="raw-api-access">Raw API access</h3>

<p>The <code class="language-plaintext highlighter-rouge">api-call</code> function allows you to interact with DynamoDB on a low level. It
accepts the client, the target name, and a raw payload you’d like to send to
DB. The payload gets sent as-is with no kind of processing or interference.</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">api/api-call</span><span class="w"> </span><span class="n">CLIENT</span><span class="w">
             </span><span class="s">"NotImplementedTarget"</span><span class="w">
             </span><span class="p">{</span><span class="no">:ParamFoo</span><span class="w"> </span><span class="n">...</span><span class="w"> </span><span class="no">:ParamBar</span><span class="w"> </span><span class="n">...</span><span class="p">})</span><span class="w">
</span></code></pre></div></div>

<h3 id="specs">Specs</h3>

<p>The library provides a number of specs for the API. Find them in the
<code class="language-plaintext highlighter-rouge">dynamodb.spec</code> module. It’s not imported by default to prevent the binary file
from growing when compiled with GraalVM. That’s a known issue when introducing
<code class="language-plaintext highlighter-rouge">clojure.spec</code> adds +20 Mbs to the file.</p>

<p>Still, those specs are useful for testing and documentation. Import the specs,
then instrument the functions by calling the <code class="language-plaintext highlighter-rouge">instrument</code> function:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">require</span><span class="w"> </span><span class="ss">'dynamodb.spec</span><span class="p">)</span><span class="w">
</span><span class="p">(</span><span class="nf">require</span><span class="w"> </span><span class="o">'</span><span class="p">[</span><span class="n">clojure.spec.test.alpha</span><span class="w"> </span><span class="no">:as</span><span class="w"> </span><span class="n">spec.test</span><span class="p">])</span><span class="w">

</span><span class="p">(</span><span class="nf">spec.test/instrument</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Now if you pass something wrong into one of the library functions, you’ll get a
spec exception.</p>

<h3 id="tests">Tests</h3>

<p>The primary testing module called <code class="language-plaintext highlighter-rouge">api_test.clj</code> relies on a local DynamoDB
instance running in Docker. To bootstrap it, execute the command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make docker-up
</code></pre></div></div>

<p>It spawns <code class="language-plaintext highlighter-rouge">amazon/dynamodb-local</code> image on port 8000. Now connect to the REPL
and run the API tests from your editor as usual.</p>

<p>Ivan Grishaev, 2023</p>

    
<div class="prev-next">

    <div class="prev-next-left">
    
        <p><small><a href="/wiped/">&larr; Удалил</a></small></p>
    
    </div>

    <div class="prev-next-mid">
    </div>

    <div class="prev-next-right">
    
        <p><small><a href="/holidays/">Праздники &rarr;</a></small></p>
    
    </div>

</div>

  </div>

</article>

<center>
    <p>
        <small>Нашли ошибку? Выделите мышкой и нажмите Ctrl/&#8984;+Enter</small>
    </p>
</center>





<center>
    
    Комментариев пока нет
    
    
</center>









<form id="comment-form" method="POST" action="https://functions.yandexcloud.net/d4ehfuf08fjfjr59ivnf">

    <div class="block">
        <p class="comment-form-label"><small>Your name</small></p>
        <input required id="comment-form-author" name="author" type="text">
    </div>

    <div class="block">
        <p class="comment-form-label"><small>Comment (markdown syntax)</small></p>
        <textarea required id="comment-form-comment" name="comment"></textarea>
    </div>

    <input required name="path" type="hidden" value="/en/dynamodb/">
    <input required name="captcha" type="hidden" value="5 &#215; 3">

    <div class="block">
        <span class="comment-form-label"><small>5 &#215; 3 = </small></span>
        <input required id="comment-form-solution" name="solution" type="text">
    </div>

    <div class="block">
        <button id="comment-form-send" type="submit">Send</button>
    </div>

</form>


      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>Ivan Grishaev's blog</li>
          <li><a href="mailto:ivan@grishaev.me">ivan@grishaev.me</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
            <li><a href="https://github.com/igrishaev">GitHub</a></li>
            <li><a href="https://t.me/igrishaev_blog">Telegram</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>Writing on programming, education, books and negotiations.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
