<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Bogus: a simple GUI debugger for Clojure</title>
  <meta name="description" content="(This is a copy of the readme file from the repository.)">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/custom.css">
  <link rel="canonical" href="https://grishaev.me/en/bogus/">
  <link rel="alternate" type="application/rss+xml" title="Ivan Grishaev's blog" href="https://grishaev.me/feed.xml">

  <link rel="shortcut icon" type="image/x-icon" href="/assets/static/favicons/favicon.ico">

  <script type="text/javascript" src="/assets/typo.js"></script>

</head>


  <body>
    <header class="site-header">

    <div class="wrapper flex-container">

        <div>
            <a href="/">
                <img src="/assets/static/photo-round-small.png" alt="Ivan Grishaev">
            </a>
        </div>

        <div class="flex-container-vert" style="margin-left: 15px; width: 80%">

            <div class="flex-container full-width">
                <p style="margin-bottom: 5px">Ivan Grishaev's blog</p>
                <div class="flex-huge"></div>
                <div >
<form id="search-form"
      target="_blank"
      style="display: inline"
      method="get"
      action="https://www.google.com/search">

    <input name="sitesearch"
           value="grishaev.me"
           type="hidden">

    <input type="text"
           required="required"
           name="q"
           placeholder="Google search..."
           autocomplete="off">

    <button style="border: none; background-color: transparent; cursor: pointer;"
            type="submit">&#x1f50d;</button>

</form>
</div>
            </div>

            <p><small>Writing on programming, education, books and negotiations.
</small></p>

            <div class="flex-container">
                <a class="menu-item" href="/">Home</a>
                <a class="menu-item" href="/about/">About</a>
                <a class="menu-item" href="/bookshelf/">Bookshelf</a>
                <a class="menu-item" href="/feed.xml">RSS</a>
            </div>

            <div class="flex-container">
                <a class="menu-item minor" href="/tag/clojure/">Clojure</a>
                <a class="menu-item minor" href="/tag/emacs/">Emacs</a>
                <a class="menu-item minor" href="/tag/python/">Python</a>
                <a class="menu-item minor" href="/tag/programming/">Programming</a>
                <a class="menu-item minor" href="/interview/">Interview</a>
                <a class="menu-item minor" href="/video/">Video</a>
            </div>

            <div class="flex-container">
                <a class="menu-item minor hl" href="/clojure-in-prod/">Книга «Clojure на производстве»</a>
            </div>

        </div>
    </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">

    <h1 class="post-title" itemprop="name headline">Bogus: a simple GUI debugger for Clojure</h1>

    
<div class="post-meta">

    <time class="post-time"
          datetime="2022-03-16T00:00:00+00:00">
        Mar 16, 2022
    </time>

    <a href="/tag/clojure/" rel="tag">clojure</a>, <a href="/tag/programming/" rel="tag">programming</a>

</div>


  </header>

  <div class="post-content" itemprop="articleBody">
    <p><em>(This is a copy of the readme file from the repository.)</em></p>

<p><a href="https://github.com/igrishaev/bogus">Bogus</a> is a small, GUI-powered, <a href="https://en.wikipedia.org/wiki/Not_invented_here">NIH</a>-reasoned debugger for Clojure.</p>

<h3 id="installation">Installation</h3>

<p>Lein:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="n">com.github.igrishaev/bogus</span><span class="w"> </span><span class="s">"0.1.0"</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<p>Deps.edn</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="n">com.github.igrishaev/bogus</span><span class="w"> </span><span class="p">{</span><span class="no">:mvn/version</span><span class="w"> </span><span class="s">"0.1.0"</span><span class="p">}}</span><span class="w">
</span></code></pre></div></div>

<p>The best way to use Bogus is to setup it locally in your <code class="language-plaintext highlighter-rouge">profiles.clj</code> file:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">;; ~/.lein/profiles.clj</span><span class="w">

</span><span class="p">{</span><span class="no">:user</span><span class="w">
 </span><span class="p">{</span><span class="no">:dependencies</span><span class="w"> </span><span class="p">[[</span><span class="n">com.github.igrishaev/bogus</span><span class="w"> </span><span class="s">"0.1.0"</span><span class="p">]]</span><span class="w">
  </span><span class="no">:injections</span><span class="w"> </span><span class="p">[(</span><span class="nf">require</span><span class="w"> </span><span class="ss">'bogus.core</span><span class="p">)]}}</span><span class="w">
</span></code></pre></div></div>

<h3 id="usage">Usage</h3>

<p>Once you have the dependency added and the <code class="language-plaintext highlighter-rouge">bogus.core</code> namespace imported,
place one of these two forms into your code:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">bogus.core/debug</span><span class="p">)</span><span class="w">
</span><span class="c1">;; or</span><span class="w">
</span><span class="o">#</span><span class="n">bg/debug</span><span class="w">
</span></code></pre></div></div>

<p>For example:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">do-some-action</span><span class="w"> </span><span class="p">[]</span><span class="w">
  </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">[</span><span class="n">a</span><span class="w"> </span><span class="mi">1</span><span class="w">
        </span><span class="n">b</span><span class="w"> </span><span class="mi">2</span><span class="w">
        </span><span class="n">c</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">b</span><span class="p">)]</span><span class="w">
    </span><span class="o">#</span><span class="n">bg/debug</span><span class="w"> </span><span class="c1">;; or (bogus.core/debug)</span><span class="w">
    </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="n">c</span><span class="p">)))</span><span class="w">
</span></code></pre></div></div>

<p>Now run the function, and you’ll see the UI:</p>

<p><img src="/assets/static/aws/bogus/screen1.png" /></p>

<p>The UI window blocks execution of the code. In the example above, you’ll hang
right before executing the next <code class="language-plaintext highlighter-rouge">(+ a b c)</code> form. Close the window to continue
execution of the code.</p>

<p>The UI consists from three parts: the input area, the output, and the log. Type
any Clojure-friendly form in the input textarea and press “Eval”. The result
will take place in the output textarea. You can copy it from there to your
editor.</p>

<p>The input can take many Clojure forms at once. They are executed as follows:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nb">eval</span><span class="w"> </span><span class="o">'</span><span class="p">(</span><span class="nf">do</span><span class="w"> </span><span class="p">(</span><span class="nf">form1</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nf">form2</span><span class="p">)</span><span class="w"> </span><span class="n">...</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p>so you’ll get the result of the last one.</p>

<p>If you mark some text in the input with selection, only this fragment of code
will be executed.</p>

<p><img src="/assets/static/aws/bogus/screen2.png" /></p>

<p>In the input code, you can use any local variables as they’re global ones. In the
example above we’ve executed the <code class="language-plaintext highlighter-rouge">(+ a b c)</code> form referencing local <code class="language-plaintext highlighter-rouge">a</code>, <code class="language-plaintext highlighter-rouge">b</code>,
and <code class="language-plaintext highlighter-rouge">c</code> from the <code class="language-plaintext highlighter-rouge">let</code> clause.</p>

<p>The “Locals” button pretty-prints the local variables. Bogus does it in advance
when the window opens the first time. The “Inspect” button opens the standard
<code class="language-plaintext highlighter-rouge">clojure.inspector/inspect-tree</code> widget rendering the locals. This is quite
useful when examining massive chunks of data.</p>

<p><img src="/assets/static/aws/bogus/screen3.png" /></p>

<p>The Log area tracks the history of the expressions you executed and their
results. That’s useful sometimes to copy-paste it somewhere. Should you get an
exception, it gets rendered with the <code class="language-plaintext highlighter-rouge">clojure.stacktrace/print-stack-trace</code>
function (which probably needs some improvements).</p>

<p><img src="/assets/static/aws/bogus/screen4.png" /></p>

<p>You can have several debug breakpoints, for example:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">do-some-action</span><span class="w"> </span><span class="p">[]</span><span class="w">
  </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">[</span><span class="n">a</span><span class="w"> </span><span class="mi">1</span><span class="w">
        </span><span class="n">b</span><span class="w"> </span><span class="mi">2</span><span class="w">
        </span><span class="n">c</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">b</span><span class="p">)]</span><span class="w">
    </span><span class="o">#</span><span class="n">bg/debug</span><span class="w">
    </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="n">c</span><span class="p">)</span><span class="w">
    </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">[</span><span class="n">d</span><span class="w"> </span><span class="mi">9</span><span class="p">]</span><span class="w">
      </span><span class="o">#</span><span class="n">bg/debug</span><span class="w">
      </span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="n">d</span><span class="p">))))</span><span class="w">
</span></code></pre></div></div>

<p>The first debug session will take the <code class="language-plaintext highlighter-rouge">a</code>, <code class="language-plaintext highlighter-rouge">b</code>, and <code class="language-plaintext highlighter-rouge">c</code> locals, whereas the
second one will have <code class="language-plaintext highlighter-rouge">a</code>, <code class="language-plaintext highlighter-rouge">b</code>, <code class="language-plaintext highlighter-rouge">c</code>, and <code class="language-plaintext highlighter-rouge">d</code>. You won’t proceed to the second
session until you close the first window.</p>

<p>Bogus debugger works in tests, in nREPL, in ordinary REPL, in Manifold, in the
futures as well. Here is a small demo of having two debug sessions in parallel
threads:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">[</span><span class="n">f1</span><span class="w"> </span><span class="p">(</span><span class="nf">future</span><span class="w">
           </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">[</span><span class="n">a</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w">
             </span><span class="o">#</span><span class="n">bg/debug</span><span class="w">
             </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="mi">1</span><span class="p">)))</span><span class="w">
      </span><span class="n">f2</span><span class="w"> </span><span class="p">(</span><span class="nf">future</span><span class="w">
           </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">[</span><span class="n">b</span><span class="w"> </span><span class="mi">2</span><span class="p">]</span><span class="w">
             </span><span class="o">#</span><span class="n">bg/debug</span><span class="w">
             </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="mi">1</span><span class="p">)))]</span><span class="w">
  </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="o">@</span><span class="n">f1</span><span class="w"> </span><span class="o">@</span><span class="n">f2</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p>If you run this code, you’ll get the two windows each having their own locals:</p>

<p><img src="/assets/static/aws/bogus/screen5.png" /></p>

<p>The second session has the <code class="language-plaintext highlighter-rouge">f1</code> local var captured from the <code class="language-plaintext highlighter-rouge">let</code> clause. If you
try to <code class="language-plaintext highlighter-rouge">deref</code> it, the entire REPL will hang due to the mutual blocking, so be
careful when dealing with parallel debugging.</p>

<h3 id="how-it-works">How it works</h3>

<p>The under-hood of Bogus is simple: it captures the local vars from the <code class="language-plaintext highlighter-rouge">&amp;env</code>
mapping available in a macro. Then there is a couple of functions that
“globalize” the locals by injecting them into the origin namespace using
<code class="language-plaintext highlighter-rouge">clojure.core/intern</code>. Once the namespace is populated, the <code class="language-plaintext highlighter-rouge">eval</code> form treats
local vars as globals. Before leaving the macros, the vars are “deglobalized”
meaning all the injected vars are removed. The macros is smart enough to
preserve existing global vars: it temporary assigns them another name like
<code class="language-plaintext highlighter-rouge">__OLD_my-var__</code>.</p>

<h3 id="why">Why</h3>

<p>The idea of making my own debugger came into my mind while I was writing a new
chapter about nREPL and code evaluation. Although Cider provides much more
powerful tools for debugging, I still believe Bogus might be useful for someone
new to Clojure. The main benefit of Bogus is, it doesn’t require the whole nREPL
stuff and Emacs. One can use it with any editor or environment. After all,
tinkering with Bogus gave me some good material for the book.</p>

<h3 id="other">Other</h3>

<p>Copyright © 2022 Ivan Grishaev</p>

  </div>

</article>

<center>
    <p>
        <small>Нашли ошибку? Выделите мышкой и нажмите Ctrl/&#8984;+Enter</small>
    </p>
</center>






<center>Комментариев пока нет</center>









<form id="comment-form" method="POST" action="https://functions.yandexcloud.net/d4ehfuf08fjfjr59ivnf">

    <div class="block">
        <p class="comment-form-label"><small>Your name</small></p>
        <input required id="comment-form-author" name="author" type="text">
    </div>

    <div class="block">
        <p class="comment-form-label"><small>Comment (markdown syntax)</small></p>
        <textarea required id="comment-form-comment" name="comment"></textarea>
    </div>

    <input required name="path" type="hidden" value="/en/bogus/">
    <input required name="captcha" type="hidden" value="2 &#215; 1">

    <div class="block">
        <span class="comment-form-label"><small>2 &#215; 1 = </small></span>
        <input required id="comment-form-solution" name="solution" type="text">
    </div>

    <div class="block">
        <button id="comment-form-send" type="submit">Send</button>
    </div>

</form>


      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>Ivan Grishaev's blog</li>
          <li><a href="mailto:ivan@grishaev.me">ivan@grishaev.me</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
            <li><a href="https://github.com/igrishaev">GitHub</a></li>
            <li><a href="tg://resolve?domain=igrishaev_blog">Telegram</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>Writing on programming, education, books and negotiations.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
