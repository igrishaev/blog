<!DOCTYPE html>
<html lang="ru">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Что такое RAML и как он помогает проекту</title>
  <meta name="description" content="Расскажу об интересной штуке под названием RAML. Используюв текущем проекте и очень доволен. Технология молодая, информации всети мало, на русском вообще не ...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/custom.css">
  <link rel="canonical" href="https://grishaev.me/raml/">
  <link rel="alternate" type="application/rss+xml" title="Ivan Grishaev's blog" href="https://grishaev.me/feed.xml">

  <link rel="shortcut icon" type="image/x-icon" href="/assets/static/favicons/favicon.ico">

  <script type="text/javascript" src="/assets/typo.js"></script>

</head>


  <body>
    <header class="site-header">

    <div class="wrapper flex-container">

        <div>
            <a href="/">
                <img id="avatar" src="/assets/static/avatar.jpg" alt="Ivan Grishaev">
            </a>
        </div>

        <div class="flex-container-vert" style="margin-left: 15px; width: 80%">

            <div class="flex-container full-width">
                <p style="margin-bottom: 5px"><a href="/">Ivan Grishaev's blog</a></p>
                <div class="flex-huge"></div>
                <div >
<form id="search-form"
      target="_blank"
      style="display: inline"
      method="get"
      action="https://www.google.com/search">

    <input name="sitesearch"
           value="grishaev.me"
           type="hidden">

    <input type="text"
           required="required"
           name="q"
           placeholder="Google search..."
           autocomplete="off">

    <button style="border: none; background-color: transparent; cursor: pointer;"
            type="submit">&#x1f50d;</button>

</form>
</div>
            </div>

            <p><small>Writing on programming, education, books and negotiations.
</small></p>

            <div class="flex-container">
                <a class="menu-item" href="/">Home</a>
                <a class="menu-item" href="/about/">About</a>
                <a class="menu-item" href="/open-source/">Open Source</a>
                <a class="menu-item" href="/bookshelf/">Bookshelf</a>
                <a class="menu-item" href="/feed.xml">RSS</a>
            </div>

            <div class="flex-container">
                <a class="menu-item minor" href="/tag/clojure/">Clojure</a>
                <a class="menu-item minor" href="/tag/emacs/">Emacs</a>
                <a class="menu-item minor" href="/tag/python/">Python</a>
                <a class="menu-item minor" href="/tag/programming/">Programming</a>
                <a class="menu-item minor" href="/interview/">Interview</a>
                <a class="menu-item minor" href="/video/">Video</a>
            </div>

            <div class="flex-container">
                <a class="menu-item minor hl" href="/clojure-in-prod/">Книга «Clojure на производстве»</a>
            </div>

            <div class="flex-container">
                <a class="menu-item minor hl" href="/clojure-in-prod-2/">Книга «Clojure на производстве», второй том</a>
            </div>

        </div>
    </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">

    <h1 class="post-title" itemprop="name headline">Что такое RAML и как он помогает проекту</h1>

    
<div class="post-meta">

    <time class="post-time"
          datetime="2016-03-10T00:00:00+00:00">
        Mar 10, 2016
    </time>

    <a href="/tag/raml/" rel="tag">raml</a>, <a href="/tag/programming/" rel="tag">programming</a>

</div>


  </header>

  <div class="post-content" itemprop="articleBody">
    <p>Расскажу об интересной штуке под названием <a href="http://raml.org/">RAML</a>. Использую
в текущем проекте и очень доволен. Технология молодая, информации в
сети мало, на русском вообще не попадалось.</p>

<p>Предположим, несколько сервисов сообщаются по HTTP API. Авторизация,
история операций, бизнес-транзакции. Сервисы принимают и отдают JSON,
сигнализируют об ошибках правильными статусами ответа. Нет
пользователя – 404, нет прав – 403, кривые данные
– 400. Классический рест.</p>

<p>Как составить документацию? Нужно перечислить все урлы. Указать
правила авторизации, заголовки, как правильно их составить. Для
каждого урла перечислить методы GET, POST, etc. Описать структуру
входных данных. Структуру ошибочных ответов. Добавить человеческое
описание каждого метода. И все это поддерживать в актуальном
состоянии.</p>

<p>Возможно, есть специалисты, которые ведут документацию правильно,
чтобы все было описано по пунктам и ничего не расползалось. Не нужно
уточнять детали, ответ сервера в точности такой, как написано. И
группа людей соблюдает все соглашения о ведении документации.</p>

<p>На практике я вижу обратное. Документация отстает от разработки. Текст
пишут в вики в ужасной разметке. Каждый человек придерживается особых
правил. На ретроспективе холиварят о том, как документировать
правильно.</p>

<p>RAML решает эти проблемы. Название означает REST API Markup
Language. Технически это YAML-документ с набором фич. Стандарт задает
жесткую структуру для описания рестовых апих. Разработчики держат этот
файл в гите и наполняют вместе с кодом. Во время билда особая утилита
переводит документ в формат HTML.</p>

<p>Перечислю достоинста технологии:</p>

<ol>
  <li>
    <p><strong>Структура.</strong> RAML – это стандарт, поэтому отсебятены в документе
быть не может. В группе разработчиков не будет конфликтов, как
описать схему запроса или входные параметры.</p>
  </li>
  <li>
    <p><strong>Формат YAML.</strong> Это лучший формат для конфигураций. Краток, удобен
для чтения. Поддерживает основные типы. Имеет списки,
словари. Поддерживает многострочные данные. Разрешает
комментарии. Не падает из-за лишней запятой на конце, как JSON.</p>
  </li>
  <li>
    <p><strong>Поддержка markdown.</strong> Описание к каждой сущности пишется в
маркдауне. Это самый простой язык разметки. Очень подходит для
вставки кода, простейшей структуры (заголовки, подзаголовки).</p>
  </li>
  <li>
    <p><strong>Инклуды.</strong> Большой файл легко декомпозировать на составные части
и подключать по частям директивой <code class="language-plaintext highlighter-rouge">include</code>. Более того, инклуд
поощрается стандартом, чтобы не дублировать сущности. Например,
любой <code class="language-plaintext highlighter-rouge">list</code>-метод (список сущностей методом <code class="language-plaintext highlighter-rouge">GET</code>) принимает
параметры <code class="language-plaintext highlighter-rouge">limit</code> и <code class="language-plaintext highlighter-rouge">offset</code>. Создаем отдельный файл с их
описанием, примерами. Подключаем к нужным методам инклуд,
компилируем. На выходе у каждого метода идентичное описание этих
параметров.</p>

    <p>Инклуды позволяют комбинировать документацию для разных
целей. Например, есть публичные апи, а есть внутренние. Описываем
каждую в отдельном файле. Создаем два документа. Первый для
заказчика, с инклудами только публичных апих. Второй для внутренних
нужд – только с инклудами внутренних.</p>
  </li>
  <li>
    <p><strong>Утилиты и экспорт.</strong> Документацию в RAML легко обрабатывать
машинным способом, потому что это стандарт, протокол. Уже
существует <a href="http://raml.org/projects/projects">пачка утилит</a> для работы с
форматом. Визуальные редакторы, генерация кода по заданным урлам,
плагины к редакторам и ИДЕ, и конечно, тулза для экспорта в
markdown и HTML.</p>
  </li>
  <li>
    <p><strong>JSON-схемы.</strong> Схема – лучший способ описать структуру
данных. Она заменит долгие списки и абзацы человеческого
языка. Схема декларативна – сложные структуры могут быть
представлены как ссылки на схемы проще. RAML поддерживает инклуд
схем.</p>
  </li>
  <li>
    <p><strong>Поддержка HTTP/REST.</strong> Стандарт знает все о заголовках и статусах
ответа. Красиво, когда документация покажет не только тело ответа,
но и статус с описанием, примеры заголовков.</p>
  </li>
</ol>

<p>Существует два версии формата: 0.8 и 1.0. Вторая предлагает больше
полей и возможностей для описания. Я пока что пользуюсь 0.8.</p>

<p>Рассмотрим простой пример. Пусть есть простая апиха. Вот что мы
напишем в заголовке файла <code class="language-plaintext highlighter-rouge">example.raml</code>:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#%RAML 0.8</span>
<span class="na">title</span><span class="pi">:</span> <span class="s">Some Title</span>
<span class="na">version</span><span class="pi">:</span> <span class="s">v3</span>
<span class="na">baseUri</span><span class="pi">:</span> <span class="s">https://example.com/api/v1/</span>
</code></pre></div></div>

<p>Добавим вводную документацию. Для каждого раздела укажем
подзаголовок. Ниже:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">documentation</span><span class="pi">:</span>
 <span class="pi">-</span> <span class="na">title</span><span class="pi">:</span> <span class="s">Main Title</span>
   <span class="na">content</span><span class="pi">:</span> <span class="pi">|</span>
     <span class="s">common notes on this document.</span>

 <span class="pi">-</span> <span class="na">title</span><span class="pi">:</span> <span class="s">Authorization</span>
   <span class="na">content</span><span class="pi">:</span> <span class="pi">|</span>
     <span class="s">Some text to describe HTTP headers to access data.</span>
     <span class="s">~~~</span>
     <span class="s">code goes here...</span>
     <span class="s">~~~</span>
</code></pre></div></div>

<p>Задекларируем правила авторизации. У нас в проекте это обычная базовая
авторизация по протоколу HTTPS. Стандарт RAML знает, что это такое:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">securitySchemes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">Basic Authentication</span><span class="pi">:</span>
      <span class="na">type</span><span class="pi">:</span> <span class="s">Basic Authentication</span>
</code></pre></div></div>

<p>Теперь, описывая урл, можем просто состаться на этот тип
авторизации. В скомпилированном HTML-документе напротив урла будет
стоять замочек, а по клику откроется окошко с описанием правил
авторизации.</p>

<p>Начнем описывать урлы:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">/api/v1/user</span><span class="pi">:</span>
  <span class="na">securedBy</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">Basic Authentication</span><span class="pi">]</span>
  <span class="na">get</span><span class="pi">:</span>
    <span class="na">description</span><span class="pi">:</span> <span class="pi">|</span>
      <span class="s">Retrieves a list of users.</span>
      <span class="s">### Syntax</span>
      <span class="s">~~~</span>
      <span class="s">GET /api/v1/user/</span>
      <span class="s">Host: {host}</span>
      <span class="s">Authorization: {authorization}</span>
      <span class="s">~~~</span>
    <span class="na">queryParameters</span><span class="pi">:</span>
      <span class="kt">!include</span> <span class="s">user_list_params.raml</span>
    <span class="na">responses</span><span class="pi">:</span>
      <span class="na">200</span><span class="pi">:</span>
        <span class="na">body</span><span class="pi">:</span>
          <span class="s">application/json</span><span class="pi">:</span>
            <span class="na">example</span><span class="pi">:</span> <span class="kt">!include</span> <span class="s">examples/user_list_response.json</span>
            <span class="na">schema</span><span class="pi">:</span> <span class="kt">!include</span> <span class="s">schemas/user_list_response.json</span>
</code></pre></div></div>

<p>Все просто. Мы декларируем апиху, которая отдает список юзеров. Доступ
защищен базовой авторизацией. В описании пример запроса. Файл
<code class="language-plaintext highlighter-rouge">user_list_params.raml</code> содержит парамеры командной строки: лимит,
смещение, сортировка.</p>

<p>Схема ответа может быть большой, поэтому инклуд. В файле
<code class="language-plaintext highlighter-rouge">examples/user_list_response.json</code> лежит схема, примерно такая:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"$schema"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://json-schema.org/draft-04/schema#"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"additionalProperties"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"definitions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"item"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"additionalProperties"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nl">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"minimum"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"integer"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"maxLength"</span><span class="p">:</span><span class="w"> </span><span class="mi">64</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"required"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="s2">"id"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"name"</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"object"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"count"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"minimum"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"integer"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"results"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"items"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"$ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"#/definitions/item"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"array"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"required"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"count"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"results"</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"object"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Смотрите, как удобно: в начале схемы декларируется тип юзера. Конечный
ответ – это массив таких сущностей.</p>

<p>Дальше документ очень удобно развивать. Добавлять методы (POST, PUT,
DELETE), ссылаться на уже определенные структуры, выносить повторы в
инклуды.</p>

<p>Скомпилируем документ в файл. Утилита <a href="https://github.com/raml2html/raml2html">raml2html</a>
написана на node.js и ставиться через npm. Компилим:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>raml2html example.raml &gt; example.html
</code></pre></div></div>

<p>Не нравится дефолтный шаблон? Можно передать свой:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>raml2html -t custom-templates/template.nunjucks -i example.raml -o example.html
</code></pre></div></div>

<p>В результате получим HTML-документ (<strong>UPD</strong> документ по ссылке удалили).</p>

<p>RAML действительно экономит время на составление документации. Технология
молода, но очень перспективна. Советую использовать уже сейчас.</p>


    
<div class="prev-next">

    <div class="prev-next-left">
    
        <p><small><a href="/meetup3/">&larr; Третья встреча любителей глобоко порефакторить</a></small></p>
    
    </div>

    <div class="prev-next-mid">
    </div>

    <div class="prev-next-right">
    
        <p><small><a href="/poverty/">О нищенском мышлении &rarr;</a></small></p>
    
    </div>

</div>

  </div>

</article>

<center>
    <p>
        <small>Нашли ошибку? Выделите мышкой и нажмите Ctrl/&#8984;+Enter</small>
    </p>
</center>





<center>
    
    Комментарии
    
    
</center>



<div id="comments">
  
    <div id="comment-3254096318" class="comment-block">
      <p class="comment-lead">
        <small>
          <em>
            ntkr,
            13th Apr 2017,
            <a href="#comment-3254096318">link</a>
            
          </em>
        </small>
      </p>
      <div><p><a href="https://rawgit.com/raml2html/raml2html/master/examples/example.html" rel="nofollow noopener" title="https://rawgit.com/raml2html/raml2html/master/examples/example.html">https://rawgit.com/raml2htm...</a> - 404<br />«Не нравится», без мягкого знака.<br />Спасибо.</p>
</div>
    </div>
  
    <div id="comment-3255988969" class="comment-block">
      <p class="comment-lead">
        <small>
          <em>
            Ivan Grishaev,
            14th Apr 2017,
            <a href="#comment-3255988969">link</a>
            , <a href="#comment-3254096318">parent</a>
          </em>
        </small>
      </p>
      <div><p>Исправил ошибку. Документ с примером, к сожалению, выпилили из репозитория.</p>
</div>
    </div>
  
</div>









<form id="comment-form" method="POST" action="https://functions.yandexcloud.net/d4ehfuf08fjfjr59ivnf">

    <div class="block">
        <p class="comment-form-label"><small>Your name</small></p>
        <input required id="comment-form-author" name="author" type="text">
    </div>

    <div class="block">
        <p class="comment-form-label"><small>Comment (markdown syntax)</small></p>
        <textarea required id="comment-form-comment" name="comment"></textarea>
    </div>

    <input required name="path" type="hidden" value="/raml/">
    <input required name="captcha" type="hidden" value="3 &#215; 4">

    <div class="block">
        <span class="comment-form-label"><small>3 &#215; 4 = </small></span>
        <input required id="comment-form-solution" name="solution" type="text">
    </div>

    <div class="block">
        <button id="comment-form-send" type="submit">Send</button>
    </div>

</form>


      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>Ivan Grishaev's blog</li>
          <li><a href="mailto:ivan@grishaev.me">ivan@grishaev.me</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
            <li><a href="https://github.com/igrishaev">GitHub</a></li>
            <li><a href="https://t.me/igrishaev_blog">Telegram</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>Writing on programming, education, books and negotiations.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
