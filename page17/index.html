<!DOCTYPE html>
<html lang="ru">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Ivan Grishaev's blog</title>
  <meta name="description" content="Writing on programming, education, books and negotiations.
">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/custom.css">
  <link rel="canonical" href="https://grishaev.me/page17/">
  <link rel="alternate" type="application/rss+xml" title="Ivan Grishaev's blog" href="https://grishaev.me/feed.xml">

  <link rel="shortcut icon" type="image/x-icon" href="/assets/static/favicons/favicon.ico">

  <script type="text/javascript" src="/assets/typo.js"></script>

</head>


  <body>
    <header class="site-header">

    <div class="wrapper flex-container">

        <div>
            <a href="/">
                <img id="avatar" src="/assets/static/avatar.jpg" alt="Ivan Grishaev">
            </a>
        </div>

        <div class="flex-container-vert" style="margin-left: 15px; width: 80%">

            <div class="flex-container full-width">
                <p style="margin-bottom: 5px">Ivan Grishaev's blog</p>
                <div class="flex-huge"></div>
                <div >
<form id="search-form"
      target="_blank"
      style="display: inline"
      method="get"
      action="https://www.google.com/search">

    <input name="sitesearch"
           value="grishaev.me"
           type="hidden">

    <input type="text"
           required="required"
           name="q"
           placeholder="Google search..."
           autocomplete="off">

    <button style="border: none; background-color: transparent; cursor: pointer;"
            type="submit">&#x1f50d;</button>

</form>
</div>
            </div>

            <p><small>Writing on programming, education, books and negotiations.
</small></p>

            <div class="flex-container">
                <a class="menu-item" href="/">Home</a>
                <a class="menu-item" href="/about/">About</a>
                <a class="menu-item" href="/bookshelf/">Bookshelf</a>
                <a class="menu-item" href="/feed.xml">RSS</a>
            </div>

            <div class="flex-container">
                <a class="menu-item minor" href="/tag/clojure/">Clojure</a>
                <a class="menu-item minor" href="/tag/emacs/">Emacs</a>
                <a class="menu-item minor" href="/tag/python/">Python</a>
                <a class="menu-item minor" href="/tag/programming/">Programming</a>
                <a class="menu-item minor" href="/interview/">Interview</a>
                <a class="menu-item minor" href="/video/">Video</a>
            </div>

            <div class="flex-container">
                <a class="menu-item minor hl" href="/clojure-in-prod/">Книга «Clojure на производстве»</a>
            </div>

            <div class="flex-container">
                <a class="menu-item minor hl" href="/clojure-in-prod-2/">Книга «Clojure на производстве», второй том</a>
            </div>

        </div>
    </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="home">

    <ul class="post-list">
        
        <li>

            <h2>
                <a class="post-link" href="/guns/">Оружие</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2021-11-05T00:00:00+00:00">
        Nov 5, 2021
    </time>

    <a href="/tag/life/" rel="tag">life</a>, <a href="/tag/guns/" rel="tag">guns</a>

</div>


            <div class="entry">
                
                    <p>Этот пост касается сложной темы: оружия и массовых расстрелов в школах. Я специально публикую его не по следам очередной трагедии, потому что считаю подобные вещи гнусной спекуляцией. Такого рода текст лучше писать в отрыве от истерии и информационной волны.</p>

<p>В разное время мое отношение к оружию менялось. Если бы я писал этот пост лет пять назад, то залепил бы что-то в духе: оружие помогает защититься, вот случай А, вот случай Б, а кто не согласен, тот идиот. Именно так и протекают дискуссии на тему оружия (или сводятся к этому). К счастью, я уже отошел от подобной точки зрения.</p>

<p>Написать этот пост меня побудило эссе Стивена Кинга “Оружие”. Да, тот самый Кинг, который про ужасы и зомби. После очередной стрельбы он написал текст страниц на двадцать, где затронул проблемы оружия и американского общества в целом.</p>

<p>Эссе, что называется, зашло в массы, и теперь после каждой стрельбы на него кидают ссылку изо всех углов. Феномен дошел и до России: после недавних событий все чаты вскипели, и “Оружие” приводят по поводу и без.</p>

<p>Я не поленился прочитал это эссе. Прочитайте и вы: <a href="https://libking.ru/books/nonf-/nonf-publicism/414428-stiven-king-oruzhie.html">вот ссылка</a> на хороший русский перевод. Прочитали? Давайте обсудим.</p>

<p>Первая часть описывает типичную и беспощадную информационную волну. Новостные источники наполняются дрожащими кадрами с бегущими людьми. Никто ничего не знает, начинаются спекуляции на тему числа убитых. Как только ясны события, высказываются политики обеих партий, используя стрельбу как повод пнуть друг друга. Несколько дней дебатов кончаются тем, что тема уходит с повестки, и все выдыхают.</p>

<p>Далее Кинг опровергает миф о пристрастии американцев к насилию. Приводит аргументы, что несмотря на жестокие игры и фильмы, топ-чарты занимают симуляторы, гонки и сериалы про отношения. Доказательства длятся несколько страниц, и до конца не ясно, с чем спорит Кинг. Очевидно, что американцы — такие же люди как и все: любят айфоны, гаджеты, сериалы, никакого насилия в них нет.</p>

<p>Ближе к середине Кинг подходит с сути проблемы: оружию и причинам, по которым оно оказалось в руках нападавшего. Он упоминает травлю и роман, что написал еще в старшей школе, где ученик творит резню. Роман называется “Ярость”, и он идет красной линией сквозь все эссе. Кинг постоянно возвращается к теме того, что добровольно изъял его из продажи, и это отвлекает от главной мысли.</p>

<p>Вывод, к которому склоняется Кинг, показался мне крайне скудным. Если коротко, он умещается в тезис “запретить автоматическое оружие”. Кинг долго описывает, сколько людей способен убить человек, вооруженный автоматической винтовкой, и насколько труднее сделать это пистолетом. Сравнивает числа жертв, погибших от разных видов оружия; приводит случаи, когда ученик с автоматом убил тридцать человек, а с револьвером — двух или трех.</p>

<p>Соглашусь, автоматическое оружие гораздо смертоносней обычного. Да, вооруженный им человек убьет больше людей. Очень странно, что столь мощное оружие можно купить для “самообороны” или коллекционирования. То, что оно должно быть запрещено в гражданском обществе, не вызывает вопросов.</p>

<p>И на этом месте Кинг останавливается. Дальше идет лирика, опять роман “Ярость”, сатира над американскими политиками и шоу, понятная только американцам (кое-что разъясняют сноски в русском переводе). Эссе заканчивается, и в этот моменты вы должны над ним подумать.</p>

<p>Но я не хочу над ним думать. Меня интересует другое.</p>

<p>Когда очередной подросток стреляет в школе, нам сообщают, скольких людей он убил, были у него сообщники или нет и другие стандартные вещи. Я бы хотел бы узнать тот пусть, что привел его в школу с оружием в рюкзаке. Что именно побудило его стрелять в своих.</p>

<p>Надо понимать, что даже без жертв стрельба — это событие из ряда вон. Такого быть не должно. Если убили двух человек из пистолета, мы не должны радоваться тому, что это был не автомат Калашникова и не тридцать жертв. Смерть даже одного человека — трагедия, и она вызывает такой же по силе стресс, что и гибель тридцати человек. Смертей должно быть ноль.</p>

<p>Для примера сравните Бостонский марафон, где погибло три человека, и события 11 сентября. Число погибших отличаются тремя порядками, но информационный шлейф и всплеск стресса соизмеримы. Это естественно, потому что в мирное время люди не терпят смерть своих, хоть трех человек, хоть трех тысяч.</p>

<p>Выражаясь айтишными терминами, стрельба в школе — это критичный баг в проде. В дрянных фирмах за это наказывают конкретного человека: админа, программиста, менеджера. Выговор и лишение премии, чтобы другим было неповадно. В правильных фирмах проводят то, что называется “постмортем”. Это когда досконально разбирают хронологию событий и их причины. При этом ставят цель не наказать человека, а организовать такой регламент, при котором ошибку допустить в принципе невозможно.</p>

<p>Примеры громких постмортемов вы знаете. Когда взорвался тот самый шаттл, причину расследовали годами. Привлекали лучшие умы планеты — того же Фейнмана, вторая книга которого посвящена инциденту с шаттлом. Все документы по этому делу открыты, их может прочесть каждый.</p>

<p>Надеюсь, вы поняли, куда я клоню. Вместо того, чтобы обсуждать вид оружия, из которого стрелял нападавший, надо выяснить, что вынудило его стрелять. Намеренное убийство своих — это очень серьезный рубеж в психике, и если он пройден, причины были столь же серьезны. Подобно случаю с шаттлом, каждую стрельбу и ее виновника нужно изучать годами. Собрать лучших экспертов, написать полки документов. И самое главное — сделать расследование достоянием общественности.</p>

<p>Происходит ли что-либо подобное в России? Сомневаюсь, да и насчет других стран тоже. Как только новость уходит с главной, то же происходит и с расследованием. Допускаю, что с нападавшим работают следователь и психолог, но до широкой публики результаты их трудов не доходят. А значит, все зря.</p>

<p>В расследовании стрельбищ кроется неприятный факт. Если изучить последние пару лет из жизни нападавшего, выяснится, что он отчаянно подавал знаки, которые общество отказалось слышать. В социальной сети были радикальные картинки, но их никто не заметил. Провайдер купил оборудование на миллион по закону Яровой; в соцсети тысяча модераторов, чтобы банить адептов Навального, а наш герой успешно миновал все это. Одноклассники не заступились в момент травли. Учитель предпочел не заметить конфликта. Участковый занят с наркоманами и алкашами. У родителей ипотека и кредиты, день и ночь на работе. Подростка никто не слышит.</p>

<p>Другими словами, косвенно виноваты все. Это тяжело признать, и гораздо легче цепляться за жестокие игры и интернет. В широком плане стрельба не выгодна никому: ни обывателю, ни полиции, ни политиками всех партий. Полноценное расследование займет столько сил и вскроет столько проблем, что лучше не открывать этот ящик Пандоры.</p>

<p>Популярные ток-шоу сводятся к популизму, крикам и оскорблениям. Сегодня в российском эфире нет тем кроме Украины, газа, и коронавируса. Любая стрельба быстро сходит на нет. Не пройдет и двух дней, как пьяный актер устроит ДТП или у чиновника найдут виллу в Альпах. Тема уйдет с новостных сайтов, и стрельбу забудут до следующего раза.</p>

<p>Что касается “Оружия” Кинга, то оно оставило неприятный осадок. Кинг — мастер слова, замечательный писатель, это слышно даже в переводе. Его описания точны, текст бросает читателя то в одно чувство, то в другое. Кинг — плоть от плоти американского общества и понимает его как никто другой. Но он именно художественный писатель, а не ученый или психолог, вот что нужно помнить при чтении его эссе.</p>

<p>Непонятно, как его главный его тезис — запретить автоматическое оружие — скажется на числе трагедий. И не только их числе, но и здоровье общества. В этом плане Кинг напоминает селебрити, которая выпускает миллионным тиражом книгу о том, как красить ногти. Эссе читают не потому, что он досконально понимает проблему, а потому что на обложке известное имя. В таком важном деле мы должны видеть разницу между красивыми словами и смыслом.</p>

<p>Какие выводы можно сделать?</p>

<p>Я считаю, частая стрельба говорит о неблагополучном фоне в обществе. Задача власти — искоренить этот фон. Это очень размытый тезис без четких контуров. Неясно, сколько времени займет этот процесс и будет ли на выходе польза. С точки зрения денег это однозначно убыток, поэтому вряд ли кто-то возьмется планомерно искоренять негативный фон.</p>

<p>У населения должен быть образ будущего. Сейчас этого образа нет. В прошлом веке образы происходили от конкуренции СССР и США. Эти государства производили не только продукцию, но и образы будущего. Люди намеренно ехали и бежали из США в СССР и наоборот лишь потому, что считали те социальные принципы более правильными.</p>

<p>Если говорить о России, то никакого образа будущего у подростков нет. Есть иностранные гаджеты и социальные сети, из которых льется сомнительный контент с рекламой. Приоритет нашей власти — геополитика, недружественный страны, газовый шантаж. По телевизору — Украина, короновирус, иностранные агенты.</p>

<p>В муниципальных школах в лучшем случае один психолог, а чаще всего их нет. Их должно быть по числу классов и больше. Должно быть больше занятий, когда ученики свободно общаются с учителем и задают ему вопросы через записки. Должно быть больше наставничества. Но расписание забито религией, двумя историями (отечества и мира), дети перегружены: в лучшем случае шесть уроков, а иногда и семь.</p>

<p>Продолжать можно долго, но я не вижу в этом смысла. Ясно одно: в масштабном плане никто не будет ничего делать. Все зависит от нас: как мы живем, на что обращаем внимание, насколько принципе мы считаем себя ответственными за происходящее.</p>

<p>Мне ясно: запрет какого-то вида оружия, будь то автоматическое, нарезное или с красной рукояткой, не сделает нашу жизнь лучше. Ровно как и повсеместное его разрешение. Каждый резонансный случай должен быть рассмотрен так досконально, как только это возможно. Решение придет оттуда.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/copybook/">Тетрадь</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2021-11-04T00:00:00+00:00">
        Nov 4, 2021
    </time>

    <a href="/tag/life/" rel="tag">life</a>

</div>


            <div class="entry">
                
                    <p>Иногда меня охватывают приступы продуктивности: я записываю задачи, ставлю помидоры и пишу в блог об эффективности.</p>

<p>Это временно. Потом меня отпускает, и я веду дела как все: урывисто и ситуативно.</p>

<p>Только одну вещь удалось сделать привычкой: вести тетрадь. Пишу в нее список дел, мелкие заметки, схемы. Одно время даже вел дневник. И должен сказать, тетрадь — великая вещь.</p>

<p>Переключение с гаджета на бумагу работает так же, как и прогулка во время трудной задачи. Физически чувствуешь, как включается другой отдел мозга. С бумаги воспринимаешь по-другому. Мысль, записанная рукой, дольше остается в памяти. Раньше я считал это бредом, но оказалось правдой.</p>

<p>С тетрадью можно отлично поработать в самолете, поезде или такси. Ей не нужна зарядка. Классно пролистать тетрадь назад: это своего рода ретроспектива.</p>

<p>Особо важные страницы я фотографирую, но снимки до сих не пригодились. На обложке тетради пишу телефон и просьбу вернуть в случае утраты.</p>

<p>В тетради можно записать список дел на месяц вперед, сделать одно и забить. А через месяц вернуться и продолжить, и дела рано или поздно будут сделаны. Прямо сейчас пролистал на двадцать страниц назад. Весь лист А4 занят списком дел в две колонки. Когда-то он казался мне адом, а сегодня в нем осталось два не зачеркнутых пункта. И таких страниц хватает.</p>

<p>Не так уж много нужно для того, чтобы доводить дела до конца. Но обязательно — честность с собой и окружающими.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/clj-dmk-press/">Книга в ДМК-Пресс</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2021-10-19T00:00:00+00:00">
        Oct 19, 2021
    </time>

    <a href="/tag/clojure/" rel="tag">clojure</a>, <a href="/tag/databases/" rel="tag">databases</a>

</div>


            <div class="entry">
                
                    
<p>Моя книга про Кложу выходит в <a href="https://dmkpress.com/catalog/computer/programming/functional/978-5-93700-055-2/">издательстве ДМК-Пресс</a>. Ожидаемая дата —
середина ноября. Твердый переплет, формат B5 (165x235 мм).</p>

<p>Внимание: на время предзаказа цена 799 рублей (вместо 999 рублей). С промокодом</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Grishaev_Clojure20
</code></pre></div></div>

<p>она станет еще меньше. Если вы бываете в книжных магазинах, то знаете, что
компьютерных книг дешевле тысячи почти не бывает. А тут такое предложение! Надо
брать.</p>

<p>Книга почти ничем не отличается от второго издания, что вышло в Ридеро. Исправил
опечатки и неточности в коде, на которые указали читатели. Особая благодарность
Алексею Иванцову, который не просто нашел ошибки, но и оформил их в виде PR к
репозиторию книги. Мне оставалось только нажать кнопку, чтобы их принять.</p>

<p>Кроме того, собрал и залил исправленные PDF на <a href="https://gum.co/clojure-in-prod">Gumroad</a>. Если вы уже
покупали там, зайдите и скачайте новые файлы. Если нет — самое время купить,
цена всего пять долларов.</p>

<p>Для меня выход книги в ДМК-Пресс — это событие. Во-первых, издание вышло на меня
само. Когда заинтересован не ты, а в тебе, это меняет дело: значит, книга
действительно кому-то нужна.</p>

<p>Во-вторых, приятно, что ДМК-Пресс — издание с долгой историей и богатым списком
выпущенных книг. Именно в ДМК девять лет назад вышло “Программирование на
Clojure” — тот самый альманах на 800 страниц. Он кстати, почти не устарел,
советую прочитать. Вдвойне приятно, что моя книга займет место рядом с ним.</p>

<p>Что это значит для читателя? Главное — книгу в твердой обложке теперь можно
купить не только у меня, а на сайте ДМК или в магазине. Это главная проблема
Ридеро: у них нет массовой печати в твердой обложке, только разовый (и потому
дорогой) тираж. Так что теперь не обязательно слать мне Яндекс.Деньги:
заказывайте на сайте ДМК. Однако я всегда рад подписать книжку и отправить в
любую страну.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/clj-db/">Реляционные базы данных в Clojure</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2021-10-13T00:00:00+00:00">
        Oct 13, 2021
    </time>

    <a href="/tag/clojure/" rel="tag">clojure</a>, <a href="/tag/databases/" rel="tag">databases</a>

</div>


            <div class="entry">
                
                    
<h2>

    Содержание

</h2>

<ul id="toc-item-pg-to-datomic">
  <li><a href="#реляционные-базы-данных" id="toc-item-pg-to-datomic-реляционные-базы-данных">Реляционные базы данных</a>    <ul>
      <li><a href="#запросы" id="toc-item-pg-to-datomic-запросы">Запросы</a></li>
      <li><a href="#доступ-из-clojure" id="toc-item-pg-to-datomic-доступ-из-clojure">Доступ из Clojure</a></li>
      <li><a href="#знакомство-с-clojurejavajdbc" id="toc-item-pg-to-datomic-знакомство-с-clojurejavajdbc">Знакомство с clojure.java.jdbc</a></li>
      <li><a href="#основы-clojurejavajdbc" id="toc-item-pg-to-datomic-основы-clojurejavajdbc">Основы clojure.java.jdbc</a>        <ul>
          <li><a href="#чтение" id="toc-item-pg-to-datomic-чтение">Чтение</a></li>
          <li><a href="#вставка" id="toc-item-pg-to-datomic-вставка">Вставка</a></li>
          <li><a href="#обновление" id="toc-item-pg-to-datomic-обновление">Обновление</a></li>
          <li><a href="#удаление" id="toc-item-pg-to-datomic-удаление">Удаление</a></li>
          <li><a href="#выполнение" id="toc-item-pg-to-datomic-выполнение">Выполнение</a></li>
          <li><a href="#практика" id="toc-item-pg-to-datomic-практика">Практика</a></li>
        </ul>
      </li>
      <li><a href="#подробнее-о-запросах" id="toc-item-pg-to-datomic-подробнее-о-запросах">Подробнее о запросах</a>        <ul>
          <li><a href="#sql-инъекции" id="toc-item-pg-to-datomic-sql-инъекции">SQL-инъекции</a></li>
          <li><a href="#атаки-с-union" id="toc-item-pg-to-datomic-атаки-с-union">Атаки с UNION</a></li>
          <li><a href="#кавычки" id="toc-item-pg-to-datomic-кавычки">Кавычки</a></li>
          <li><a href="#подготовленные-выражения" id="toc-item-pg-to-datomic-подготовленные-выражения">Подготовленные выражения</a></li>
        </ul>
      </li>
      <li><a href="#результат-запроса" id="toc-item-pg-to-datomic-результат-запроса">Результат запроса</a>        <ul>
          <li><a href="#массивы" id="toc-item-pg-to-datomic-массивы">Массивы</a></li>
          <li><a href="#ключи" id="toc-item-pg-to-datomic-ключи">Ключи</a></li>
          <li><a href="#ленивость" id="toc-item-pg-to-datomic-ленивость">Ленивость</a></li>
        </ul>
      </li>
      <li><a href="#транзакции" id="toc-item-pg-to-datomic-транзакции">Транзакции</a></li>
      <li><a href="#jdbc-спека-с-состоянием" id="toc-item-pg-to-datomic-jdbc-спека-с-состоянием">JDBC-спека с состоянием</a>        <ul>
          <li><a href="#пул-соединений" id="toc-item-pg-to-datomic-пул-соединений">Пул соединений</a></li>
        </ul>
      </li>
      <li><a href="#sqlite" id="toc-item-pg-to-datomic-sqlite">SQLite</a>        <ul>
          <li><a href="#база-в-памяти" id="toc-item-pg-to-datomic-база-в-памяти">База в памяти</a></li>
        </ul>
      </li>
      <li><a href="#сложные-типы" id="toc-item-pg-to-datomic-сложные-типы">Сложные типы</a>        <ul>
          <li><a href="#организация-кода" id="toc-item-pg-to-datomic-организация-кода">Организация кода</a></li>
          <li><a href="#поддержка-json" id="toc-item-pg-to-datomic-поддержка-json">Поддержка JSON</a></li>
          <li><a href="#запись-json" id="toc-item-pg-to-datomic-запись-json">Запись JSON</a></li>
          <li><a href="#проблема-nil-в-json" id="toc-item-pg-to-datomic-проблема-nil-в-json">Проблема nil в JSON</a></li>
          <li><a href="#типизированные-записи" id="toc-item-pg-to-datomic-типизированные-записи">Типизированные записи</a></li>
        </ul>
      </li>
      <li><a href="#проблемы-sql" id="toc-item-pg-to-datomic-проблемы-sql">Проблемы SQL</a>        <ul>
          <li><a href="#шаблоны" id="toc-item-pg-to-datomic-шаблоны">Шаблоны</a></li>
          <li><a href="#выражения" id="toc-item-pg-to-datomic-выражения">Выражения</a></li>
          <li><a href="#построители" id="toc-item-pg-to-datomic-построители">Построители</a></li>
          <li><a href="#служебные-функции" id="toc-item-pg-to-datomic-служебные-функции">Служебные функции</a></li>
          <li><a href="#логирование-и-форматирование" id="toc-item-pg-to-datomic-логирование-и-форматирование">Логирование и форматирование</a></li>
          <li><a href="#расширения" id="toc-item-pg-to-datomic-расширения">Расширения</a></li>
          <li><a href="#сырой-sql" id="toc-item-pg-to-datomic-сырой-sql">Сырой SQL</a></li>
          <li><a href="#повторное-использование-запросов" id="toc-item-pg-to-datomic-повторное-использование-запросов">Повторное использование запросов</a></li>
          <li><a href="#аналоги" id="toc-item-pg-to-datomic-аналоги">Аналоги</a></li>
          <li><a href="#промежуточный-итог" id="toc-item-pg-to-datomic-промежуточный-итог">Промежуточный итог</a></li>
        </ul>
      </li>
      <li><a href="#структура-и-группировка" id="toc-item-pg-to-datomic-структура-и-группировка">Структура и группировка</a>        <ul>
          <li><a href="#выборка-по-слоям" id="toc-item-pg-to-datomic-выборка-по-слоям">Выборка по слоям</a></li>
          <li><a href="#ручная-группировка" id="toc-item-pg-to-datomic-ручная-группировка">Ручная группировка</a></li>
          <li><a href="#порядок-записей" id="toc-item-pg-to-datomic-порядок-записей">Порядок записей</a></li>
          <li><a href="#итог" id="toc-item-pg-to-datomic-итог">Итог</a></li>
        </ul>
      </li>
      <li><a href="#группировка-в-базе" id="toc-item-pg-to-datomic-группировка-в-базе">Группировка в базе</a></li>
      <li><a href="#миграции" id="toc-item-pg-to-datomic-миграции">Миграции</a>        <ul>
          <li><a href="#migratus" id="toc-item-pg-to-datomic-migratus">Migratus</a></li>
          <li><a href="#несколько-запросов-в-миграции" id="toc-item-pg-to-datomic-несколько-запросов-в-миграции">Несколько запросов в миграции</a></li>
          <li><a href="#миграции-с-профилями" id="toc-item-pg-to-datomic-миграции-с-профилями">Миграции с профилями</a></li>
          <li><a href="#параметры-подключения" id="toc-item-pg-to-datomic-параметры-подключения">Параметры подключения</a></li>
          <li><a href="#миграции-в-коде" id="toc-item-pg-to-datomic-миграции-в-коде">Миграции в коде</a></li>
          <li><a href="#программные-миграции" id="toc-item-pg-to-datomic-программные-миграции">Программные миграции</a></li>
          <li><a href="#ragtime" id="toc-item-pg-to-datomic-ragtime">Ragtime</a></li>
        </ul>
      </li>
      <li><a href="#nextjdbc" id="toc-item-pg-to-datomic-nextjdbc">Next.JDBC</a></li>
      <li><a href="#заключение" id="toc-item-pg-to-datomic-заключение">Заключение</a></li>
    </ul>
  </li>
</ul>

<h1 id="реляционные-базы-данных">Реляционные базы данных</h1>

<p><em>В этой главе мы поговорим о том, как работать с реляционными базами данных в Clojure. Бóльшую часть описания займет библиотека clojure.java.jdbc и дополнения к ней. Вы узнаете, какие проблемы встречаются в этой области и как их решают в Clojure.</em></p>

<p>В бекенд-разработке базы данных занимают центральное место. Если говорить упрощенно, то любая программа сводится к обработке данных. Конечно, они поступают не только из баз, но и сети и файлов. Однако в целом за доступ к информации отвечают именно базы данных — специальные программы, сложные, но с богатыми возможностями.</p>

<p>Базы данных, или сокращенно БД, бывают разных видов. Они различаются в архитектуре, способе хранения информации, типом связи с клиентом. Некоторые базы работают только на клиенте, то есть в рамках одного компьютера. Другие хранят только текст и оставляют типы на усмотрение клиента. Встречаются базы, где данные хранятся в оперативной памяти и пропадают после выключения.</p>

<p>Мы не ставим цель охватить как можно больше баз и способов работы с ними. Наоборот, сфокусируем внимание на том, что встретит вас в реальном проекте. Скорей всего это будет классическая реляционная база данных вроде PostgreSQL или MySQL. О них мы и будем говорить.</p>

<p>Реляционные базы данных называют так из за модели <a href="https://ru.wikipedia.org/wiki/%D0%A0%D0%B5%D0%BB%D1%8F%D1%86%D0%B8%D0%BE%D0%BD%D0%BD%D0%B0%D1%8F_%D0%B0%D0%BB%D0%B3%D0%B5%D0%B1%D1%80%D0%B0">реляционной алгебры</a>. Это изящная математическая модель с набором операций, например выборкой, проекцией, декартовым произведением и другими. Из модели следуют строгие правила о том, как работает та или иная операция. Поэтому базы данных работают не спонтанно, а по четким алгебраическим правилам. Из этих правил следуют <a href="https://ru.wikipedia.org/wiki/%D0%9D%D0%BE%D1%80%D0%BC%D0%B0%D0%BB%D1%8C%D0%BD%D0%B0%D1%8F_%D1%84%D0%BE%D1%80%D0%BC%D0%B0">нормальные формы</a> (первая, вторая и третья), доказать которые можно аналитически, а не на глаз.</p>

<p>Мы будем учить реляционную алгебру с самых азов. Обратитесь к статье в Википедии или книгам, где она описана без привязки к конкретной БД.</p>

<p>Перейдем к понятиям, более привычным программисту. Базы хранят содержимое в таблицах. Запись в таблице называется кортежем и состоит из отдельных полей. Поля могут быть разного типа. Состав полей и их порядок одинаков в рамках таблицы. Не может быть так, что в первой записи два поля, а во второй три. Если нужно указать, что в поле нет значения, в него пишут специальное пустое, чаще всего NULL.</p>


                    <p><a href="/clj-db/">Read more &rarr;</a></p>
                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/dead-soft/">Мертвые программы</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2021-10-04T00:00:00+00:00">
        Oct 4, 2021
    </time>

    <a href="/tag/life/" rel="tag">life</a>

</div>


            <div class="entry">
                
                    <p>Самые лучшие программы — те, что обыватели называют “мертвыми”.  То есть те, что
обновляются либо никогда, либо редко и по мелочам. Иной раз поражаюсь:
собеседник вроде неглуп, но Sublime Editor у него считается мертвым. Видите ли,
давно не обновлялся.</p>

<p>Не обновлялся, и что? Это же прекрасно! Никаких неожиданностей с интерфейсом,
дуракцих фич, синхронизации учетной записи, облачной подписки, что там
еще… Как в старые добрые времена. Поставил Фотошоп версии пять, через год
вышел шестой. А не через день, как сегодня. И нельзя запустить, пока не
скачаешь.</p>

<p>Желая обновлений, вы сами накликаете беду. Пусть будет софт, который не
обновляется. Такой, чтобы из года в год мы получали ту же программу, что и
раньше. Глупцы не понимают, что индустрия насыпет им обновлений сверх меры. Оно
вам надо? Софт, который из года в год работает одинаково, – разве не будет он
глотком воздуха в этом аду?</p>

<p>Удивляюсь тем, кто отслеживает грядущие фичи и расстраивается, если их нет в
релизе. Я всегда полагался только на то, что идет из коробки. Нахожу забавным
обзоры релизов какой-нибудь IDE от Джетбрейнс. Тут заработал автокомплит! А
здесь новое окошко! Прокрутка на 3.3 процента плавнее! Поддержка эмодзи, вы
слышали! Смехота и только.</p>

<p>Сердце моего окружения — это именно мертвые программы: Emacs, Git, Bash, утилиты
GNU, LaTeX. В них я могу создать программу, сайт, книгу. Они обновляются, но это
не играет роли: я использую только то, что в них уже много лет. Если завтра за
их поддержку введут смертную казнь, мне хватит их на оставшуюся жизнь. Они не
отвалятся из-за протухшей учетной записи, заблокированной кредитки или переезда
в Крым-наш.</p>

<p>Это очень круто и дает настоящую, неподдельную радость.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/printers/">Принтеры</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2021-09-22T00:00:00+00:00">
        Sep 22, 2021
    </time>

    <a href="/tag/life/" rel="tag">life</a>

</div>


            <div class="entry">
                
                    <p>Пожалуй, самая нелепая, не поддающаяся описанию вещь в нашем мире — это
принтеры.</p>

<p>Даже если принтер размером с холодильник и стоит как самолет, его экран будет
как пейджер нулевых. То есть со спичечный коробок с четырьмя кнопками, у которых
по десять функций в зависимости от контекста.</p>

<p>У любого принтера ужасный драйвер и интерфейс опций. Типичный случай —
восемь-девять табов с опциями, раскиданными без всякой логики.</p>

<p>Принтеры ужасно выглядят: у них миллион каких-то щелей, фазок, выемок, лотков,
которыми никто не пользуется. Все это скрипит и ходит, как потертое седло. Те же
ощущения, что от ноутбуков HP десятилетней давности.</p>

<p>Самая феерия — это дозаправка картриджа. Производитель считает, что ты должен
купить новый у официалов, и если вставить заправленный картридж, система его не
увидит. Для своего принтера нагуглил инструкцию (копирую как есть):</p>

<ul>
  <li>Включите аппарат и откройте крышку.</li>
  <li>Теперь выключите принтер.</li>
  <li>Зажмите клавишу «Go» на клавиатуре панели управления устройства и не отпускайте.</li>
  <li>Снова включите принтер.</li>
  <li>Дождитесь пока начнут гореть все индикаторы кроме «Ready».</li>
  <li>После еще три секунды подержите и отпустите «Go».</li>
  <li>Теперь 10 раз нажмите «Go» и следите, чтобы после каждого загорался индикатор «Ready» именно зеленым цветом.</li>
  <li>После делаем небольшую паузу. В это время должны гореть три лампочки вверху.</li>
  <li>И снова кнопку «Go» жмем 5 раз.</li>
  <li>После этих мероприятий лампочки еще некоторое время помигают разными оттенками.</li>
  <li>В конце лампочка «Ready» должна начать постоянно светится.</li>
</ul>

<p>Удивительно, но это дерьмо работает. Реально, если нажать, подержать, помигать,
отпустить и так далее, то принтер подхватит заправленный картридж. Не знаю
плакать или смеяться. Представьте, если после замены воздушного фильтра в машине
надо зажать тормоз и газ, открыть все двери и перекреститься. А тут всерьез.</p>

<p>Дополняет все беды то, что системный диалог печати в операционных системах убог
до невозможности, а каждая программа предлагает свои уродские диалоги. В Ворде
он ужасен. В Хроме — кастрирован. Для себя нашел спасение: любой документ
сохраняю в PDF и печатаю из эпловского Preview. Единственная программа с
нормальным диалогом печати.</p>

<p>Интересно, что именно в компании Xerox начались изыскания в области
интерфейса. Окна, кнопки, вырезать-вставить. Но в итоге печатная промышленность
пришла куда-то не туда.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/that-is-what-I-do/">Что я делаю</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2021-09-16T00:00:00+00:00">
        Sep 16, 2021
    </time>

    <a href="/tag/life/" rel="tag">life</a>

</div>


            <div class="entry">
                
                    <p>В последнее время мало пишу в блог, потому что занят другими вещами. Эта заметка
— попытка обозначить их для самого себя. Итак, помимо основной работы, я делаю
вот что.</p>

<p>Менторю пару девушек: студентку и школьницу. Делаю это бесплатно, потому что не
вижу смысла брать с них денег. Путь лучше в будущем научат кого-то еще.</p>

<p>Занимаюсь вопросами дома, в котором живу. Только что провел тяжелейшее
голосование по установке шлагбаумов на территории. Теперь претворяю в
жизнь. Получил колоссальный опыт в плане общения с людьми и организации.</p>

<p>Редактирую текст второй главы по базам данных для следующей книги о Кложе. В
день выходит по чайной ложке, но все-же когда-нибудь добью.</p>

<p>Неожиданно стал майнить. Занимаюсь майнингом всего четыре месяца, на за это
время получил вагон знаний о железе, крипте и электричестве. Может, когда-нибудь
напишу про это небольшую книжку.</p>

<p>А блог… Что ж, пусть со временем он станет архивом. Реальные дела важнее.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/db-draft/">Анонс главы. Базы данных в Сlojure</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2021-09-02T00:00:00+00:00">
        Sep 2, 2021
    </time>

    <a href="/tag/book/" rel="tag">book</a>, <a href="/tag/draft/" rel="tag">draft</a>

</div>


            <div class="entry">
                
                    <p>Только что закончил черновик главы о реляционных базах в Сlojure. Вышло сто
страниц А4; в книжных страницах это около ста шестидесяти. Мой самый большой
текст.</p>

<p>В прошлом году я опубликовал <a href="/clj-jdbc-1/">огрызок</a> этой главы. Идея была в
том, чтобы выкладывать частями. Но потом передумал: гораздо лучше подчистить и
выложить целиком, чтобы не рассеивать внимание.</p>

<p>Посмотрел на дату публикации того огрызка и не поверил: ноябрь 2020 года. Прошел
почти год! С возрастом время летит незаметно.</p>

<p>Впереди еще несколько этапов чистки, и только потом опубликую главу. Думаю,
ждать осталось месяц.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/meduza/">Медуза</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2021-08-23T00:00:00+00:00">
        Aug 23, 2021
    </time>

    <a href="/tag/covid/" rel="tag">covid</a>, <a href="/tag/life/" rel="tag">life</a>

</div>


            <div class="entry">
                
                    <p>С сожалением понял, что не могу больше читать Медузу. Это прекрасное издание, и
я даже поддерживаю их после признания иностранным агентом. Причина сложная, но
постараюсь грамотно ее передать.</p>

<p>Долгое время я рассматривал Медузу как новостной сайт. Но за последний год ее
формат изменился. Теперь это не новости, а скорее блоггинг или что-то вроде
того. Главный индикатор — в издании отчетливо слышится повестка.</p>

<p>Повесткой я называю тезисы и идеи, за которые кто-то топит. Например, моя
повестка — программирование, Лисп и ФП, образование, книги, управление
временем. Повестка условного Варламова — урбанистика, архитектура, политика,
общественные события. В блоге повестка обязательна: читатель сразу должен
понять, за что топит автор, и исходя из этого уйти или остаться. У меня, как и у
всех, есть мнение насчет госдолга США и как поднять Россию с колен, но я
стараюсь не писать на эти темы. В первую очередь из уважения к читателям.</p>

<p>В новостном издании, напротив, повестка не должна проступать так выпукло, как в
блоге. Когда я открываю новость, я не хочу, чтобы автор ее оценивал. Я жду
нейтральную информацию о том, что случилось, и если нужна оценка, то либо
составляю ее сам, либо обращаюсь к блоггерам.</p>

<p>Увы, Медуза нарушила этот формат. Ее публикации все больше напоминают блог
группы авторов. Сначала в интонации и между строк, а затем и в заголовках
редакция выражает свое отношение к новости, и это невыносимо.</p>

<p>Талибы(1) — плохо. Навальный — жертва. Его расследования — круто. Коронавирус —
главная угроза обществу. Вакцинация — хорошо. Тот, кто отрицает —
ковид-диссидент (даже термин придумали). Песков несет пургу. Стеб над
Путиным. Несправедливое отношение к геям и неграм. Ущемление лесбийских пар в
России.</p>

<p>Ощущение, что Медуза возомнила себя транслятором передовых идей Европы и
пытается окультурить отсталую Россию. Культурное прокси в Риге.</p>

<p>Дело не в том, что я поддерживаю Путина и Пескова — было бы странно заподозрить
меня в этом. Но мне не нравится, когда издание стебется над кем-то. Например,
Медуза частенько ставит на главную туманную цитату Пескова и приписывает
издевательский заголовок. По мне это то же самое, что подрисовывать усы в книге
— детский сад.</p>

<p>После признания ингантом Медуза ведет себя, как обидевшаяся женщина. В
заголовках — пассивная агрессия, стеб, сарказм. Так быть не должно. А еще эмодзи
в заголовках. Если смешно, то ржачный смайлик. Если грустно, то плачущий. Какое
дно.</p>

<p>В целом, попытка редакции сблизиться с читателем скорее меня отталкивает. Каждая
новость пытается выдавить из меня гнев, осуждение, негодование, отчаяние и
смех. Я не хочу всего этого. Если переживать за всех ущемленных и несправедливо
попавших под ментовский произвол, то исчерпаешь ментальную устойчивость. Да и
никакие это не новости. Это тот же условный Варламов.news, то есть блоггинг под
видом новостей.</p>

<p>Конечно, каждый из нас нуждается в толковании событий. Хорошо то или иное
событие или нет, молодцы эти ребята или нет. Поставили скульптуру в виде
<del>говна</del> глины. Если коллеги заспорят в курилке, за что мне топить? Говно или
искусство?  Для этого и существует блоггинг — люди делятся мнением, а читатель
выбирает, к какому лагерю примкнуть. Но тут важны две вещи.</p>

<p>Во-первых, не надо выключать голову. Бывает, насмотрится человек Шульман, и я по
второй-третьей фразе понимаю, откуда дровишки. Во-вторых, цените издания,
которые не дают оценки событий. Скорей всего, это вымирающий вид. Не станет их,
и вы волей-неволей скатитесь к просмотру варламовых и лебедевых.</p>

<p>Это все равно что клевать мертвечину.</p>

<p>(1): вроде бы считаются запрещенной в России организацией, так что вынужден дать
эту сноску.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/strategy/">Стратегия</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2021-08-02T00:00:00+00:00">
        Aug 2, 2021
    </time>

    <a href="/tag/life/" rel="tag">life</a>, <a href="/tag/programming/" rel="tag">programming</a>

</div>


            <div class="entry">
                
                    <p>Предположим, вы смотрите какой-то митап на Ютубчике. Голова с экрана говорит
вам, что:</p>

<ul>
  <li>нужно нанимать только фулстек-разработчиков;</li>
  <li>нужно вставать в 5 утра;</li>
  <li>нужно читать по три книги в месяц</li>
</ul>

<p>и все в том же духе. При этом выступающий чего-то добился, и вроде как ему можно
доверять.</p>

<p>Что делать? Менять технический стек? Закупать книги? Ставить будильник?</p>

<p>Чтобы все объяснить, прибегу к дешевому трюку — аналогии.</p>

<p>Есть такой жанр компьютерных игр — стратегии. Это когда строишь юнитов и давишь
ими противника. Стратегии интересны бесконечным сочетанием юнитов, их
способностей, карты, выпавших предметов, случайности и других факторов.</p>

<p>У слова “стратегия” есть и другой смысл — набор действий в игре. Например,
удачная комбинация конкретных юнитов. Или порядок постойки зданий. Или покупка
предметов и зачистки монстров для раскачки.</p>

<p>Теперь внимание: в играх не бывает стратегии, которая однозначно определяет
успех. Если таковая находится, ее тут же исправляют патчем: ослабляют юнитов,
делают их дороже, сдвигают выше по технологическому дереву.</p>

<p>Известный игрок Moon на одном из турниров убил сильного противника базовым
юнитом — лучницами. Сразу после турнира многие стали играть так же, что не
принесло им успеха. Так появилась новая стратегия за эльфов, которую пробуют
время от времени, но она не обещает выигрыша.</p>

<p>Теперь обратно к говорящим из Ютуба. Рынок — это игра, в которой многие факторы
не определены. Жизнь постоянно корректирует его законы. Нет стратегии, которая
обязательно принесет прибыль.</p>

<p>Нужно нанимать только фулстек-разработчиков? Возможно, это зашло только в вашем
проекте и в группе конкретных людей.</p>

<p>Нужно вставать в 5 утра? Обратитесь к истории про Стивена Хокинга, когда он
совершил открытие ложась в кровать поздно ночью.</p>

<p>Надо держать монореп? У тех успешных ребят отдельные репы.</p>

<p>И так далее.</p>

<p>Понимаете, нет заведомо выигрышной стратегии. Одинокий тезис, высказанный со
сцены, на практике переплетен со сложным контекстом: где, когда и с кем. Но со
сцены вы его не услышите. Как и в Варкрафте, после успешного выступления сотни
людей бегут повторять увиденное, но почему-то не выходит.</p>

<p>Вывод? Смотри Ютуб, почитывай Хабр, но следуй своему пути.</p>

                
            </div>

        </li>
        
    </ul>

    <h4>
        
        <a href="/page16" class="previous">&larr;</a>
        
        <span class="page_number ">Страница 17 из 71</span>
        
        <a href="/page18" class="next">&rarr;</a>
        
    </h4>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>Ivan Grishaev's blog</li>
          <li><a href="mailto:ivan@grishaev.me">ivan@grishaev.me</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
            <li><a href="https://github.com/igrishaev">GitHub</a></li>
            <li><a href="tg://resolve?domain=igrishaev_blog">Telegram</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>Writing on programming, education, books and negotiations.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
