<!DOCTYPE html>
<html lang="ru">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Ivan Grishaev's blog</title>
  <meta name="description" content="Writing on programming, education, books and negotiations.
">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/custom.css">
  <link rel="canonical" href="https://grishaev.me/page2/">
  <link rel="alternate" type="application/rss+xml" title="Ivan Grishaev's blog" href="https://grishaev.me/feed.xml">

  <link rel="shortcut icon" type="image/x-icon" href="/assets/static/favicons/favicon.ico">

  <script type="text/javascript" src="/assets/typo.js"></script>

</head>


  <body>
    <header class="site-header">

    <div class="wrapper flex-container">

        <div>
            <a href="/">
                <img id="avatar" src="/assets/static/avatar.jpg" alt="Ivan Grishaev">
            </a>
        </div>

        <div class="flex-container-vert" style="margin-left: 15px; width: 80%">

            <div class="flex-container full-width">
                <p style="margin-bottom: 5px">Ivan Grishaev's blog</p>
                <div class="flex-huge"></div>
                <div >
<form id="search-form"
      target="_blank"
      style="display: inline"
      method="get"
      action="https://www.google.com/search">

    <input name="sitesearch"
           value="grishaev.me"
           type="hidden">

    <input type="text"
           required="required"
           name="q"
           placeholder="Google search..."
           autocomplete="off">

    <button style="border: none; background-color: transparent; cursor: pointer;"
            type="submit">&#x1f50d;</button>

</form>
</div>
            </div>

            <p><small>Writing on programming, education, books and negotiations.
</small></p>

            <div class="flex-container">
                <a class="menu-item" href="/">Home</a>
                <a class="menu-item" href="/about/">About</a>
                <a class="menu-item" href="/bookshelf/">Bookshelf</a>
                <a class="menu-item" href="/feed.xml">RSS</a>
            </div>

            <div class="flex-container">
                <a class="menu-item minor" href="/tag/clojure/">Clojure</a>
                <a class="menu-item minor" href="/tag/emacs/">Emacs</a>
                <a class="menu-item minor" href="/tag/python/">Python</a>
                <a class="menu-item minor" href="/tag/programming/">Programming</a>
                <a class="menu-item minor" href="/interview/">Interview</a>
                <a class="menu-item minor" href="/video/">Video</a>
            </div>

            <div class="flex-container">
                <a class="menu-item minor hl" href="/clojure-in-prod/">Книга «Clojure на производстве»</a>
            </div>

            <div class="flex-container">
                <a class="menu-item minor hl" href="/clojure-in-prod-2/">Книга «Clojure на производстве», второй том</a>
            </div>

        </div>
    </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="home">

    <ul class="post-list">
        
        <li>

            <h2>
                <a class="post-link" href="/date-task/">Задача с датами</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2024-10-22T00:00:00+00:00">
        Oct 22, 2024
    </time>

    <a href="/tag/programming/" rel="tag">programming</a>, <a href="/tag/date/" rel="tag">date</a>

</div>


            <div class="entry">
                
                    <p>Прочитал, что в одной фирме дают задание: не используя библиотеки и Гугл,
написать функцию, которая для заданной даты вернет название дня. Скажем, для
2021-03-25 — вторник, для 2015-09-11 — среду (беру с потолка). Я бы эту задачу
не решил, и вот почему.</p>

<p>Во-первых, я не помню все критерии високосного года. Каждый четвертый — это
понятно, но есть еще два критерия, которые встречаются реже. Нужно смотреть их в
википедии.</p>

<p>Во-вторых, я не помню, сколько дней в каком месяце за исключением февраля. В
детском саду и школе нас учили считать по костяшкам, но на мой взгляд, это
бред. Костяшек восемь, месяцев двенадцать. Если брать одну руку, то костяшек
четыре, а промежутков три, в сумме семь. Как ни крути, эта сова не натягивается.</p>

<p>В-третьих, нужна точка отсчета. Даже если я переведу дату в число дней и возьму
остаток от деления на семь, нужно знать, какой день был первым. Считается, что
Иисус родился в понедельник? В любом случае это нужно сверять с википедией.</p>

<p>Еще был переход с юлианского календаря на григорианский, отсюда “старый стиль”,
“старый новый год” и прочее.</p>

<p>Наконец, текущая система дат и времени — это костыль на костыле, которые
достались нам от древних греков. Самое худшее, что можно вообразить — это
работать с датами без библиотеки.</p>

<p>“Что ж, свою кандидатуру я снимаю сам.” ©</p>

<p>А вы бы решили?</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/sh2-more/">Еще про Silent Hill 2</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2024-10-18T00:00:00+00:00">
        Oct 18, 2024
    </time>

    <a href="/tag/games/" rel="tag">games</a>, <a href="/tag/silent-hill/" rel="tag">silent-hill</a>, <a href="/tag/ost/" rel="tag">ost</a>

</div>


            <div class="entry">
                
                    <p>Еще одна заметка про Silent Hill. Понимаю, что всем пофиг, но это для себя. В
этот раз — еще одна партия наблюдений, незамеченных в детстве.</p>

<p>Как вы знаете, герой ищет пропавшую жену Мэри. Город знакомит его с Марией —
женщиной, которая выглядит как жена, но противоположна ей по характеру:
общительна, сексуально раскрепощена. Часть локаций Джеймс проходит с Марией, у
нее есть ключи от закрытых дверей.</p>

<p>Во второй половине игры происходят странные вещи: Марию начинают убивать, причем
каждый раз с большей жестокостью. В первый раз ее пронзает ножом Пирамида, во
второй раз Джеймс находит ее истерзанной в тюрьме, в третий раз ее казнят
кольями. Каждый случай Джеймс переживает все тяжелее, и это расшатывает его
рассудок. Примечательно, что после смерти Мария ничего не помнит и ведет
разговор о посторонних вещах.</p>

<p>Не монстры, не ужасы города, а именно Мария становится главным мучением
Джеймса. В каждой ее смерти он винит себя. Это напоминает наказание в аду, когда
преступник переживает преступление снова и снова. Вот в чем заключается
наказание Джеймса: город дает ему идеальную женщину и постоянно убивает ее,
сводя с ума.</p>

<p>Только в последней сцене, увидев Марию живой в четвертый раз, Джеймс отвергает
ее. Этим он разрывает порочный круг, и начинается финал.</p>

<p>Другой сложный символ, который сопровождает игру — это кровать, и появляется он
в двух значениях. Первый — медленный уход из жизни, когда человек проводит дни в
страданиях. Кровать становится его тюрьмой, превращаясь в могилу. Пустая кровать
появляется, когда речь идет об умершей жене. Пустые кровати часто встречаются в
игре как немой упрек: раньше здесь был человек, а теперь его нет.</p>

<p>Второе значение кровати — страсть, секс. Кровать встречается в сценах с Марией,
альтер-эго умершей жены. Иногда Мария ложится якобы отдохнуть, взглядом и жестом
приглашая Джеймса занять место рядом. После первого убийства Джеймс находит
Марию в тюрьме в комнате длительных свиданий — проще говоря, месте, отведенном
для секса. Мария сидит на кровати за решеткой, и нужно найти к ней другой
путь. Когда Джеймс отправляется на поиски хода, она откидывается назад, намекая,
какой будет встреча.</p>

<p>Когда Джеймс приходит к ней подземным ходом, Мария оказывается убитой. Шокирует
резкая смена контекста: еще недавно она лежала на кровати соблазняя, а теперь
лежит, будучи жертвой. Такой быстрый переход от любви к смерти подействовал на
меня сильно. В детстве я не оценил мощь этой перемены, видимо, я просто не
мог. С возрастом появились какие-то струнки, которые теперь задеты.</p>

<p>Интересный факт насчет трех лет. Джеймс утверждает, что жена умерла три года
назад. Он продолжает это делать даже когда вылазят зловещие нестыковки. Ближе к
концу мы узнаем, откуда взялись эти три года. В лодочной станции есть магнитофон
с записями диспетчеров. Если послушать их, послышится диалог Джеймса с доктором
в госпитале. Джеймс пытается выжать из доктора, сколько осталось жене. Доктор
дает крайне широкую оценку: возможно, три года, возможно, несколько месяцев. И
хотя все произошло за неделю, ум Джеймса ухватился за эти три года, стараясь
задвинуть трагедию как можно дальше в прошлое.</p>

<p>Сексуализация монстров, которые выглядят как женские фигуры, связана с
подавленным желанием Джеймса. В игре не обсуждается его сексуальная жизнь, но
судя по долгому угасанию жены, в ней значительный пробел. Навещая жену в
госпитале, Джеймс смотрел на ноги и грудь медсестер — в основном из этих частей
состоят монстры. В середине игры есть сцена, где обыграно изнасилование одного
из существ. Очевидно, это фантазии Джеймса.</p>

<p>Каждый персонаж живет в своем мире, и только изредка они пересекаются. Каждому
предназначено свое мучение. Об этом не сказано явно, нужно догадаться из
диалогов. Когда Джеймс видит Анжелу в последний раз, он замечает, что все в огне
(намек на то, что Анжела сожгла дом вместе с насильником). На это Анжела
отвечает, что “для нее всегда так”. Неудачника Эдди преследуют выдуманные им же
люди, которые насмехаются над ним. Джеймс не видит этих людей, потому что они в
мире Эдди. Пересекаясь с ним, он видит только трупы убитых насмешников. В мире
Лоры нет ни монстров, ни опасностей, только кошки. Догадаться об этом можно по
диалогу, когда Джеймс находит Лору в подвале госпиталя и спрашивает, как есть
удалось не получить ни царапины. Лора искренне не понимает, что ей может
угрожать.</p>

<hr />

<p>Много всего я надумал, ненадолго вернувшись к этой игре. Ощущение, что
перечитываешь Достоевского или Булгакова — нет-нет да найдешь то, что раньше не
замечал. Может быть, через пятнадцать лет еще что-то найду — и разумеется, дам
вам знать.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/sh2-ost/">Саундтрек из Silent Hill 2</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2024-10-18T00:00:00+00:00">
        Oct 18, 2024
    </time>

    <a href="/tag/games/" rel="tag">games</a>, <a href="/tag/silent-hill/" rel="tag">silent-hill</a>, <a href="/tag/ost/" rel="tag">ost</a>

</div>


            <div class="entry">
                
                    
<p>Один знакомый, зная, что я неравнодушен к серии Silent Hill, прислал ссылку на
саундтрек ремастера. Оказалось, это не полноценный саундтрек, а нарезка по 20
секунд из каждого трека. Но поскольку там 90 треков длительностью три часа,
сумма огрызков набегает на час. <a href="https://ixbt.games/news/2024/10/01/konami-nagnetaet-atmosferu-v-preddverii-vyxoda-silent-hill-2-remake-otryvki-iz-obnovlennogo-saundtre.html">Послушайте и вы по ссылке.</a></p>

<p>Вдохновившись музыкой, пересмотрел ключевые сцены из оригинальной второй
части. Лишний раз убедился, что Silent Hill 2 — уникальная в своем роде
игра. Другой такой нет, да и не нужно — пусть она останется неповторимой.</p>

<p>Дело в том, что в основе игры лежит глубокая личная драма заурядного
человека. Главный герой Джеймс не спасает мир от монстров и не ищет волшебные
артефакты. Его проблема — медленный уход из жизни близкого человека. Боль,
борьба желания и долга, терзания, что сказать и сделать в ситуации, когда и то,
и другое бесполезно.</p>

<p>Пересматривая кат-сцены, не переставал удивляться глубокому символизму
игры. Каждый кадр, каждая сцена выстроена так, чтобы сообщать что-то между
строк. Это и окружающие предметы, и антураж, и одежда героев.</p>

<p>Красной нитью сквозь игру идет тема суда — подавленное желание наказать себя за
преступление. Это преступление тщательно забыто, но прорывается наружу
флешбеками и уликами. Темы суда и казни особенно сильны в конце, когда герой
поднимается на крышу по железному коридору. Формально железные ограждения нужны,
чтобы человек не упал с лестницы, но на самом деле это отсылка к тюремному
коридору, по которому заключенный идет к месту казни. Когда Джеймс ступает на
крышу, коридор падает — обратно он не вернется.</p>

<p>Другой назойливый символ игры — нож. В меню игры его форму имеет курсор. Нож
передает Джеймсу Анжела. Оружие Пирамиды есть увеличенный в размерах нож — тот
самый, что носит Джеймс. Его гротескный размер, вероятно, имеет отсылку к
картинам Сальвадора Дали, где гигантизм означает дутую немощь.</p>

<p>Ближе к концу игры Анжела просит отдать нож: она хочет покончить с собой, чтобы
избежать мучений. Джеймс отказывается, на что Анжела замечает: бережешь для
себя? И хотя Джеймс несколько раз за игру произносит, что не убил бы себя,
именно это случается в главной концовке. Я в курсе, что есть и другие, в том
числе когда он уходит из города с новой женщиной, а в лучшем случае — даже с
ребенком. Но получить хорошую концовку при первом прохождении, скажем мягко,
затруднительно. Поэтому суицидальный конец истории я считаю каноничным.</p>

<p>Завершение самоубийством по-своему хорошо тем, что вписывается в концепцию
игры. Она становится абсолютно, полностью завершенной. Дело в том, что игра
начинается на парковке возле пристани. Оттуда Джеймс начинает путешествие в
город. На парковке стоит его машина. При попытке открыть багажник Джеймс
говорит, что почему-то хочет этого делать — в то время как взять вещи из машины,
казалось бы, самое логичное дело.</p>

<p>Здесь и таится главная недосказанность игры: в багажнике машины лежит тело его
жены. Повидав ужасы города, лишенный всех надежд Джеймс, пережив смерть жены
дважды, возвращается на парковку. Там он заводит автомобиль и топит себя с телом
жены. Не все из этого показано в игре, но концепция не оставляет других
толкований.</p>

<p>На мой взгляд, второй Silent Hill — это “Преступление и наказание” нашего
времени. В нем заложен такой плотный концепт, что можно разбирать очень
долго. Это самообман, оправдание преступления, различные приемы, чтобы убедить
совесть в обратном, подавленная сексуальность, ненависть к зависимому человеку и
целый короб подобных штучек. И это только Джеймс, не считая второстепенных
персонажей вроде Анжелы, Эдди и Лоры. Подобно Раскольникову или Соне, каждого
персонажа можно брать и рассматривать часами.</p>

<p>Пишу это, чтобы напомнить: второй Silent Hill — важный культурный продукт нашего
времени. Понимаю, это несколько странно: применять к игре формулировки, которые
больше подходят книге. Да, из-за формата не все могут ознакомиться с ней. Но
будь у вас лишние несколько часиков — не знаю, правда, откуда они в сорок лет —
ознакомиться не помешает.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/microservices/">Микросервисы</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2024-10-18T00:00:00+00:00">
        Oct 18, 2024
    </time>

    <a href="/tag/programming/" rel="tag">programming</a>, <a href="/tag/microservices/" rel="tag">microservices</a>, <a href="/tag/architecture/" rel="tag">architecture</a>

</div>


            <div class="entry">
                
                    <p>Беда микросервисов в том, что их разработчики не понимают одну вещь. Хотя
формально микросервисы отделены друг от друга, на самом деле они связаны, потому
что подчиняются общим требованиям.</p>

<p>Обычно об этом не думают и колбасят пачки сервисов. Доходит до того, что один
сервис пишут на Питоне, второй на Ноде, а в третьей команде экстремисты
протащили Хаскель. И все такие — а что такого, у нас микросервисы, общение по
HTTP JSON, какая разница, что крутится в кубернетисе?</p>

<p>Не все равно хотя бы по следующим причинам.</p>

<p>По нажатию кнопки микросервис должен сгенерировать HTML-документацию со всеми
апишками и схемами. Все это генерится из кода, а не руками. Документашка пишется
в докстрингах, схемы хранятся в файлах. Далеко не каждый фреймворк обладает
столь мощной интроспекцией, чтобы перебрать свои кишки и понять, на какой
эндпоинт что навешено.</p>

<p>На практике я наблюдаю, что документацию завозят только если продают апишку
внешним потребителям. Для своих отношение другое — посмотришь исходник, не
рассыпешься.</p>

<p>Далее трассировка. Каждый сервис трекает в общей базе request-id, с которым его
вызвали. Записывается начало запроса, конец и статус. Должна быть админка, где
вводишь request-id и система рисует граф вызовов с метриками. Опять же, где вы
такое видели?</p>

<p>Лимиты. У каждого сервиса должен быть механизм рейт-лимита, чтобы его не
ддосили. Как бывает обычно? Ты вызвал сервис 1000 раз, и начинаются крики “кто
нас дидосит!!11”. Так ведь нигде не написано, сколько раз можно вызывать! Должна
быть прокладка, которая считает число запросов в разрезе потребителей и внятно
отвечает, сколько ждать до обнуления. Такое хоть где-то бывает?</p>

<p>Длины массивов. Сервис принимает список айдишников. Передаю 10 тысяч и получаю
статус 500. Начинается восточный базар: передавай по сто. Нет, это мало, давай
по тысяче? Нет, давай по пятьсот. Ну ок.</p>

<p>Разумеется, этого не должно быть. У каждого массива или строки должен быть
верхний лимит — чего я не наблюдаю.</p>

<p>Из этого следует правило: микросервисы должны клепаться не как попало, а из
общей болванки. В ней встроено все, описанное выше: генерилка документации,
трекинг запросов, рейт-лимиты и так далее. В идеале сначала пишут болванку, а
потом множат из нее микросервисы. Но разве так бывает? Все наоборот: сперва
колбасят никак не связанные сервисы, а потом думают, как заставить их идти в
одной упряжке.</p>

<p>Здесь и кроется предубеждение: хотя формально микросервисы не связаны друг с
другом, на практике это клоны одного проекта. Изменения в клоне отражаются в его
копиях, поэтому ни о какой самобытности не может быть и речи. Правильные
микросервисы — это унификация, полный отказ от самостоятельности.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/fake-faces/">Нейролица</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2024-10-18T00:00:00+00:00">
        Oct 18, 2024
    </time>

    <a href="/tag/ui/" rel="tag">ui</a>, <a href="/tag/ai/" rel="tag">ai</a>, <a href="/tag/fake/" rel="tag">fake</a>

</div>


            <div class="entry">
                
                    <p><img src="/assets/static/aws/fake-faces/1.jpeg" /></p>

<p>В интернете все больше лиц, нарисованных нейросетью. На картинке выше — какой-то
медицинский стартап. Предполагается, что все эти улыбчивые люди — довольные
клиенты сервиса.</p>

<p>Мне неприятно смотреть на эти лица, потому что они выглядят как натертые воском
яблоки. Каждый раз смотрю и не понимаю: откуда эти блики? Они что, собрались на
oiled-вечеринку? Ясно, что иллюстраторы любят градиенты и блики, но почему
нельзя обучить алгоритм на каких-то реальных фото?</p>

<p>Моральных аспект: искусственные лица подаются как клиенты бизнеса, которых на
самом деле нет. Тут включается внутренний голос и говорит: будь на фотках люди с
фотостоков, тебе было бы легче? Это же модели, актеры, которые сегодня врачи,
завтра домохозяйки, а послезавтра у них съемки белья для Вайлдберриз. Прям так
сильно тебе нужны настоящие люди?</p>

<p>И отвечаю — да, лично мне нужны. Я не хочу покупать то, что рекламирует
откровенно сгенерированный человек. Хотят моего внимания — пусть напрягутся и
раздобудут настоящего.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/mobile-permissions/">Разрешения</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2024-10-10T00:00:00+00:00">
        Oct 10, 2024
    </time>

    <a href="/tag/ios/" rel="tag">ios</a>, <a href="/tag/permissions/" rel="tag">permissions</a>

</div>


            <div class="entry">
                
                    <p>В мобильных операционках мне нравится далеко не все. Но есть одна вещь, которую
я горячо поддерживаю, и которая перешла в десктопы — это система
разрешений. Например, доступ к камере, микрофону, контактам, календарю. Все это
дает контроль за программами, которые лезут, куда не просят.</p>

<p>Может быть, не все помнят ранний Андроид, а я помню. В версиях до какой-то там у
Андроида не было разрешений по требованию. Это значит, ты ставишь какой-нибудь
Фонарик Про, а он говорит: нужен доступ к фоткам, контактам, акселерометру и еще
десяти пунктам. А если не согласен, иди лесом. У Эпла разрешения были по запросу
с возможностью позже отозвать их. Модель Гугла была ужасна, ее обузили так
сильно, что пришлось сделать как у Эпла.</p>

<p>Так вот, возвращаясь к десктопу. Хотя в нем есть система разрешений, ее
возможностей не хватает. Например, я бы хотел регулировать, какой программе
можно в интернет, а какой нет. Чтобы снять в настройках чекбокс у программы — и
все, шабаш. Не увидишь модалки, что вышло обновление. Не появится прогресс-бар с
загрузкой. Не будет сбора метрик и кликов. Сейчас, чтобы победить эту хрень,
приходится возиться фаерволом.</p>

<p>Вряд ли такое произойдет, но помечтать не вредно.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/clojure-last/">Last in Clojure</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2024-10-10T00:00:00+00:00">
        Oct 10, 2024
    </time>

    <a href="/tag/programming/" rel="tag">programming</a>, <a href="/tag/clojure/" rel="tag">clojure</a>, <a href="/tag/chatgpt/" rel="tag">chatgpt</a>

</div>


            <div class="entry">
                
                    <p><strong>Chat GPT:</strong> No, the <code class="language-plaintext highlighter-rouge">last</code> function is not particularly expensive for vectors
in Clojure. It runs in O(1) time because vectors in Clojure support efficient
access to their last element.</p>

<p>Meanwhile, Clojure:</p>

<p><img src="/assets/static/aws/clojure-last/1.jpeg" /></p>


                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/clj-last-explain/">Подробней о last</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2024-10-10T00:00:00+00:00">
        Oct 10, 2024
    </time>

    <a href="/tag/programming/" rel="tag">programming</a>

</div>


            <div class="entry">
                
                    <p>Поскольку <a href="/clojure-last/">в заметке про last</a> отметились только профильные
специалисты (в Телеграме), считаю, нужна его подробная версия. Я и сам понимаю,
что для таких огрызков служит Твиттер, но чего нет — того нет.</p>

<p>Итак, дело вот в чем. Коллега спрашивает у Chat GPT, насколько дорого получить
последний элемент вектора функцией last в Кложе. На это чат говорит — все
тип-топ, у вектора доступ к последнему элементу работает за O(1).</p>

<p>Все бы ничего, но в ответе напутаны правда и ложь, и в целом он не верный. Чтобы
в этом убедиться, откроем исходный код функции last:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(dеf
 ^{:doc "Return the last item in coll, in linear time"}
 last (fn ^:static last [s]
        (if (next s)
          (recur (next s))
          (first s))))
</code></pre></div></div>

<p>Полагаю, даже человек, едва знакомый с Лиспом, увидит паттерн. Функция принимает
коллекцию, и если в ней больше одного элемента (есть хвост), то она вызывает
себя с хвостом. Когда длина хвоста равна одному, возвращается этот элемент.</p>

<p>В коде нет проверок на тип коллекции, например, отдельно для вектора или
списка. Все очень просто и линейно.</p>

<p>Наконец, докстринг функции как бы говорит нам: вернуть последний элемент
коллекции за линейное время. Линейное, Карл, то есть такое, что растет с числом
элементов, то есть O(N).</p>

<p>Поэтому буквальный ответ на вопрос таков: нет, функция last вернет последний
элемент вектора за O(N) шагов. Что не подходит для больших векторов.</p>

<p>Спрашивается, откуда у чата уверенность в правоте? Дело в том, что вектор
действительно хранит ссылку на последний элемент. Для доступа к нему служит
функция с забавным названием peek (заглянуть). Она работает только для вектора и
для всего остального кинет ошибку.</p>

<p>Можно предъявить Ричу Хикки: надо было сделать интерфейс <code class="language-plaintext highlighter-rouge">Lastable</code> с методом
<code class="language-plaintext highlighter-rouge">getLast</code>. Обычные коллекции бегут с головы, а вектор берет с конца. Все это
упаковано в <code class="language-plaintext highlighter-rouge">last</code>, который переключает на нужную логику. Все довольны и
смеются. Но имеем то, что имеем, тем более что я согласен с текущим положением
дел. Из всех коллекций только вектор может вернуть последний элемент. Остальным
коллекциям это не положено по идеологическим причинам.</p>

<p>Скорее всего, чат прочитал вопросы на StackOverflow и слепил некую
компиляцию. Вроде бы да, но вроде бы нет. В этом и состоит вред: чат выдает
что-то, очень похожее на истину. Выглядит настолько правдоподобно, что
принимаешь за чистую монету. Но если проверить, то окажется, что не в карты, а в
нарды, и не корову, а машину, и не выиграл, и проиграл.</p>

<p>Поэтому я не пользуюсь чатом и аналогами, я в них даже не зарегистрирован. И вам
советую прибегать к ним реже.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/clj-deed/">Deed: a fast encoding and decoding library for Clojure</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2024-10-07T00:00:00+00:00">
        Oct 7, 2024
    </time>

    <a href="/tag/programming/" rel="tag">programming</a>, <a href="/tag/clojure/" rel="tag">clojure</a>, <a href="/tag/encoding/" rel="tag">encoding</a>, <a href="/tag/decoding/" rel="tag">decoding</a>

</div>


            <div class="entry">
                
                    
<h2>

    Table of Content

</h2>

<ul id="toc-item-clj-deed">
  <li><a href="#about" id="toc-item-clj-deed-about">About</a></li>
  <li><a href="#motivation" id="toc-item-clj-deed-motivation">Motivation</a></li>
  <li><a href="#installation--requirements" id="toc-item-clj-deed-installation--requirements">Installation &amp; Requirements</a></li>
  <li><a href="#quick-demo" id="toc-item-clj-deed-quick-demo">Quick Demo</a></li>
  <li><a href="#api" id="toc-item-clj-deed-api">API</a>    <ul>
      <li><a href="#simple-encode-and-decode" id="toc-item-clj-deed-simple-encode-and-decode">Simple Encode and Decode</a></li>
      <li><a href="#encoding-to-memory" id="toc-item-clj-deed-encoding-to-memory">Encoding to Memory</a></li>
      <li><a href="#sequential-encoding-and-decoding" id="toc-item-clj-deed-sequential-encoding-and-decoding">Sequential Encoding and Decoding</a></li>
      <li><a href="#low-level-api" id="toc-item-clj-deed-low-level-api">Low-Level API</a></li>
      <li><a href="#api-options" id="toc-item-clj-deed-api-options">API Options</a></li>
    </ul>
  </li>
  <li><a href="#gzipped-streams" id="toc-item-clj-deed-gzipped-streams">GZipped Streams</a></li>
  <li><a href="#appending-to-a-file" id="toc-item-clj-deed-appending-to-a-file">Appending to a File</a></li>
  <li><a href="#handle-unsupported-types" id="toc-item-clj-deed-handle-unsupported-types">Handle Unsupported Types</a></li>
  <li><a href="#supported-types" id="toc-item-clj-deed-supported-types">Supported Types</a></li>
  <li><a href="#extending-custom-types" id="toc-item-clj-deed-extending-custom-types">Extending Custom Types</a>    <ul>
      <li><a href="#encode" id="toc-item-clj-deed-encode">Encode</a></li>
      <li><a href="#decode" id="toc-item-clj-deed-decode">Decode</a></li>
      <li><a href="#macros" id="toc-item-clj-deed-macros">Macros</a></li>
    </ul>
  </li>
  <li><a href="#handling-defrecords" id="toc-item-clj-deed-handling-defrecords">Handling Defrecords</a></li>
  <li><a href="#contrib" id="toc-item-clj-deed-contrib">Contrib</a>    <ul>
      <li><a href="#base64" id="toc-item-clj-deed-base64">Base64</a></li>
      <li><a href="#vectorz" id="toc-item-clj-deed-vectorz">VectorZ</a></li>
    </ul>
  </li>
  <li><a href="#binary-format" id="toc-item-clj-deed-binary-format">Binary Format</a></li>
  <li><a href="#benchmarks" id="toc-item-clj-deed-benchmarks">Benchmarks</a></li>
</ul>

<h2 id="about">About</h2>

<p><a href="https://github.com/igrishaev/deed">Deed is a library</a> to dump any value into a byte array and read it
back. It supports plenty of types out from the box: Java primitives, most of the
Clojure types, Java collections, date and time, and so on. It supports even such
tricky types as atoms, refs, and input streams. The full list of supported types
is shown in the <a href="#supported-types">“Supported Types”</a> section below.</p>

<p>Deed can be extended with custom types with ease. There is a contrib package
that extends encoding and decoding logic for vectors from the the well-known
<a href="https://github.com/mikera/vectorz">mikera/vectorz</a> library.</p>

<p>Deed is written in pure Java and thus is pretty fast (see the
<a href="#benchmarks">“Benchmarks”</a> section). It’s about 30-50% faster than Nippy.</p>

<p>It doesn’t rely on the built-in Java <code class="language-plaintext highlighter-rouge">Serializable</code> interface for security
reasons. Every type is processed manually.</p>

<p>Deep provides convenient API for reading the frozen data lazily one by one.</p>

<h2 id="motivation">Motivation</h2>

<p>Obviously you would ask why doing this if we already have Nippy? This is what I
had in mind while working on Deed:</p>

<ol>
  <li>
    <p>The library must be <strong>absolutely free</strong> from dependencies. This is true for
the <code class="language-plaintext highlighter-rouge">deed-core</code> package: it’s written in pure Java with no dependencies at
all. By adding it into a project, you won’t blow up you uberjar, nor you will
have troubles with building a native image with GraalVM.</p>
  </li>
  <li>
    <p>Any part of Deed that requires 3rd-party stuff must be a sub-library. So you
have precise control of what you use and what you don’t</p>
  </li>
  <li>
    <p>Unlike Nippy, Deed never falls back to native Java serialization. There is no
such an option. Thus, your application cannot be attacked by someone how has
forged a binary dump.</p>
  </li>
  <li>
    <p>Deed is simple: it blindly works with input- and output byte streams having
no idea what’s behind them. It doesn’t take compression nor encryption into
account – yet there are utilities for streams.</p>
  </li>
  <li>
    <p>The library provides API which personally I consider more convenient than
Nippi’s. Namely, Deed can lazily iterate on a series of encoded data instead
of reading the whole dump at once.</p>
  </li>
  <li>
    <p>Finally, why not using popular and cross-platform formats like JSON, Message
Pack, or YAML? Well, because of poor types support. JSON has only primitive
types and collections, and nothing else. Extending it with custom types is
always a pain. At the same time, I want my decoded data be as close to the
origin data as possible, say, <code class="language-plaintext highlighter-rouge">LocalDateTime</code> be an instance of
<code class="language-plaintext highlighter-rouge">LocalDateTime</code> but not a string or <code class="language-plaintext highlighter-rouge">java.util.Date</code>. Sometimes, preserving
metadata is crucial. To haldle all of these cases, there now a way other than
making your own library.</p>
  </li>
</ol>


                    <p><a href="/clj-deed/">Read more &rarr;</a></p>
                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/world-of-goo-2/">World of Goo 2</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2024-10-06T00:00:00+00:00">
        Oct 6, 2024
    </time>

    <a href="/tag/games/" rel="tag">games</a>, <a href="/tag/goo/" rel="tag">goo</a>

</div>


            <div class="entry">
                
                    
<p>Вышла <a href="https://worldofgoo2.com/">вторая часть World of Goo</a>. Я долго не знал об этом, потому что
повестка забита другим, да и на работе зашиваюсь. Однако это самая приятная
новость за последние полгода или около.</p>

<p>Изюминка в том, что с момента первой части прошло шестнадцать лет. И дело не в
том, какая графика или саундтрек в новой части. Просто испытываешь радость за
тех двух парней, которые выкатили продолжение. Такое же чувство испытываешь,
когда любимая группа записала альбом после долгих лет турне.</p>

<p>Шестнадцать лет исполнилось моему старшему ребенку. Помню, как начал играть в
Гушек, когда ему было пять месяцев. Гушек прошли вдоль и поперек двое моих
детей, третьей еще предстоит.</p>

<p>Если вы не играли в первую часть, горячо советую это сделать. Игра — не просто
залипательная казуалка. В ней много попыток что-то донести между строк. Почти
каждый уровень — это метафора на что-то из жизни. Попадаются намеки на
отношения, красоту и любовь. Есть серия уровней в компьютере, где моделируется
перехват трафика, балансировка нагрузки и другие айтишные штучки. Есть длинный
диалог на тему браузерных кук. Ближе к концу — эпичный поворот с удаленными
электронными письмами.</p>

<p>Приятно не только расставлять шарики, но и ловить подсказки, намеки, искать
отсылки. Гушки — настоящее произведение искусства. Спасибо двум парням, которые
заставили часами залипать в этот мир. Прошло шестнадцать лет — и я снова загляну
туда, пусть ненадолго, но с тем же интересом.</p>

                
            </div>

        </li>
        
    </ul>

    <h4>
        
        <a href="/" class="previous">&larr;</a>
        
        <span class="page_number ">Страница 2 из 84</span>
        
        <a href="/page3" class="next">&rarr;</a>
        
    </h4>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>Ivan Grishaev's blog</li>
          <li><a href="mailto:ivan@grishaev.me">ivan@grishaev.me</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
            <li><a href="https://github.com/igrishaev">GitHub</a></li>
            <li><a href="https://t.me/igrishaev_blog">Telegram</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>Writing on programming, education, books and negotiations.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
