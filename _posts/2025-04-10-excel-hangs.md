---
layout: post
title: "Зависание окон в Экселе"
permalink: /excel-hangs/
tags: excel
telegram_id: 786
---

Работал в Экселе и заметил одну вещь.

В офисном пакете интерфейс устроен по принципу "один файл -- одно окно". Это
значит, если открыто пять файлов, то будет пять окон. А восприятие наше таково,
что каждое окно считается независимым. Технически много окон могут обслуживаться
одним процессом, да. Но когда я вижу окно во весь экран с менюшкой и табиками,
оно ощущается отдельной программой.

Это приводит к странному поведению: во время долгого импорта виснут все окна
Экселя. Я рассуждал так: пока импортируется тяжелый файл, я поработаю с другим
файлом. Но Эксель в этом плане однопоточный: остальные окна тупо ждут, пока
отпустит первое. Может, такое только на Маке, а на Винде проблем нет, спорить не
буду.

Интересно вот что. Сегодня все браузеры работают по принципу "одна вкладка --
один процесс". Я смутно помню, что этого браузеры, в том числе Хром, часто
вылетали с ошибками, потому что вкладки были на тредах. Сегодня это редкость, а
лет 15 назад было в порядке вещей. Или браузер мог повиснуть на Ютубе или
какой-то упоротой верстке, заморозив все табы. А теперь, когда вкладке плохо, мы
этого даже не замечаем.

Было бы забавно проверить эту модель в современном вебе. Иногда на звонках люди
шарят экран, и я вижу Хром с тремя десятками вкладок. Без преувеличения, не
менее тридцати, потому что табики сжаты до размера иконки. Десятки табов Джиры,
Конфлюэнса и прочей корпоративной жести. А каждая Джира -- это, на минуточку, 50
мегабайтов скриптов и запросы на каждый клик. Мне кажется, если бы тридцать Джир
крутились в одном процессе, интернета мы бы вообще не увидели.

И еще одна мысль, которую не знаю, куда приткнуть. Сервер PostgreSQL работает по
принципу "одно соединение -- один процесс". Никаких тредов там нет и в помине,
на каждое подключение делается форк главного процесса. Обмен данными происходит
через shared memory -- участок памяти, доступный всем процессам. Что-то вроде
глобальной переменной, только в рамках процессов.

Вроде топорно, но оказывается удобным на практике, потому и дожило до наших
дней.
