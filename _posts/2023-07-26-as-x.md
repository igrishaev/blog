---
layout: post
title:  "Как в X"
permalink: /as-x/
tags: programming coding
---

Совершенно ужасная вещь — писать на яыке X как в Y. Например, в Питоне как на
Хаскеле, а в JavaScript — как в Кложе. Придумать какие-нибудь "элегантные
объекты" и тыкать людям, что они живут неправильно.

Чемпионом в этой области является Питон. Из-за его гибкости на нем можно
косплеить любой язык — хоть Хаскел, хоть Кобол. Скажем, выражение ниже можно
сделать рабочим:

~~~python
items = List[1, ...]
~~~

Для этого пишут особый класс `List` с метаклассом, у которого реализован метод
`__getitem__`. В нем проверяется, что если второй элемент — класс `Ellipsis`, то
возвращается ленивый список от 1 до бесконечности.

[f]: https://github.com/igrishaev/f

Для Питона созданы сотни библиотек, которые косплеят другие языки — Хаскель,
Скалу и другие. Я тоже отметился: написал либу с [лаконичным названием f][f], где
собраны плюшки Кложи: стрелочные операторы, мультиметоды и всякие мелочи.

Все это замечательно, если бы не одна деталь: оно никому не сдалось. До перехода
в Кложу я работал с Питоном семь лет и ни разу не видел, чтобы использовались
функциональные поделки. Промышленные проекты на Питоне — это скучный ООП-код без
map/reduce, монад и алгебраических типов. В точности так, как это видит
создатель языка.

Точно так же в Кложе никто не использует монады. Уже в седьмой раз я устраиваюсь
кложуристом и не вижу их в проде (и это хорошо).

В текущем проекте на Кложе беда — его начинали люди, которые знали ее синтаксис,
но не идиомы. Другими словами, они знали, что вместо `1 + 2` надо писать `(+ 1 2)`,
но не знали, как устроить работу с базой, компоненты, тесты и окружение.

Кажется, это были рубисты. Я не держал свечку, но это сквозит в коде. Чуваки
написали свою ORM, которая матчит базу с REST — кривую и глючную. Для
конфигурации используют переменные среды, и это тоже треш и содомия. Компоненты
и система убоги. Позже в фирму пришли люди опытом на Кложе. Они либо обходят
легаси — ходят в базу напрямую, используют свои решения, — либо прибегают к нему
с легким отвращением.

Идиома "писать на X как в Y" — это проигрыш по определению. В любом виде. Это
билет в один конец, и он всегда одинаков. Вы пишете "как надо", но потом
уходите, и другие с трудом приводят код в нужное русло. Не всегда удается
сделать это полностью — иной раз авгиевы конюшни столь полны, что переделывать
слишком дорого, и с этим как-то живут.

Легковестные агенты из Эрланга в Кложе. Элегантные объекты в Джаве. Монады
вместо исключений в Питоне. Да, интересно, да, ярко. Но бесполезно.

Если идеи по-настоящему сильны, их нужно выразить в новом языке. Не устраивает
чистый C — появляется C++. Не устраивают древние диалекты Лиспа — появляется
Кложа. Не нравится бородатый Эрланг — пишут Эликсир.

На любом языке надо писать так, как в нем принято. На Руби — как в Руби, а не в
Кложе. На Кложе — как принято в Кложе, а не в Руби.

Чем раньше это поймешь, тем скорее на тебя снизойдет благодать.
