---
layout: post
title: "И ещё об AWS SDK"
permalink: /aws-sdk-last/
tags: programming aws sdk s3
---

Последняя заметка об AWS SDK и все — закрываю тему, чтобы не утомлять.

Почему я взъелся на этот SDK? Потому что в мире Кложи это своего рода
проклятье. Нужно работать с сервисами Амазона и казалось бы — бери Джавный SDK и
пиши обертку. Но библиотеки Амазона ужасны: нужно 25 пакетов ради HTTP-запроса,
а классы написаны по отвратительному паттерну. Вдобавок это добро не
компилируется Граалем — а у нас все на нем. В результате у нас самописные
клиенты к S3, Dynamo, CloudWatch и десятку других сервисов.

Меня это совсем не радует, потому что клиенты реализованы частично. Если нужна
новая апишка, то открывай доку и пиши код. Самая жесть с сигнатурами. За
короткое время я нашел два бага в библиотеке aws-sign, которая подписывает
запрос. Отлаживать сигнатуры — такая грусть и боль, что и не хочется вспоминать.

Узнав про SDK 2.0, я подумал, что пора перевести наш зоопарк на официальные
библиотеки AWS. Пусть их поддерживают другие люди, а нам не придется кувыркаться
с сигнатурами и прочим. Быстрый гуглеж показал, что SDK 2.0 дружит с Граалем, и
я засел.

Написал обертку, компилирую — не работает. Полез в интернет и выяснилось,
что... даже руки опускаются от отчаяния. Релиз, который поддерживает GraalVM и
компиляцию native-image, был год назад. За это время код поменяли, а нового
релиза с Граалем не делали.

Может быть, со стороны это звучит непоятно, но я поражен. Либо ты поддерживаешь
GraalVM, либо нет. Он накладывает ограничения на Джава-код, поэтому важно
принять решение и следовать ему. А у ребят из Амазона получились релизы
Шредингера: этот поддерживает, тот нет, а следующий, возможно, будет снова
поддерживать.

Технически это лечится дополнительным шагом в CI, где текущая ветка
компилируется Граалем, и если что-то не так — изменения не принимаются. Новый
шаг добавляется в CI за пару часов без преувеличений. И только после этого можно
писать в readme: да, мы поддерживаем Грааль. А не так — один раз получилось,
значит, получится всегда.

Мысль о стажерах, которых сажают писать SDK, пока нет другой работы, крепнет во
мне все сильнее.
