---
layout: post
title: "Просто берите SQLite"
permalink: /pg-and-sqlite/
tags: programming postgres sql
telegram_id: 959
---

Тезис к размышлению: при помощи Postgres и SQLite можно решить (почти) все
насущные задачи. Без распределенных кэшей, очередей, облачных паб-сабов и так
далее.

Насчет Постгреса все ясно: [я уже писал о нем отдельно](/just-use-postgres/). А
что SQLite?

Замечаю одно и то же: иной раз требуется хранить в памяти какие-то
данные. Сначала это словарь вида id -> сущность. Потом нужен поиск по полю
сущности. Строится обратная мапа поле -> список сущностей. Потом нужная вторая
сущность и перекрестные ссылки. Код превращается в ад.

Наблюдаю такое в трех сервисах. Ребята читают из файлов сущности, строят прямые
мапы, обратные, перекрестные… потом ходят по ним безо всяких проверок, ловят
нулы и странные результаты.

А решение простое: запиши свое барахло в SQLite! Из коробки получишь индексы,
поддержку целостности, универсальный интерфейс, поддержку JSON и миллион
расширений. И появился SQLite не вчера, а старше иного разработчика. И тестов
под него написано чуть ли не сотня тысяч.

SQLite отлично подходит, чтобы не шатать боевую базу. Забрал данные, сложил себе
и делаешь что хочешь. Можно делать ночную выгрузку, чтобы всякие отчеты
принимали SQLite, а не ходили в прод.

Если данные не помещаются в памяти, можно скинуть их на диск. Красота же?

Есть и другие рецепты использования SQLite, например использовать его для обмена
данными. Каждый, кто сталкивался с сериализацией, знает, какая это боль и
сколько в ней подводных камней. Один из способов их обойти – кидаться файлами
SQLite.

За счет SQLite можно выкинуть просто нелепое количество кода и самописных
решений. Разумеется, не всегда – но по моему опыту, очень-очень часто.
