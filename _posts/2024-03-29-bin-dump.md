---
layout: post
title:  "Бинарный дамп"
permalink: /bin-dump/
tags: programming binary dump json nippy
---

Простое правило: никогда не пользуйтесь бинарными дампами. Если нужно сбросить
данные на диск, используйте JSON, EDN, YAML, что угодно. Но не нужно брать
библиотеку, которая сериализует любой объект в байтики — это плохо кончится.

Десять лет назад я работал в Wargaming, и для очереди задач там использовали
pickle. Кто не знает, это бинарный дамп объектов PyObject. И пока был только
Питон, все работало. Но потом в качестве эксперимента завезли Эрланг, и
приехали: он не мог читать эти дампы. Ребятам пришлось писать парсер, который с
горем пополам вытягивал оттуда данные. Потом пришлось мигрировать сообщеньки с
pickle на json, не спать неделю, мониторить и все такое.

В мире Clоjure есть похожая поделка — nippy. Это сброс чего угодно в байты с
последующим чтением. Ужасная библиотека с интерфейсом а-ля "чужой для
хищников". Самое главное — с ней везде проблемы. Кастомные классы не читаются
без приседаний. Ошибки игнорируются, вместо них мапы "тут что-то не то". Стоит
внедрить, как найдется потребитель с Питоном или Lua, для которых реализаций
нет.

Потерял два дня, пытаясь заставить работать nippy в Граале. Не работает. Черная
магия десериализации валится со страшными трейсами.

Хочется впасть в отчаяние: почему люди не учатся? Почему я ходил по этим граблям
10 лет назад, и меня заставили снова? Если хочется бинарей, возьми протобуф:
стандарт с реализацией под все платформы. Зачем брать поделку от "опен-сорс
ламы" (так автор себя называет)?

Все это мне не понятно.
