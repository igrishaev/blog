---
layout: post
title: "Память у Андроида (2)"
permalink: /android-mem-2/
tags: android memory storage
---

Продолжение [прошлой заметки](/android-mem-1/) про Андроид.

На мой взгляд, 90 процентов всех телефонов страдают от нехватки места. Сценарий
один и тот же: человек покупает телефон и фотографирует каждый угол. Еще
он ставит три мессенджера, и в каждом ему присылают прикольные видосы и
гифки. Проходит полгода, и места не остается.

Человек запускает менеджер очистки, но это сплошное издевательство. Менеджер
говорит: у тебя занято 20 гигов фотками и видео, удаляй сам. А так я могу
очистить временные файлы на сумму 30 мегабайтов.

Я проходил это десять раз, не меньше. Покупаешь телефон маме, жене, детям,
родственникам — и через полгода они приходят к тебе с вопросом "закончилось
место". Ты скидываешь фотки на комп, и на год тебя оставляют в покое.

Я понимаю, проблему с местом было трудно предсказать, когда Андроид только
вышел. Но на третий-четвертый год это стало очевидно: места никогда не хватает,
аппетиты пользователей растут, ровно и как возможности приложений.

Принято считать, что за местом должен следить пользователь: регулярно смотреть
статистику, удалять файлы, настраивать кеши в мессенджерах. Да, некоторые это
делают. Но как должны справляться с этим обычные люди? Скажем, чтобы настроить
кеш в Телеграме, нужно нажать многоточие, потом гайку, потом смотаться до Data &
Storage, и там выставить опции. Вы считаете, ваша мама это сделает? А потом то
же самое в Вацапе и Вайбере?

Когда я на это жалуюсь, мне говорят — что ты хотел? Тут ничего не поделаешь. А
на самом деле поделать можно много чего.

Заботу о диске должна брать на себя операционная система. Во-первых, если
свободного места меньше 70%, то старые фотки уменьшаются в
разрешении. Современные телефоны производят джипеги по 3-7 магабайтов — такие
фотографии можно печатать в натуральный рост. Это, мягко говоря, избыточно для
экрана размером с ладонь. Когда места перестает хватать, старые фотки сжимаются
до 700 килобайт, освобождая от 2.5 до 5 магабайтов. Сто фоток — полгига.

Разумеется, этот процесс должен действовать тонко, а именно: брать самые
неиспользуемые фотки; пропускать те, которые отмеченные лайком или которые
пользователь часто открывает. Это не подойдет свадебным фотографом, но и
организация фото у таких людей выстроена не так, как у обывателей.

То же самое с видео: если сейчас ночь, и заряд батареи выше порога, то берется
старое видео и перегоняется в низкое разрешение. Как и в случае с джипегами, на
экране размером в ладонь никто не заметит разницы, а это дает 200-300 мегов с
каждого ролика.

Насчет кешей и разбухающих приложений. Ожидать, что человек откроет каждое
приложение и все настроит — идиотизм. Когда системе не хватает места, она
рассылает приложениям системный вызов а-ля "срочно удали кеши". Можно добавить
параметр — уровень критичности. Если он зеленый, то можно ничего не удалять,
если желтый — удалить все данные, кроме последнего месяца, если красный — то
все.

Вы скажете, что никто не будет этого делать. А между прочим, это в интересах
самих приложений. Потому что если на телефоне 2% свободного места, то
пользоваться условным Телеграмом невозможно. А если каждое приложение освободит
по 200-400 мегабайтов, то в сумме будет пара гигов, и телефон худо-бедно
заработает.

Наконец, самое важное — старые данные можно удалять без спроса пользователя. Да,
вот так просто взять и удалить. Объяснение этому простое: представьте, что
человек собрался в компании и хочет снять видео. А места нет. И у нас выбор:
либо сказать, что места нет и заставить чистить файлы самому, либо удалить
фотографии пятилетней давности, которые человек ни разу не открывал. Что лучше?

В большинстве случаев — второе, потому что человеку интересно то, что происходит
сейчас. Ему важно записать видео именно пока он в компании, а не удалять файлы,
пока остальные веселятся. Интерес к фото и видео можно представить как правую
половину гауссианы: она резко спадает во времени, и нет беды в том, чтобы
подчищать старье за пользователя.

Если хотите, аналогия. Современные телефоны работают как резервуар: сначала он
наполняется, а если вливать больше, то польется мимо. Это неправильно: телефон
должен быть как проточный бассейн с входом и выходом. Когда в него вливается
сверх меры, то с другой стороны выливается.

По такому принципу телефон может работать годами, не вынося владельцу мозг
нехваткой места.

Допускаю, что есть программы, которые умеют что-то подобное, но это сторонние
программы, их нужно ставить, покупать, разбираться с ними. Нет из коробки — нет
как такового. А еще телефон, который вместо двух лет прослужил бы пять, мягко
говоря, не согласуется с бизнес-моделью всяких Гуглов, Ксяоми и прочих.

Хочу лишь показать — многие вещи можно переосмыслить, и технически они
возможны. Дело в бизнесе и отношении к ним.
