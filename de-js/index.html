<!DOCTYPE html>
<html lang="ru">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Деджаваскриптизиция</title>
  <meta name="description" content="Как вы думаете, сколько запросов делает браузер, пока вы читаете заметку в моем блоге? Я тоже не знал. Десять, двадцать? Что гадать, если можно проверить!">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/custom.css">
  <link rel="canonical" href="https://grishaev.me/de-js/">
  <link rel="alternate" type="application/rss+xml" title="Ivan Grishaev's blog" href="https://grishaev.me/feed.xml">

  <link rel="shortcut icon" type="image/x-icon" href="/assets/static/favicons/favicon.ico">

  <script type="text/javascript" src="/assets/typo.js"></script>

</head>


  <body>
    <header class="site-header">

    <div class="wrapper flex-container">

        <div>
            <a href="/">
                <img id="avatar" src="/assets/static/avatar.jpg" alt="Ivan Grishaev">
            </a>
        </div>

        <div class="flex-container-vert" style="margin-left: 15px; width: 80%">

            <div class="flex-container full-width">
                <p style="margin-bottom: 5px">Ivan Grishaev's blog</p>
                <div class="flex-huge"></div>
                <div >
<form id="search-form"
      target="_blank"
      style="display: inline"
      method="get"
      action="https://www.google.com/search">

    <input name="sitesearch"
           value="grishaev.me"
           type="hidden">

    <input type="text"
           required="required"
           name="q"
           placeholder="Google search..."
           autocomplete="off">

    <button style="border: none; background-color: transparent; cursor: pointer;"
            type="submit">&#x1f50d;</button>

</form>
</div>
            </div>

            <p><small>Writing on programming, education, books and negotiations.
</small></p>

            <div class="flex-container">
                <a class="menu-item" href="/">Home</a>
                <a class="menu-item" href="/about/">About</a>
                <a class="menu-item" href="/bookshelf/">Bookshelf</a>
                <a class="menu-item" href="/feed.xml">RSS</a>
            </div>

            <div class="flex-container">
                <a class="menu-item minor" href="/tag/clojure/">Clojure</a>
                <a class="menu-item minor" href="/tag/emacs/">Emacs</a>
                <a class="menu-item minor" href="/tag/python/">Python</a>
                <a class="menu-item minor" href="/tag/programming/">Programming</a>
                <a class="menu-item minor" href="/interview/">Interview</a>
                <a class="menu-item minor" href="/video/">Video</a>
            </div>

            <div class="flex-container">
                <a class="menu-item minor hl" href="/clojure-in-prod/">Книга «Clojure на производстве»</a>
            </div>

            <div class="flex-container">
                <a class="menu-item minor hl" href="/clojure-in-prod-2/">Книга «Clojure на производстве», второй том</a>
            </div>

        </div>
    </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">

    <h1 class="post-title" itemprop="name headline">Деджаваскриптизиция</h1>

    
<div class="post-meta">

    <time class="post-time"
          datetime="2022-09-11T00:00:00+00:00">
        Sep 11, 2022
    </time>

    <a href="/tag/programming/" rel="tag">programming</a>, <a href="/tag/javascript/" rel="tag">javascript</a>, <a href="/tag/blog/" rel="tag">blog</a>, <a href="/tag/disqus/" rel="tag">disqus</a>

</div>


  </header>

  <div class="post-content" itemprop="articleBody">
    <p>Как вы думаете, сколько запросов делает браузер, пока вы читаете заметку в моем блоге? Я тоже не знал. Десять, двадцать? Что гадать, если можно проверить!</p>

<p>Открываем консоль разработчика, вкладка Network. Виден всякий ajax/js-хлам. Тык правой кнопкой → “Save all as HAR with content”:</p>

<p><img src="/assets/static/aws/de-js/1.png" /></p>

<p>Получаем жирный JSON со всеми запросами. Вот как выдрать из него урлы:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cat </span>grishaev.me.har | jq <span class="s1">'.log.entries[].request.url'</span> | <span class="nb">sort</span> <span class="o">&gt;</span> urls.txt
</code></pre></div></div>

<p>Если открыть <code class="language-plaintext highlighter-rouge">urls.txt</code> и удалить адреса с доменом <code class="language-plaintext highlighter-rouge">grishaev.me</code> (коих 5 штук), получится… 69 запросов. Вот они:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://a.disquscdn.com/1662551939/images/noavatar92.png
https://a.disquscdn.com/1662551939/images/noavatar92.png
https://accounts.google.com/o/oauth2/iframe
https://accounts.google.com/o/oauth2/iframerpc?action=checkOrigin&amp;origin=https%3A%2F%2Fdisqus.com&amp;client_id=508198334196-bgmagrg0a2rub674g0shidj8fnd50dji.apps.googleusercontent.com
https://accounts.google.com/o/oauth2/iframerpc?action=issueToken&amp;response_type=token%20id_token&amp;login_hint=AJDLj6J0ayD55kiHpX6FEyK8AjchAx-IxO13rW-0myyrGzenEj7YZFquZJE4XTK6YDPt86Y7SJkVEXs3QpNMeay0bCjiNqDIwg&amp;client_id=508198334196-bgmagrg0a2rub674g0shidj8fnd50dji.apps.googleusercontent.com&amp;origin=https%3A%2F%2Fdisqus.com&amp;scope=profile%20email&amp;ss_domain=https%3A%2F%2Fdisqus.com&amp;include_granted_scopes=true
https://apis.google.com/_/scs/abc-static/_/js/k=gapi.lb.en.z9QjrzsHcOc.O/m=auth2/rt=j/sv=1/d=1/ed=1/rs=AHpOoo8359JQqZQ0dzCVJ5Ui3CZcERHEWA/cb=gapi.loaded_0?le=scs
https://apis.google.com/js/api.js
https://c.disquscdn.com/get?url=https%3A%2F%2Fgrishaev.me%2Fassets%2Fstatic%2Faws%2Fbw%2Fui.png&amp;key=5su7aFyKRIY_tqfWlxdSzw&amp;h=200
https://c.disquscdn.com/get?url=https%3A%2F%2Fgrishaev.me%2Fassets%2Fstatic%2Faws%2Fmail%2F2.png&amp;key=P-FCJdQOuptvsG613K8vJA&amp;h=200
https://c.disquscdn.com/get?url=https%3A%2F%2Fs3.amazonaws.com%2Figrishaev.public%2Fexcel%2Fgood.jpg&amp;key=8OltNCXozdgFxMHmgBTDtQ&amp;h=200
https://c.disquscdn.com/get?url=https%3A%2F%2Fs3.amazonaws.com%2Figrishaev.public%2Ftele%2Fscan.jpg&amp;key=3S4NMvR9Sa2dqAik9FSSBw&amp;h=200
https://c.disquscdn.com/get?url=https%3A%2F%2Fs3.amazonaws.com%2Figrishaev.public%2Fvlc%2Feat.png&amp;key=_fOEu4w6cw03wCawGGrA_Q&amp;h=200
https://c.disquscdn.com/next/current/embed/lang/ru.js
https://c.disquscdn.com/next/current/publisher-admin/assets/img/emoji/funny-512x512.png
https://c.disquscdn.com/next/current/publisher-admin/assets/img/emoji/sad-512x512.png
https://c.disquscdn.com/next/current/publisher-admin/assets/img/emoji/upvote-512x512.png
https://c.disquscdn.com/next/current/recommendations/lang/ru.js
https://c.disquscdn.com/next/embed/alfie_v4.63f1ab6d6b9d5807dc0c94ef3fe0b851.js
https://c.disquscdn.com/next/embed/assets/font/icons.4cc7a703d2fdfe684151ff8ac24d45f1.woff2
https://c.disquscdn.com/next/embed/assets/img/disqus-social-icon-dark.a621bea3e02c9fa04fd3965a3d6f424d.svg
https://c.disquscdn.com/next/embed/assets/img/loader.ba7c86e8b4b6135bb668d05223f8f127.gif
https://c.disquscdn.com/next/embed/assets/img/sprite.ad630a07080a45451f139a7487853ff8.png
https://c.disquscdn.com/next/embed/assets/img/svg-sprite.4da5413f5086c5755b46094b813dbfcd.svg
https://c.disquscdn.com/next/embed/common.bundle.33bc87b2c4f9324203cc85b7dd1d0492.js
https://c.disquscdn.com/next/embed/common.bundle.33bc87b2c4f9324203cc85b7dd1d0492.js
https://c.disquscdn.com/next/embed/lounge.bundle.8d28276e15f31af0eebfd934278922d1.js
https://c.disquscdn.com/next/embed/lounge.bundle.8d28276e15f31af0eebfd934278922d1.js
https://c.disquscdn.com/next/embed/lounge.load.0837a7fb2afa86b68e4ee5098ec9905b.js
https://c.disquscdn.com/next/embed/styles/lounge.4ceaf0673822a0def820ebdc38d84415.css
https://c.disquscdn.com/next/embed/styles/lounge.4ceaf0673822a0def820ebdc38d84415.css
https://c.disquscdn.com/next/recommendations/assets/img/img-placeholder.df52e7638153b73862008d3d0556fdda.png
https://c.disquscdn.com/next/recommendations/common.bundle.a59fbd11efae764ccd959d61e4925fee.js
https://c.disquscdn.com/next/recommendations/common.bundle.a59fbd11efae764ccd959d61e4925fee.js
https://c.disquscdn.com/next/recommendations/recommendations.bundle.926bc472e4859a48daa346b4ba2ab4f4.js
https://c.disquscdn.com/next/recommendations/recommendations.bundle.926bc472e4859a48daa346b4ba2ab4f4.js
https://c.disquscdn.com/next/recommendations/recommendations.load.9d352c9674ae8172f8669d3aa3a905e9.js
https://c.disquscdn.com/next/recommendations/styles/recommendations.10022a97346f1c6e3798931bbd8e4bb5.css
https://c.disquscdn.com/next/recommendations/styles/recommendations.10022a97346f1c6e3798931bbd8e4bb5.css
https://cdn.viglink.com/images/pixel.gif?ch=1&amp;rn=8.95348561821992
https://cdn.viglink.com/images/pixel.gif?ch=2&amp;rn=8.95348561821992
https://connect.facebook.net/en_US/sdk.js
https://disqus.com/api/3.0/discovery/listRecommendations.json?forum=igrishaev&amp;thread=url%3Ahttps%3A%2F%2Fgrishaev.me%2Fen%2Fzippo%2F&amp;limit=8&amp;api_key=E8Uh5l5fHZ6gD8U3KycjAIAk46f68Zw7C6eW8WSjZvCLXebZ7p0r1yrYDrLilk2F
https://disqus.com/api/3.0/forums/details?forum=igrishaev&amp;attach=forumFeatures&amp;api_key=E8Uh5l5fHZ6gD8U3KycjAIAk46f68Zw7C6eW8WSjZvCLXebZ7p0r1yrYDrLilk2F
https://disqus.com/api/3.0/forums/details?forum=igrishaev&amp;attach=forumFeatures&amp;api_key=E8Uh5l5fHZ6gD8U3KycjAIAk46f68Zw7C6eW8WSjZvCLXebZ7p0r1yrYDrLilk2F
https://disqus.com/api/3.0/threadReactions/loadReactions?thread=9335567925&amp;api_key=E8Uh5l5fHZ6gD8U3KycjAIAk46f68Zw7C6eW8WSjZvCLXebZ7p0r1yrYDrLilk2F
https://disqus.com/embed/comments/?base=default&amp;f=igrishaev&amp;t_u=https%3A%2F%2Fgrishaev.me%2Fen%2Fzippo%2F&amp;t_d=Zippo%3A%20additions%20to%20the%20standard%20clojure.zip%20package.&amp;t_t=Zippo%3A%20additions%20to%20the%20standard%20clojure.zip%20package.&amp;s_o=default
https://disqus.com/next/config.js
https://disqus.com/next/config.js
https://disqus.com/next/config.js
https://disqus.com/recommendations/?base=default&amp;f=igrishaev&amp;t_u=https%3A%2F%2Fgrishaev.me%2Fen%2Fzippo%2F&amp;t_d=Zippo%3A%20additions%20to%20the%20standard%20clojure.zip%20package.&amp;t_t=Zippo%3A%20additions%20to%20the%20standard%20clojure.zip%20package.
https://fonts.googleapis.com/css?family=PT+Serif:400,400i,700,700i&amp;display=swap&amp;subset=cyrillic,cyrillic-ext,latin-ext
https://fonts.gstatic.com/s/ptserif/v17/EJRSQgYoZZY2vCFuvAnt66qSVyvVp8NA.woff2
https://fonts.gstatic.com/s/ptserif/v17/EJRVQgYoZZY2vCFuvAFSzr-_dSb_nco.woff2
https://fonts.gstatic.com/s/ptserif/v17/EJRVQgYoZZY2vCFuvAFWzr-_dSb_.woff2
https://glitter.services.disqus.com/urls/?callback=dsqGlitterResponseHandler&amp;forum_shortname=igrishaev&amp;thread_id=9335567925&amp;referer=https%3A%2F%2Fgrishaev.me%2F
https://igrishaev.disqus.com/embed.js
https://igrishaev.disqus.com/recommendations.js
https://io.narrative.io/?companyId=19&amp;id=disqus_id%3Ac6g0c4dk2irns7l&amp;ret=img&amp;ref=https%3A%2F%2Fgrishaev.me%2Fen%2Fzippo%2F
https://links.services.disqus.com/api/ping
https://live.rezync.com/pixel.html?c=4656c20ee35215f78e9273796625d90b&amp;cid=c6g0c4dk2irns7l&amp;pctry=RU&amp;referrer=https%3A%2F%2Fgrishaev.me%2Fen%2Fzippo%2F
https://mc.yandex.ru/metrika/tag.js
https://pippio.com/api/sync?pid=1391&amp;ref=https%3A%2F%2Fgrishaev.me%2Fen%2Fzippo%2F&amp;it=1&amp;iv=c6g0c4dk2irns7l
https://referrer.disqus.com/juggler/event.gif?abe=1&amp;embed_hidden=0&amp;load_time=1311&amp;event=init_embed&amp;thread=9335567925&amp;forum=igrishaev&amp;forum_id=3964395&amp;imp=2l7278t3kf6iha&amp;prev_imp&amp;thread_slug=zippo_additions_to_the_standard_clojurezip_package&amp;user_type=anon&amp;referrer=https%3A%2F%2Fgrishaev.me%2F&amp;theme=next&amp;dnt=0&amp;tracking_enabled=1&amp;experiment=network_default&amp;variant=fallthrough&amp;service=dynamic&amp;promoted_enabled=true&amp;max_enabled=true
https://referrer.disqus.com/juggler/event.js?experiment=network_default&amp;variant=fallthrough&amp;page_referrer=https%3A%2F%2Fgrishaev.me%2F&amp;product=embed&amp;thread=9335567925&amp;thread_id=9335567925&amp;forum=igrishaev&amp;forum_id=3964395&amp;zone=thread&amp;page_url=https%3A%2F%2Fgrishaev.me%2Fen%2Fzippo%2F&amp;service=dynamic&amp;verb=view&amp;object_type=product&amp;object_id=embed&amp;extra_data=%7B%22color_scheme%22%3A%22light%22%2C%22anchor_color%22%3A%22rgb(42%2C122%2C226)%22%2C%22typeface%22%3A%22serif%22%2C%22width%22%3A740%7D&amp;event=activity&amp;imp=2l7278t3kf6iha&amp;prev_imp=&amp;section=default&amp;area=n%2Fa
https://referrer.disqus.com/juggler/stat.gif?event=lounge.loading.view
https://www.google-analytics.com/analytics.js
https://www.gstatic.com/_/mss/boq-identity/_/js/k=boq-identity.IdpIFrameHttp.en_US.z2a12LkW96g.es5.O/d=1/rs=AOaEmlHeSnuHrM44y1tAD9SSj44ODEuRFQ/m=base
https://yastatic.net/es5-shims/0.0.2/es5-shims.min.js
https://yastatic.net/share2/share.js
</code></pre></div></div>

<p>Да, Карл: шестьдесят девять запросов на всякие аналитики, кнопки шаринга и комментарии Disqus. Не знаю, почему некоторые урлы повторяются, выяснять это нет никакого желания. Важное уточнение: 69 – это только в начале. Если промотать страницу и написать комментарий, подгрузится еще пачка скриптов.</p>

<p>С Disqus вообще беда: с недавних пор они внедрили рекламу. Блокировщики справляются, но как-то раз я зашел на сайт из голого Сафари и о…уел от того, что творит Disqus на странице:</p>

<p><img src="/assets/static/aws/de-js/2.jpg" /></p>

<p><img src="/assets/static/aws/de-js/3.jpg" /></p>

<p>На мобиле еще хуже: баннеры выстраиваются вертикально, и нужно мотать два экрана.</p>

<p>Кое-что из этого можно отключить в настройках, но в целом от рекламы нельзя избавиться, не заплатив. Да и не в рекламе дело, а в адском количестве скриптов. Сомневаюсь, что купив подписку, можно убавить их число.</p>

<p><img src="/assets/static/aws/de-js/4.png" /></p>

<p>Ясно одно: это не правильно, нужно исправлять.</p>

<p>Социальные кнопки и гугло-аналитику банально удалю. За кнопки мне стыдно, потому что это рудимент нулевых. Сегодня они встречаются разве что на сайтах, сделанных в говно-CMS вроде Джумлы, Друпала и Вордпресса. Аналитика была б хороша, если б Гугл не плевал на все этические нормы. Выбирая между желанием посмотреть, кто и что читает и приватностью читателей, я предпочту второе.</p>

<p>Самое интересное с комментариями. Не сказать, что мои заметки активно комментируют, но время от времени это случается. Особо приятно получить комментарий от бывших коллег, с которыми когда-то работал. Несколько раз в комментариях писали ценные вещи, и я был искренне благодарен.</p>

<p>У меня возникла идея перенести комментарии Disqus в блог. Технически это возможно: в админке Disqus выгружаем все комментарии, получаем жирный XML-файл (про JSON ребята не слышали). Далее пишем скрипт, который обходит XML и дописывает в файлы с постами. Однажды я уже делал так, <a href="/new-blog/">когда мигрировал</a> с Эгеи (движка на PHP), только вместо XML был дамп MySQL.</p>

<p>Остался последний вопрос: как сделать прием комментариев без Disqus? У меня есть одна мысль, но я опишу ее в другой раз, а пока что послушаю ваши советы.</p>

  </div>

</article>

<center>
    <p>
        <small>Нашли ошибку? Выделите мышкой и нажмите Ctrl/&#8984;+Enter</small>
    </p>
</center>






<center>Комментарии</center>

<div id="comments">
  
    <div id="comment-5977195864" class="comment-block">
      <p class="comment-lead">
        <small>
          <em>
            Semyon Bochkaryov,
            11th Sep 2022,
            <a href="#comment-5977195864">link</a>
            
          </em>
        </small>
      </p>
      <div><p>remark42 на своём сервере отлично подойдёт.</p>
</div>
    </div>
  
    <div id="comment-5977498622" class="comment-block">
      <p class="comment-lead">
        <small>
          <em>
            DN,
            12th Sep 2022,
            <a href="#comment-5977498622">link</a>
            
          </em>
        </small>
      </p>
      <div><p>гиковский вариант <a href="https://blog.rpsl.info/2020/09/how-migrate-comments-from-disqus-to-github/" rel="nofollow noopener" title="https://blog.rpsl.info/2020/09/how-migrate-comments-from-disqus-to-github/">https://blog.rpsl.info/2020...</a></p>
</div>
    </div>
  
    <div id="comment-5977524142" class="comment-block">
      <p class="comment-lead">
        <small>
          <em>
            Shiva the Destroyer,
            12th Sep 2022,
            <a href="#comment-5977524142">link</a>
            , <a href="#comment-5977498622">parent</a>
          </em>
        </small>
      </p>
      <div><p>думаешь там меньше запросов?</p>
</div>
    </div>
  
    <div id="comment-5977529112" class="comment-block">
      <p class="comment-lead">
        <small>
          <em>
            Ivan Grishaev,
            12th Sep 2022,
            <a href="#comment-5977529112">link</a>
            , <a href="#comment-5977524142">parent</a>
          </em>
        </small>
      </p>
      <div><p>Вариант с Гитхабом я встречал много раз. В теории все можно сделать одним запросом: выгрести комменты в JSON и отрисовать на странице.</p>
</div>
    </div>
  
    <div id="comment-5977529195" class="comment-block">
      <p class="comment-lead">
        <small>
          <em>
            Ivan Grishaev,
            12th Sep 2022,
            <a href="#comment-5977529195">link</a>
            , <a href="#comment-5977195864">parent</a>
          </em>
        </small>
      </p>
      <div><p>Не знал о таком, посмотрю.</p>
</div>
    </div>
  
</div>









<form id="comment-form" method="POST" action="https://functions.yandexcloud.net/d4ehfuf08fjfjr59ivnf">

    <div class="block">
        <p class="comment-form-label"><small>Your name</small></p>
        <input required id="comment-form-author" name="author" type="text">
    </div>

    <div class="block">
        <p class="comment-form-label"><small>Comment (markdown syntax)</small></p>
        <textarea required id="comment-form-comment" name="comment"></textarea>
    </div>

    <input required name="path" type="hidden" value="/de-js/">
    <input required name="captcha" type="hidden" value="9 &#215; 2">

    <div class="block">
        <span class="comment-form-label"><small>9 &#215; 2 = </small></span>
        <input required id="comment-form-solution" name="solution" type="text">
    </div>

    <div class="block">
        <button id="comment-form-send" type="submit">Send</button>
    </div>

</form>


      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>Ivan Grishaev's blog</li>
          <li><a href="mailto:ivan@grishaev.me">ivan@grishaev.me</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
            <li><a href="https://github.com/igrishaev">GitHub</a></li>
            <li><a href="tg://resolve?domain=igrishaev_blog">Telegram</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>Writing on programming, education, books and negotiations.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
