<!DOCTYPE html>
<html lang="ru">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Ivan Grishaev's blog</title>
  <meta name="description" content="Writing on programming, education, books and negotiations.
">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/custom.css">
  <link rel="canonical" href="https://grishaev.me/page3/">
  <link rel="alternate" type="application/rss+xml" title="Ivan Grishaev's blog" href="https://grishaev.me/feed.xml">

  <link rel="shortcut icon" type="image/x-icon" href="/assets/static/favicons/favicon.ico">

  <script type="text/javascript" src="/assets/typo.js"></script>

</head>


  <body>
    <header class="site-header">

    <div class="wrapper flex-container">

        <div>
            <a href="/">
                <img id="avatar" src="/assets/static/avatar.jpg" alt="Ivan Grishaev">
            </a>
        </div>

        <div class="flex-container-vert" style="margin-left: 15px; width: 80%">

            <div class="flex-container full-width">
                <p style="margin-bottom: 5px"><a href="/">Ivan Grishaev's blog</a></p>
                <div class="flex-huge"></div>
                <div >
<form id="search-form"
      target="_blank"
      style="display: inline"
      method="get"
      action="https://www.google.com/search">

    <input name="sitesearch"
           value="grishaev.me"
           type="hidden">

    <input type="text"
           required="required"
           name="q"
           placeholder="Google search..."
           autocomplete="off">

    <button style="border: none; background-color: transparent; cursor: pointer;"
            type="submit">&#x1f50d;</button>

</form>
</div>
            </div>

            <p><small>Writing on programming, education, books and negotiations.
</small></p>

            <div class="flex-container">
                <a class="menu-item" href="/">Home</a>
                <a class="menu-item" href="/about/">About</a>
                <a class="menu-item" href="/open-source/">Open Source</a>
                <a class="menu-item" href="/bookshelf/">Bookshelf</a>
                <a class="menu-item" href="/feed.xml">RSS</a>
            </div>

            <div class="flex-container">
                <a class="menu-item minor" href="/tag/clojure/">Clojure</a>
                <a class="menu-item minor" href="/tag/emacs/">Emacs</a>
                <a class="menu-item minor" href="/tag/python/">Python</a>
                <a class="menu-item minor" href="/tag/programming/">Programming</a>
                <a class="menu-item minor" href="/interview/">Interview</a>
                <a class="menu-item minor" href="/video/">Video</a>
            </div>

            <div class="flex-container">
                <a class="menu-item minor hl" href="/clojure-in-prod/">Книга «Clojure на производстве»</a>
            </div>

            <div class="flex-container">
                <a class="menu-item minor hl" href="/clojure-in-prod-2/">Книга «Clojure на производстве», второй том</a>
            </div>

        </div>
    </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="home">

    <ul class="post-list">
        
        <li>

            <h2>
                <a class="post-link" href="/workplace/">Место работы</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2025-09-13T00:00:00+00:00">
        Sep 13, 2025
    </time>

    <a href="/tag/life/" rel="tag">life</a>, <a href="/tag/work/" rel="tag">work</a>

</div>


            <div class="entry">
                
                    <p>Я, кстати, придумал вот что: прошелся по всем профилям и убрал текущее место
работы. Оставил только vast fintech с описанием технологий — и довольно.</p>

<p>Почему? Считаю, рекрутерам не нужно знать, где я работаю. Прошлые места смотрите
ради бога, а текущее вас не касается. Буду искать работу — созвонимся, и я все
расскажу. А пока держите от меня фигу с маслом.</p>

<p>Есть и моральный аспект. Когда ведешь бложик, работа часто подкидывает темы — в
том числе основанные на противоречии, когда не согласен и хочешь
выговориться. Чтобы не бросать на кого-то тень, считаю правильным не раскрывать,
где работаешь.</p>

<p>Когда-то я волновался о том, как выгляжу на Линкед-ине. Но когда в пятый раз
находишь работу по знакомству, это становится неважно.</p>

<p>В целом я считаю излишним, когда о тебе знает каждый угол интернета. Еще давно я
удалился из всех соцсетей и ни разу не пожалел. Оставил только Гитхаб и
Линкед-ин: этих двух хватает, чтобы найти работу где угодно — однако им
необязательно знать все.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/ussr-jews/">Евреи в СССР</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2025-09-13T00:00:00+00:00">
        Sep 13, 2025
    </time>

    <a href="/tag/life/" rel="tag">life</a>, <a href="/tag/ussr/" rel="tag">ussr</a>, <a href="/tag/jews/" rel="tag">jews</a>

</div>


            <div class="entry">
                
                    <p>Я не застал толком советский союз, но запомнил некоторые его рудименты. Один из
них заключался в том, чтобы, увидев еврейскую фамилию, обязательно это
подчеркнуть.</p>

<p>Например, идут титры, и написано: композитор А. Шпильман. Взрослые такие с
легкой улыбкой – еврей! Как будто раскрыли агента, который тщательно скрывался.</p>

<p>Я, маленький, долго не понимал, что это за еврей такой и почему он появляется во
всех титрах. Я думал, это конкретный человек и удивлялся его продуктивности.</p>

<p>Помню как прочел фантастический рассказ “Песок” о космонавтах, которые потерпели
бедствие на планете-пустыне. Одного из них звали Шапиро. Когда я пересказывал
рассказ пожилому родственнику, это звучало так: Шапиро сказал своему другу
(“Шапиро? Это еврейская фамилия!”), что они падают, потом Шапиро вышел из
корабля (“Шапиро – это еврей!”) и увидел пустыню, затем Шапиро пошел (“Тот самый
еврей?”)…</p>

<p>Короче, то, что Шапиро – еврей, я услышал раз десять, но так и не понял, что это
значит. По сюжету он был нормальным чуваком, так что я не нашел связи между
тегом и поведением. И вообще, в эпоху межпланетных путешествий мало кого
волновало, кем он был: русским, мексиканцем, французом.</p>

<p>Еще одна кулстори на тему евреев случилась в школе. Урок истории, тема – приход
к власти фашистов и преследование евреев. Историк – маленький неженатый мужчина,
который делал сомнительные комплименты девочкам и просил их фотографии. И вот он
объясняет, за что преследовали евреев: вы понимаете, у них нет своей страны, они
везде образуют диаспоры, строят заговоры И ВООБЩЕ — они же Иисуса распяли!</p>

<p>Как вы думаете, что́ мы, дети, запомнили из этой тирады?</p>

<p>Следующий урок замещает другая учительница, спрашивает – за что преследовали
евреев? Весь класс хором – потому что они Иисуса распяли! У учительницы глаза из
орбит, она тихим голосом спрашивает: кто вам это сказал? Отвечаем — Константин
Батькович. Она: понятно, я с ним поговорю.</p>

<p>А потом прошли годы, и гнилая привычка выявлять евреев как-то
выветрилась. Сегодня это считается моветоном, и очень хорошо. На этом примере мы
видим, что еще 30 лет назад люди не знали кое-что из элементарной этики. Поэтому
брать пример с прошлого поколения нужно очень осмотрительно.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/ublock/">Настройка uBlock Origin</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2025-09-13T00:00:00+00:00">
        Sep 13, 2025
    </time>

    <a href="/tag/ublock/" rel="tag">ublock</a>, <a href="/tag/ad/" rel="tag">ad</a>

</div>


            <div class="entry">
                
                    <p>Заметка самому себе как настроить uBlock Origin.</p>

<ol>
  <li>
    <p>На закладке Filters отметить все галочки кроме “Block Outsider Intrusion into
LAN”. С ней отваливаются картинки на Ютубе и в других музыкальных
сервисах. Почему – пока не разобрался.</p>
  </li>
  <li>
    <p>Во вкладке My filters добавить такую строку:</p>
  </li>
</ol>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>||accounts.google.com/gsi/*$xhr,script,3p
</code></pre></div></div>

<p>Она отключает выпадашку с авторизацией Гугла. Эта выпадашка – вселенское зло:
закрывается буквально на день и завтра вылезает снова. Ее добавили на все сайты
семейства StackExchange. Неважно чем ты интересуешься – базой данных,
редактором, версткой – она липнет как навязчивая муха.</p>

<p>Поражает, сколько фильтров нужно ставить, чтобы просто смотреть
интернет. Пользуясь случаем, шлю Гуглу лучи добра за то, что запретили uBlock в
последнем Хроме. Я так понимаю, кроме форков Файерфокса вариантов нет?</p>

<p>Еще одна мысль: обидно, когда в консоли написано “Blocked by uBlock”, но нет
информации о том, какой фильтр сработал. Имя фильтра и номер строки были бы
спасением. Эти данные по-любому есть в контексте и нужно только добавить их в
сообщение. Или я плохо смотрел?</p>

<p>На закладке Settings включить “Block media elements larger than” и задать свой
размер. Полезно, чтобы отключать большие обложки к статьям. Все равно они
сгенерены нейронкой.</p>

<p>Там же: опция “Block remote fonts”. Полезно для сайтов, чьи дизайнеры любят
поиграть со шрифтами.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/socrates/">Метод Сократа</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2025-09-13T00:00:00+00:00">
        Sep 13, 2025
    </time>

    <a href="/tag/life/" rel="tag">life</a>, <a href="/tag/socrates/" rel="tag">socrates</a>

</div>


            <div class="entry">
                
                    <p>В комментариях упомянули диалог методом Сократа. Вспомнил, что хотел написать на
эту тему.</p>

<p>Что такое метод Сократа? Это когда собеседник не возражает напрямую, а задает
серию вопросов, чтобы направить другого к истине. “Истина”, “направить” – как
благородно звучит!</p>

<p>К счастью, сегодня есть точное и емкое слово, чтобы описать метод Сократа — это
троллинг. В античные времена такого слова не было — как, к примеру, не было
термина “пассивная агрессия”. Но явление было, а Сократ стал его мастером.</p>

<p>Тролль — это человек, который не вступает в конфликт прямо, а старается
поссорить других. Либо, если собеседник один, строит разговор так, чтобы
собеседник противоречил сам себе. В результате тролль разводит руками: дружище,
ты противоречишь, сначала разберись, потом поговорим. И с видом победителя
уходит в закат.</p>

<p>Схема работает по простой причине. На вопросы можно ответить без ошибок только
если готовился к ним. Когда отвечаешь вживую, так или иначе будет нескладно. Не
на пятой, так на десятой итерации ты скажешь то, что противоречит чему-то
сказанному ранее. Это абсолютно точно и неоспоримо, буквально аксиома: чем больше
говоришь, тем больше нестыковок можно найти.</p>

<p>Примерно как в любом фильме можно найти ляпы, когда кружка стоит слева, а в
следующем кадре — справа. Или детектив только что прикурил, а через пять секунд
тушит окурок. И находятся же говноеды, которые разбирают фильм на кадры и
смотрят, что где стояло и на сколько сантиметров сдвинулось! Однако на успех
фильма это никак не влияет.</p>

<p>Я давно научился узнавать троллей, косящих под Сократа. Высказал какую-то мысль,
и подобно мухе к тебе пристал человек. Задает наводящие вопросы: что ты имел в
виду, а что ты скажешь на то, на се… Как будто не очевидно: тролль собирает
базу высказываний, чтобы сказать: ага, сначала ты заявил X, а потом Y! Ты
противоречишь, иди разберись.</p>

<p>Поэтому если от человека следует поток вопросов, я быстро его прерываю. Либо
проходи мимо, либо пиши у себя опровержение. Я даже дам ссылку, мне не жалко.</p>

<p>Про Стива Джобса была замечательная цитата. В Стиве было две половины: засранца
и гения. Из-за гения ему прощали засранца. Сегодня многие подражают Джобсу, но
пока что у них выходит засранец, а не гений.</p>

<p>То же самое применимо к Сократу. Он был гением и абсолютным троллем. Но подражая
Сократу, пожалуйста, держите курс на гения. Троллей и без вас хватает.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/native-content-02/">Оригинальная озвучка (2)</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2025-09-13T00:00:00+00:00">
        Sep 13, 2025
    </time>

    <a href="/tag/life/" rel="tag">life</a>, <a href="/tag/english/" rel="tag">english</a>

</div>


            <div class="entry">
                
                    <p>Как и обещал, пример русской озвучки и оригинала. Предлагаю сцену из первого
Гарри Поттера, где он узнает о том, что родственники все от него скрывали. В
очередной момент подключается тетя Петуния и дает небольшой монолог. Прослушайте
его (ссылки с таймкодами):</p>

<p>Оригинал:</p>

<iframe width="100%" height="500" src="https://www.youtube.com/embed/nnD8FKXzIGs?start=82" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen="">
</iframe>

<p>Переозвучка:</p>

<iframe width="100%" height="500" src="https://www.youtube.com/embed/X9vxIXBgUCs?start=176" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen="">
</iframe>

<p>Обратите внимание, что в оригинале тетя говорит негромко. Она начинает чуть ли
не шепотом от негодования и плавно повышает голос. При этом она не кричит, а
больше играет интонацией. И конечно, за счет того, что обе актрисы (на съемках и
в озвучке) говорят на одном языке, попадание в губы идеальное. В русской озвучке
она говорит громче и с каким-то придыханием.</p>

<p>Ну и сравните голоса Гарри. В оригинале говорит ребенок ровно того возраста, что
и актер в фильме. Это голос мальчика 8-10 лет до пубертата. В русской версии это
голос студента театрального училища.</p>

<p>Когда годами смотришь фильмы в переозвучке, это не парит. Но потом раз — нет-нет
да услышишь оригинал, и возникает диссонанс. Почему в оригинале не то что другие
голоса, а вообще иные громкость и манера речи?</p>

<p>Короче, просто посмотрите эти два куска.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/native-content-01/">Оригинальная озвучка (1)</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2025-09-13T00:00:00+00:00">
        Sep 13, 2025
    </time>

    <a href="/tag/life/" rel="tag">life</a>, <a href="/tag/english/" rel="tag">english</a>

</div>


            <div class="entry">
                
                    <p>Чтобы насладиться продуктом в полной мере (игрой, фильмом, книгой), потребляйте
его на языке оригинала. Особенно это касается английского контента, и вот
почему.</p>

<p>Я не знаю, как устроена русская озвучка в целом – я имею в виду общие принципы,
– но она довольно странная. Там, где в оригинале персонаж шепчет, перводчик
орет, словно над ухом. Русская озвучка до неприличия громкая как в маршрутке:
громко, четко и заранее.</p>

<p>Перевод начисто срезает акценты персонажей. Скажем, англоязычный китаец говорит
с характерным акцентом, которого банально нет в переводе. В лучшем случае
китайца озвучивают тоном выше, мол, азиат же. Но это не то. Аналогично с
мексиканским рокочущим произношением – его просто нет.</p>

<p>Послушайте персонажей из “Омерзительной восьмерки” Тарантино. Там каждый голос –
праздник. Южный выговор, северный, мексиканский акцент, оттяжки, проглатывание
слогов и целых слов. Красота!</p>

<p>То, что пропадают игра слов и различные отсылки, нет смысла писать. Видимо, на
их адаптацию не остается времени.</p>

<p>Теряются акценты речи. Например, босс называет чернокожего подчиненного “black
cunt” – в переводе мы получаем “урод”. Конечно, я бы не хотел слышать дословный
перевод, но вместе с тем и не должно быть беззубого сглаживания. Это же бандиты!
Персонаж высказался грубо и уничижительно, и нужно как-то это передать.</p>

<p>Приведу пример, который особенно меня расстроил. В игре Resident Evil 4 Remake
есть дополнение за второстепенного персонажа. Это полноценная кампания, которая
называется Separate ways – раздельные пути. В русской версии она называется “Два
пути”. Казалось бы, довольно близко. Не все ли равно?</p>

<p>А вот и нет, у названия – два смысла. Первый – оба персонажа идут к цели разными
дорогами, временами сталкиваясь и расходясь, поэтому их пути – раздельные. А
второй – в финале происходит предательство, и главный герой на прощание
произносит:</p>

<blockquote>
  <p>I think we both know this is where we go our separate ways.</p>
</blockquote>

<blockquote>
  <p>Полагаю, мы оба знаем, что теперь наши пути – врозь.</p>
</blockquote>

<p>То есть речь идет о разобщении, о том, что альянсу конец.</p>

<p>Вот в чем дело! Последняя фраза обыгрывает название кампании. В нем два смысла:
прямой (разные дороги) и переносный (конец дружбы). Название подобрано так, что
истинный смысл игрок поймет в финале. Покачает головой и скажет: да, теперь наши
пути действительно separated.</p>

<p>Скажите на милость, как русский перевод “Два пути” все это передаст? Ответ –
никак, игрок просто проезжает мимо.</p>

<p>Ясно, что не всегда уровень английского позволяет все понять без пауз и
перемоток. Но результат того стоит. То же самое касается книг: в свободное время
почитываю Остров сокровищ и Гарри Поттера на английском. Попадаются отличия, но
об этом – в другой раз.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/google-and-apple/">Гугл и Эпл</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2025-09-13T00:00:00+00:00">
        Sep 13, 2025
    </time>

    <a href="/tag/life/" rel="tag">life</a>, <a href="/tag/google/" rel="tag">google</a>, <a href="/tag/apple/" rel="tag">apple</a>

</div>


            <div class="entry">
                
                    <p>Пишут, что Гугл закручивает гайки: запрещает ставить приложения из
.apk-файлов. Основание – борьба с вирусами и обманом пользователей, когда под
видом официального приложения им впаривают невесть что.</p>

<p>Насколько я понял из комментариев, на самом деле будет так: приложения из .apk
все-таки можно поставить, но только если они подписаны ключом
разработчика. Чтобы получить этот ключ, нужно пройти верификацию Гугла, и,
возможно, заплатить (последнее – неточно). Разумеется, если разработчик
проштрафится, Гугл отзовет его ключ и все .apk, им подписанные, превратятся в
тыкву.</p>

<p>В этом плане установка из .apk не отличается от установки из магазина, потому
что ограничения остаются в силе. Подойдет разве что приложениям, которые по
требованию властей убрали из Play Store: фирма может выложить подписанный apk на
сайте.</p>

<p>Особым приложениям новое правило навредит. Это некая серая зона: софт, который
полезен людям, но не пройдет модерацию Гугла. Например, приложение для
диабетиков, которое дает указания по приему инсулина и других
лекарств. Рекомендация лекарств запрещена в Гугле, поэтому люди выкладывают
самосборный .apk. Что им теперь делать – не знаю.</p>

<p>Я тоже получил письмо от Гугла с предложением пройти верификацию. Все потому,
что лет пятнадцать(!) назад выкладывал в стор приложение – личный кабинет
Читинского Энергосбыта. Им даже пользовались, а однажды какая-то УК хотела его
купить.</p>

<p>Вторая новость – Эпл создаст внутренний магазин приложений для России. Там
смогут публиковаться те, кто под санкциями: всякие сберы-тиньковы и так
далее. Пока что магазина нет, но Эпл сам идет навстречу.</p>

<p>Я пишу это не для того, чтобы сказать: Гугл плохой, а Эпл – хороший. Дело в
другом: принципы айти-гигантов всегда оказываются соглашением в моменте. Многие
выбирали Андроид только затем, чтобы ставить ломанные приложухи с
4pda. Яблочников стыдили: у вас рабство. А теперь ситуация если не переменилась,
то близка к этому: один гигант закручивает гайки, другой – ослабляет, хотя оба
били себя пяткой в грудь и заявляли, что никогда такого не будет.</p>

<p>Открытый код, бесплатность, убеждения руководителя – все это условно и
справедливо только в моменте. Проходят годы и то, что было свободным, открытым
или без рекламы, становится закрытым и собирает данные. Руководитель взрослеет и
предпочитает не бороться, а договариваться.</p>

<p>Словом, уверенность в положительных сторонах софта или сервиса сегодня не может
быть долгой. Все течет, все меняется.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/ai-summary/">ИИ-выжимка</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2025-09-13T00:00:00+00:00">
        Sep 13, 2025
    </time>

    <a href="/tag/life/" rel="tag">life</a>, <a href="/tag/ai/" rel="tag">ai</a>

</div>


            <div class="entry">
                
                    <p>Я часто гуглю и привык, что на первом месте – уже не ссылка или реклама, а блок
с выжимкой ИИ (Gemini или как там ее). Должен признать, выжимка довольно точно
пересказывает оригинал, и порой ее достаточно. Фактически, гуглить сегодня – все
равно что пользоваться GPT: в обоих случаях вам покажут чей-то текст или их
комбинацию.</p>

<p>Разумеется, объединять тексты по смыслу и делать краткий пересказ – непростая
задача. Но даже она — это всего лишь алгоритм на матрицах и весах, и при чем тут
интеллект – я не понимаю.</p>

<p>Полезным упражнением может быть вот что. Загуглите что-нибудь, над чем работали
только вы. Например, библиотеку на Гитхабе с осмысленным readme. У меня есть
такие, где в readme написано много. Скажем, “clоjure github deed” или “clоjure
github pg2”. В результате Gemini покажет пересказ твоего же текста.</p>

<p>Может быть, не совсем ясен смысл моего сообщения, но постараюсь
объяснить. Большинство пользователей интернета – потребители. Они смотрят
обучающие видео, статьи, подключают чужой код. Алгоритм, который собрал сотню
источников и выдал их сжатую версию, кажется чудом. Но чудо пропадает, когда у
какого-то кусочка знания один источник и работал над ним один человек – особенно
если это вы.</p>

<p>Когда понимаешь, что источник выжимки — ты сам, возникает интересное
сопоставление. Своего рода маппинг между тем, что было в твоей голове и тем, что
выдал Гугл. Примерно как смутно догадываешься, что будет по нажатию кнопки до
того, как это сделаешь. Становится видна машинная природа алгоритма. Месяц
тренировки – и научишься думать как он, чтобы выжимка была точнее и охватывала
то, что нужно. По аналогии с сео-оптимизаторами, которые по множеству действий
угадывали алгоритм ранжирования и пусть худо-бедно, но проталкивали одни сайты
выше других.</p>

<p>Сегодня многие люди считают ИИ-модели богом из машины. Они доверяют им важные
решения: на кого учиться, куда переехать, как строить отношения. Проблема в том,
что им нельзя показать, из чего складывается ответ модели. В интернете нет
кусочка знаний, который произвели только они. Поэтому не на чем
продемонстрировать случай, о котором я писал: чтобы человек сопоставил свое
мышление и алгоритм.</p>

<p>Если бы такой кусочек был, они бы увидели, как сильно заблуждаются.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/clojure-any-equals/">A fake Clojure Object equals to what you want</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2025-09-11T00:00:00+00:00">
        Sep 11, 2025
    </time>

    <a href="/tag/programming/" rel="tag">programming</a>, <a href="/tag/clojure/" rel="tag">clojure</a>, <a href="/tag/tests/" rel="tag">tests</a>

</div>


            <div class="entry">
                
                    <p>Imagine you write a unit test where you compare two maps:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">is</span><span class="w"> </span><span class="p">(</span><span class="nb">=</span><span class="w"> </span><span class="p">{</span><span class="no">:some</span><span class="w"> </span><span class="p">{</span><span class="no">:nested</span><span class="w"> </span><span class="p">{</span><span class="no">:id</span><span class="w"> </span><span class="n">...</span><span class="p">}}}</span><span class="w">
       </span><span class="p">(</span><span class="nf">get-result</span><span class="p">)))</span><span class="w">
</span></code></pre></div></div>

<p>Turns out, this map has a random UUID deep inside so you cannot blindly compare
them with the “equals” function:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">get-result</span><span class="w"> </span><span class="p">[]</span><span class="w">
  </span><span class="p">{</span><span class="no">:some</span><span class="w"> </span><span class="p">{</span><span class="no">:nested</span><span class="w"> </span><span class="p">{</span><span class="no">:id</span><span class="w"> </span><span class="p">(</span><span class="nf">random-uuid</span><span class="p">)}}})</span><span class="w">

</span><span class="p">(</span><span class="nf">is</span><span class="w"> </span><span class="p">(</span><span class="nb">=</span><span class="w"> </span><span class="p">{</span><span class="no">:some</span><span class="w"> </span><span class="p">{</span><span class="no">:nested</span><span class="w"> </span><span class="p">{</span><span class="no">:id</span><span class="w"> </span><span class="n">???</span><span class="p">}}}</span><span class="w">
       </span><span class="p">(</span><span class="nf">get-result</span><span class="p">)))</span><span class="w">
</span></code></pre></div></div>

<p>This won’t work because the nested <code class="language-plaintext highlighter-rouge">:id</code> field will is random every time.</p>

<p>What to do? Most often, people use libraries for fuzzy matching, DSLs,
etc. Well, a single case still doesn’t mean you should drag in another
library. Apparently, it could be solved with a dummy object that equals to any
UUID:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">def</span><span class="w"> </span><span class="n">any-uuid</span><span class="w">
  </span><span class="p">(</span><span class="nf">reify</span><span class="w"> </span><span class="n">Object</span><span class="w">
    </span><span class="p">(</span><span class="nf">equals</span><span class="w"> </span><span class="p">[</span><span class="n">_</span><span class="w"> </span><span class="n">other</span><span class="p">]</span><span class="w">
      </span><span class="p">(</span><span class="nf">uuid?</span><span class="w"> </span><span class="n">other</span><span class="p">))))</span><span class="w">

</span><span class="p">(</span><span class="nb">=</span><span class="w"> </span><span class="n">any-uuid</span><span class="w"> </span><span class="p">(</span><span class="nf">random-uuid</span><span class="p">))</span><span class="w">
</span><span class="n">true</span><span class="w">

</span><span class="p">(</span><span class="nb">=</span><span class="w"> </span><span class="n">any-uuid</span><span class="w"> </span><span class="mi">42</span><span class="p">)</span><span class="w">
</span><span class="n">false</span><span class="w">
</span></code></pre></div></div>

<p>Now replace the value in your map, and the test will pass:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">is</span><span class="w"> </span><span class="p">(</span><span class="nb">=</span><span class="w"> </span><span class="p">{</span><span class="no">:some</span><span class="w"> </span><span class="p">{</span><span class="no">:nested</span><span class="w"> </span><span class="p">{</span><span class="no">:id</span><span class="w"> </span><span class="n">any-uuid</span><span class="p">}}}</span><span class="w">
       </span><span class="p">(</span><span class="nf">get-result</span><span class="p">)))</span><span class="w">
</span></code></pre></div></div>

<p>It works the same for numbers:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">def</span><span class="w"> </span><span class="n">any-number</span><span class="w">
  </span><span class="p">(</span><span class="nf">reify</span><span class="w"> </span><span class="n">Object</span><span class="w">
    </span><span class="p">(</span><span class="nf">equals</span><span class="w"> </span><span class="p">[</span><span class="n">_</span><span class="w"> </span><span class="n">other</span><span class="p">]</span><span class="w">
      </span><span class="p">(</span><span class="nf">number?</span><span class="w"> </span><span class="n">other</span><span class="p">))))</span><span class="w">

</span><span class="p">(</span><span class="nb">=</span><span class="w"> </span><span class="n">any-number</span><span class="w"> </span><span class="mi">42</span><span class="p">)</span><span class="w">
</span><span class="n">true</span><span class="w">

</span><span class="p">(</span><span class="nb">=</span><span class="w"> </span><span class="n">any-number</span><span class="w"> </span><span class="mi">-99</span><span class="p">)</span><span class="w">
</span><span class="n">true</span><span class="w">
</span></code></pre></div></div>

<p>The only caveat is, this dummy object must be the first one in the <code class="language-plaintext highlighter-rouge">=</code>
function. It does equal to any object on the left but the opposite is false: a
normal UUID doesn’t equal to a fake UUID.</p>

<p>For the rest, it short and trivial, and no other libraries are needed.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/sql-created-at/">Индекс по created_at</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2025-08-15T00:00:00+00:00">
        Aug 15, 2025
    </time>

    <a href="/tag/programming/" rel="tag">programming</a>, <a href="/tag/sql/" rel="tag">sql</a>

</div>


            <div class="entry">
                
                    <p>Маленькая техническая заметка про SQL. Такая: если в таблице есть поле
<code class="language-plaintext highlighter-rouge">created_at</code>, по нему должен быть btree-индекс. Если поля нет, его нужно
добавить вместе с индексом.</p>

<p>Объяснение следующее. Срез по времени – это самая частая задача в работе с
данными. Если не фиксировать время события, это обернется бедой.</p>

<p>Эти два дня я отлаживал серьезный баг, о котором напишу отдельно. Но попутно
выяснилось следующее. В базе данных есть таблица, которая фиксирует изменения
сущностей. В ней один индекс – айди сущности. Это хорошо, если требуется
расследовать конкретную сущность. Но оказалось, пострадало их много за
определенный период, так что этот индекс бесполезен.</p>

<p>Я хотел выбрать события по времени, благо интервал небольшой, всего неделя. Но
оказалось, что у поля <code class="language-plaintext highlighter-rouge">created_at</code> нет индекса. В таблице 400 миллионов записей,
и отбор по нему работает страшно медленно: <code class="language-plaintext highlighter-rouge">limit 10</code> занимает 8 минут.</p>

<p>Добавить индекс в такую таблицу – страшно дорого. Это нужно делать ночью на
выходных, кто на это пойдет?</p>

<p>Скажете: используй <code class="language-plaintext highlighter-rouge">create index CONCURRENTLY</code>. А я скажу, что конкурентный
индекс не работает для партицированных таблиц, а наша именно такая. Нужно делать
либо обычный индекс в лоб, либо создавать конкурентный индекс для каждой
партиции. Все сложно.</p>

<p>По факту таблица превратилась в черную дыру: в нее все входит, но ничего не
выходит. Она беспомощна из-за своей массы. Разве что можно найти данные по
конкретной сущности, но этого часто недостаточно.</p>

<p>Время – ключевой фактор при расследовании инцидентов. Даже если в таблице
миллиард записей, границы времени известны хотя бы примерно. Можно выбрать срез
и дальше обработать его вручную. А если индекса нет, мы лишили себя такой
возможности. Сами себе Буратины.</p>

<p>Поэтому – индекс по времени должен быть всегда и обязательно.</p>

                
            </div>

        </li>
        
    </ul>

    <h4>
        
        <a href="/page2" class="previous">&larr;</a>
        
        <span class="page_number ">Страница 3 из 101</span>
        
        <a href="/page4" class="next">&rarr;</a>
        
    </h4>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>Ivan Grishaev's blog</li>
          <li><a href="mailto:ivan@grishaev.me">ivan@grishaev.me</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
            <li><a href="https://github.com/igrishaev">GitHub</a></li>
            <li><a href="https://t.me/igrishaev_blog">Telegram</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>Writing on programming, education, books and negotiations.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
