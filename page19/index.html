<!DOCTYPE html>
<html lang="ru">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Ivan Grishaev's blog</title>
  <meta name="description" content="Writing on programming, education, books and negotiations.
">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/custom.css">
  <link rel="canonical" href="https://grishaev.me/page19/">
  <link rel="alternate" type="application/rss+xml" title="Ivan Grishaev's blog" href="https://grishaev.me/feed.xml">

  <link rel="shortcut icon" type="image/x-icon" href="/assets/static/favicons/favicon.ico">

  <script type="text/javascript" src="/assets/typo.js"></script>

</head>


  <body>
    <header class="site-header">

    <div class="wrapper flex-container">

        <div>
            <a href="/">
                <img id="avatar" src="/assets/static/avatar.jpg" alt="Ivan Grishaev">
            </a>
        </div>

        <div class="flex-container-vert" style="margin-left: 15px; width: 80%">

            <div class="flex-container full-width">
                <p style="margin-bottom: 5px">Ivan Grishaev's blog</p>
                <div class="flex-huge"></div>
                <div >
<form id="search-form"
      target="_blank"
      style="display: inline"
      method="get"
      action="https://www.google.com/search">

    <input name="sitesearch"
           value="grishaev.me"
           type="hidden">

    <input type="text"
           required="required"
           name="q"
           placeholder="Google search..."
           autocomplete="off">

    <button style="border: none; background-color: transparent; cursor: pointer;"
            type="submit">&#x1f50d;</button>

</form>
</div>
            </div>

            <p><small>Writing on programming, education, books and negotiations.
</small></p>

            <div class="flex-container">
                <a class="menu-item" href="/">Home</a>
                <a class="menu-item" href="/about/">About</a>
                <a class="menu-item" href="/bookshelf/">Bookshelf</a>
                <a class="menu-item" href="/feed.xml">RSS</a>
            </div>

            <div class="flex-container">
                <a class="menu-item minor" href="/tag/clojure/">Clojure</a>
                <a class="menu-item minor" href="/tag/emacs/">Emacs</a>
                <a class="menu-item minor" href="/tag/python/">Python</a>
                <a class="menu-item minor" href="/tag/programming/">Programming</a>
                <a class="menu-item minor" href="/interview/">Interview</a>
                <a class="menu-item minor" href="/video/">Video</a>
            </div>

            <div class="flex-container">
                <a class="menu-item minor hl" href="/clojure-in-prod/">Книга «Clojure на производстве»</a>
            </div>

            <div class="flex-container">
                <a class="menu-item minor hl" href="/clojure-in-prod-2/">Книга «Clojure на производстве», второй том</a>
            </div>

        </div>
    </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="home">

    <ul class="post-list">
        
        <li>

            <h2>
                <a class="post-link" href="/en/mask/">The Mask library for Clojure</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2023-03-04T00:00:00+00:00">
        Mar 4, 2023
    </time>

    <a href="/tag/clojure/" rel="tag">clojure</a>, <a href="/tag/programming/" rel="tag">programming</a>

</div>


            <div class="entry">
                
                    <p><em>(This is a copy of the readme file from the repository.)</em></p>

<p><a href="https://github.com/igrishaev/mask">Mask</a> is a small library to prevent secrets from being logged, printed or leaked
in any similar way. Ships tags for Clojure, EDN and Aero.</p>

<p>Why? Because I’ve been in such a situation three times, namely:</p>

<ul>
  <li>We don’t mask the secrets.</li>
  <li>Someone logs the entire config.</li>
  <li>Secrets have leaked!</li>
  <li>Rotate all the keys, tokens, etc.</li>
  <li>Change the team and face the same.</li>
</ul>

<p>This library is an attempt to break this vicious circle.</p>

<h3 id="installation">Installation</h3>

<p>Leiningen/Boot:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="n">com.github.igrishaev/mask</span><span class="w"> </span><span class="s">"0.1.0"</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<p>Clojure CLI/deps.edn:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">com.github.igrishaev/mask</span><span class="w"> </span><span class="p">{</span><span class="no">:mvn/version</span><span class="w"> </span><span class="s">"0.1.0"</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="usage">Usage</h3>

<p>The <code class="language-plaintext highlighter-rouge">mask.core</code> namespace provides <code class="language-plaintext highlighter-rouge">mask</code> and <code class="language-plaintext highlighter-rouge">unmask</code> functions. Pass a value
to <code class="language-plaintext highlighter-rouge">mask</code> to make it safe for logging or printing in REPL:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nb">in-ns</span><span class="w"> </span><span class="ss">'mask.core</span><span class="p">)</span><span class="w">
</span><span class="o">#</span><span class="nb">namespace</span><span class="p">[</span><span class="n">mask.core</span><span class="p">]</span><span class="w">

</span><span class="p">(</span><span class="k">def</span><span class="w"> </span><span class="n">-m</span><span class="w"> </span><span class="p">(</span><span class="nf">mask</span><span class="w"> </span><span class="s">"Secret123"</span><span class="p">))</span><span class="w">

</span><span class="n">-m</span><span class="w">
</span><span class="n">&lt;&lt;</span><span class="w"> </span><span class="n">masked</span><span class="w"> </span><span class="n">&gt;&gt;</span><span class="w">

</span><span class="p">(</span><span class="nb">str</span><span class="w"> </span><span class="s">"The password is "</span><span class="w"> </span><span class="n">-m</span><span class="p">)</span><span class="w">
</span><span class="s">"The password is &lt;&lt; masked &gt;&gt;"</span><span class="w">
</span></code></pre></div></div>

<p>Masking is idempotent meaning that you can mask the same value multiple times
but the result will be one-level masked value:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nb">-&gt;</span><span class="w"> </span><span class="n">-m</span><span class="w"> </span><span class="n">mask</span><span class="w"> </span><span class="n">mask</span><span class="w"> </span><span class="n">mask</span><span class="p">)</span><span class="w">
</span><span class="n">&lt;&lt;</span><span class="w"> </span><span class="n">masked</span><span class="w"> </span><span class="n">&gt;&gt;</span><span class="w">
</span></code></pre></div></div>

<p>To release a value from a mask, <code class="language-plaintext highlighter-rouge">unmask</code> it:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">unmask</span><span class="w"> </span><span class="n">-m</span><span class="p">)</span><span class="w">
</span><span class="s">"Secret123"</span><span class="w">
</span></code></pre></div></div>

<p>Unmasking is idempotent a well:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(-&gt; -m unmask unmask unmask)
"Secret123"
</code></pre></div></div>

<p>Note: the library treats <code class="language-plaintext highlighter-rouge">nil</code> as an error value that cannot be masked. You’ll
get an exception:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">mask</span><span class="w"> </span><span class="n">nil</span><span class="p">)</span><span class="w">
</span><span class="n">Execution</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="p">(</span><span class="nf">IllegalArgumentException</span><span class="p">)</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">...</span><span class="w"> </span><span class="p">(</span><span class="nf">core.clj</span><span class="no">:34</span><span class="p">)</span><span class="nb">.</span><span class="w">
</span><span class="n">Cannot</span><span class="w"> </span><span class="n">mask</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">nil</span><span class="w"> </span><span class="n">value</span><span class="w">
</span></code></pre></div></div>

<p>Masking an empty value signals you’re doing something wrong. Most likely you’ve
missed a corresponding key or an environment variable. Thus, the further work
makes no sense.</p>

<h4 id="spec">Spec</h4>

<p>The <code class="language-plaintext highlighter-rouge">mask.spec</code> module provides the <code class="language-plaintext highlighter-rouge">::mask</code> spec that checks if a value is
really masked. An example from the tests:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">[</span><span class="n">config</span><span class="w">
      </span><span class="p">{</span><span class="no">:username</span><span class="w"> </span><span class="s">"Ivan"</span><span class="w">
       </span><span class="no">:password</span><span class="w"> </span><span class="o">#</span><span class="n">mask</span><span class="w"> </span><span class="s">"secret"</span><span class="p">}]</span><span class="w">

  </span><span class="p">(</span><span class="nf">is</span><span class="w"> </span><span class="p">(</span><span class="nf">s/valid?</span><span class="w"> </span><span class="no">::config</span><span class="w"> </span><span class="n">config</span><span class="p">)))</span><span class="w">

</span><span class="c1">;; true</span><span class="w">
</span></code></pre></div></div>

<h4 id="clojure-tag">Clojure tag</h4>

<p>The built-in <code class="language-plaintext highlighter-rouge">#mask</code> tag wraps any value with a mask:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="no">:token</span><span class="w"> </span><span class="o">#</span><span class="n">mask</span><span class="w"> </span><span class="s">"abc123"</span><span class="w"> </span><span class="no">:password</span><span class="w"> </span><span class="s">"SecretABC"</span><span class="p">}</span><span class="w">

</span><span class="p">{</span><span class="no">:token</span><span class="w"> </span><span class="n">&lt;&lt;</span><span class="w"> </span><span class="n">masked</span><span class="w"> </span><span class="n">&gt;&gt;,</span><span class="w"> </span><span class="no">:password</span><span class="w"> </span><span class="s">"SecretABC"</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h4 id="edn-tag">EDN tag</h4>

<p>There is a <code class="language-plaintext highlighter-rouge">reader-edn</code> function that acts like an EDN reader for the same tag:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">[</span><span class="n">source</span><span class="w"> </span><span class="p">(</span><span class="nb">-&gt;</span><span class="w"> </span><span class="s">"{:foo #mask 42}"</span><span class="p">)]</span><span class="w">
  </span><span class="p">(</span><span class="nf">edn/read-string</span><span class="w"> </span><span class="p">{</span><span class="no">:readers</span><span class="w"> </span><span class="p">{</span><span class="ss">'mask</span><span class="w"> </span><span class="n">reader-edn</span><span class="p">}}</span><span class="w">
                   </span><span class="n">source</span><span class="p">))</span><span class="w">

</span><span class="c1">;; {:foo &lt;&lt; masked &gt;&gt;}</span><span class="w">
</span></code></pre></div></div>

<h4 id="aero-tag">Aero tag</h4>

<p>To extend Aero with the <code class="language-plaintext highlighter-rouge">#mask</code> tag, import the <code class="language-plaintext highlighter-rouge">mask.aero</code> namespace:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">require</span><span class="w"> </span><span class="ss">'mask.aero</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Then read a config with the tag:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">;; config.edn</span><span class="w">
</span><span class="p">{</span><span class="no">:foo</span><span class="w"> </span><span class="o">#</span><span class="n">mask</span><span class="w"> </span><span class="o">#</span><span class="n">env</span><span class="w"> </span><span class="s">"SOME_PASSWORD"</span><span class="p">}</span><span class="w">

</span><span class="c1">;; code</span><span class="w">
</span><span class="p">(</span><span class="nf">aero/read-config</span><span class="w"> </span><span class="p">(</span><span class="nf">io/resource</span><span class="w"> </span><span class="s">"config.edn"</span><span class="p">))</span><span class="w">

</span><span class="c1">;; {:foo &lt;&lt; masked &gt;&gt;}</span><span class="w">
</span></code></pre></div></div>

<p>The Aero dependency is not included. You’ve got to provide it by your own.</p>

<p><em>Ivan Grishaev, 2023</em></p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/hey/">Эй</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2023-03-04T00:00:00+00:00">
        Mar 4, 2023
    </time>

    <a href="/tag/life/" rel="tag">life</a>, <a href="/tag/internet/" rel="tag">internet</a>

</div>


            <div class="entry">
                
                    <p>Почему-то большие компании не могут нормально составить письмо на русском. Будут
ошибки или нелепые обороты. Сегодня получил письмо от Дискорда, где ко мне
обращаются на “эй”:</p>

<p><img src="/assets/static/aws/hey/1.png" /></p>

<p>Сам ты эй! Понятно, это дурацкая калька с английского hey. Почему не нашли
русского чувака, чтобы показать ему перевод перед отправкой? В больших фирмах
всегда найдется русский, украинец, поляк или венгр. Даже если он кодер, пусть
посмотрит. Он скажет, что обращение на эй в русском не только неестественно, но
даже грубо.</p>

<p>Жаль, не сохранил скриншоты Гугла и Godaddy. Иной раз такую дичь присылают, что
хватаешься за волосы. Сейчас реже, но все равно.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/sh2-remake/">Silent Hill 2</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2023-02-24T00:00:00+00:00">
        Feb 24, 2023
    </time>

    <a href="/tag/games/" rel="tag">games</a>, <a href="/tag/sh2/" rel="tag">sh2</a>

</div>


            <div class="entry">
                
                    
<p>Появился трейлер переиздания <a href="https://ru.wikipedia.org/wiki/Silent_Hill_2">Silent Hill 2</a> — одной из главных игр моего детства. Наверняка вы его смотрели, но вот на всякий случай:</p>

<iframe width="772" height="480" src="https://www.youtube.com/embed/pyC_qiW_4ZY" title="Silent Hill 2 - Teaser Trailer | PS5 Games" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen=""></iframe>

<p>Графика выше всяких похвал, сказать нечего. Однако у меня вопрос — что не так с этим трейлером? Не проматывая вниз, постарайтесь подумать.</p>


                    <p><a href="/sh2-remake/">Read more &rarr;</a></p>
                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/holidays/">Праздники</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2023-02-22T00:00:00+00:00">
        Feb 22, 2023
    </time>

    <a href="/tag/life/" rel="tag">life</a>

</div>


            <div class="entry">
                
                    <p>Не люблю праздники посреди недели. Скажем, по четвергам я хожу в зал, но завтра он не работает. Что мешает администратору прийти и открыть дверь, непонятно. И вообще — чем этот четверг отличается от других четвергов? Ничем, кроме дурацкого обычая, что в какой-то день вместо работы валяют дурака.</p>

<p>Хотел переставить на среду, но оказывается, что у жены на работе поменяли смены из-за предпраздничного дня. У старших детей укороченные уроки, и нужно ехать за ними раньше обычного.</p>

<p>Вот и думаешь: стоило ли переставлять кучу дел из-за одного праздника? Кому вообще всрались эти 23 Февраля, 8 Марта, Дни единства и все такое? Кто эти люди, что их празднуют? И как?</p>

<p>Выгоду от праздников получают только дети, потому что не надо идти в школу. Взрослые, даже если они бюджетники, должны что-то переставлять и отрабатывать, что еще то мучение и нарушение ритма.</p>

<p>Считаю, любой праздник должен автоматом переноситься на ближайший выходной —
празднуй сколько хочешь, а другим не мешай работать. Исключение из этого правило
одно — Новый год, его празднуют строго по календарю. Но это и так очевидно.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/en/dynamodb/">The DynamoDB library for Clojure</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2023-02-15T00:00:00+00:00">
        Feb 15, 2023
    </time>

    <a href="/tag/clojure/" rel="tag">clojure</a>, <a href="/tag/programming/" rel="tag">programming</a>

</div>


            <div class="entry">
                
                    <p><em>(This is a copy of the readme file from the repository.)</em></p>

<p><a href="https://github.com/igrishaev/dynamodb">This library</a> is a driver for <a href="https://aws.amazon.com/dynamodb/">DynamoDB</a> written in pure
Clojure. No AWS SDK, lightweight dependencies, GraalVM-friendly.</p>

<h3 id="benefits">Benefits</h3>

<ul>
  <li>Free from AWS SDK. Everything is implemented with pure JSON + HTTP.</li>
  <li>Quite narrow dependencies: just <a href="https://github.com/http-kit/http-kit">HTTP Kit</a> and <a href="https://github.com/dakrone/cheshire">Cheshire</a>.</li>
  <li>Compatible with <a href="https://www.graalvm.org/22.0/reference-manual/native-image/">Native Image</a>! Thus, easy to use as a binary
file in AWS Lambda.</li>
  <li>Clojure-friendly: supports fully qualified keyword attributes and handles
properly them in SQL expressions.</li>
  <li>Both encoding &amp; decoding are extendable with protocols &amp; multimethods.</li>
  <li>Raw API access for special cases.</li>
  <li>Specs for better input validation.</li>
  <li>Compatible with <a href="https://cloud.yandex.com/en-ru/services/ydb">Yandex DB</a>.</li>
</ul>


                    <p><a href="/en/dynamodb/">Read more &rarr;</a></p>
                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/wiped/">Удалил</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2023-02-13T00:00:00+00:00">
        Feb 13, 2023
    </time>

    <a href="/tag/life/" rel="tag">life</a>, <a href="/tag/telegram/" rel="tag">telegram</a>

</div>


            <div class="entry">
                
                    <p>Как и многие, я храню всякий хлам в канале Saved Messages в Телеграме: ссылки, идеи, напоминалки. Иногда перебрасываю креды к сервисам, если лень это делать через гист или менеджер паролей.</p>

<p>Только что случилась забавная вещь. Удаляя сообщение из Saved Messages, не заметил, как кликнул по каналу и удалил его. Нажимая на подтверждение, подумал, что диалог какой-то странный, но палец было не остановить. Вжух — и канала не стало со всеми сообщениями.</p>


                    <p><a href="/wiped/">Read more &rarr;</a></p>
                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/no-bash/">Баш-скрипты</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2023-02-09T00:00:00+00:00">
        Feb 9, 2023
    </time>

    <a href="/tag/programming/" rel="tag">programming</a>, <a href="/tag/bash/" rel="tag">bash</a>

</div>


            <div class="entry">
                
                    <p>Программист должен помнить не только о вещах, которые нужно делать. Обратное тоже важно: запоминайте, чего делать не нужно. Плохой опыт — тоже опыт. Он поможет не упасть там, где спотыкаются другие.</p>

<p>Одна из таких вещей — скрипты на баше. Я взял за правило: никаких баш-скриптов. Когда хочется написать на нем что-то длиннее пяти строк, закрывайте ноут и идите за молоком. Потом вернитесь и сделайте правильно — то есть без баша.</p>

<p>Шелл-скрипты хрупки и тяжелы в поддержке. Их трудно читать и отлаживать. Они опираются на сторонние утилиты, которые где-то есть, а где-то нет. Поведение зависит от платформы и флагов.</p>

<p><strong>Шелл — это плавное погружение в смоляную яму, из которой не выбраться.</strong> Год-другой — и скрипт занимает экраны, никто не знает, как он работает. Лучше не трогать.</p>

<p>Замечу, что сказанное не относится к случаям, когда вызывают несколько утилит, соединяя их каналы, например:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> ps aux | <span class="nb">grep </span>java
</code></pre></div></div>

<p>Это совершенно нормально. Я имею в виду скрипты, где шелл выступает в роли настоящего языка программирования, то есть:</p>

<ul>
  <li>активно используются переменные;</li>
  <li>циклы, ветвления, переходы;</li>
  <li>объявление и вызов функций;</li>
  <li>импорт других скриптов.</li>
</ul>

<p>Все вместе это становится таким адом, что лучше уволиться, чем ворошить осиное гнездо (или, в английской идиоме — тараканье).</p>

<p>Кусок скрипта откуда-то из интернета:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">no_more_args</span><span class="o">=</span>1 <span class="p">;</span>
  -<span class="k">*</span><span class="o">)</span>
   <span class="k">if</span> <span class="o">[</span> <span class="s2">"x</span><span class="nv">$no_more_args</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"x1"</span> <span class="o">]</span> <span class="p">;</span>
<span class="k">then
    </span><span class="nb">dirs</span><span class="o">[</span><span class="nv">$num_dirs</span><span class="o">]=</span><span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span><span class="p">;</span>
    <span class="nb">let</span> <span class="s2">"num_dirs++"</span>
<span class="k">else
 if</span> <span class="o">[[</span> <span class="s2">"x</span><span class="k">${</span><span class="nv">1</span>:1:1<span class="k">}</span><span class="s2">"</span> <span class="o">!=</span> <span class="s2">"x-"</span> <span class="o">&amp;&amp;</span> <span class="s2">"x</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">=</span>~ <span class="s2">"x-.*a.*"</span> <span class="o">]]</span> <span class="p">;</span>
 <span class="k">then
     </span><span class="nv">no_dots</span><span class="o">=</span>0<span class="p">;</span>
 <span class="k">fi
    </span><span class="nv">opts</span><span class="o">=</span><span class="s2">"</span><span class="nv">$opts</span><span class="s2"> </span><span class="nv">$1</span><span class="s2">"</span><span class="p">;</span>
   <span class="k">fi</span>
  <span class="k">*</span><span class="o">)</span>
   <span class="nb">dirs</span><span class="o">[</span><span class="nv">$num_dirs</span><span class="o">]=</span><span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span><span class="p">;</span>
   <span class="nb">let</span> <span class="s2">"num_dirs++"</span>
 <span class="k">esac
 </span><span class="nb">shift</span>
</code></pre></div></div>

<p>Для меня он выглядит как китайская грамота. Что такое <code class="language-plaintext highlighter-rouge">[ "x$no_more_args" = "x1" ]</code>? Что такое [<code class="language-plaintext highlighter-rouge">[ "x${1:1:1}" != "x-" &amp;&amp; "x$1" =~ "x-.*a.*" ]]</code>? Как это читать и поддерживать?</p>

<p>Во времена Unix шелл-скрипты были прорывом, с этим никто не спорит. Однако время не стоит на месте, и созданы более удобные инструменты. Вот несколько примеров.</p>

<p>Если с проектом нужно делать много мелких вещей, <a href="/makefiles/">подойдет make</a>. Напомню, make — это набор именованных действий. Кроме вызова по отдельности их можно комбинировать, например собрать бек и фронт за раз. В любом проекте я завожу Makefile и помещаю туда все, что придет в голову, например:</p>

<ul>
  <li>сборку проекта</li>
  <li>прогон тестов и миграций</li>
  <li>очистку временных файлов и папок</li>
  <li>запуск и остановку Докера</li>
  <li>много чего еще</li>
</ul>

<p>Пример большого Make-файла можно посмотреть в <a href="https://github.com/igrishaev/clj-book/blob/master/Makefile">репозитории с книгой</a>.</p>

<p>Далее: если нужны действительно сложные скрипты, возьмите Питон. Даже на  голом Питоне писать в разы легче, чем на баше. Для Питона созданы библиотеки с изящным API, чтобы вызывать процессы, двигать файлы и прочее.</p>

<p>Да, Питон требует окружения. Однако если у вас сложные скрипты, он окупается.  Установку Питона и его барахла поместите в Makefile.</p>

<p>Для управления машинами лучше писать плейбуки на YAML. Кроме Ansible, полно других утилит для конфигураций.</p>

<p>Любые действия лучше задавать декларативно. Если вы пишете скрипты, скорей всего, вы не знаете о нужной утилите.</p>

<p>Еще одна интересная мысль — генерация шелла из другого языка. Подобно тому, как из TypeScript производят JavaScript, можно произвести шелл из условного Лиспа или Питона. Когда я работал в Exoscale, у нас была библиотека для генерации шелла на Кложе. Я ей не пользовался, но само наличие говорит о том, что в руководстве понимали риски ручного скриптописания.</p>

<p>Припомню только один случай, когда от шелла не отвертишься — это докер-контейнеры. Кроме голой операционки там ничего нет, поэтому сжимаешь булки и пишешь на шелле. Тянуть мегабайты Питона, конечно, будет плохим вариантом.</p>

<p>В общем, чем раньше вы замените шелл-скрипт на что-то профильное, тем лучше.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/thank-you-for/">Спасибо, что</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2023-02-01T00:00:00+00:00">
        Feb 1, 2023
    </time>

    <a href="/tag/life/" rel="tag">life</a>

</div>


            <div class="entry">
                
                    <p>Кто читает Ильяхова, знает про “заранее спасибо”. Это когда пытаются манипулировать — свалить задачу, важное дело — и как бы проявляют вежливость.</p>

<p>Сделай до понедельника, заранее спасибо. Напиши за ночь, заранее спасибо. Заполни сто полей, подтверди почту и телефон, заранее спасибо. Словом, все то, после чего думаешь “нет уж, спасибо”.</p>

<p>В определенных кругах “заранее спасибо” стало мемом. Например, обращаешься за помощью и в шутку добавляешь эту фразу. Только важно убедиться, что человек на том конце понимает юмор.</p>

<p>У “заранее спасибо” есть другая форма: “спасибо, что”. Как и в случае с оригиналом, она вызывает одну мысль — я и не собирался. Лучше объясни, что делать, а не благодари.</p>

<p>— Спасибо, что закрыли дверь!</p>

<p>— Поставь доводчик.</p>

<p>— Спасибо, убрали за собой!</p>

<p>— Что убирать? Куда убирать? Как быть с жидкостями?</p>

<p>Оказалось, “спасибо, что” есть и в английском языке. Когда-то давно я переписывался с коллегой, и он сказал “…and thank you for doing bla-bla-bla”. Я слегка удивился: вроде ничего не делал, а коллега благодарит. Начал было объяснять, но потом понял — это просто формулировка. Поручение в замысловатой форме, а thank you для того, чтобы я не обиделся. Типа такая вежливость. Bla-bla-bla я в итоге сделал, но душок от манеры речи остался.</p>

<p>Надо ли говорить, что подобные вещи хоть в русском, хоть в английском языке смотрятся плохо. Общее между ними одно — манипуляция. Просьбу всегда следует выражать явно. Затасканная фраза вместо прикрытия дает фальшь.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/interview-today/">Собеседование сегодня</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2023-01-30T00:00:00+00:00">
        Jan 30, 2023
    </time>

    <a href="/tag/interview/" rel="tag">interview</a>

</div>


            <div class="entry">
                
                    <p>Много лет назад я работал в Датаарте, писал код на Питоне. В какой-то момент мне доверили собеседовать кандидатов, и я заинтересовался темой. Смотрел видео, читал материалы и писал в блог по тегу interview. Считал, что хорошо разбираюсь в собеседованиях и все такое.</p>

<p>В выходом на удаленку я перестал собеседовать. Так складывается, что я пишу код, а решения о найме принимают другие люди. К тому же со временем мои взгляды на собеседование сильно изменились. Ниже — мысли о том, как я вижу собеседование сегодня. Как бы я собеседовал кандидата в свою воображаемую фирму, которой, конечно, у меня нет и вряд ли когда-то будет.</p>

<p>Итак, цель собеседования в том, чтобы определить, подходит кандидат или нет. Однако редко кто из собеседующих понимает суть процесса. Кандидату задают расплывчатые вопросы, ответы на которые прикидывают “на глазок”. Часто бывает, что один неудачный ответ затмевает остальные и собеседующий помнит только его. Или наоборот: кандидат не умеет писать код, но понравился эйчару манерой общения.</p>

<p>Мне кажется, на собеседовании должна быть только конкретика. Вопросы про слабости и неудачи, видение себя через пять лет и прочее я считаю дурным тоном. Сюда же относятся расплывчатые технические вопросы, например сравнение архитектур, Linux vs Windows и другие темы, где главное — как подвешен язык.</p>

<p>На предпоследнем собеседовании меня спросили, как работает компьютер. Я наплел всякую лажу про регистры, сумматоры и прерывания процессора, переходы и вот это все. Прошел (хотя не взяли по особым причинам). Но если бы не наплел, что бы это изменило?</p>

<p>На последнем собеседовании спросили, какую проблему в айти я бы решил, если б имел неограниченные ресурсы. Тоже наплел ахинею про зависимости, пакеты и прочее. Прошел, вот сижу и пишу на Кложе. Спрашивается, если бы не наплел, хуже бы тогда писал?</p>

<p>Еще одна категория вопросов, которые не стоит задавать — это родимые травмы языков. Например, что получится, если сложить объект и массив в Javascript? Не заглядывая в консоль Хрома, подумайте и объясните, какой будет результат и почему не иначе:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{}</span> <span class="o">+</span> <span class="p">{}</span>
</code></pre></div></div>

<p>Если вы знали заранее, это круто. Когда-то я тоже знал, но потом выкинул из головы, потому что понял: если на вход подать мусор, получим мусор. Ни к чему хранить в памяти подобные рецепты и делать мозг окружающим.</p>

<p>Приведу пример из Python, который задавал всем кандидатам на этот язык. Предположим, нужна холостая лямбда, которая не делает ничего. Можно ли описать ее как в коде ниже и что случиться, если его запустить?</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">nope</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="k">pass</span>
</code></pre></div></div>

<p>Другой вариант этой задачи: лямбда, которая всегда бросает исключения:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">riser</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="k">raise</span> <span class="nb">Exception</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</code></pre></div></div>

<p>Прежде чем читать далее, предлагаю подумать и вам.</p>

<p>Ответ: код не запустится из-за ошибки синтаксиса. Анонимная функция в Питоне устроена так, что в теле может быть только выражение. В нашем случае <code class="language-plaintext highlighter-rouge">pass</code> и <code class="language-plaintext highlighter-rouge">raise</code> — это операторы, а не выражения, отсюда ошибка компиляции. Чтобы первая лямбда работала, нужно заменить pass на None.</p>

<p>Разумеется, ни один кандидат не ответил без подсказок, а я гордился, что знаю такое поведение. Хотя очевидно, это бред: что мешает поправить компилятор так, чтобы <code class="language-plaintext highlighter-rouge">pass</code> в лямбде возвращал <code class="language-plaintext highlighter-rouge">None</code>? Это дело нескольких строк, просто никому нет дела. Поэтому не парьте мозги окружающим.</p>

<p>В крупные компании, куда стоят толпы народу, практикуют метод “нам не нужны неудачники” из известного анекдота. Не смог перестроить красно-чёрное дерево на бумаге? Пошел вон. И неважно, что в будущем будешь перекладывать протобуфы из Кафки в базу — нужно как-то отсеять желающих. Эйчаров на всех не хватает, а искусственный интеллект, как обычно, заработает не сейчас, а в скором будущем (сейчас он работает, но неправильно: выбирает белых образованных мужчин).</p>

<p>Плохи те собеседования, где предлагают решить одну сложную задачу. Обычно она требует концентрации и гугления алгоритмов, что запрещено форматом интервью. Если добавить сюда стресс и неидеальную связь, станет ясно: задача служит скорее фильтром неудачника из прошлого абзаца.</p>

<p>Знакомый собеседовался в Яндекс на высокую должность. Архимаг по алгоритмам дал задачу на поиск строки с мудреными ограничениями. Главный критерий был в том, чтобы решить за O(N), а все очевидные решения давали квадрат. Эту задачу мы решали всем чатом, но так и не нашли ответа с O(N). Должности в Яндексе знакомый не получил.</p>

<p>Оглядываясь на этот эпизод, пытаюсь понять, какой в этом смысл? Зачем мучить человека одной задачей в течение часа? Разве сотрудник Яндекса работает в таких же условиях? — его заводят в комнату на час, и если он не найдет алгоритм, увольняют? Уж наверное он общается с коллегами, ходит в курилку и все такое. Почему кандидат, который был в шаге от решения, не имел возможности даже пройтись по комнате? Все тот же критерий неудачника.</p>

<p>Требовать от кандидата решить задачу на время значит поставить его в неудобное положение. Каждому известно, что мозг работает в двух режимах: сфокусированном и рассеянном. Их комбинация и продолжительность зависят от генетики. Возможно, кандидат нашел решение сразу после ответа “мы вам перезвоним”. Может быть, ему нужно сходить до туалета, чтобы смочить лицо. Или в магазин за молоком. Может, его знакомый уже решал такую задачу и может за пять минут поделиться опытом. Но собеседующего это не волнует: часы затрекал, таску закрыл.</p>

<p>Бинарная оценка — решил/не решил — по своей сути не отличается от оценки по размеру груди, знаку зодиака или цвету волос кандидата. Так можно, если вы условный Яндекс. Но важно понимать, что в основе этой градации лежит дурацкий принцип и пренебрежение к людям.</p>

<p>Правильным — хотя скорее, более нравственным — способом будет дать простую задачу и постепенно усложнять ее. Под усложнением я имею в виду постепенный охват смежных тем. От написания кода перейти к оценке алгоритма, поиску ошибок, тестам и их запуску. С таким подходом видны навыки кандидата и его потенциальный грейд.</p>

<p>На роль усложняемой задачи подходит всем известный FizzBuzz. И хотя многие о нем слышали, редкий кандидат решит его без ошибок. Подвох FizzBuzz в том, что, как правило, кандидат пишет логику как слышит, то есть проверяет сперва на 3, потом на 5, а затем на оба числа:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">101</span><span class="p">):</span>
    <span class="k">elif</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Fizz"</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Buzz"</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"FizzBuzz"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</code></pre></div></div>

<p>Первое же число, которое делится на 3 и 5 — это 15 — даст сбой: для него сработает первая ветка, и вместо FizzBuzz получим Fizz. В этом нет ничего страшного, гораздо важнее, как довести ошибку до кандидата и оценить его действия.</p>

<p>Можно сказать, что в коде ошибка и предложить ее найти. Другой вариант — скинуть выхлоп правильного FizzBuzz и предложить написать тест. Это интересный случай, потому что навык писать тесты обязателен для программиста. Скорей всего, тест вынудит кандидата изменить код, чтобы вместо печати он строил список строк. Продвинутый кандидат перехватит вывод  консоли в файл или поток.</p>

<p>Если кандидат написал FizzBuzz, пусть даже с ошибкой в начале, и покрыл его тестами, поздравляю: это редкий случай. Берите и не спрашивайте о круглых люках, недостатках, хобби и прочей ерунде. Если нужен человек, который хорошо пишет код, и кандидат хорошо пишет код, какие могут быть вопросы?</p>

<p>Дополнительно можно спросить про SQL и оператор JOIN. Если кандидат выбрал пользователей и профили одним запросом с LEFT JOIN, это вообще круто. Отпадают все сомнения.</p>

<p>Если FizzBuzz приелся, замените его на другое задание с подвохом — факториал. Написать его можно сотней способов — apply, loop, recur — и каждый дает пищу для размышлений (например, хвостовая рекурсия: что такое, примеры). Подвох в том, что факториал нуля равен единице, и редкий кандидат помнит об этом. Как и в случае с FizzBuzz, предложите найти ошибку. Как будет лучше ее исправить? Добавить if/else или вести счетчик от нуля? Поправить аккумулятор? И конечно, написать и запустить тесты.</p>

<p>В таких заданиях я смотрю не столько на решение, сколько на принцип работы кандидата. Настроена ли у него среда разработки? Если он претендует на Кложу, а пишет код в блокноте, мягко говоря, это сомнительно. Как он работает с REPL-ом? Как выполняет код из редактора? Как запускает тесты — и пишет ли их в принципе? Простой FizzBuzz даст на порядки больше информации, чем зубодробилка с O(N).</p>

<p>Если вам интересно, моя градация следующая. Не смог написать FizzBuzz или факториал — извини, к нам еще рано. Если смог и исправил ошибку — джун. То же самое плюс варианты решений — мидл. Смог тесты — заявка на сеньора. Смог SQL — дай тебя поцелую!</p>

<p>Просто, линейно. Без круглых люков, ваших слабостей и провалов, кем-видения через пять лет и остального. Да, возможно, кандидат круто играет на гитаре, читает книги на английском и просто хороший человек. Но моя задача взять того, кто пишет хороший код и тесты — и умеет это прямо сейчас, а не обещает выучиться за две недели.</p>

<p>В заключение — краткие тезисы.</p>

<ul>
  <li>От кандидата вас интересует его последний год. Прерывайте, если он рассказывает, как заводил Doom на утюге в 11 лет. Это никому не интересно.</li>
  <li>Программиста берут, чтобы он писал код и тесты. Еще до собеседования попросите кандидата поделиться кодом. Подойдут гитхаб или приватные гисты. Если кода нет вообще никакого, это странно.</li>
  <li>Дайте простую задачу, в которой, тем не менее, легко ошибиться. Оцените, как кандидат найдет ошибку и исправит ее.</li>
  <li>Считаю, что тесты обязательны. Программист, который с ними не знаком, претендует в лучшем случае на мидла.</li>
  <li>Полезно узнать навыки SQL. База встречается почти в каждом проекте, чего не скажешь про Кафки-Редисы. Эти опционально.</li>
</ul>

<p>Как-то так.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/avatar2/">Аватар 2</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2023-01-16T00:00:00+00:00">
        Jan 16, 2023
    </time>

    <a href="/tag/movies/" rel="tag">movies</a>, <a href="/tag/life/" rel="tag">life</a>, <a href="/tag/avatar/" rel="tag">avatar</a>

</div>


            <div class="entry">
                
                    <p>Что ж, сходил я на второй Аватар. Красиво, качество картинки просто космос. Хоть фильм и затянут, есть моменты, когда наслаждаешься кадрами, ни о чем не думая. Качество съемок, рендера, анимации тянет на миллион по какой угодно шкале.</p>

<p>Удивляет другое: если на фильм тратят космические деньги — сотни миллионов долларов, — то почему нельзя написать хороший сценарий? Чтобы он был целостный, а не как лоскутное одеяло — с лишними ответвлениями, забытыми персонажами и слабыми местами. Это правда тяжело понять.</p>

<p>Еще первый Аватар журили за избитый сюжет. Герой попадает к дикарям с корыстными целями, но переходит на их сторону. До какого-то момента он двойной агент, далее его раскрывают и выгоняют. Тогда он находит супер-девайс — меч, эликсир, дракона — и возвращает доверие. Происходит битва, и вождь как нельзя кстати гибнет. Герой становится вождем, получает королевство и царскую дочку.</p>

<p>При всей банальности у этого сюжета неоспоримый плюс — он целостный и законченный. Все персонажи приходят к своему финалу (победа, любовь, поражение), не остается открытых вопросов, внутренний и внешний конфликты решены. Зрители довольные расходятся по домам.</p>

<p>Во втором Аватаре пошли по принципу “добавим больше всего”. Получилось скомканно и путано; возникают вопросы о нестыковках. Перечислю некоторые из них.</p>

<p>В начале фильма показывают сильную женщину, главу поселения. Сразу ясно: она главная, и даже злодей в ее подчинении. При первой встрече она лупит боксерскую грушу, показывая — смотрите, я баба с яйцами. Очевидно, она должна быть в финале, чтобы ответить за вторжение. Что имеем в итоге? Ее показывают пару раз и забывают. Зачем вводить персонажа, если он не доходит до финала и не влияет на сюжет? Банальная глупость.</p>

<p>Далее: злодей, противник героя. Он настолько примитивен, что просто руки опускаются. Едва подорвался с больничной койки, как побежал убивать Джейка. Почему так глупо? Неужели его нисколько не коснулись вопросы самоидентификации: кто я, в каком мире я живу и для чего? Зачем убивать какого-то типа, который не причинил мне вреда? И это при том, что злодей прекрасно понимает — он просто копия того вояки, другое существо со своей волей.</p>

<p>Все списали на то, что он унаследовал воспоминания, плюс добавили сцену с останками на месте сражения из первой части. Но будем откровенны — посыл очень слабый. На базе этих предпосылок можно было бы сделать отличную концовку, кораздо более сложную и филосовскую (см. ниже).</p>

<p>Есть еще один персонаж, за счет которого можно было бы усложнить сюжет — это Паук, человек, который живет с Нави. Это классический двойной агент вроде Маугли — вроде бы свой, но помани пальцем, и он перейдет к врагу. Паренек не сдает Нави явно, но работает против них: учит злодея штучкам и языку, переводит на допросах. Из-за него гибнет старший сын. Что в итоге? Паука освобождают и принимают обратно. Молодец, че.</p>

<p>Классические сюжеты учат, что подобные вещи не сходят с рук так легко. За них платят самопожертвованием или в лучшем случе рискуют жизнью. Это и драма, и логическое завершение сюжета: накосячил — исправляй. Кроме того, при помощи Паука можно было устроить другую мощную концовку, о которой я тоже скажу ниже.</p>

<p>Еще одна нелепость — нет единства конфликта. В первой части люди добывали минерал, который стоил конских денег (8 миллионов за кило). Куда делся этот минерал в новой части, не ясно. Ладно, дана другая установка — переселение всех жителей Земли на Пандору. Однако в середине фильме оказывается, у людей новый промысел: ловля китов. Их рыбий жир дает вечную жизнь и стоит на Земле миллиарды. Получается нестыковка: в чем главная угроза — экспансия людей или убийство китов? С чем мы боремся? Я понимаю, что технически можно и то, и другое, но для сюжета это вредно: должна быть одна проблема.</p>

<p>Нелепые ответвления сюжета. Дети героя — подростки, и конфликт старших братьев уже оттягивает на себя внимание. Внезапно приемная дочь становится экстрасенсом, впадает в обмороки и прочее. В нелепой сцене она видит мать, которую куда-то засасывает. Эта история должна разрешиться во что-то серьезное, но на деле оказывается банальностью: девочка управляет растениями, которые губят единственный батискаф. В конце она позвала светлячков, чтобы осветить путь побега, но это тоже слабо. Тему экстрасенсов надо было либо убрать, либо развить за счет чего-то другого.</p>

<p>Фильм не дает ответа на вопрос: как все-таки выгнать понаехавших людей. В фильме показано даже не поселение, а крупный город с инфраструктурой — поездами, рельсами и прочее. А герой весь фильм убивал один-единственный корабль. Да, много техники и людей погибло, но в масштабах города это капля в море. В итоге опять блуждающий конец: взяли сражение, но до победы далеко, а тут еще и злодей выполз из-под руин. Совершенная банальность.</p>

<p>Весь фильм меня бесило, что играют на чувствах родителя. Три раза повторяется паттерн “дети убежали” -&gt; “попали в плен” -&gt; “пошли их спасать”. Как родитель я не принимаю сюжет, где гибнет ребенок. Это хтоническое дно, так просто нельзя. Сотни дикарей плывут на пулеметы и хоть бы что, а подающего надежды сына убили. Сценаристы спохватились, что надо кого-то убить из наших. Убили, да не того.</p>

<p>Нормально, когда убивают родителей или они жертвуют собой. Тут все логично: отец ушел, его дело продолжил сын. Но когда наоборот, это полное днище. Решили добавить драмы, но сделали топорно, особенно при том, что была сотня способов повернуть сюжет — тут не хватает приличных слов. В какой-то момент возникла мысль — блин, увезите детей в горы и заприте в шкаф. Победите злодеев, а потом выпускайте. Минус две трети всех проблем.</p>

<p>Пока на экране показывали медуз и карасей, я все думал о том, как сложится финал. И надумал по крайней мере три концовки, которые опишу ниже.</p>

<p>Первая связана с идентификацией злодея. Как я писал выше, он крайне туп — при всем интеллекте человека действует как биоробот. Его путь надо было сделать похожим на путь героя из первой части. Сначала он ловит героя как человек без особого успеха. Затем изучает повадки и язык Нави. Далее наступает внутренний конфликт — он не понимает, кто он: человек или Нави. Воспоминания полковника теряются, их заменяют новые ощущения.</p>

<p>В штабе видят, что злодей неуправляем и его пытаются убить. Злодей переходит на сторону Нави и вместе с героем берет город. В эпичном финале убивают бабу с яйцами, что снимает вопрос о ее нужности. Бывший злодей гибнет или жертвует собой, искупляя причиненное им зло. Его подельники образуют в лесу поселение. Чтобы помочь им выжить и разнообразить род, часть племени героя переходит к ним. В эпилоге показано, что на Земле отказались от программы клонировать Нави. Экспансию на Пандору откладывают, потому что ни одна попытка не окупила себя.</p>

<p>Эта концовка просто супер. Все конфликты решены, все приходят к финалу, ничего лишнего. Что мешало сделать так же?</p>

<p>Вторая концовка связана с Пауком. Парнишка должен был сыграть роль Дарта Вейдера — сперва помогает творить зло, но в итоге встает на путь истинный и искупляет грехи. В финальной битве злодей побеждает, надежды нет. Его сынуля вертит головой, борется внутри. Затем затаскивает папулю в тонущий батискаф и говорит: я помогал тебе творить зло, исправляю вину. Все это с пафосом, под крики и слезы. Есть шанс спастить самому, но это дело чести. Злодей мертв, предатель пожертвовал собой, все сходится, конфликт закрыт.</p>

<p>Третью концовку я не успел как следует продумать, вот ее черновик. Из самопожертвования Паука, рыбьего жира и девочки-экстрасенса можно было слепить оживление погибшего сына. Еще лучше — перенести душу сына в тело Паука. Почему нет, ведь в первой части такое было? Эту версию нужно проработать, чтобы избежать глупой сказочности; однако в ней нет ничего, что противоречит фильму. Замечу, что это тоже хеппи-энд: сын вроде бы и умер, но воскрес в другом облике. Паук тоже умер, но облик остался. Стал два-в-одном, все довольны. Тема бессмертия и дочки-экстрасенса раскрыта, все конфликты решены.</p>

<p>Все это придумал обычный программист из Воронежа. Почему сценаристы из Голливуда со ставкой миллион в час не могли так же?</p>

<p>Несколько слов в завершение. Великий писатель Антон Чехов высказал простой тезис: если на стене висит ружье, в финале оно должно выстрелить. Это касается буквально каждой мелочи в произведении. Показал персонажа — либо он одержит победу, либо умрет. Показал чудо-кристалл — либо он поможет герою, либо навредит злодею. У кого-то приступы ясновидения — в финале это расстроит замыслы врага. Все в том же роде, исключений не бывает. Все идет к своему финалу: люди, предметы, явления.</p>

<p>Из кинозала я вышел вовсе не раздраженный, а вполне сдержанный. Сняли продолжение — спасибо и на этом. Огромный труд и столько пищи для ума. Новая веха в кинематографе.</p>

                
            </div>

        </li>
        
    </ul>

    <h4>
        
        <a href="/page18" class="previous">&larr;</a>
        
        <span class="page_number ">Страница 19 из 79</span>
        
        <a href="/page20" class="next">&rarr;</a>
        
    </h4>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>Ivan Grishaev's blog</li>
          <li><a href="mailto:ivan@grishaev.me">ivan@grishaev.me</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
            <li><a href="https://github.com/igrishaev">GitHub</a></li>
            <li><a href="tg://resolve?domain=igrishaev_blog">Telegram</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>Writing on programming, education, books and negotiations.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
