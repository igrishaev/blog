<!DOCTYPE html>
<html lang="ru">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Ivan Grishaev's blog</title>
  <meta name="description" content="Writing on programming, education, books and negotiations.
">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/custom.css">
  <link rel="canonical" href="https://grishaev.me/page78/">
  <link rel="alternate" type="application/rss+xml" title="Ivan Grishaev's blog" href="https://grishaev.me/feed.xml">

  <link rel="shortcut icon" type="image/x-icon" href="/assets/static/favicons/favicon.ico">

  <script type="text/javascript" src="/assets/typo.js"></script>

</head>


  <body>
    <header class="site-header">

    <div class="wrapper flex-container">

        <div>
            <a href="/">
                <img id="avatar" src="/assets/static/avatar.jpg" alt="Ivan Grishaev">
            </a>
        </div>

        <div class="flex-container-vert" style="margin-left: 15px; width: 80%">

            <div class="flex-container full-width">
                <p style="margin-bottom: 5px"><a href="/">Ivan Grishaev's blog</a></p>
                <div class="flex-huge"></div>
                <div >
<form id="search-form"
      target="_blank"
      style="display: inline"
      method="get"
      action="https://www.google.com/search">

    <input name="sitesearch"
           value="grishaev.me"
           type="hidden">

    <input type="text"
           required="required"
           name="q"
           placeholder="Google search..."
           autocomplete="off">

    <button style="border: none; background-color: transparent; cursor: pointer;"
            type="submit">&#x1f50d;</button>

</form>
</div>
            </div>

            <p><small>Writing on programming, education, books and negotiations.
</small></p>

            <div class="flex-container">
                <a class="menu-item" href="/">Home</a>
                <a class="menu-item" href="/about/">About</a>
                <a class="menu-item" href="/open-source/">Open Source</a>
                <a class="menu-item" href="/bookshelf/">Bookshelf</a>
                <a class="menu-item" href="/feed.xml">RSS</a>
            </div>

            <div class="flex-container">
                <a class="menu-item minor" href="/tag/clojure/">Clojure</a>
                <a class="menu-item minor" href="/tag/emacs/">Emacs</a>
                <a class="menu-item minor" href="/tag/python/">Python</a>
                <a class="menu-item minor" href="/tag/programming/">Programming</a>
                <a class="menu-item minor" href="/interview/">Interview</a>
                <a class="menu-item minor" href="/video/">Video</a>
            </div>

            <div class="flex-container">
                <a class="menu-item minor hl" href="/clojure-in-prod/">Книга «Clojure на производстве»</a>
            </div>

            <div class="flex-container">
                <a class="menu-item minor hl" href="/clojure-in-prod-2/">Книга «Clojure на производстве», второй том</a>
            </div>

        </div>
    </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="home">

    <ul class="post-list">
        
        <li>

            <h2>
                <a class="post-link" href="/remote/">Про удаленную работу</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2016-04-22T00:00:00+00:00">
        Apr 22, 2016
    </time>

    <a href="/tag/remote/" rel="tag">remote</a>, <a href="/tag/work/" rel="tag">work</a>, <a href="/tag/ivan/" rel="tag">ivan</a>, <a href="/tag/sam/" rel="tag">sam</a>

</div>


            <div class="entry">
                
                    <p><img src="/assets/static/ivan-sam.jpg" alt="ivan-and-sam" /></p>

<p>В прошлый вторник <a href="/hexlet-remote">прошел слаконар</a> на канале Хекслета
об удаленной работе. Я рассказал кое-что, ответил на вопросы. Публикую
ниже отредактированную версию чата – с исправленными формулировками,
удобной структурой. Сюда же добавил некоторые вопросы, которые
задавали в чате чаще других.</p>

<p>Выложить этот материал я планировал в декабре, когда моей удаленке
исполнится год. Но если уж рассказал в слаке, тянуть смысла нет.</p>

<h2>

    Содержание

</h2>

<ul id="toc-item-remote">
  <li><a href="#введение" id="toc-item-remote-введение">Введение</a></li>
  <li><a href="#общий-порядок-работы" id="toc-item-remote-общий-порядок-работы">Общий порядок работы</a></li>
  <li><a href="#контракт-отпуск-увольнение" id="toc-item-remote-контракт-отпуск-увольнение">Контракт, отпуск, увольнение</a></li>
  <li><a href="#о-слежке" id="toc-item-remote-о-слежке">О слежке</a></li>
  <li><a href="#виды-удаленки" id="toc-item-remote-виды-удаленки">Виды удаленки</a></li>
  <li><a href="#о-поиске-удаленной-работы" id="toc-item-remote-о-поиске-удаленной-работы">О поиске удаленной работы</a></li>
  <li><a href="#общение" id="toc-item-remote-общение">Общение</a></li>
  <li><a href="#английский" id="toc-item-remote-английский">Английский</a></li>
  <li><a href="#деньги" id="toc-item-remote-деньги">Деньги</a></li>
  <li><a href="#налоги" id="toc-item-remote-налоги">Налоги</a></li>
  <li><a href="#как-жить-с-удаленной-работой" id="toc-item-remote-как-жить-с-удаленной-работой">Как жить с удаленной работой</a></li>
  <li><a href="#о-прокрастинации" id="toc-item-remote-о-прокрастинации">О прокрастинации</a></li>
  <li><a href="#другое" id="toc-item-remote-другое">Другое</a></li>
</ul>

<h3 id="введение">Введение</h3>

<p>Последние 6 месяцев я работаю удаленно в лондонской фирме. Я задумался
об удаленке примерно за полгода до ухода из прошлой компании. Начал
постепенно собирать информацию. Нашел вакансию, связался, выполнил
практическое задание, прошел собеседование – и все заверте…</p>

<p>Собеседование стандартное. Кто такой, какие проекты, что
умеешь. Просили спроектировать игру “Монополия”. Задавали вопросы на
тему сети, пингов.</p>

<p>Задание было написать геопоиск без базы данных, на уровне
структур. Кстати, это было довольно интересно. Построение дерева,
обход и тд. Иногда я мысленно возвращаюсь к нему и пытаюсь найти более
оптимальные способы решения. Попутно я узнал, что такое геохеш, кривые
Лагранжа и прочие штуки.</p>

<p>Я общаюсь с другими удаленщиками, в том числе и не с нашего
проекта. Не все, о чем пойдет речь ниже, я опробовал лично, но слышал
от коллег.</p>

<p>Для начала разберемся с терминологией. Не стоит путать удаленку с
фрилансом. Разница большая. Удаленный сотрудник – это полноценный
член команды. Он разделяет ценности компании, заинтересован в ее
росте. Сотрудник может работать удаленно в течение долгого времени,
получать повышения. Напритив, фриланс – это большей частью мелкие
задачи. Сотрудника волнуют проблемы фирмы, ее рост и вектор развития,
фрилансера – нет.</p>

<p>При фриланс-биржи вроде ODesk и Upwork я не особо в теме, поэтому не
буду о них говорить. В моем видении удаленная работа носит более
высокий приоритет, чем фриланс.</p>

<h2 id="общий-порядок-работы">Общий порядок работы</h2>

<p>Я работаю 5 дней по 8 часов, 40 часов в неделю, 2 выходных, как в
РФ. Переработок еще не было. Труд оплачивается по часам. Есть понятие
рейта — N долларов в час. Проходит месяц, вы умножаете рейт на 8 и на
число дней. Выставляете счет на полученную сумму.</p>

<p>Обычно заказчик и работник находятся в разных часовых
зонах. Оговаривают, каким будет временное пересечение. Например, 5
часов в течение суток. Если требуется постоянная связь на случай
факапав, это оговаривается отдельно.</p>

<p>Всегда можно отлучиться по важному делу, сообщив заранее в слак или
скайп.</p>

<h2 id="контракт-отпуск-увольнение">Контракт, отпуск, увольнение</h2>

<p>Контракт высылают на почту. Подписываете и отправляете скан. Таким же
образом происходит работа со всеми другими документами. Слать
нотариально заверенные копии не нужно.</p>

<p>Отпуск не оплачивается. Вы уходите на две недели – получаете зарплату
в два раза меньше. Отдыхали месяц – зарплаты нет. Впрочем, отдых
длиною в месяц в ай-ти – штука мифическая.</p>

<p>Порядок увольнения может быть оговорен по желанию сторон. Чаще всего
компания оставляет за собой право расстаться без объяснения причин в
любой момент. Предупреждают за неделю или около того.</p>

<p>Это краеугольный камень в удаленной работе – ты ничем не защищен. У
заказчика не болит голова, если нужно избавиться от человека, в
котором ошибся.</p>

<p>Причины увольнения тоже могут быть разные. Может, компания освоила
бюджет и вы теперь больше не нужны. Иногда удаленщиков берут, чтобы
тупо освоить инвестиции. Или у вас не сложилось из-за трудностей в
коммуникациях, бывает. Не стоит убиваться, делайте выводы и ищите
новую работу.</p>

<p>В чем основной профит удаленки по сравнению с фрилансом? В том, что
это работа, рост, повышение компетенции. Чем больше ты знаешь о фирме,
тем сложней тебя уволить. В штате бывают настолько компетентные
удаленщики, что их мгновенное увольнение ставит бизнес под угрозу. Они
выходят из фирмы по полгода – настолько велика их погруженность.</p>

<h2 id="о-слежке">О слежке</h2>

<p>В чате было много вопросов о том, следит ли за мной заказчик. И как
контроллируется процесс. Конкретно в моем случае мне <strong>НЕ нужно</strong>
устанавливать особое ПО, которое следит за десктопом и шлет скриншоты
начальству. У нас Джира, в задачах выставлен примерный эстимейт,
который предварительно обсуждаем всей командой. Взявшись за задачу, ты
должен в него уложиться, либо объяснить, на что уйдет дополнительное
время.</p>

<p>От людей, работающих через Crossover, я знаю, что им ставят программу,
которая трекает пребывание в определенных программах. Например,
столько времени провел в редакторе, столько – в браузере, столько –
в почтовом клиенте. Какие программы или вкладки в браузере считать
полезными – это оговаривается с заказчиком заранее.</p>

<p>Отработать 8 часов полностью нереально. Есть определенный КПД. По моим
подсчетам, в плодотворный день удается поработать 6 часов. Чтобы
сделать 8 полных часов, надо сидеть за компом 11 часов. Ноу лайф,
словом. Максимум на день-два.</p>

<p>Чем больше закачик доверяет личному общению взамен программы-шпиона,
тем лучше. Я лично считаю, достаточно 5-минутного разговора, чтобы
понять, работает человек или валяет дурака. А то, что он потратил час
на блог или личный проект, роли не играет.</p>

<h2 id="виды-удаленки">Виды удаленки</h2>

<p>Я разделяю два вида удаленки – внутреннюю (в рамках текущей страны,
для меня – России) и внешнюю – Европу, США, Сингапур и тд. Кратко
опишу первый пункт, чтобы затем на него не отвлекаться.</p>

<p>Внутренняя удаленка не сильно отличается от обычного
трудоустройства. Недавно из интереса я собеседовался на удаленную
вакансю по Clojure в Москве. Обычное собеседование с техлидом. Вы
устраиваетесь официально, подписываете документы по почте, отправляете
трудовую книжку. Вам присылают карточку, на которую раз в месяц
перевоят зарплату. Разница в том, что сидите не в офисе.</p>

<p>Или заключаете трудовой контракт на определенный период. Или вообще
ничего не заключаете, а деньги вам скидывают на карточку или
Яндекс-деньги, и все держится на доверии.</p>

<p>Гораздо интересней говорить на тему внешней удаленки. Здесь сразу куча
всего.</p>

<p>Какие плюсы и недостатки есть в удаленноой работе? Пройдусь кратко,
затем каждый пункт проговорим подробно.</p>

<p><strong>Деньги.</strong> Европейская зарплата выше российской. С другой стороны,
получение валюты из-за рубежа влечет за собой некоторые
трудности. Придется открыть ИП, регулярно платить взносы, налоги,
сдавать отчетность.</p>

<p><strong>Ответственность.</strong> Удаленка мне кажется более высокой формой
сотрудничества, потому что повышается ответственность. Дело в том, что
много вещей приходится разруливать самостоятельно. Минус, эту
ответственность нужно быть готовым принять. То есть теперь вы не
только пишете код, но и занимаетесь предпринимательством, платите
налоги, обо всем договариваетесь с заказчиком и много всего
другого.</p>

<p>При этом еще нужно успевать работать. Когда вы обычный работник, с вас
взятки гладки сразу по всем показателям.</p>

<p><strong>Свобода в выборе.</strong> Удаленной работы сейчас много, и хороший
сотрудник может выбирать, с кем работать. Например, вы отработали 5
лет на PHP, понимаете, что не растете, пора двигаться дальше, в но в
городе вакансии только на Пых и 1с. Остается только переезд. Но если у
вас семья, дети? Вы же не потащите из через всю страну только потому,
что захотелось писать на Хаскеле?</p>

<h2 id="о-поиске-удаленной-работы">О поиске удаленной работы</h2>

<p>Где искать удаленку? Есть хороший сайт
<a href="https://remoteok.io/">Remote OK</a> – агрегатор удаленных вакансий.</p>

<p>Они же попадаются на <a href="https://stackoverflow.com/jobs">Stack Overflow</a>
с тегом <code class="language-plaintext highlighter-rouge">remote</code>.</p>

<p>Вакансии неплохо ищутся на сайтах конкретных языков или технологий,
например, для Питона это раздел <a href="https://www.python.org/jobs/">Jobs</a>
на официальном сайте.</p>

<p>На всех указанных выше ресурсах есть RSS-ленты, что облегчает трекинг.</p>

<p>Есть рекрутинговые агенства, специализирующиеся на особых технологиях,
например, <a href="https://jobs.functionalworks.com/">Functional Works</a> –
подбор программистов на функциональных языках. Чтобы увидеть
расширенную информацию на борде, надо зарегистрироваться. Сейчас там
висят 3-4 удаленки. Из прямого общения с рекрутером можно вытянуть
больше.</p>

<p>Наконец, лучший источник – это профиль на Линкед-ине. Нужно заполнить
профиль максимально полно, указать проекты, образование, степень
знания английского, сертификаты, волонтерские проекты. И что важно,
скилы. Попросите заказчиков отписать вам рекомендации. После этого
рекрутеры начнут наплывать толпами.</p>

<p>Я предполагаю, срабатывает какой-то алгоритм, согласно которому, если
человек часто обновляет профиль, он заинтересован в поиске работы, и
его профиль чаще всплывает в поиске. Но это только догадка.</p>

<p>В чате был хороший вопрос о том, как понять, пора ли идти искать
удаленку. На мой взгляд, удаленке должна предшествовать работа в
промышленной разработке. Вы должны уметь работать в команде, владеть
целевой технологией, иметь в портфолио несколько проектов. Словом,
пройти боевое крещение.</p>

<p>С другой стороны, если нацелены на удаленку, не стоит оттягивать
процесс. Крупные компании могут усыплять бдительность. Повысят в
должности, прибавят зарплату. Печенек отсыпят, в пейнтбол повезут. А
потом семья и дети, нужна стабильность, поезд ушел – менять что-то
будет страшно.</p>

<p>В удаленке востребованы все те же промышленные языки и технологии, что
и в индустрии в целом. Плюсы, Джава, Пых, Питон, Руби, Шарп,
Джаваскрипт. Встречается Гоу и функциональные вещи вроде Кложи, Скалы,
Хаскела. Везде без исключения надо знать БД, алгоритмы и основы веба.</p>

<h2 id="общение">Общение</h2>

<p>В удаленке очень важны коммуникации, я это понял не сразу. Удаленного
сотрудника оценивают в первую очередь по тому, насколько легко
получить от него отклик. Это значит, нужно быть готовым говорить,
обсуждать.</p>

<p>Как правило, удаленщик находится в другой часовй зоне, поэтому
оговаривают, в какие часы сотрудник должен быть на связи. Наиболее
благоприятный случай – когда зоны различаются на 2-3 часа, как Москва
и Лондон, например. Люди, которые работают с США, испытывают трудности
из-за слишком большой разницы во времени. У вас 18-00, а у них только
утренний кофе. Постепенно ваш распорядок съезжает на ночное время, что
плохо для здоровья и социальной составляющей.</p>

<p>В штате могут быть другие русскоговорящие сотрудники, на на созвонах
это не поможет – все должны понимать друг друга. Разве что, они могут
дать полезные советы с глазу на глаз или подбодрить, если дела идут
плохо.</p>

<p>Используют стандартные средства связи – слака, скайп, хенгаутс,
почта. Нельзя шутить про секс-меньшинства, цвет кожи, беженцев и
другие больные для европейского общества темы.</p>

<h2 id="английский">Английский</h2>

<p>В общении все упирается в английский. Чтобы преуспеть в удаленке,
нужно понимать тонкости языка. Бывает, потребуется защищать свою точку
зрения. Вы предложили использовать новый фреймворк, отвечают –
подготовь презентацию и расскажи, какая польза бизнесу. И будь
фреймворк трижды крут, вам не дадут добро, если не сможете донести
мысль.</p>

<p>Никогда не нужно извиняться за язык или обращать внимание на проблемы
в общении. Это и так понятно и только напрягает обе стороны. Просто
вежливо переспрашивайте.</p>

<p>На прошлой работе я посещал группу английского 2 года. Маленькие
группы очень эффективны, потому что в них сильна конкуренция. И все
же, начав работать удаленно, я обнаружил, что навыков недостаточно для
эффективной коммуникации. Срочно занялся английским. Вот что мне
помогло.</p>

<p>Первое – улучшить чтение. Приходится много читать. Документация,
переписка, скайп, чаты в слаке. Бывает, сообщения сыпятся, а ты уже
минуту одупляешь одну и ту же фразу. Помогла
<a href="/kindle">электронная читалка Kindle</a>. Я читаю тех. литературу на
английском на темы, которые хорошо знаю – Емакс, Лисп. Когда знаешь
контекст, вопринимать легче. К тому же, в Киндле есть встроенные
словари – увидел незнакомое слово, нажал, сразу вышло его
транскрипция и толкование. Причем это не голимый гугл-транслейт, а
оксфордский словарь с примерами.</p>

<p>Я не очень рекомендую бумажные книги, потому что неудобно лазить в
словарь и переводчик. Особенно в худ. литературе много прилагательных,
смысл которых можно смутно понять из контекста, но все равно они
останутся неясными мозгу, пока не посмотришь в словаре.</p>

<p>Второе и гораздо более важное – улучшить восприятие на слух. У людей
может быть самый разный акцент. Кого-то я хорошо понимаю, кого-то
нет. По иронии судьбы, хуже всего понимаю начальника, а с этим шутки
плохи. Чтобы улучшить восприятие, я рекомендую смотреть
<a href="https://www.youtube.com/user/VOALearningEnglish/playlists">эти короткие видео</a>.</p>

<p>Каждое видео длится три минуты. Смотреть нужно по следующей схеме:</p>

<ul>
  <li>смотрим и читаем бегущую стоку. Важно, чтобы все слова были понятны.</li>
  <li>Слушаем снова, но не читаем.</li>
  <li>Слушаем на скорости 1.25. Если что-то не понятно, повторяем или идем
на предыдущий шаг.</li>
  <li>Аналогично, только на скорости 1.5.</li>
  <li>Аналогично, только на скорости 2. Это максимальная скорость. На ней
лучше прослушать несколько раз.</li>
</ul>

<p>Как вы догадались, секрет состоит в постепенном нарастании
скорости. Поскольку с каждым просмотром нарастает контекст, мозгу
становится легче воспринимать голос.</p>

<p>Скорость можно менять только в браузере, айпад и айфон эту возможность
не поддерживают. На одно занятие уходит 15 минут. Делаем так строго
каждый день утром, как только садимся за комп, вместо смешных картинок
или Фейсбука. Эффект станет заметен буквально после двух
занятий. Включите любую популярную песню и убедитесь, что стали
воспринимать больше слов, чем раньше.</p>

<h2 id="деньги">Деньги</h2>

<p>Закончим про английский, вернемся к удаленке. Поговорим подробней о
деньгах.</p>

<p>Зарплата из-за рубежа выше. Грубо говоря, зарплата мидла в Европе
равна зарплате синьора в России. Или даже больше. Эта разница вызвана
следующими факторами:</p>

<ul>
  <li>
    <p>Жизнь в Европе дороже, там очень высокие налоги. Треть или даже 40%
дохода европейца уходит на налоги.</p>
  </li>
  <li>
    <p>Удаленный сотрудник не защищен профсоюзами. Это покажется странным,
но на западе человека не могут уволить месяцами, потому что трудовой
договор сильно защищает работника. Еще есть профсоюзы. Удаленщика
никто не защищает. По контракту фирма предупреждает за неделю и
давай до свидания.</p>
  </li>
  <li>
    <p>Денежные переводы, которые фирма отправляет сотруднику, не
облагаются налогами. Для фирмы это как купить мешок картошки. Из
пункта о величине налогов следует экономия бюджета в 40%.</p>
  </li>
</ul>

<p>Из-за разницы в ценах между странами заказчик покупает синьора по
стоимости мидла-джуна. Это устраивает обе стороны.</p>

<p>Кто-то может сказать, что ты не стоишь этих денег, потому что просто
играешь на разнице цен. Но подобно тому, как вода движется от высокого
давления к низкому, экономика работает на разнице цен. На моем ноуте
написано “Designed in California, assembled in Malaysia”. Одну работу
выгодней делать в одной части земного шара, другую – в другой.</p>

<p>Работа на Европу или США – это законный долларовый доход. Сегодня в
России абсолютно все зависит от цены доллара – от продуктов до
техники.</p>

<p>До введения санкций я покупал Макбук за 65тр, теперь он стоит
120тр. Шоколадный батончик стоил 20 рублей, стал 41. Наша семья
побтребляет много молока – раньше брал за 35 рублей, однако с
введением продуктового эмбаго качество молока, сыра, масла резко
ухудшилось. Приходится покупать молоко за 65 рублей. Словом, в
современной России рублевый доход – очень шаткая штука.</p>

<p>Для получения валюты нужен статус ИП с валютным счетом. Сейчас есть
МФЦ, где все делается быстро, буквально неделя. Подготовить бумаги
помогу сервисы вроде “Мое дело” и “Контур Эльба”. Они же составят
график выплат взносов, налогов и многое другое.</p>

<p>Я работаю в Эльбе. Первый год бесплатен, потом 4 тр в год.</p>

<p>Есть разные системы налогооблажения, самая простая УСН – 6 % с
доходов. Каждый квартал платите 6 процентов с того, что
заработали. Своевременно вносите в Эльбу заработанные суммы, система
сама расчитает налог. Суммы в долларах автоматом переводятся в рубли
по тому курсу ЦБ, который действовал на момент ее получения. Ставить
неверную дату, чтобы снизить курс с целью уменьшить налог нельзя –
это противозаконно.</p>

<p>Получать валюту физлицу либо нельзя, либо можно, но с большим
геморроем. Я даже не стал разбираться в тонкостях.</p>

<p>Когда вам присылают валюту, она падает на транзитный счет. Вы не
можете снять ее. Нужно предоставить пакет документов, которые
подтверждают законность перевода. Состав документов зависит от
банка. В моем случае – это 7 документов, которые я должен
предоставлять каждый месяц.</p>

<p>Есть такое понятие как паспорт сделки, когда показываете документы
один раз. Их фиксируют в некую юридическую сущность, а вы ссылаетесь
на нее многократно.</p>

<p>Существует система <a href="https://www.payoneer.com/">Payoneer</a>, которая
создает вам счет в американском банке и присылает карточку для снятия
денег. Я ни разу с ней не работал, но вижу минусы в следующем:</p>

<ul>
  <li>
    <p>счет принадлежит не вам, а фирме. В Америке с этим строго – счет
открыть может только резидент. То, что на карте ваше имя –
формальность, можно хоть имя собаки написать. Если счет заблокируют,
вы ничего не догоните.</p>
  </li>
  <li>
    <p>На каждую операцию – поступление на счет, конвертация, снятие –
комиссии про пронципу <code class="language-plaintext highlighter-rouge">(N + %) USD</code>. У ИП, если операции протекают
внутри банка, комиссии гораздо ниже.</p>
  </li>
</ul>

<p>Я пользуюсь услугами известного банка. Хотя и был с ними
<a href="/bank">досадный инцидент</a>, услугами я доволен. Любая операция
доступна в личном кабинете. Сайт работает только в Файерфоксе,
интерфейс очень кривой, нужна Джава, но это мелочи.</p>

<h2 id="налоги">Налоги</h2>

<p>Вам придется платить налоги уже после получения денег, иногда это
могут быть крупные суммы. Расставаться с ними уже псле получения
трудно. Не удивительно, что человек, который платит налоги сам,
становится более требовательным к себе и окружающим. Я заметил это по
некоторым блоггерам, которые работают как ИП. Стали ИП – начали
писать про политику, налоги, социальные вопросы.</p>

<p>Ни в коем случе нельзя уходить от уплаты налогов, да еще с зарубежных
переводов. Будет бо-бо, вплоть до тюрьмы.</p>

<p>Еще есть патент. Вы оформляете патент на вид деятельности, и сумма
налога станвится фиксированной. Эльба умеет работать с
патентом. Получать его просто — качаете заявление, заполняете и несете
в налоговую по месту прописки.</p>

<p>Стоимость патента зависит от региона, уточняйте на сайте
<a href="https://patent.nalog.ru/info/">Налоговой службы</a>.</p>

<p>Налоговые органы могут ученить проверку. Информация о том, кого будут
проверять, выкладывается на официальных сайтах. Эльба трекает эти
сайты и подскажет, если в отношении вас что-то планируют.</p>

<h2 id="как-жить-с-удаленной-работой">Как жить с удаленной работой</h2>

<p>Главное в удаленке – не остаться в изоляции. Есть риск
деградировать. Нельзя замыкаться, ищите единомышленников.</p>

<p><img src="/assets/static/degradation.png" alt="degradation" /></p>

<p>Хорошей альтернативой может стать коворкинг или другое место, где
собираются около-айтишные люди. Там, среди разного сброда, можно найти
действительно полезные связи.</p>

<p>Должно быть место, куда вы добираетесь, чтобы работать. Это место
проводит грань – вот я на рабаоте, вот я дома. Иначе становится
трудно отделить работу от семьи. Ты встал из-за стола, а коллеги все
пишут и пишут в скайп. Ты отвечаешь, хотя вроде решил, что на сегодня
хватит…</p>

<p>Иногда работа размазывается по всему дню, с этим тоже надо уметь
жить. Я работаю до обеда из коворкинга, а после обеда из дома, потому
что вожу и забираю из школы сына. Приходится быстро адаптироваться к
условиям. Например, пока сын плавает в бассейне, быдлокодю в
фойе. Потом идем в парк, сын катается на велике, а я быдлокодю на
лавочке. И все это – без раскачки, с полным контекстом в голове.</p>

<p>Первое время после увольнения будет не хватать людей, общения, прежних
связей. Выходом стали регулярные встречи на айтишные темы. Мы с
коллегами организовали <a href="https://www.facebook.com/groups/deeprefactoring/">“Глубокий рефакторинг”</a>. Раз в месяц
мы рассказываем всякие интересные штуки, шутим, троллим друг друга.</p>

<h2 id="о-прокрастинации">О прокрастинации</h2>

<p>В чате были вопросы о том, как бороться с прокрастинацией. Например,
как быстро набирать контекст, приступать к делу без раскачки.</p>

<p>Минимальные требования – избавиться от вредных привычек (курение и
алкоголь), делать зарядку, ложиться рано, не сидеть по поздна за
компом. Ходить пешком и немного заниматься спортом, скажем, хотя бы
раз в неделю что-то посещать – зал, бассейн.</p>

<p>Сократить число отвлекающих факторов. Отключить нотификации в
месенджерах, всяких скайпах-слаках. Оставить только самые важные,
например, от конкретных людей. Чаты со смешными картинками поставить
на мьют.</p>

<p>Слушать музыку без слов, а лучше всего шумы природы, океана. Под них
очень классно работать.</p>

<p>Не пользоваться соцсетями, читать только RSS в Feedly или другом
клиенте. Не шариться просто так по сайтам. Использовать текстовые
редакторы вместо ИДЕ, плоский текст вместо бинарных файлов или
конфигов. Вместо облачных хранилищ подойдет приватный репозиторий на
Гитхабе.</p>

<p>Если прокрастинация имеет место, не надо делать трагедии. Стоит тушить
комп и делать паузу минут на 15. Полезно пройтись после работы. Не
смотрите телевизор и сериалы, сократите информационный поток,
откажитесь от чего-то лишнего.</p>

<h2 id="другое">Другое</h2>

<p>Среди прочего я нелестно высказался в чате на тему скриптовых языков,
Руби и Питона в частности. Извиняюсь, если кого-то обидел. На эту тему
будет отдельный пост.</p>

<p>Туманные рассуждения о преимуществах Лиспа и Гоу – там же.</p>

<p>После моего прощания в чате высказались другие удаленщики. Их тоже
интересно почитать.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/hexlet-remote/">Сегодня рассказываю про удаленную работу</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2016-04-19T00:00:00+00:00">
        Apr 19, 2016
    </time>

    <a href="/tag/remote/" rel="tag">remote</a>, <a href="/tag/work/" rel="tag">work</a>, <a href="/tag/hexlet/" rel="tag">hexlet</a>, <a href="/tag/slack/" rel="tag">slack</a>

</div>


            <div class="entry">
                
                    <p><strong>UPD</strong> <a href="https://github.com/Hexlet/hexlet-slack-archive/wiki/%D1%81%D0%BB%D0%B0%D0%BA%D0%BE%D0%BD%D0%B0%D1%80:-%D0%9F%D1%80%D0%BE-%D1%83%D0%B4%D0%B0%D0%BB%D0%B5%D0%BD%D0%BD%D1%83%D1%8E-%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%83">Ссылка на дамп чата</a>. Через несколько дней
размещу в блоге структурированный текст.</p>

<p>Сегодня во вторник в 18:00 по Москве состоиться слаконар на тему
удаленной работы. Слаконар – это конференция в Слаке в текстовом
режиме. Общаться будем на канале <a href="https://hexlet-ru.slack.com/archives/general">#general</a>
образовательного проекта Хекслет.</p>

<p>Я расскажу о тонкостях удаленной работы примерно по такому плану:</p>

<ul>
  <li>что такое удаленка и как я пришел в нее,</li>
  <li>в чем отличие от фриланса,</li>
  <li>виды удаленки, сравнение удаленной работы в России и в других странах,</li>
  <li>удаленная работа на иностранные компании,</li>
  <li>плюсы и минусы такой работы,</li>
  <li>как найти удаленную работу и как ее легально оформить.</li>
</ul>

<p>Общение займет ориентировочно 2 часа. Позже дамп беседы выложат в
<a href="https://github.com/Hexlet/hexlet-slack-archive/wiki">архивную Вики</a>, а я оформлю в блоге отдельным постом.</p>

<p>Заходите, будет интересно.</p>


                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/psycho/">Послушайте, что пишет психотерапевт</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2016-04-16T00:00:00+00:00">
        Apr 16, 2016
    </time>

    <a href="/tag/psycho/" rel="tag">psycho</a>, <a href="/tag/article/" rel="tag">article</a>, <a href="/tag/quotes/" rel="tag">quotes</a>

</div>


            <div class="entry">
                
                    <p>Наткнулся на <a href="http://misstits.ru/psiholog-mihail-litvak-u-nas-zhenshhin-vospityvayut-kak-prostitutok/">интересную статью</a> одного
психотерапевта. Говорит грамотные вещи, хорошо причищает
мозги. Позволю себе процитировать самое интересное с комментариями.</p>

<p>О детях:</p>

<p><em>Ребенка надо выращивать, а не воспитывать. Воспитание – это
ограничение. И самое тяжкое ограничение – это запрет мыслить. Потому
что если ребенок начнет делать что-то свое, непонятное учителям, они
ему поставят двойку. Вот я помог младшему сыну решить задачу по
математике. А сын потом говорит, неправильно, у нас учительница не так
решала. И в следующий раз он будет уже не задачу решать, а угадывать,
что нужно учителю.</em></p>

<p>Подпишусь кровью. Учителей, которые заворачивают домашнюю работу за
то, что “решено не так”, надо вешать на столбах, чтоб неповадно было.</p>

<p>О праздниках:</p>

<p><em>Или когда у человека безрадостная жизнь, он начинает праздники
праздновать. А это не по природе. По природе каждый день должен быть
праздником.</em></p>

<p><em>Например, празднование Нового года. Оно обходится человеку в 100
тыс. долларов как минимум. Только я считаю не из того, сколько он
сейчас зарабатывает, а сколько хотел бы и мог. Например, нормальный
заработок психотерапевта в час – это 100 долларов. Но его можно
достигнуть не сразу, в 18 лет, а в 25. Но если люди две недели до
Нового года черте чем занимаются, две недели после, то и не дорастают
до самих себя, конечно.</em></p>

<p>Праздников в Российском календаре слишком много. Это особенно заметно,
когда начинаешь работать с Европой или США. Я не могу передать, как
бесит перестановка рабочего времени из-за праздника. Например,
работаем в субботу, чтобы отдыхать в понедельник. Очевидно же, что
никто в субботу работать не будет. Биоритмы! Ну, а праздники с датами
в названиях, вроде 8 Марта, 23 Февраля, 1, 9 Мая – это такой совок,
что стыд. В этому году жена говорит – не поздравляй меня с 8 Марта,
лучше в любой другой день, потому что это так уныло. А я и сам хотел
об этом сказать. Так что теперь мы их не празднуем.</p>

<p>Про труд и любовь:</p>

<p><em>Элементарно просто. Интересный труд и любовь. Причем любовь на втором
месте. У нас от любви ждут больше, чем она может дать. Вот я дом
построил. Электричество есть, водопровод, отопление, канализация. Все,
можно жить. Но нет обоев. А люди думают, что обои – это самое
главное. Образно выражаясь, дерьма в голове много, и это дерьмо
управляет поведением.</em></p>

<p>Интересный труд – это то, что реализует человека. Не случайно же
Маслоу задвинул реализацию на самый верх. Человек, одержимый любимым
делом, любит всех и любим всеми, даже если он по натуре засранец, как Стив
Джобс.</p>

<p>О личностном и карьерном росте:</p>

<p><em>Нужно стать профессионалом экстра-класса. Тогда автоматически станешь
полезным другим. Это еще Адам Смит говорил. Я вот книжки
пишу. Рассказываю, как лучше жить, удобнее. Результаты есть – многие
мои ученики круто вверх поднялись. Можно, оказывается, и в наших
условиях успехов добиться. А когда перестал Дни рождения и новый год
праздновать, хоть бы кто от общения со мной отказался.</em></p>

<p>Проще говоря, нужно не только накапливать знания, но и делиться ими.</p>

<p>О деньгах:</p>

<p><em>Когда человек приходит с любовной тягомотиной, я спрашиваю, сколько ты
зарабатываешь. Научись зарабатывать пять тысяч долларов, а потом
занимайся решением семейных проблем.</em></p>

<p>Тоже верно. Нам втирают, что деньги не главное, однако, деньги решают
90% всех проблем. Если взять типичную несчастную семью и начать
копать, все упрется в стеснение в средствах.</p>

<p>О состоятельных женихах:</p>

<p><em>Идиотки. Вот пример приведу. У нас один ростовский олигарх женился на
парикмахерше, снял ее с работы. А потом его застрелили. Ей 25 лет и
пятилетний ребенок. Так я наблюдал, как она через несколько лет по
миру пошла. Была бы обучена – удержала бы состоянием. А он говорил,
зачем, я сам заработаю.</em></p>

<p>Таких печальных историй со знакомыми из детства я знаю не
одну. Находят пузатых бандитов, купаются в шоколаде. Потом мужа
сажают, убивают или тупо отжимают бизнес. Жене остается или выживать,
или идти на сексуальное содержание к другому бизнесмену.</p>

<p>О проституции и морали:</p>

<p><em>Мужчина и женщина – это только когда речь идет о сексе и участии в
деторождении. А когда речь идет о деле, тут кто лучше делает. У нас же
женщин воспитывают в стиле латентной проституции. Она ищет мужчину,
который бы ее защищал, кормил, жил для нее. А сама она может быть
никем. Как это назвать? Мне обычная проституция кажется более честной,
когда проститутка отрабатывает технику секса, получает деньги и не
навязывается мужчине в постоянные спутницы жизни.</em></p>

<p>О сумашествии:</p>

<p><em>Это еще Ницше сказал, что сумасшествие единиц – исключение,
сумасшествие масс – правило. Есть психотические расстройства – бред,
галлюцинации, нелепое поведение. Таких сумасшедших немного, где-то
шесть на тысячу.</em></p>

<p>Без комментариев, просто посмотрите выпуск новостей на ОРТ.</p>

<p>О тех, у кого все виноваты:</p>

<p><em>Этого я не знаю. Я не президент. Но к молодому и здоровому человеку,
если у него что-то не получается, у меня никакого сострадания
нет. Пойди на оптовый рынок, купи и потом продавай. Или на машине
таксуй.</em></p>

<p>Занимательно, что столь интересный материал опубликован а бабском
сайте, где все сплошь про макияж и фен-шуй. Бывает же.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/atomic-scala/">Книга Atomic Scala и наивные впечатления от языка</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2016-04-13T00:00:00+00:00">
        Apr 13, 2016
    </time>

    <a href="/tag/scala/" rel="tag">scala</a>, <a href="/tag/books/" rel="tag">books</a>

</div>


            <div class="entry">
                
                    <p><img src="/assets/static/atomic-scala.jpg" alt="cover" /></p>

<p>Прочитал книжку <a href="http://www.atomicscala.com/">о Скале</a>, заодно немного поковырял язык. Это
первая книжка, прочитанная мной на <a href="/kindle">Киндле</a>.</p>

<p>Понравилась структура. Примерно 30 глав – атомов – по разным
аспектам языка. Автор – плюсовик со стажем, по ходу действия дает
полезные советы, объясняет ООП-паттерны, затрагивает ФП.</p>

<p>Ближе к концу серия глав о монадах. Описаны <code class="language-plaintext highlighter-rouge">Either</code>, <code class="language-plaintext highlighter-rouge">Maybe
(Option)</code>, <code class="language-plaintext highlighter-rouge">Try</code>. Понравилось, что автор ни разу не употребил термин
“монада”. Это камень в огород Хаскела, где монады начинаются с
аппликативных функторов.</p>

<p>К книжке прилагается набор примеров с тестами, доками. Все добротно и
на совесть, <a href="https://github.com/AtomicScala">лежит на Гитхабе</a>. Автор очень ответственно
подошел к делу. По сути, у него не просто книга, а сообщество вокруг
нее. Покупка книги – своего рода членский билет.</p>

<p>Я немного повозился с языком и могу сказать следующее. Прошу прощения
за дилетантский взгляд, все пункты ниже могут оказаться ложью и
провокацией.</p>

<ul>
  <li>
    <p>Сперва язык кажется очень простым, вроде Гоу или Питона, только с
типизацией. Примерно к середине книги понимаешь, что все не так
просто.</p>
  </li>
  <li>
    <p>Некоторые элементы дизайна очень странны. Например, составные
объекты, когда объявлены класс и объект с одинаковыми именами. Я
долго ломал голову, пока наконец понял, что таким образом
формируется метакласс. Можно было сделать удобнее.</p>
  </li>
  <li>
    <p>Избыточные модификаторы вроде <code class="language-plaintext highlighter-rouge">sealed</code>, <code class="language-plaintext highlighter-rouge">implict</code>. Мне кажется, их
впихнули задним числом, получилось не очень. Скала вроде стремится в
минимализму, а получается опять Джава.</p>
  </li>
  <li>
    <p>Самая жесть с параметрическими трейтами. Напоминает Хаскел, но очень
неуклюже. В книге есть пример как построить модель рецепта
мороженного. 100 строк на декларацию трейтов, затем дикий микс из
них. В конце автор пишет, что вот как хорошо получилось. Я бы убился
поддерживать это мороженное.</p>
  </li>
  <li>
    <p>Скала все-таки ООП-язык, хоть и с функциональным уклоном. Насколько
я понял, в экосистеме Скалы не поощрается процедурно-модульное
программирование. Получается <code class="language-plaintext highlighter-rouge">yet another oop language</code>.</p>
  </li>
</ul>

<p><img src="http://41.media.tumblr.com/393d852bf9be9b339e76e4bc393aad34/tumblr_o56sc7ASY31ugyavxo1_1280.jpg" alt="picture" /></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Hieronymus Bosch “A visual guide to the Scala language” oil on oak
panels, 1490-1510.

The left panel shows the functional features, the main one describes
the type system, and the right the object oriented parts.

</code></pre></div></div>

<p>Все же, интерес к языку у меня возник, и при случае был бы рад принять
участие в проекте на нем.</p>

<p>Выборочные цитаты из книги с моим вольным переводом.</p>

<p>О ручной итерации:</p>

<blockquote>
  <p>Notice that <code class="language-plaintext highlighter-rouge">map</code> and <code class="language-plaintext highlighter-rouge">reduce</code> take care of the iteration code that
you normally write by hand. Although managing the iteration yourself
might not seem like much effort, it’s one more error-prone detail,
one more place to make a mistake (and since they’re so “obvious,”
such mistakes are particularly hard to find).</p>
</blockquote>

<p><em>Обратите внимание, <code class="language-plaintext highlighter-rouge">map</code> и <code class="language-plaintext highlighter-rouge">reduce</code> сами заботятся об итерации. В
императивном подходе итерация ложится на ваши плечи. Это кажется
пустяком, но увеличивает код и вероятность ошибки. Баг в ручной
итерации замечаешь в последнюю очередь.</em></p>

<p>О комментариях:</p>

<blockquote>
  <p>Comments should add new information that isn’t obvious from reading
the code. If the comments just repeat what the code says, it becomes
annoying (and people start ignoring your comments). When the code
changes, programmers often forget to update comments, so it’s a good
practice to use comments judiciously, mainly for highlighting tricky
aspects of your code.</p>
</blockquote>

<p><em>Комментарии должны дополнять код, объяснять неочевидные моменты.
Раздражает, когда комментарий повторяет в точности то, что делает
код. Люди проигнорируют их. Когда код меняется, программист часто
забывает обновить комментарий. Комментируйте вдумчиво, в основном
чтобы объяснить неочевидные приемы в коде.</em></p>

<p>О паттерн-матчинге:</p>

<blockquote>
  <p>Notice that pattern matching can overlap with the functionality of
if statements. Because pattern matching is more flexible and
powerful, we prefer it over if statements when there’s a choice.</p>
</blockquote>

<p><em>Замечу, что паттер-матчинг похож на условное выражение. Первый более
гибок, поэтому будем использовать его вместо условия при удобном
случае.</em></p>

<p>В целом, книжка зачет, не жалею потраченного времени.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/potato/">Картофельный мап</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2016-04-07T00:00:00+00:00">
        Apr 7, 2016
    </time>

    <a href="/tag/potato/" rel="tag">potato</a>, <a href="/tag/programming/" rel="tag">programming</a>, <a href="/tag/map/" rel="tag">map</a>, <a href="/tag/fp/" rel="tag">fp</a>

</div>


            <div class="entry">
                
                    <p>По следам прошлого поста о <a href="/map">функции <code class="language-plaintext highlighter-rouge">Map</code></a>.</p>

<p>Вам дали задачу – смоделировать процесс приготовлении картошки. Имеем
набор картофелин. Каждая должна пройти стадию чистки, мойки, резки и
варки.</p>

<p>Не вопрос, отвечет программист:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Potato</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">wash</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">cut</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">cook</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

<span class="n">potatos</span> <span class="o">=</span> <span class="p">[</span><span class="n">Potato</span><span class="p">(),</span> <span class="n">Potato</span><span class="p">(),</span> <span class="p">...]</span>

<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">potatos</span><span class="p">:</span>
    <span class="n">p</span><span class="p">.</span><span class="n">clean</span><span class="p">()</span>
    <span class="n">p</span><span class="p">.</span><span class="n">wash</span><span class="p">()</span>
    <span class="n">p</span><span class="p">.</span><span class="n">cut</span><span class="p">()</span>
    <span class="n">p</span><span class="p">.</span><span class="n">cook</span><span class="p">()</span>
</code></pre></div></div>

<p>Вроде ОК? Нет, все развалится.</p>

<p>Сперва попросят добавить временные задержки. Чистка – 10 секунд,
мойка и резка – 5 секунд, варка – 15 минут (900 секунд). Впишем
<code class="language-plaintext highlighter-rouge">time.sleep(N)</code> в нужные методы.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="p">...</span>
    <span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="p">...</span>
</code></pre></div></div>

<p>Запустим код и убедимся, что 10 картошек варятся 150 минут! Конечно,
ведь каждая картошка обрабатывается отдельно. Мы варим картошку
поштучно. Так никто не делает.</p>

<p>Выходит, варить картошку в цикле нельзя. Должен быть особый код,
который сварит картошки вне цикла. Класс картофелины не должен знать о
технике варки. Значет, будет некий менеджер
<code class="language-plaintext highlighter-rouge">CookManager.cook(potatos)</code>.</p>

<p>Теперь скажут, что картошку готовы чистить два человека. В цикле выше
это никак не предусмотрено. Придется заворачивать цикл в функцию и
передавать часть списка:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="n">potatos</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">potatos</span><span class="p">:</span>
        <span class="p">...</span>

<span class="n">potatos</span> <span class="o">=</span> <span class="p">[</span><span class="n">Potato</span><span class="p">(),</span> <span class="n">Potato</span><span class="p">(),</span> <span class="p">...]</span>

<span class="n">process</span><span class="p">(</span><span class="n">potatos</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
<span class="n">process</span><span class="p">(</span><span class="n">potatos</span><span class="p">[</span><span class="n">n</span><span class="p">:])</span>

<span class="n">CookManager</span><span class="p">.</span><span class="n">cook</span><span class="p">(</span><span class="n">potatos</span><span class="p">)</span>
</code></pre></div></div>

<p>Поделили. Но код никак не учитывает, что в процессе чистки может
подключиться еще один человек. Или наоборот, уйти. Перестроить списки
в процессе невозможно.</p>

<p>Есть проблема серьезней: процесс мойки делить между людьми
нельзя. Потому что мойка одна. Это значит, нужно выдергивать из цикла
операцию <code class="language-plaintext highlighter-rouge">p.wash()</code>, и как-то все перетасовать. И не забыть про варку
в конце.</p>

<p>Короче, я к тому, что нужно сразу делать правильно:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Potato</span><span class="p">:</span>
    <span class="p">...</span>

<span class="n">potatos</span> <span class="o">=</span> <span class="p">[...]</span>

<span class="nb">map</span><span class="p">(</span><span class="n">Potato</span><span class="p">.</span><span class="n">clean</span><span class="p">,</span> <span class="n">potatos</span><span class="p">)</span>
<span class="nb">map</span><span class="p">(</span><span class="n">Potato</span><span class="p">.</span><span class="n">wash</span><span class="p">,</span> <span class="n">potatos</span><span class="p">)</span>
<span class="nb">map</span><span class="p">(</span><span class="n">Potato</span><span class="p">.</span><span class="n">cut</span><span class="p">,</span> <span class="n">potatos</span><span class="p">)</span>
<span class="nb">map</span><span class="p">(</span><span class="n">Potato</span><span class="p">.</span><span class="n">cook</span><span class="p">,</span> <span class="n">potatos</span><span class="p">)</span>
</code></pre></div></div>

<p>Правильно – значит, оставлять потенциал для абстракций. Пока что код
выше технически не отличается от цикла. Картошка тоже вариться 150
минут. Но это легко исправить:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">map_threaded</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">seq</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">multiprocessing.dummy</span> <span class="kn">import</span> <span class="n">Pool</span>
    <span class="n">pool</span> <span class="o">=</span> <span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">seq</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">pool</span><span class="p">.</span><span class="nb">map</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">seq</span><span class="p">)</span>

<span class="p">...</span>

<span class="n">map_threaded</span><span class="p">(</span><span class="n">Potato</span><span class="p">.</span><span class="n">cook</span><span class="p">,</span> <span class="n">potatos</span><span class="p">)</span>
</code></pre></div></div>

<p>Здесь мы определяем мап в тредах. Число тредов равно числу
картошек. Это значит, все они будут готовиться параллельно, как в
реальности в одной кастрюле. Питонячьи треды переключаются при
<code class="language-plaintext highlighter-rouge">time.sleep()</code>. Засыпание равносильно IO-ожиданию. Поэтому все
картошки приготовятся за 15 минут.</p>

<p>Теперь чистка. Это будет мап на очередях. Воркеры –
люди. Конфигурация очереди никак не влияет на код, поэтому можем
подключить два, три и более воркеров со своими приоритетами и
весами. Захотим, отключим воркер в процессе работы. Мап будет примерно
такой:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">map_queued</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">seq</span><span class="p">):</span>
    <span class="n">task</span> <span class="o">=</span> <span class="n">celery</span><span class="p">.</span><span class="n">task</span><span class="p">(</span><span class="n">func</span><span class="p">)(</span><span class="o">&lt;</span><span class="n">task</span> <span class="n">options</span><span class="p">...</span><span class="o">&gt;</span><span class="p">)</span>
    <span class="n">res_id_list</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">task</span><span class="p">.</span><span class="n">apply_async</span><span class="p">,</span> <span class="n">seq</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="n">task</span><span class="p">.</span><span class="n">get_result</span><span class="p">,</span> <span class="n">res_id_list</span><span class="p">)</span>

<span class="n">map_queued</span><span class="p">(</span><span class="n">Potato</span><span class="p">.</span><span class="n">clean</span><span class="p">,</span> <span class="n">potatos</span><span class="p">)</span>
</code></pre></div></div>

<p>Мойку параллелить нельзя, оставляем обычный мап. Все вместе:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Potato</span><span class="p">:</span>
    <span class="p">...</span>

<span class="n">potatos</span> <span class="o">=</span> <span class="p">[...]</span>

<span class="n">map_queued</span><span class="p">(</span><span class="n">Potato</span><span class="p">.</span><span class="n">clean</span><span class="p">,</span> <span class="n">potatos</span><span class="p">)</span>
<span class="nb">map</span><span class="p">(</span><span class="n">Potato</span><span class="p">.</span><span class="n">wash</span><span class="p">,</span> <span class="n">potatos</span><span class="p">)</span>
<span class="n">map_queued</span><span class="p">(</span><span class="n">Potato</span><span class="p">.</span><span class="n">cut</span><span class="p">,</span> <span class="n">potatos</span><span class="p">)</span>
<span class="n">map_threaded</span><span class="p">(</span><span class="n">Potato</span><span class="p">.</span><span class="n">cook</span><span class="p">,</span> <span class="n">potatos</span><span class="p">)</span>
</code></pre></div></div>

<p>Смысловая часть кода осталась неизменной. Мы просто поменяли один мап
на другой. Всегда можем вернуть старый мап, если что-то пойдет не
так. Функции map, filter, reduce, eval, apply – фундамент
абстракций. Абстракции делают код открытым к изменеиям.</p>

<p>В идеале следует избавиться от классов, чтобы не хранить состояние
картошки. Заменить методы на функции и пробрасывать результат
предыдущего мапа в следующий.</p>

<iframe width="100%" height="500" src="https://www.youtube.com/embed/-MDLrCBEKto" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen="">
</iframe>


                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/kindle/">Впечатления от электронной читалки Kindle</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2016-04-06T00:00:00+00:00">
        Apr 6, 2016
    </time>

    <a href="/tag/kindle/" rel="tag">kindle</a>, <a href="/tag/books/" rel="tag">books</a>, <a href="/tag/reading/" rel="tag">reading</a>

</div>


            <div class="entry">
                
                    
<p><strong>UPD продолжение:</strong> <a href="/kindle2">впечатления два года спустя</a>.</p>

<p>Месяц-два назад заказал читалку Kindle Paperwhite. Очень доволен
покупкой. Прочел пару книг, делюсь впечатлениями.</p>

<p>Читалка классная. Компактная, удобно читать, носить. От нее почти не
устают глаза. Если читаешь вечером, утром не чуствуешь последствий. От
айпада или монитора, наоборот, ощущения, что глаза засыпали песком. На
солнце все видно без проблем.</p>

<p>Забавно, что дневной свет экономит питание электронной читалки, а на
айпадах, наоборот, заставляет выкручивать яркость на максимум.</p>

<p>Заказывал в магазине www.elektrokniga.net. Контора напоминает шарашку.
Например, вы не оплачиваете товар, а переводите деньги физлицу на
карту. Но обошлось, доставили оперативно. Слали по два письма в день о
том, что с моим заказом и где он едет.</p>

<p>Какие преимущества читалки перед настольной книгой вообще? Я выделяю
следующие:</p>

<ul>
  <li>
    <p>Удобство. Для чтения бумажной книги нужен стол, свет, чистые
руки. Для меня все три сразу – как парад планет. С читалкой можно
бухнуться на диван или залипнуть в очереди в Сбербанке.</p>
  </li>
  <li>
    <p>Таскать бумажную книгу накладно. Лишний вес, книга теряет товарный
вид от трения в сумке. Или таскаешь весь день, а шанс почитать так и
не выпал.</p>
  </li>
  <li>
    <p>С ценой на зарубежные книги еще можно смириться. Но доставка в два
месяца, равная цене книги… нет, я не миллионер, платить 100
долларов за книгу в мягкой обложке.</p>
  </li>
  <li>
    <p>Кое-что достать в бумажном виде уже не реально.</p>
  </li>
</ul>

<p>Теперь преимущества конкретно Киндла:</p>

<ul>
  <li>
    <p>Очень высокое качество сборки. Ничто не скрипит, пластик пригнан,
щелей нет. Обложка, хоть и не оригинал, тоже на уровне. Магнитик на
обложке погружает книгу в сон, если закрыть.</p>
  </li>
  <li>
    <p>Девайс действительно создан для комфортного чтения. Очень четкий
экран, ощущение, что читаешь с бумаги. Глубокий контраст,
равномерная подсветка. Специально подобранные шрифты.</p>
  </li>
  <li>
    <p>В прошивке только то, что нужно. Нет тяжелого наследия
Андроида. Интерфейс минимальный, настройки простые.</p>
  </li>
  <li>
    <p>В поставке идут словари. Читаешь книжку на английском, например,
нажал на слово – всплывают две плашки. В одной – выдержка из
Оксфордского словаря, в другой – поиск в Википедии. В словаре не
просто перевод, а описание термина в разных контекстах.</p>
  </li>
  <li>
    <p>Амазон дает емейл <code class="language-plaintext highlighter-rouge">username@kindle.com</code>. Шлешь на него книгу – и
через минуту она скачалась в читалку. Не надо заморачиваться с
проводами.</p>
  </li>
  <li>
    <p>Книжки хранятся в облаке. При утрате двайса все легко
восстановится. Удалил случайно книжку – всегда можно закачать
обратно из облака.</p>
  </li>
  <li>
    <p>Качественная интеграция с сервисом Амазона. Покупаешь прямо в
интерфейсе читалки. Все элементы адаптированы под специфичный экран.</p>
  </li>
</ul>

<p>Конечно, есть и минусы.</p>

<ul>
  <li>
    <p>Девайс обновляется сам по себе, когда Амазон сочтет
нужным. Отключить обновление прошивки нельзя, либо опция запрятана
так, что найти не реально. При этом не все изменения мне по
душе. Например, в последнем апдейте, чтобы отрегулировать подсветку,
теперь нужно три клика, а раньше два. А ведь это самое важное при
чтении.</p>
  </li>
  <li>
    <p>Читалка не поддерживает популярные форматы ebup и fb2. Не такой уж
минус, полно утилит для конвертации. Но немного раздражает.</p>
  </li>
  <li>
    <p>Я прекрасно понимаю, что устройство полностью контролируется
Амазоном. Информация о моих книгах используется, чтобы показывать
мне рекламу. Пользоваться Киндлом я смогу ровно столько, сколько
позволит Амазон. <a href="https://stallman.org/amazon.html">Столлман прав.</a></p>
  </li>
</ul>

<p>Следует победить юношеские комплексы и брать читалку не по размеру, а
качеству экрана. Сейчас самый крутой – 6’ 300 dpi Carta. Он стоит в
последних Киндлах и некоторых Ониксах, например, в модели
Дарвин. Однако, в Дарвине щели такие, что ноготь пролазит, а по цене
почти одинаково.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/map/">Map как замена циклу</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2016-04-03T18:58:00+00:00">
        Apr 3, 2016
    </time>

    <a href="/tag/map/" rel="tag">map</a>, <a href="/tag/programming/" rel="tag">programming</a>, <a href="/tag/abstraction/" rel="tag">abstraction</a>, <a href="/tag/cycle/" rel="tag">cycle</a>

</div>


            <div class="entry">
                
                    <p>Я нашел, что отказ от циклов в пользу <code class="language-plaintext highlighter-rouge">map</code> улучшает код сразу по
нескольким критериям, а заодно вправляет мозги. Код с мапами короче,
меньше подвержен ошибкам, его легче поддерживать.</p>

<p><a href="https://en.wikipedia.org/wiki/Map_(higher-order_function)">Функция <code class="language-plaintext highlighter-rouge">map</code></a> родом из мира функционального
программирования (далее ФП). Почти любой язык имеет ее аналог в
стандартной поставке. Map может быть как функцией, так и методом
коллекции.</p>

<p>Map принимает функцию и коллекцию. Функция обрабатывает один
элемент. Результат <code class="language-plaintext highlighter-rouge">map</code> – коллекция результатов функции на множестве
входных данных.</p>

<p>Map призван заменить циклы и ручную итерацию с накоплением
результатов. ФП в российских вузах либо не преподают, либо касаются
факультативно. Студенты мыслят циклами и переносят привычки во
взрослую жизнь.</p>

<p>Мышление циклами – плохая штука. Цикл – примитивная, не
регламентированная конструкция, которая быстро выходит из-под контроля
и превращает код в лапшу. <code class="language-plaintext highlighter-rouge">Map</code> лучше цикла по следующим пунктам.</p>

<h3 id="меньше-кода">Меньше кода</h3>

<p>Пусть определена функция <code class="language-plaintext highlighter-rouge">do_stuff(item)</code>, ее тело не важно. Это
штучный обработчик объекта. Сравним два фрагмента кода:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">results</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">do_stuff</span><span class="p">,</span> <span class="n">my_data_list</span><span class="p">)</span>
</code></pre></div></div>

<p>и</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">my_data_list</span><span class="p">:</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">do_stuff</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">results</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</code></pre></div></div>

<p>Очевидно, первый вариант короче и не засоряет пространство лишними
переменными. Строку с промежуточным результатом <code class="language-plaintext highlighter-rouge">res</code> можно опустить,
но тогда следующая строка <code class="language-plaintext highlighter-rouge">results.append(do_stuff(x))</code> станет
сложнее. Две операции на одну строку – не желательно.</p>

<h3 id="сдвиг-кода-и-логические-прыжки">Сдвиг кода и логические прыжки</h3>

<p>Цикл – это дополнительный сдвиг кода. ООП уже дает сдвиги для классов
и методов, а тут еще циклы. При этом нужно бегать глазами к
переменным-спискам, объявленным до цикла. Map не делает сдвига и
создает переменные по требованию.</p>

<h3 id="декларативный-код-безопасней">Декларативный код безопасней</h3>

<p><code class="language-plaintext highlighter-rouge">Map</code> – это декларативная операция. Это значит, я говорю что именно
хочу получить, а не как. За счет автоматизации ручных действий,
декларативный код очень легко поддерживать и в нем меньше
багов. Бывает, баг кроется именно в неверной итерации или ручной
сборке списка. Но из-за кажущейся тривиальности проверяешь это место в
последнюю очередь.</p>

<h3 id="дополнительный-уровень-абстракции">Дополнительный уровень абстракции</h3>

<p>Map несет большой потенциал для построения абстракций. Скажем, в
обычном языке <code class="language-plaintext highlighter-rouge">map</code> – это банальный прогон функции по элементам в
цикле. Но в других языках <code class="language-plaintext highlighter-rouge">map</code> обретает преимущества, недоступные
обычным циклам.</p>

<p>Если у нас неизменяемые коллекции и транзакционная память,
интерпретатор раскидает задачу по ядрам. Имея 1000 элементов и 4 ядра,
получим по 250 итераций на одно ядро. Описать это циклом –
нетривиальная задача. Насколько я знаю, Clojure и некоторые реализации
Haskell параллелят <code class="language-plaintext highlighter-rouge">map</code> при заданных флагах компиляции.</p>

<p><code class="language-plaintext highlighter-rouge">Map</code> очень круто параллелит запросы в сеть. Например, нужно дернуть
100 урлов, при этом сервера находятся в разных полушариях, и время
отклика ожидаемо велико. Отклик в 10 секунд на запрос из Европы в
Сингапур – нормальное дело. Важно понять, что хоть у вас
супер-кластер, он будет висеть 10 секунд в цикле, ожидая блокирующий
запрос. По меркам машинного времени это целая вечность.</p>

<p><code class="language-plaintext highlighter-rouge">Map</code> легко перестоит одну схему исполнения в другую. Вот обычный
подход, аналогичный циклу:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">url_list</span> <span class="o">=</span> <span class="p">[</span><span class="s">"http://foo1.com"</span><span class="p">,</span> <span class="s">"http://foo2.com"</span><span class="p">,</span> <span class="p">...]</span>

<span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">).</span><span class="n">json</span><span class="p">()</span>

<span class="n">data_list</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">get_data</span><span class="p">,</span> <span class="n">url_list</span><span class="p">)</span>
</code></pre></div></div>

<p>Теперь напишем свой map с использованием тредов:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">multiprocessing.dummy</span> <span class="kn">import</span> <span class="n">Pool</span>

<span class="k">def</span> <span class="nf">map_threaded</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">seq</span><span class="p">):</span>
    <span class="n">pool</span> <span class="o">=</span> <span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pool</span><span class="p">.</span><span class="nb">map</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">seq</span><span class="p">)</span>

<span class="n">data_list</span> <span class="o">=</span> <span class="n">map_threaded</span><span class="p">(</span><span class="n">get_data</span><span class="p">,</span> <span class="n">url_list</span><span class="p">)</span>
</code></pre></div></div>

<p>Всего лишь поменяли <code class="language-plaintext highlighter-rouge">map</code> на <code class="language-plaintext highlighter-rouge">map_threaded</code>, но какая большая разница
в реализации! Был цикл, а стали треды, но сигнатуры одинаковые. Теперь
на всю операцию понадобится время, равное самому долгому запросу.</p>

<p>(Да, это пул тредов не смотря на название модуля.)</p>

<p>Мощь абстракции <code class="language-plaintext highlighter-rouge">map</code> очень велика. Мы можем использовать любой другой
метод распределения задач. Например, процессы вместо тредов. Или
подключить фреймворк вроде <code class="language-plaintext highlighter-rouge">Celery</code>, который шлет задания воркерам,
собирает ответы и отдает список.</p>

<p>Мощь Гугла – это комбинация функций
<a href="https://ru.wikipedia.org/wiki/MapReduce">Map и Reduce</a>. Инженеры Гугла дробят задачи на
подзадачи и эффективно исполняют их на тысячах серверов. Технология
работает в масштабах планеты. Под капотом может быть скучный ООП-код
на Java, но <code class="language-plaintext highlighter-rouge">Map</code> и <code class="language-plaintext highlighter-rouge">Reduce</code> – абстракция высочайшего
порядка. Благодаря им Гугл стал тем, что есть сейчас.</p>

<h3 id="контроль-за-разрастанием-цикла">Контроль за разрастанием цикла</h3>

<p>Проблема цикла в том, что код внутри никак не регламентирован. Тело
цикла бесконтрольно разрастается. Сперва кажется, что в цикле все
ясно. Но меняются бизнес-требования, нужны фичи, и ясность быстро
уходит.</p>

<p>Добавили <code class="language-plaintext highlighter-rouge">if</code>, затем еще один, затем <code class="language-plaintext highlighter-rouge">continue</code> по условию, а потом
вообще залепили вложенный цикл. В этой ветке пишем в результирующий
список, а в этой нет. Логику накопления результатов отследить трудно.</p>

<p>Бывает, мы добавляем костыли в цикл, потому что на носу релиз, и
возиться некогда. Часто в ревью мы видим пару строчек:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
<span class="o">+</span>     <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span><span class="p">.</span><span class="n">check_foo</span><span class="p">():</span>
<span class="o">+</span>         <span class="k">continue</span>
  <span class="p">...</span>
</code></pre></div></div>

<p>которые ни у кого не вызывают подозрений. Ну, пропускаешь шаг, все
понятно.</p>

<p>Это плохо.</p>

<p>Ближайшая аналогия – растение морской желудь. Он разрастается по дну
судна. Если планово не счищать, скорость судна и потребление горючего
падают и возрастают соответственно на 40%.</p>

<p>Отрефакторить цикл, в котором полно <code class="language-plaintext highlighter-rouge">if</code>, <code class="language-plaintext highlighter-rouge">continue</code>, <code class="language-plaintext highlighter-rouge">try/catch</code>
очень трудно. Все завязано на глобальные списки, объявленные до входа
в цикл. Оператор <code class="language-plaintext highlighter-rouge">continue</code> я считаю дурным тоном. Мы должны отделять
котлеты от мух до входа в итерацию.</p>

<p><code class="language-plaintext highlighter-rouge">Map</code> исключает условия и пропуск элементов. Целевая функция не может
сказать “этот обработать не могу, дай-ка лучше следующий”. Список
следует предварительно очистить функцией <code class="language-plaintext highlighter-rouge">filter</code>.</p>

<h3 id="неверное-прохождение-слоев-бизнес-логики">Неверное прохождение слоев бизнес-логики</h3>

<p>Мы часто работаем со списками объектов. Типичная задача – извлечь
данные из базы и выполнить для каждого ряд действий. Например,
<code class="language-plaintext highlighter-rouge">действие1</code>, <code class="language-plaintext highlighter-rouge">действие2</code> и <code class="language-plaintext highlighter-rouge">действие3</code>.</p>

<p>Итерируясь вручную, программист выполняет все три для первого объекта,
затем для второго, и так далее. И забывает, что противоположный обход
– сначала для всех выполнить <code class="language-plaintext highlighter-rouge">действие1</code>, затем для всех <code class="language-plaintext highlighter-rouge">действие2</code>
и т.д. – выгодней по следующим причинам:</p>

<ul>
  <li>для очередного действия может потребоваться какой-то ресурс: файл,
сеть, авторизация. Логично открыть его, прогнать объекты, закрыть
ресурс и переходить к следующей стадии. В цикле придется держать
ресурсы открытыми все время.</li>
  <li>если мы лажанулись уже в начале, открывать некоторые ресурсы не
понадобиться вообще.</li>
  <li>описанный подход – это проход бизнес-логики по слоям, что ближе к
реальному положению дел. Например, вы прошли два действия, но третье
не вышло – нет сети или файла. Можно сдампить результаты в файл и
несложным хаком вернуться в состояние, когда результаты двух первых
стадий есть, а третьей – нет. В случае ошибки на середине цикла
контекст будет намного сложней, а вернуться на конкретный шаг
итерации – невозможно.</li>
</ul>

<h3 id="повышенные-требования-к-коду">Повышенные требования к коду</h3>

<p><code class="language-plaintext highlighter-rouge">Map</code> заставляет писать код качественней. <code class="language-plaintext highlighter-rouge">Map</code> не имеет встроенной
защиты от не пойманных исключений. Если упадет первый элемент, не
выполнятся остальные 999. Поэтому передавая функцию в мап, программист
должен подписаться, что функция не подведет.</p>

<p>Не каждый готов дать эту гарантию. Часто мы видим такое:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">process_item</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">process_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">result</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="p">.</span><span class="k">except</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">continue</span>
</code></pre></div></div>

<p>Этот код ужасен. Он беззуб и неуклюж. Функции написаны криво и бросают
ошибки. Смысловая часть уехала на два отступа. На выходе из цикла не
ясно, с какими элементами случилась ошибка. Смешались в кучу итерация,
отлов исключений, логирование.</p>

<p>А ведь достаточно завернуть целевую функцию в декоратор или другую
функцию, которая отдаст пару <code class="language-plaintext highlighter-rouge">(err, result)</code> и прогнать через
<code class="language-plaintext highlighter-rouge">map</code>. После прогона отделить хорошие результаты от плохих. Ошибки
залогировать отдельным шагом. Хорошие результаты отправить в следующий
слой бизнес-логики.</p>

<p>Хорошая новость в том, что мы уже в двух шагах от монад, но пока не
будем о них.</p>

<h3 id="вместо-заключения">Вместо заключения</h3>

<p>Отказ от циклов сокращает код, делает его яснее и легче в
поддержке. Map не позволит воткнуть в середине условие или переход к
следующей итерации. Ручное накопление списка чревато багами, поэтому
лучше доверить это надежной функции.</p>


                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/meetup4/">Записи докладов с четвертой встречи любителей рефакторить</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2016-04-03T15:00:00+00:00">
        Apr 3, 2016
    </time>

    <a href="/tag/programming/" rel="tag">programming</a>, <a href="/tag/meetup/" rel="tag">meetup</a>, <a href="/tag/deep-refactoring/" rel="tag">deep-refactoring</a>

</div>


            <div class="entry">
                
                    <p>Провели четвертую встречу!</p>

<p>Роман Гребенников выступил с докладом о распределенных системах:</p>

<iframe width="100%" height="500" src="https://www.youtube.com/embed/6ZQ-3NmpXOs" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen="">
</iframe>

<p>Евгений Рыжков рассказал о тонкостях манипуляций:</p>

<iframe width="100%" height="500" src="https://www.youtube.com/embed/M2oryEQkYbQ" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen="">
</iframe>

<p><a href="http://www.slideshare.net/IvanGrishaev/project-management-60404921">Слайды</a></p>

<p>Напомню, сообщество тусит в <a href="https://www.facebook.com/groups/deeprefactoring/">группе Фейсбука</a>. Скоро
анонс пятой встречи, принимаем заявки на доклады.</p>


                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/npm/">Идиотизм вокруг NPM</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2016-03-30T00:00:00+00:00">
        Mar 30, 2016
    </time>

    <a href="/tag/npm/" rel="tag">npm</a>, <a href="/tag/idiots/" rel="tag">idiots</a>

</div>


            <div class="entry">
                
                    <p>Как и другие разработчики, я с интересом наблюдаю за скандалом вокруг
экосистемы Node.js и пакетного менеджера NPM.</p>

<p>Если вы не в курсе дела, смотрите ссылки в конце поста. А я напомню,
что у Node-разработчиков прошлая неделя прошла в боли и
страданиях. Программист Азер Кочулу удалил из NPM свои 100500 пакетов,
том числе один аж на 11 строк. Без него не смогли собраться React,
Babel и куча всего.</p>

<p>Азер удалил код потому, что администрация NPM в одностороннем порядке
передала права на пакет Kik от Азера к представителям одноименной
компании. Якобы юристы Kik запугали патентами и торговой маркой.</p>

<p>Развязка: Азер перенес все пакеты в Гитхаб, администрация NPM
запретила удалять пакеты по истечении 24 часов в момента
публикации. Азер на коне, он весь такой Д’Артаньян в белых перчатках,
в Твиттере пафосные картинки.</p>

<p>Страсти спадают, и теперь, после недели хаоса, следует подумать, кто в
это ситуации был мудаком.</p>

<p>Имеем три стороны – Азер, администрация NPM и юристы компании
Kik. Кто неправ в этой истории?</p>

<p>Первые два. Объясню с конца.</p>

<p>Юристы Kik действуют в своих интересах. Они стараются расширить
экспансию вверенного им продукта. Совершенно естественно, что их цель
– захватить имя Kik разных его проявлениях.</p>

<p>Поскольку под именем Kik размещен левый пакет, а компания хочет
предоставить разработчикам API, юристы начали переговоры о передаче
прав на пакет.</p>

<p>Азер обозвал их мудаками и послал на хуй (как было, так и перевел). А
в начале написал “Ха-ха”. Кто-то сомневается в неадекватности
пациента? Взрослый же человек, просто откажи, зачем оскорблять людей?</p>

<p>Увидев, что собеседник в неадеквате, юристы пишут администрации NPM. Я
бы тоже так поступил на их месте. Тут NPM жидко сливаются, передав
права без каких-либо документов и согласований. Да, пусть этот Азер
хамло, но права пользователей надо уважать.</p>

<p>Кто-то думает, что NPM зассали перед патентом на торговую марку “Kik”,
а на самом деле все просто – одни из основателей NPM работал в Kik
раньше. Это банальный блат, работает не только в России.</p>

<p>Поэтому администрация NPM – тоже мудаки.</p>

<p>Далее Айзер включил бунтаря и удалил все 250 пакетов, что успел к тому
времени наплодить. Многие из них успели стать зависимостями в других
пакетах. Айзер, прекрасно осознавая что делает, испортил жизнь тысячам
людей по всему земному шару.</p>

<p>Когда валютные вкладчики приковывают себя наручниками к дверям банка,
то и это не тот градус шизофрении, что ученил Азер. Это детская нужда
стать нужным. Послать миру весть, что без него нельзя обойтись.</p>

<p>Администрация NPM, к их чести, вынесла правильный урок. Теперь
запрещено удалять пакеты, с момента публикаций которых прошло больше
24 часов. Это правильно, потому что если разработчик выложил код, то
значит, он предлагает его другим, верно? Иначе зачем выкладывать,
ставь из приватного репозитория.</p>

<p>Не хочешь поддерживать – ставишь галку, что ищешь мейнтейнера,
передаешь права. Удалять – это нонсенс. Что будет, если каждый
разработчик, поругавшись в подружкой, начнет удалять модули? Это
строительство дома из пивных банок.</p>

<p>Давайте окинем быстрым взглядом 250 пакетов Азера. Двести пятьдесят,
Карл, как пишут в интернете.</p>

<ul>
  <li><a href="https://github.com/azer/run-paralelly">run-paralelly</a> – 11 комитов, 46 строк.</li>
  <li><a href="https://github.com/azer/left-pad">left-pad</a>, из-за которого сломался интернет. 11 комитов,
11 значимых строк. 660 звезд.</li>
  <li><a href="https://github.com/azer/flat-glob">flat-glob</a> – 6 комитов, 49 строк. Прогресс.</li>
  <li><a href="https://github.com/azer/get-object-path">get-object-path</a> – 9 комитов, 21 строка.</li>
  <li><a href="https://github.com/azer/rnd">rnd</a> – 1 комит, 8 строк.</li>
  <li><a href="https://github.com/azer/random-color">random-color</a> – 7 комитов, 8 строк.</li>
  <li><a href="https://github.com/azer/route-map">route-map</a> – 6 комитов, 55 строк.</li>
</ul>

<p>Ну ты понел.</p>

<p>В интернете точно пошутили, что чуваку нужен не Гитхаб, а
Твиттер. Каждый твит – новый пакет. Большая часть уместится в 140
символов, если переменные укоротить. А “тяжелые” проекты на 50 строк и
больше декомпозировать и подключить зависимостями.</p>

<p>Блин, у него декларация <code class="language-plaintext highlighter-rouge">package.json</code> занимает больше места, чем код.</p>

<p>Что мешает этому Азеру создать пакет <code class="language-plaintext highlighter-rouge">azer-tools</code> и наполнять его
утилитами? Принцип “один пакет – одна функция” это не глупость, a рак
мозга. Я не видел такого ни в одном другом языке.</p>

<p>Ничего удивительного, что подобное произошло. Странно, как такое до
сих пор не случилось, учитывая идиотизм разработчиков вроде
Азера. Когда ты строишь дом из пивных банок, всегда найдется тот, кто
выдернет самую нижнюю, потому что на дне еще осталось. И все упадет.</p>

<p>А ведь я помню поток статей в духе “Node.js спасет мир” пять лет
назад. 2016 на дворе, а в сообществе сканалы на уровне Дома-2.</p>

<p>На закуску – статья Теда Дзюбы
<a href="http://widgetsandshit.com/teddziuba/2011/10/node-js-is-cancer.html">“Node.Js Is Cancer”</a>. На Хабре был перевод.</p>

<p>Ссылки:</p>

<ul>
  <li><a href="https://meduza.io/feature/2016/03/28/kak-slomat-internet">Новость на Медузе</a></li>
  <li><a href="https://medium.com/@mproberts/a-discussion-about-the-breaking-of-the-internet-3d4d2a83aa4d">Переписка Азера</a></li>
  <li><a href="https://medium.com/@azerbike/i-ve-just-liberated-my-modules-9045c06be67c">Сообщение Азера о переносе модулей</a></li>
  <li><a href="https://habrahabr.ru/post/280099/">Что-то с Хабра</a></li>
</ul>


                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/code-data/">Что значит код как данные</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2016-03-26T00:00:00+00:00">
        Mar 26, 2016
    </time>

    <a href="/tag/code/" rel="tag">code</a>, <a href="/tag/data/" rel="tag">data</a>, <a href="/tag/programming/" rel="tag">programming</a>, <a href="/tag/lisp/" rel="tag">lisp</a>, <a href="/tag/macros/" rel="tag">macros</a>

</div>


            <div class="entry">
                
                    <p>Про Лисп говорят, что код это данные, а данные – код. Пока не
поработаешь с Лиспом, понять смысл кода как данных трудно. Ниже – моя
попытка объяснить простыми словами.</p>

<p>Предположим, кто-то осваивает Лисп и делает задачки вроде факториала и
рекурсии. Частенько приходится записывать числовые выражения вроде
<code class="language-plaintext highlighter-rouge">(x + y) * (a / b)</code>. В Лиспе пишут польской нотацией, то есть
выражение выглядит так:</p>

<div class="language-lisp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nb">*</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
   <span class="p">(</span><span class="nb">/</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">))</span>
</code></pre></div></div>

<p>Не очень привычно. Было бы здорово, думает студент, написать функцию,
которая принимает выражение как удобно мне, а возвращала то, что нужно
Лиспу. Начинает писать функцию <code class="language-plaintext highlighter-rouge">expr</code>, что-то вроде <code class="language-plaintext highlighter-rouge">(expr (x + y) *
(a / b))</code>.</p>

<p>Ничто не предвещает беды. Но вот облом: Лисп, как и другие ЯП,
вычисляет аргументы функции до входа в нее. А выражение <code class="language-plaintext highlighter-rouge">(x + y)...</code>
ошибочно с точки зрения и семантики, и синтаксиса, поэтому даже до
вызова функции <code class="language-plaintext highlighter-rouge">expr</code> дело не дойдет. Что же делать?</p>

<p>Помогут макросы.</p>

<p>Макрос похож на функцию, но с важным отличием. Выражение, переданное в
макрос, НЕ вычисляется. Вместо этого макрос получает список
лексем. Задача макроса – перестоить список в правильную Лисп-форму и
вернуть ее, НЕ вычисляя. Интерпретатор сам вычислит ее, получив из
макроса.</p>

<p>Короткими словами, макросу можно скормить полную дичь:
крестики-нолики, математическое выражение, кусок кода на любом языке,
asii-арт. Внутри макроса это станет списком. Задача макроса –
перестроить дичь в правильный список, который вычислит Лисп.</p>

<p>Именно в этот момент срабатывает срабатывает принцип
код-как-данные. Когда мы пишем <code class="language-plaintext highlighter-rouge">(expr (x + y) * (a / b))</code>, для нас это
код. Но внутри макроса это список! Нулевой элемент списка –
открывающая скобочка, первый – символ x, затем символ плюсика, и так
до последней закрывающей скобочки.</p>

<p>Рассмотрим макрос для вычисления выражений из двух операндов. Он
вычислит простейшие вещи вроде <code class="language-plaintext highlighter-rouge">3 + 2</code>, <code class="language-plaintext highlighter-rouge">2 * 10</code>, <code class="language-plaintext highlighter-rouge">-3 / 2</code>:</p>

<div class="language-lisp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nb">defmacro</span> <span class="nv">expr</span> <span class="nv">[v1</span> <span class="nv">op</span> <span class="nv">v2]</span>
  <span class="o">`</span><span class="p">(</span><span class="nv">~op</span> <span class="nv">~v1</span> <span class="nv">~v2</span><span class="p">))</span>

<span class="p">(</span><span class="nv">expr</span> <span class="mi">2</span> <span class="nb">+</span> <span class="mi">2</span><span class="p">)</span>
<span class="nv">&gt;&gt;&gt;</span> <span class="mi">4</span>
<span class="p">(</span><span class="nv">expr</span> <span class="mi">2</span> <span class="nb">/</span> <span class="mi">2</span><span class="p">)</span>
<span class="nv">&gt;&gt;&gt;</span> <span class="mi">1</span>
</code></pre></div></div>

<p>Видно что в макросе <code class="language-plaintext highlighter-rouge">expr</code> я поменял элементы списка
местами. Выражения длиней трех лексем макрос не примет. Для
проивольного выражения понадобятся разбор и рекурсивный спуск, что
выходит за рамки разговора.</p>

<p>Вот почему Лисп – программируемый язык программирования. Любой
участок кода может быть обработан как список, что делает язык
невероятно мощным. Лисп разрешает любой недостаток своими же
средствами. ООП-системы, средства обработки исключений и многие другие
фундаментальные вещи – всего лишь пакеты с макросами.</p>

<p>PS: Кроме Лиспа, я знаю только один язык со схожим поведенем. Это Tcl
(Тикль) – в котором, грубо говоря, все является строкой. Тикль до сих
пор популярен на производстве: заводах, CAD-системах. Нефтяные
платформы Shell работают под управлением системы, написанной на Тикле.</p>

                
            </div>

        </li>
        
    </ul>

    <h4>
        
        <a href="/page77" class="previous">&larr;</a>
        
        <span class="page_number ">Страница 78 из 97</span>
        
        <a href="/page79" class="next">&rarr;</a>
        
    </h4>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>Ivan Grishaev's blog</li>
          <li><a href="mailto:ivan@grishaev.me">ivan@grishaev.me</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
            <li><a href="https://github.com/igrishaev">GitHub</a></li>
            <li><a href="https://t.me/igrishaev_blog">Telegram</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>Writing on programming, education, books and negotiations.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
