<!DOCTYPE html>
<html lang="ru">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Ivan Grishaev's blog</title>
  <meta name="description" content="Writing on programming, education, books and negotiations.
">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/custom.css">
  <link rel="canonical" href="https://grishaev.me/page43/">
  <link rel="alternate" type="application/rss+xml" title="Ivan Grishaev's blog" href="https://grishaev.me/feed.xml">

  <link rel="shortcut icon" type="image/x-icon" href="/assets/static/favicons/favicon.ico">

  <script type="text/javascript" src="/assets/typo.js"></script>

</head>


  <body>
    <header class="site-header">

    <div class="wrapper flex-container">

        <div>
            <a href="/">
                <img id="avatar" src="/assets/static/avatar.jpg" alt="Ivan Grishaev">
            </a>
        </div>

        <div class="flex-container-vert" style="margin-left: 15px; width: 80%">

            <div class="flex-container full-width">
                <p style="margin-bottom: 5px">Ivan Grishaev's blog</p>
                <div class="flex-huge"></div>
                <div >
<form id="search-form"
      target="_blank"
      style="display: inline"
      method="get"
      action="https://www.google.com/search">

    <input name="sitesearch"
           value="grishaev.me"
           type="hidden">

    <input type="text"
           required="required"
           name="q"
           placeholder="Google search..."
           autocomplete="off">

    <button style="border: none; background-color: transparent; cursor: pointer;"
            type="submit">&#x1f50d;</button>

</form>
</div>
            </div>

            <p><small>Writing on programming, education, books and negotiations.
</small></p>

            <div class="flex-container">
                <a class="menu-item" href="/">Home</a>
                <a class="menu-item" href="/about/">About</a>
                <a class="menu-item" href="/bookshelf/">Bookshelf</a>
                <a class="menu-item" href="/feed.xml">RSS</a>
            </div>

            <div class="flex-container">
                <a class="menu-item minor" href="/tag/clojure/">Clojure</a>
                <a class="menu-item minor" href="/tag/emacs/">Emacs</a>
                <a class="menu-item minor" href="/tag/python/">Python</a>
                <a class="menu-item minor" href="/tag/programming/">Programming</a>
                <a class="menu-item minor" href="/interview/">Interview</a>
                <a class="menu-item minor" href="/video/">Video</a>
            </div>

            <div class="flex-container">
                <a class="menu-item minor hl" href="/clojure-in-prod/">Книга «Clojure на производстве»</a>
            </div>

            <div class="flex-container">
                <a class="menu-item minor hl" href="/clojure-in-prod-2/">Книга «Clojure на производстве», второй том</a>
            </div>

        </div>
    </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="home">

    <ul class="post-list">
        
        <li>

            <h2>
                <a class="post-link" href="/reality/">Реальность</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2017-09-05T00:00:00+00:00">
        Sep 5, 2017
    </time>

    <a href="/tag/reality/" rel="tag">reality</a>

</div>


            <div class="entry">
                
                    <p>В плане профессии я знаю очень мало.</p>

<p>На Си и Ассемблере писал только в институте, уже ничего не помню.</p>

<p>Плаваю в указателях, памяти, куче. Код на C++ не понимаю.</p>

<p>О нейросетях и машин-лернинге имею самые смутные представления.</p>

<p>Про Биткоин читал только пару бульварных статей.</p>

<p>Знаю три команды из Гита. Путаю, что куда мерджить.</p>

<p>Накупил книжек, поставил пылиться на полку.</p>

<p>Не напишу и пяти строчек на баше без интернетов.</p>

<p>Не дочитал SICP. Хотел сделать все практические задания, слился.</p>

<p>Кнут только в самых влажных мечтах.</p>

<p>Компилятор или язык в жизни не осилю.</p>

<p>Пилил свой проект, бросил.</p>

<p>Пишу на Кложе, но в Джаве ни бум-бум. На Кложе потому, что язык редкий.</p>

<p>Всю жизнь клепаю формочки к базе.</p>

<p>Ненавижу JS, потому что не понимаю его, или наоборот.</p>

<p>Емакс и Лисп чтобы быть не таким как все.</p>

<p>Говорю по-английски с проблемами. Ссу провести вебинар на английском.</p>

<p>Гуглю каждый HTML-тег. Копипащу со Стека.</p>

<p>Умничаю в чате. Высмеиваю мессаджеры, сам же ими пользуюсь.</p>

<p>Не знаю нужных хоткеев, не ставлю клевых программ.</p>

<p>Не трекаю время, непродуктивен. Прокрастинирую.</p>

<p>Разбираюсь только в Лиспе, Мейк-файлах и немного в Постгресе. Тем и живу.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/en/datomic-query/">Conditional Queries in Datomic</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2017-09-01T20:49:00+00:00">
        Sep 1, 2017
    </time>

    <a href="/tag/clojure/" rel="tag">clojure</a>, <a href="/tag/datomic/" rel="tag">datomic</a>, <a href="/tag/sql/" rel="tag">sql</a>

</div>


            <div class="entry">
                
                    <p>Let’s discuss one thing related to Clojure and Datomic that might be a bit
tricky especially if you have never faced it so far.</p>

<p>Imagine you return a list of some entities to the client. It might be a list of
orders, visits or whatever. Usually, when a user is exploring a long list of
something, it’s a good idea to let them filter the list by some criteria: price,
date, age etc. On the server side, you need to apply those filters
conditionally. Say, when the <code class="language-plaintext highlighter-rouge">date_from</code> query string parameter is passed, you
apply it to the query as well or live it untouched otherwise. The same for the
rest of filters.</p>

<p>Things become more tough when filters are applied to foreign entities. For
example, an order references a user, and a user references a department. If the
<code class="language-plaintext highlighter-rouge">department_name</code> parameter has been passed, you should join all the required
tables and filter a proper field.</p>

<p>Joining all the tables even if no filters were supplied is a wrong
approach. Join operations are expensive and should never be performed in vain. A
toolset that joins tables should take into account which ones has already been
added into a query and never link them twice.</p>

<p>Such systems that control the cases mentioned above are names ORMs. They are
pretty complicated and full of ugly code and implicit hacks. But on the top
level they behave quite friendly. Say, in <a href="https://www.djangoproject.com/">Django</a> (a major Python
framework) I would perform something like that:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">query</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">Order</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nb">all</span><span class="p">()</span>
<span class="n">department_name</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">query_string</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"department_name"</span><span class="p">)</span>
<span class="k">if</span> <span class="n">department_name</span><span class="p">:</span>
    <span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="p">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">user__department_name</span><span class="o">=</span><span class="n">department_name</span><span class="p">)</span>
</code></pre></div></div>

<p>Looks pretty neat. This automatically joins <code class="language-plaintext highlighter-rouge">users</code> and <code class="language-plaintext highlighter-rouge">department</code> tables
under the hood using <code class="language-plaintext highlighter-rouge">inner join</code> SQL clause and puts <code class="language-plaintext highlighter-rouge">department.name = ?</code>
condition into <code class="language-plaintext highlighter-rouge">where</code> section.</p>

<p>People who work with such non-wide spreaded languages as Clojure usually do not
use ORMs. But still, we need to build complicated queries. The community offers
a handful of libraries (<a href="https://github.com/krisajenkins/yesql">YeSQL</a>, <a href="https://github.com/jkk/honeysql">HoneySQL</a>, <a href="https://github.com/korma/Korma">Korma</a>)
where a query is being constructed within data structures: vectors, maps. I’ve
been always against that approach. Before getting more experienced with Clojure,
I felt uncomfortable constructing nested vectors like this one:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[:select [:foo :bar]
 :from :test
 :where [(= :name "test")
         (when age-param
           (&gt; :age age-param))]]
</code></pre></div></div>

<p>The reason why I do not appreciate that is I cannot see the final query behind
brackets and colons. It will definitely fail me once I need to express
something like this (a fragment of a query from production):</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">select</span>
  <span class="n">foo</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
  <span class="n">array_agg</span><span class="p">(</span><span class="n">foo</span><span class="p">.</span><span class="n">type_id</span><span class="p">)</span> <span class="n">filter</span> <span class="p">(</span><span class="k">where</span> <span class="n">foo</span> <span class="k">is</span> <span class="k">not</span> <span class="k">null</span><span class="p">)</span> <span class="k">as</span> <span class="n">type_ids</span><span class="p">,</span>
  <span class="n">foo</span><span class="p">.</span><span class="n">name</span>
<span class="k">from</span> <span class="n">foo_table</span> <span class="k">as</span> <span class="n">foo</span>
</code></pre></div></div>

<p>Modern libraries say it’s easy and fun to express your queries through data
structures, but it is not, really. It becomes a challenge when applying multiple
conditions to a data structure without seeing the final result.</p>

<p>A good approach might be using a templating system. Say, <a href="https://github.com/layerware/hugsql">HugSQL</a>
library allows to inject Clojure snippets into your SQL query. Those snippets
are surrounded with standard SQL comments so they do not break syntax. There
won’t be an error if you copy and paste such a Clojure-instrumented query into
some RDBS administration tool.</p>

<p>Here is an example of declaring such a query:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- :name get-oreders :?</span>
<span class="k">select</span> <span class="n">o</span><span class="p">.</span><span class="o">*</span>
<span class="k">from</span> <span class="n">oreders</span> <span class="n">o</span>
<span class="cm">/*~ (when (:department-name params) ~*/</span>
<span class="k">join</span> <span class="k">user</span> <span class="n">u</span> <span class="k">on</span> <span class="n">o</span><span class="p">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span>
<span class="k">join</span> <span class="n">departments</span> <span class="n">d</span> <span class="k">on</span> <span class="k">user</span><span class="p">.</span><span class="n">department_id</span> <span class="o">=</span> <span class="n">d</span><span class="p">.</span><span class="n">id</span>
<span class="k">where</span>
    <span class="n">d</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="p">:</span><span class="n">department</span><span class="o">-</span><span class="n">name</span>
<span class="cm">/*~ ) ~*/</span>
<span class="k">order</span> <span class="k">by</span> <span class="n">o</span><span class="p">.</span><span class="n">created_at</span><span class="p">;</span>
</code></pre></div></div>

<p>Than it compiles into a Clojure function:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">;; no joins, no filters</span><span class="w">
</span><span class="p">(</span><span class="nf">get-oreders</span><span class="w"> </span><span class="n">db</span><span class="p">)</span><span class="w">

</span><span class="c1">;; causes joins and filtering</span><span class="w">
</span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">[</span><span class="n">dep-name</span><span class="w"> </span><span class="p">(</span><span class="nb">-&gt;</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="no">:params</span><span class="w"> </span><span class="no">:department-name</span><span class="p">)]</span><span class="w">
  </span><span class="p">(</span><span class="nf">get-oreders</span><span class="w"> </span><span class="n">db</span><span class="w"> </span><span class="p">{</span><span class="no">:department-name</span><span class="w"> </span><span class="n">dep-name</span><span class="p">}))</span><span class="w">
</span></code></pre></div></div>

<p>You may go further and include <a href="https://github.com/yogthos/Selmer">Selmer</a>, a template library inspired by
Django. It’s aimed at HTML rendering first but still may be used for any kind of
documents including SQL.</p>

<p>As I see it, a good templating system would be enough to generate SQL that fits
your business logic.</p>

<p>Now I’d like to discuss the same problem when using Datomic instead of classical
RDBS solutions. All the tutorials that I have read do not cover a case then you
need to apply several filters to a query. Suddenly, it may really become a
problem. Let’s return to our example with orders. Once you don’t have any
filters, the query looks simple:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">'</span><span class="p">[</span><span class="no">:find</span><span class="w"> </span><span class="p">(</span><span class="nf">pull</span><span class="w"> </span><span class="n">?o</span><span class="w"> </span><span class="p">[</span><span class="nb">*</span><span class="p">])</span><span class="w">
  </span><span class="no">:in</span><span class="w"> </span><span class="n">$</span><span class="w">
  </span><span class="no">:where</span><span class="w"> </span><span class="p">[</span><span class="n">?o</span><span class="w"> </span><span class="no">:order/number</span><span class="p">]]</span><span class="w">
</span></code></pre></div></div>

<p>But if you’ve got a department name you need to:</p>

<ol>
  <li>inject a new parameter into <code class="language-plaintext highlighter-rouge">:in</code> section;</li>
  <li>inject additional clauses into <code class="language-plaintext highlighter-rouge">:where</code> section;</li>
  <li>prevent joining a user or a department entities twice if you need to filter
by other department or user field.</li>
</ol>

<p>As we’ve seen, once you have a template system, you may render SQL queries as
well. All you need is to write a query, test how does it behaves and then wrap
some parts of it with special conditional tags.</p>

<p>In Datomic, a query is usually a vector of symbols. Moreover, an immutable
one. Thus, you cannot modify a query and adding something in the middle of it
would be difficult. Surely you could wrap a query into an atom or track indexes
where to inject a new item somehow but all of that would be a mess.</p>

<p>What I propose is using a special kind of a query represented as a map with
<code class="language-plaintext highlighter-rouge">:find</code>, <code class="language-plaintext highlighter-rouge">:where</code> and other keys. As
the <a href="http://docs.datomic.com/query.html#list-vs-map">Datomic documentation says</a>, when processing a query, every
vector is turned into a map anyway. If we had a map, it would be easier to
inject new items into it.</p>

<p>To avoid wrapping a map with an atom or redefining it continuously inside <code class="language-plaintext highlighter-rouge">let</code>
clause, there is a great form named <a href="https://clojuredocs.org/clojure.core/cond-%3E">cond-&gt;</a>. It is a mix of both
threading macro and <code class="language-plaintext highlighter-rouge">cond</code> clause. It takes an initial value and a bunch of
predicate/update pairs. If a predicate form evaluates in true, an update form is
fired using the standard threading macro. Thus, an update form should be either
a function or a list where the second argument is missing and will be
substituted with a value from a previous pair.</p>

<p>What’s the most interesting about <code class="language-plaintext highlighter-rouge">cond-&gt;</code> is unlike <code class="language-plaintext highlighter-rouge">cond</code> or <code class="language-plaintext highlighter-rouge">case</code> forms, its
branches are evaluated continuously. Each update form takes a value that a
previous form has produced. In other terms, an initial value goes through
multiple updates without being saved in some temporary variable.</p>

<p>In example below, I’ve got a data set that consists from <code class="language-plaintext highlighter-rouge">user</code>, <code class="language-plaintext highlighter-rouge">location</code> and
<code class="language-plaintext highlighter-rouge">visit</code> entities. Both <code class="language-plaintext highlighter-rouge">user</code> and <code class="language-plaintext highlighter-rouge">location</code> are simple ones and store just
dates, strings and so on. A <code class="language-plaintext highlighter-rouge">visit</code> is a bit more complex. It means that a user
has visited a location and assigned a mark to it. Therefore, a visit references
a user and a location entities as well.</p>

<p>The goal is to get an average mark for a specific location. In addition, such a
value might be filtered by user’s age, gender or location’s country name. Those
parameters come from a query string and could be either totally skipped, passed
partially or completely. I’ve got a function that accepts a location id and a
map of optional parameters:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">location-avg</span><span class="w">
  </span><span class="p">[</span><span class="n">location-id</span><span class="w"> </span><span class="p">{</span><span class="no">:keys</span><span class="w"> </span><span class="p">[</span><span class="n">fromDate</span><span class="w">
                       </span><span class="n">toDate</span><span class="w">
                       </span><span class="n">fromAge</span><span class="w">
                       </span><span class="n">toAge</span><span class="w">
                       </span><span class="n">gender</span><span class="p">]}]</span><span class="w">

</span></code></pre></div></div>

<p>The initial Datomic query:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">def</span><span class="w"> </span><span class="n">query-initial</span><span class="w">
  </span><span class="o">'</span><span class="p">{</span><span class="no">:find</span><span class="w"> </span><span class="p">[(</span><span class="nf">avg</span><span class="w"> </span><span class="n">?mark</span><span class="p">)</span><span class="w"> </span><span class="nb">.</span><span class="p">]</span><span class="w">
    </span><span class="no">:with</span><span class="w"> </span><span class="p">[</span><span class="n">?v</span><span class="p">]</span><span class="w">
    </span><span class="no">:in</span><span class="w"> </span><span class="p">[</span><span class="n">$</span><span class="w"> </span><span class="n">?location</span><span class="p">]</span><span class="w">
    </span><span class="no">:args</span><span class="w"> </span><span class="p">[]</span><span class="w">
    </span><span class="no">:where</span><span class="w"> </span><span class="p">[[</span><span class="n">?v</span><span class="w"> </span><span class="no">:location</span><span class="w"> </span><span class="n">?location</span><span class="p">]</span><span class="w">
            </span><span class="p">[</span><span class="n">?v</span><span class="w"> </span><span class="no">:mark</span><span class="w"> </span><span class="n">?mark</span><span class="p">]]})</span><span class="w">
</span></code></pre></div></div>

<p>Now, here is a long pipeline with comments:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">cond-&gt;</span><span class="w"> </span><span class="n">query-initial</span><span class="w">

  </span><span class="c1">;; First, add two initial arguments: database instance and location reference.</span><span class="w">
  </span><span class="c1">;; This form will always be evaluated.</span><span class="w">
  </span><span class="n">true</span><span class="w">
  </span><span class="p">(</span><span class="nf">update</span><span class="w"> </span><span class="no">:args</span><span class="w"> </span><span class="nb">conj</span><span class="w">
          </span><span class="p">(</span><span class="nf">get-db</span><span class="p">)</span><span class="w">                    </span><span class="c1">;; returns the DB instance</span><span class="w">
          </span><span class="p">[</span><span class="no">:location/id</span><span class="w"> </span><span class="n">location-id</span><span class="p">])</span><span class="w"> </span><span class="c1">;; location reference</span><span class="w">

  </span><span class="c1">;; If either from- or to- date were passed, join the `visit` entity</span><span class="w">
  </span><span class="c1">;; and bind its `visited_at` attribute to the `?visited-at` variable.</span><span class="w">
  </span><span class="p">(</span><span class="nb">or</span><span class="w"> </span><span class="n">fromDate</span><span class="w"> </span><span class="n">toDate</span><span class="p">)</span><span class="w">
  </span><span class="p">(</span><span class="nf">update</span><span class="w"> </span><span class="no">:where</span><span class="w"> </span><span class="nb">conj</span><span class="w">
          </span><span class="o">'</span><span class="p">[</span><span class="n">?v</span><span class="w"> </span><span class="no">:visited_at</span><span class="w"> </span><span class="n">?visited-at</span><span class="p">])</span><span class="w">

  </span><span class="c1">;; If the `fromDate` filter was passed, do the following:</span><span class="w">
  </span><span class="c1">;; 1. add a parameter placeholder into the query;</span><span class="w">
  </span><span class="c1">;; 2. add an actual value to the arguments;</span><span class="w">
  </span><span class="c1">;; 3. add a proper condition against `?visited-at` variable</span><span class="w">
  </span><span class="c1">;; (remember, it was bound above).</span><span class="w">
  </span><span class="n">fromDate</span><span class="w">
  </span><span class="p">(</span><span class="nb">-&gt;</span><span class="w">
   </span><span class="p">(</span><span class="nf">update</span><span class="w"> </span><span class="no">:in</span><span class="w"> </span><span class="nb">conj</span><span class="w"> </span><span class="ss">'?fromDate</span><span class="p">)</span><span class="w">
   </span><span class="p">(</span><span class="nf">update</span><span class="w"> </span><span class="no">:args</span><span class="w"> </span><span class="nb">conj</span><span class="w"> </span><span class="n">fromDate</span><span class="p">)</span><span class="w">
   </span><span class="p">(</span><span class="nf">update</span><span class="w"> </span><span class="no">:where</span><span class="w"> </span><span class="nb">conj</span><span class="w">
           </span><span class="o">'</span><span class="p">[(</span><span class="nb">&gt;</span><span class="w"> </span><span class="n">?visited-at</span><span class="w"> </span><span class="n">?fromDate</span><span class="p">)]))</span><span class="w">

  </span><span class="c1">;; Do the same steps for the `toDate` filter,</span><span class="w">
  </span><span class="c1">;; but the condition slightly differs (&lt; instead of &gt;).</span><span class="w">
  </span><span class="n">toDate</span><span class="w">
  </span><span class="p">(</span><span class="nb">-&gt;</span><span class="w">
   </span><span class="p">(</span><span class="nf">update</span><span class="w"> </span><span class="no">:in</span><span class="w"> </span><span class="nb">conj</span><span class="w"> </span><span class="ss">'?toDate</span><span class="p">)</span><span class="w">
   </span><span class="p">(</span><span class="nf">update</span><span class="w"> </span><span class="no">:args</span><span class="w"> </span><span class="nb">conj</span><span class="w"> </span><span class="n">toDate</span><span class="p">)</span><span class="w">
   </span><span class="p">(</span><span class="nf">update</span><span class="w"> </span><span class="no">:where</span><span class="w"> </span><span class="nb">conj</span><span class="w">
           </span><span class="o">'</span><span class="p">[(</span><span class="nb">&lt;</span><span class="w"> </span><span class="n">?visited-at</span><span class="w"> </span><span class="n">?toDate</span><span class="p">)]))</span><span class="w">

  </span><span class="c1">;; To filter by user's fields, we bind a user reference</span><span class="w">
  </span><span class="c1">;; to the `?user` variable:</span><span class="w">
  </span><span class="p">(</span><span class="nb">or</span><span class="w"> </span><span class="n">fromAge</span><span class="w"> </span><span class="n">toAge</span><span class="w"> </span><span class="n">gender</span><span class="p">)</span><span class="w">
  </span><span class="p">(</span><span class="nf">update</span><span class="w"> </span><span class="no">:where</span><span class="w"> </span><span class="nb">conj</span><span class="w">
          </span><span class="o">'</span><span class="p">[</span><span class="n">?v</span><span class="w"> </span><span class="no">:user</span><span class="w"> </span><span class="n">?user</span><span class="p">])</span><span class="w">

  </span><span class="c1">;; If from/to age filters we passed, bind user's age</span><span class="w">
  </span><span class="c1">;; to the `?birth-date` variable.</span><span class="w">
  </span><span class="p">(</span><span class="nb">or</span><span class="w"> </span><span class="n">fromAge</span><span class="w"> </span><span class="n">toAge</span><span class="p">)</span><span class="w">
  </span><span class="p">(</span><span class="nf">update</span><span class="w"> </span><span class="no">:where</span><span class="w"> </span><span class="nb">conj</span><span class="w">
          </span><span class="o">'</span><span class="p">[</span><span class="n">?user</span><span class="w"> </span><span class="no">:birth_date</span><span class="w"> </span><span class="n">?birth-date</span><span class="p">])</span><span class="w">

  </span><span class="c1">;; Then add placeholders, arguments and where clauses</span><span class="w">
  </span><span class="c1">;; for specific filters: fromAge, if passed...</span><span class="w">
  </span><span class="n">fromAge</span><span class="w">
  </span><span class="p">(</span><span class="nb">-&gt;</span><span class="w">
   </span><span class="p">(</span><span class="nf">update</span><span class="w"> </span><span class="no">:in</span><span class="w"> </span><span class="nb">conj</span><span class="w"> </span><span class="ss">'?fromAge</span><span class="p">)</span><span class="w">
   </span><span class="p">(</span><span class="nf">update</span><span class="w"> </span><span class="no">:args</span><span class="w"> </span><span class="nb">conj</span><span class="w"> </span><span class="p">(</span><span class="nf">age-to-ts</span><span class="w"> </span><span class="n">fromAge</span><span class="p">))</span><span class="w">
   </span><span class="p">(</span><span class="nf">update</span><span class="w"> </span><span class="no">:where</span><span class="w"> </span><span class="nb">conj</span><span class="w">
           </span><span class="o">'</span><span class="p">[(</span><span class="nb">&lt;</span><span class="w"> </span><span class="n">?birth-date</span><span class="w"> </span><span class="n">?fromAge</span><span class="p">)]))</span><span class="w">

  </span><span class="c1">;; ...and the same for toAge.</span><span class="w">
  </span><span class="n">toAge</span><span class="w">
  </span><span class="p">(</span><span class="nb">-&gt;</span><span class="w">
   </span><span class="p">(</span><span class="nf">update</span><span class="w"> </span><span class="no">:in</span><span class="w"> </span><span class="nb">conj</span><span class="w"> </span><span class="ss">'?toAge</span><span class="p">)</span><span class="w">
   </span><span class="p">(</span><span class="nf">update</span><span class="w"> </span><span class="no">:args</span><span class="w"> </span><span class="nb">conj</span><span class="w"> </span><span class="p">(</span><span class="nf">age-to-ts</span><span class="w"> </span><span class="n">toAge</span><span class="p">))</span><span class="w">
   </span><span class="p">(</span><span class="nf">update</span><span class="w"> </span><span class="no">:where</span><span class="w"> </span><span class="nb">conj</span><span class="w">
           </span><span class="o">'</span><span class="p">[(</span><span class="nb">&gt;</span><span class="w"> </span><span class="n">?birth-date</span><span class="w"> </span><span class="n">?toAge</span><span class="p">)]))</span><span class="w">

  </span><span class="c1">;; To filter by gender, bind user's gender to a variable</span><span class="w">
  </span><span class="c1">;; and add a clause:</span><span class="w">
  </span><span class="n">gender</span><span class="w">
  </span><span class="p">(</span><span class="nb">-&gt;</span><span class="w">
   </span><span class="p">(</span><span class="nf">update</span><span class="w"> </span><span class="no">:in</span><span class="w"> </span><span class="nb">conj</span><span class="w"> </span><span class="ss">'?gender</span><span class="p">)</span><span class="w">
   </span><span class="p">(</span><span class="nf">update</span><span class="w"> </span><span class="no">:args</span><span class="w"> </span><span class="nb">conj</span><span class="w"> </span><span class="n">gender</span><span class="p">)</span><span class="w">
   </span><span class="p">(</span><span class="nf">update</span><span class="w"> </span><span class="no">:where</span><span class="w"> </span><span class="nb">conj</span><span class="w">
           </span><span class="o">'</span><span class="p">[</span><span class="n">?user</span><span class="w"> </span><span class="no">:gender</span><span class="w"> </span><span class="n">?gender</span><span class="p">]))</span><span class="w">

  </span><span class="c1">;; The final step is to remap a query (see below).</span><span class="w">
  </span><span class="n">true</span><span class="w">
  </span><span class="n">remap-query</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Remapping a query is important because the initial data is a bit wrong. The
proper structure for a map query looks as follows:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="no">:query</span><span class="w"> </span><span class="n">&lt;query-map&gt;</span><span class="w">
 </span><span class="no">:args</span><span class="w"> </span><span class="p">[</span><span class="n">db</span><span class="w"> </span><span class="n">location_id</span><span class="w"> </span><span class="n">fromDate</span><span class="w"> </span><span class="n">...</span><span class="p">]}</span><span class="w">
</span></code></pre></div></div>

<p>In my case, I believe it’s simpler to keep one-level map rather than deal with
two levels (<code class="language-plaintext highlighter-rouge">:query</code> first, then <code class="language-plaintext highlighter-rouge">:args</code>). It would force me to use <code class="language-plaintext highlighter-rouge">update-in</code>
instead if just <code class="language-plaintext highlighter-rouge">update</code> and write more code. Here is the <code class="language-plaintext highlighter-rouge">remap-query</code>
function:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">remap-query</span><span class="w">
  </span><span class="p">[{</span><span class="n">args</span><span class="w"> </span><span class="no">:args</span><span class="w"> </span><span class="no">:as</span><span class="w"> </span><span class="n">m</span><span class="p">}]</span><span class="w">
  </span><span class="p">{</span><span class="no">:query</span><span class="w"> </span><span class="p">(</span><span class="nb">dissoc</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="no">:args</span><span class="p">)</span><span class="w">
   </span><span class="no">:args</span><span class="w"> </span><span class="n">args</span><span class="p">})</span><span class="w">
</span></code></pre></div></div>

<p>Finally, let’s check our results. If somebody passes all the filters, the query
will look like:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="no">:query</span><span class="w">
 </span><span class="p">{</span><span class="no">:find</span><span class="w"> </span><span class="p">[(</span><span class="nf">avg</span><span class="w"> </span><span class="n">?mark</span><span class="p">)</span><span class="w"> </span><span class="nb">.</span><span class="p">]</span><span class="n">,</span><span class="w">
  </span><span class="no">:with</span><span class="w"> </span><span class="p">[</span><span class="n">?v</span><span class="p">]</span><span class="n">,</span><span class="w">
  </span><span class="no">:in</span><span class="w"> </span><span class="p">[</span><span class="n">$</span><span class="w"> </span><span class="n">?location</span><span class="w"> </span><span class="n">?fromDate</span><span class="w"> </span><span class="n">?toDate</span><span class="w"> </span><span class="n">?fromAge</span><span class="w"> </span><span class="n">?toAge</span><span class="w"> </span><span class="n">?gender</span><span class="p">]</span><span class="n">,</span><span class="w">
  </span><span class="no">:where</span><span class="w">
  </span><span class="p">[[</span><span class="n">?v</span><span class="w"> </span><span class="no">:location</span><span class="w"> </span><span class="n">?location</span><span class="p">]</span><span class="w">
   </span><span class="p">[</span><span class="n">?v</span><span class="w"> </span><span class="no">:mark</span><span class="w"> </span><span class="n">?mark</span><span class="p">]</span><span class="w">
   </span><span class="p">[</span><span class="n">?v</span><span class="w"> </span><span class="no">:visited_at</span><span class="w"> </span><span class="n">?visited-at</span><span class="p">]</span><span class="w">
   </span><span class="p">[(</span><span class="nb">&gt;</span><span class="w"> </span><span class="n">?visited-at</span><span class="w"> </span><span class="n">?fromDate</span><span class="p">)]</span><span class="w">
   </span><span class="p">[(</span><span class="nb">&lt;</span><span class="w"> </span><span class="n">?visited-at</span><span class="w"> </span><span class="n">?toDate</span><span class="p">)]</span><span class="w">
   </span><span class="p">[</span><span class="n">?v</span><span class="w"> </span><span class="no">:user</span><span class="w"> </span><span class="n">?user</span><span class="p">]</span><span class="w">
   </span><span class="p">[</span><span class="n">?user</span><span class="w"> </span><span class="no">:birth_date</span><span class="w"> </span><span class="n">?birth-date</span><span class="p">]</span><span class="w">
   </span><span class="p">[(</span><span class="nb">&lt;</span><span class="w"> </span><span class="n">?birth-date</span><span class="w"> </span><span class="n">?fromAge</span><span class="p">)]</span><span class="w">
   </span><span class="p">[(</span><span class="nb">&gt;</span><span class="w"> </span><span class="n">?birth-date</span><span class="w"> </span><span class="n">?toAge</span><span class="p">)]</span><span class="w">
   </span><span class="p">[</span><span class="n">?user</span><span class="w"> </span><span class="no">:gender</span><span class="w"> </span><span class="n">?gender</span><span class="p">]]}</span><span class="n">,</span><span class="w">
 </span><span class="no">:args</span><span class="w"> </span><span class="p">[</span><span class="n">&lt;db-object&gt;</span><span class="w"> </span><span class="p">[</span><span class="no">:location/id</span><span class="w"> </span><span class="mi">42</span><span class="p">]</span><span class="w"> </span><span class="mi">1504210734</span><span class="w"> </span><span class="mi">1504280734</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="s">"m"</span><span class="p">]}</span><span class="w">
</span></code></pre></div></div>

<p>Now you pass it into <a href="http://docs.datomic.com/clojure/#datomic.api/query">datomic.api/query</a> function that accepts a map-like
query. In my case, the result is something like: <code class="language-plaintext highlighter-rouge">4.18525</code>.</p>

<p>As you have seen, composing complicated queries with Datomic might a bit tricky
due do immutability and differences between string templates and data
structures. But still, Clojure provides rich set of tools for processing
collections. In my case, the standard <code class="language-plaintext highlighter-rouge">cond-&gt;</code> has made all the
pipeline. Neither atoms nor other tricks to track the state were required. There
is a common rule: once you’ve got stuck with a data structure, keep yourself
from inventing “smart” ways to deal with it. There is probably a built-in macro
in <code class="language-plaintext highlighter-rouge">clojure.core</code> for that.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/facebook/">Фейсбук прекрасен</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2017-09-01T00:00:00+00:00">
        Sep 1, 2017
    </time>

    <a href="/tag/idiots/" rel="tag">idiots</a>, <a href="/tag/facebook/" rel="tag">facebook</a>

</div>


            <div class="entry">
                
                    <p>Каждый месяц повторяется печальное событие: мне нужно зайти в ФБ и сделать анонс
митапа. Я тяну время, но часа X не избежать.</p>

<p><img src="/assets/static/facebook.png" alt="facebook" /></p>

<p>Даже не знаю, что может быть хуже Фейсбука: столь тормозной и неорганизованный
сайт еще поискать. При том что денег у них до жопы.</p>

<p>Погрязли в жадности и бюрократизме.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/en/clj-sqlite/">In-Memory SQLite Database In Clojure</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2017-08-22T00:00:00+00:00">
        Aug 22, 2017
    </time>

    <a href="/tag/clojure/" rel="tag">clojure</a>, <a href="/tag/sqlite/" rel="tag">sqlite</a>, <a href="/tag/jdbc/" rel="tag">jdbc</a>

</div>


            <div class="entry">
                
                    <p>Recently, I’ve been working with a SQLite database using Clojure. In this post,
I’d like to share my experience that I’ve got from that challenge.</p>

<p>SQLite is a great tool used almost everywhere. Browsers and mobile devices use
it a lot. A SQLite database is represented by a single file that makes it quite
easy to share, backup and distribute. It supports most of the production-level
databases’ features like triggers, recursive queries and so on.</p>

<p>In addition, SQLite has a killer feature to be run completely in memory. So,
instead of keeping an atom of nested maps, why not to store some temporary data
into well organized tables?</p>

<p>JDBC has SQLite support as well, you only need to install a driver, the
documentation says. But then, I’ve got a problem dealing with in-memory
database:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">def</span><span class="w"> </span><span class="n">spec</span><span class="w">
  </span><span class="p">{</span><span class="no">:classname</span><span class="w">   </span><span class="s">"org.sqlite.JDBC"</span><span class="w">
   </span><span class="no">:subprotocol</span><span class="w"> </span><span class="s">"sqlite"</span><span class="w">
   </span><span class="no">:subname</span><span class="w">     </span><span class="s">":memory:"</span><span class="p">})</span><span class="w">

</span><span class="p">(</span><span class="nf">jdbc/execute!</span><span class="w"> </span><span class="n">spec</span><span class="w"> </span><span class="s">"create table users (id integer)"</span><span class="p">)</span><span class="w">
</span><span class="p">(</span><span class="nf">jdbc/query</span><span class="w"> </span><span class="n">spec</span><span class="w"> </span><span class="s">"select * from users"</span><span class="p">)</span><span class="w">

</span><span class="nb">&gt;</span><span class="w"> </span><span class="n">SQLiteException</span><span class="w"> </span><span class="p">[</span><span class="n">SQLITE_ERROR</span><span class="p">]</span><span class="w"> </span><span class="n">SQL</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="nb">or</span><span class="w"> </span><span class="n">missing</span><span class="w"> </span><span class="n">database</span><span class="w">
</span><span class="nb">&gt;</span><span class="w"> </span><span class="p">(</span><span class="nf">no</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="n">table</span><span class="err">:</span><span class="w"> </span><span class="n">users</span><span class="p">)</span><span class="w">  </span><span class="n">org.sqlite.core.DB.newSQLException</span><span class="w"> </span><span class="p">(</span><span class="nf">DB.java</span><span class="no">:909</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>What the… I’ve just created a table, why cannot you find it? An interesting
note, if I set a proper file name for the <code class="language-plaintext highlighter-rouge">:subname</code> field, everything works
fine. But I needed a in-memory database, not a file.</p>

<p>After some hours of googling and reading the code I’ve found the solution.</p>

<p>The thing is, JDBC does not track DB connections by default. Every time you call
for <code class="language-plaintext highlighter-rouge">(jdbc/*)</code> function, you create a new connection, perform an operation and
close it. For such persistent data storages like Postgres or MySQL that’ fine
although not effective (in our project, we use HikariCP to have a pool of open
connections).</p>

<p>But for in-memory SQLite database, closing a connection to it leads to wiping
the data completely out form the RAM. So you need to track the connection in
more precision way. You will create a connection by yourself and close it when
the work is done.</p>

<p>First, let’s setup your project:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">:dependencies</span><span class="w"> </span><span class="p">[</span><span class="n">...</span><span class="w">
               </span><span class="p">[</span><span class="n">org.xerial/sqlite-jdbc</span><span class="w"> </span><span class="s">"3.20.0"</span><span class="p">]</span><span class="w">
               </span><span class="p">[</span><span class="n">org.clojure/java.jdbc</span><span class="w"> </span><span class="s">"0.7.0"</span><span class="p">]</span><span class="w">
               </span><span class="p">[</span><span class="n">com.layerware/hugsql</span><span class="w"> </span><span class="s">"0.4.7"</span><span class="p">]</span><span class="w">
               </span><span class="p">[</span><span class="n">mount</span><span class="w"> </span><span class="s">"0.1.11"</span><span class="p">]</span><span class="w">
               </span><span class="n">...</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<p>and the database module:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">ns</span><span class="w"> </span><span class="n">project.db</span><span class="w">
  </span><span class="p">(</span><span class="no">:require</span><span class="w"> </span><span class="p">[</span><span class="n">mount.core</span><span class="w"> </span><span class="no">:as</span><span class="w"> </span><span class="n">mount</span><span class="p">]</span><span class="w">
            </span><span class="p">[</span><span class="n">hugsql.core</span><span class="w"> </span><span class="no">:as</span><span class="w"> </span><span class="n">hugsql</span><span class="p">]</span><span class="w">
            </span><span class="p">[</span><span class="n">clojure.java.jdbc</span><span class="w"> </span><span class="no">:as</span><span class="w"> </span><span class="n">jdbc</span><span class="p">]))</span><span class="w">
</span></code></pre></div></div>

<p>Declare a database URI as follows:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">def</span><span class="w"> </span><span class="n">db-uri</span><span class="w"> </span><span class="s">"jdbc:sqlite::memory:"</span><span class="w">
</span></code></pre></div></div>

<p>Our database shares two states: when it’s been set up and ready to work and when
it has not. To keep the state, let’s use <code class="language-plaintext highlighter-rouge">mount</code> library:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">declare</span><span class="w"> </span><span class="n">db</span><span class="p">)</span><span class="w">

</span><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">on-start</span><span class="w"> </span><span class="p">[]</span><span class="w">
  </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">[</span><span class="n">spec</span><span class="w"> </span><span class="p">{</span><span class="no">:connection-uri</span><span class="w"> </span><span class="n">db-uri</span><span class="p">}</span><span class="w">
        </span><span class="n">conn</span><span class="w"> </span><span class="p">(</span><span class="nf">jdbc/get-connection</span><span class="w"> </span><span class="n">spec</span><span class="p">)]</span><span class="w">
    </span><span class="p">(</span><span class="nb">assoc</span><span class="w"> </span><span class="n">spec</span><span class="w"> </span><span class="no">:connection</span><span class="w"> </span><span class="n">conn</span><span class="p">)))</span><span class="w">

</span><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">on-stop</span><span class="w"> </span><span class="p">[]</span><span class="w">
  </span><span class="p">(</span><span class="nb">-&gt;</span><span class="w"> </span><span class="n">db</span><span class="w"> </span><span class="no">:connection</span><span class="w"> </span><span class="n">.close</span><span class="p">)</span><span class="w">
  </span><span class="n">nil</span><span class="p">)</span><span class="w">

</span><span class="p">(</span><span class="nf">mount/defstate</span><span class="w">
  </span><span class="o">^</span><span class="p">{</span><span class="no">:on-reload</span><span class="w"> </span><span class="no">:noop</span><span class="p">}</span><span class="w">
  </span><span class="n">db</span><span class="w">
  </span><span class="no">:start</span><span class="w"> </span><span class="p">(</span><span class="nf">on-start</span><span class="p">)</span><span class="w">
  </span><span class="no">:stop</span><span class="w"> </span><span class="p">(</span><span class="nf">on-stop</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p>Once you call <code class="language-plaintext highlighter-rouge">(mount/start #'db)</code>, it becomes a map with the following fields:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="no">:connection-uri</span><span class="w"> </span><span class="s">"jdbc:sqlite::memory:"</span><span class="w">
 </span><span class="no">:connection</span><span class="w"> </span><span class="n">&lt;SomeJavaConnectionObject</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="mi">0</span><span class="n">x0...&gt;</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>When any JDBC function or a method accepts that map, it checks for the
<code class="language-plaintext highlighter-rouge">:connection</code> field. If it’s filled, JDBC uses that connection as well. If it’s
not, a new connection is issued. In my case, every execute/query call created a
new in-memory database and stopped it right after the call ends. That’s why the
second query could not to find <code class="language-plaintext highlighter-rouge">users</code> table: because it was performed within
another database.</p>

<p>Now with the <code class="language-plaintext highlighter-rouge">db</code> started, you are welcome to perform all the standard <code class="language-plaintext highlighter-rouge">jdbc</code>
operations:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">jdbc/execute!</span><span class="w"> </span><span class="n">db</span><span class="w"> </span><span class="s">"create table users (id integer, name text)"</span><span class="p">)</span><span class="w">
</span><span class="p">(</span><span class="nf">jdbc/insert!</span><span class="w"> </span><span class="n">db</span><span class="w"> </span><span class="no">:users</span><span class="w"> </span><span class="p">{</span><span class="no">:id</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="no">:name</span><span class="w"> </span><span class="s">"Ivan"</span><span class="p">})</span><span class="w">
</span><span class="p">(</span><span class="nf">jdbc/get-by-id</span><span class="w"> </span><span class="n">db</span><span class="w"> </span><span class="no">:users</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="c1">;; {:id 1 :name "Ivan"}</span><span class="w">
</span><span class="p">(</span><span class="nf">jdbc/find-by-keys</span><span class="w"> </span><span class="n">db</span><span class="w"> </span><span class="no">:users</span><span class="w"> </span><span class="p">{</span><span class="no">:name</span><span class="w"> </span><span class="s">"Ivan"</span><span class="p">})</span><span class="w"> </span><span class="c1">;; ({:id 1 :name "Ivan"})</span><span class="w">
</span></code></pre></div></div>

<p>Finally, you stop the db calling <code class="language-plaintext highlighter-rouge">(mount/stop #'db)</code>. The connection stops, the
data disappears completely.</p>

<p>For more complicated queries with joins, HugSQL library would be a good
choice. Create a file <code class="language-plaintext highlighter-rouge">queries.sql</code> in your <code class="language-plaintext highlighter-rouge">resources</code> folder. Say, you want to
write a complex query that filters a result by some values that probably are not
set. Here is an example of what you should put into <code class="language-plaintext highlighter-rouge">queries.sql</code> file:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- :name get-user-visits :?</span>
<span class="k">select</span>
    <span class="n">v</span><span class="p">.</span><span class="n">mark</span><span class="p">,</span>
    <span class="n">v</span><span class="p">.</span><span class="n">visited_at</span><span class="p">,</span>
    <span class="n">l</span><span class="p">.</span><span class="n">place</span>
<span class="k">from</span> <span class="n">visits</span> <span class="n">v</span>
<span class="k">join</span> <span class="n">locations</span> <span class="n">l</span> <span class="k">on</span> <span class="n">v</span><span class="p">.</span><span class="k">location</span> <span class="o">=</span> <span class="n">l</span><span class="p">.</span><span class="n">id</span>
<span class="k">where</span>
    <span class="n">v</span><span class="p">.</span><span class="k">user</span> <span class="o">=</span> <span class="p">:</span><span class="n">user_id</span>
    <span class="cm">/*~ (when (:fromDate params) */</span>
    <span class="k">and</span> <span class="n">v</span><span class="p">.</span><span class="n">visited_at</span> <span class="o">&gt;</span> <span class="p">:</span><span class="n">fromDate</span>
    <span class="cm">/*~ ) ~*/</span>
    <span class="cm">/*~ (when (:toDate params) */</span>
    <span class="k">and</span> <span class="n">v</span><span class="p">.</span><span class="n">visited_at</span> <span class="o">&lt;</span> <span class="p">:</span><span class="n">toDate</span>
    <span class="cm">/*~ ) ~*/</span>
    <span class="cm">/*~ (when (:toDistance params) */</span>
    <span class="k">and</span> <span class="n">l</span><span class="p">.</span><span class="n">distance</span> <span class="o">&lt;</span> <span class="p">:</span><span class="n">toDistance</span>
    <span class="cm">/*~ ) ~*/</span>
    <span class="cm">/*~ (when (:country params) */</span>
    <span class="k">and</span> <span class="n">l</span><span class="p">.</span><span class="n">country</span> <span class="o">=</span> <span class="p">:</span><span class="n">country</span>
    <span class="cm">/*~ ) ~*/</span>
<span class="k">order</span> <span class="k">by</span>
    <span class="n">v</span><span class="p">.</span><span class="n">visited_at</span><span class="p">;</span>
</code></pre></div></div>

<p>In your database module, put the following on the top level:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">hugsql/def-db-fns</span><span class="w"> </span><span class="s">"queries.sql"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Now, every SQL template has become a plain Clojure function that takes a
database and a map of additional parameters. To get all the visits in our
application, we do:</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">get-user-visits</span><span class="w"> </span><span class="n">db</span><span class="w"> </span><span class="p">{</span><span class="no">:user_id</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="no">:fromDate</span><span class="w"> </span><span class="mi">123456789</span><span class="w"> </span><span class="no">:country</span><span class="w"> </span><span class="s">"SomePlace"</span><span class="p">})</span><span class="w">
</span><span class="nb">&gt;</span><span class="w"> </span><span class="n">...gives</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="nb">seq</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">maps...</span><span class="w">
</span></code></pre></div></div>

<p>Hope this article will help those who’ve got stuck with SQLite.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/5years/">Пять лет блогу</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2017-08-21T00:00:00+00:00">
        Aug 21, 2017
    </time>

    <a href="/tag/blog/" rel="tag">blog</a>

</div>


            <div class="entry">
                
                    
<p>То, что я давненько ничего не писал, связано с тем, что залип в
конкурсе <a href="https://highloadcup.ru/">Highload Cup</a>. Две недели ни о чем другом думать не мог, все
пытался улучшить решение. И тут вспомнил, что у блога юбилей: первая запись была
сделана пять лет назад, 8 августа 2012 года.</p>

<p>Речь идет о наивной заметке под названием <a href="http://grishaev.me/2012/08/08/1/">“Рассылка смс в Питоне”</a>. Там я
популярно рассказываю, как слать смс через апишку уже несуществующего сервиса. В
те дни я работал в читинском Энергосбыте, писал на 1С, Дельфях и Питоне, а лиспы
и ФП были влажными мечтами.</p>

<p>Пять лет по меркам интернета все-таки срок. Много ребят, которых я читал, со
временем забили на блоги, не продлили домены. А мне нравится: блог стал
настоящим хобби, которое, надеюсь, продлится всю жизнь.</p>

<p>За прошедшее время я написал 320 постов. Не так много, но я не гонюсь за
количеством. Некоторые заметки, первоначально задуманные как пара абацев,
разрастались до нескольких экранов.</p>

<p>В один момент я поймал себя на мысли, что злоупотребляю низкими приемами:
жалуюсь на сервисы, высмеиваю тех, кто не согласен со мной. Это работает, но не
в том направлении, в котором бы мне хотелось. Теперь стараюсь писать только на
важные темы: программирование, образование, карьера, книги.</p>

<p>Было неприятно видеть, как любимые мной блоги вырождались в комментарии
политических новостей. Эту тему я тоже решил пресечь.</p>

<p>Решил двигаться в сторону англоязычной аудитории. В России на Кложе пишут три с
половиной анонимуса, поэтому нет смысла писать о ней на русском.</p>

<p>Технические заметки на английском порой дают сильный отклик. После
публикации статьи о миграции с Постргреса на Датомик в первый же день ко мне
зашли 9000 янглоязычных посетителей.</p>

<p>После нескольких удачных статей про Кложу меня добавили в агрегатор Планета
Кложи. Если в посте будет слово “Кложа” на английском, статья попадет в
агрегатор. Поэтому если я не хочу, чтобы такое случилось, пишу на русском.</p>

<p>В планах сделать на сайте теги, рубрикацию и прочие ништяки. Благо, блог
статичный на Руби-движке, исходники на Гитхабе, и я знаю, у кого можно
накопипастить. А пока вот просто список постов, заслуживающих внимания:</p>

<ul>
  <li><a href="/en/concept">Conceptual languages</a></li>
  <li><a href="/en/edu-startups">Educational startups</a></li>
  <li><a href="/en/pg-to-datomic">Migration from Postgres to Datomic</a></li>
  <li><a href="/en/dos-and-donts">Do’s and Don’ts</a></li>
  <li><a href="/en/english">English</a></li>
  <li><a href="/en/russian-communities">Thoughts on Russian-speaking communities</a></li>
  <li><a href="/cors">Руководство по кросс-доменным запросам (CORS)</a></li>
  <li><a href="/remote">Про удаленную работу</a></li>
  <li><a href="/emacs-story">Рассказ о Емаксе</a></li>
</ul>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/en/concept/">Conceptual languages</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2017-08-03T00:00:00+00:00">
        Aug 3, 2017
    </time>

    <a href="/tag/clojure/" rel="tag">clojure</a>, <a href="/tag/lisp/" rel="tag">lisp</a>, <a href="/tag/erlang/" rel="tag">erlang</a>, <a href="/tag/concept/" rel="tag">concept</a>

</div>


            <div class="entry">
                
                    <p>This is a short note on what I’m thinking about programming languages.</p>

<p>Briefly, I reckon some languages as being conceptual. In a conceptual language,
every part of it obeys some global idea. This idea forms design of a language,
the way it behaves and develops. If affects libraries, community and ecosystem.</p>

<p>Take Lisp, for example. The idea is, when we store our code as data, it brings
incredible possibilities to process code as data or turn the data into code. No
other language may offer something like that, only Lisp does.</p>

<p>In Erlang, every task is solved within a cascade of lightweight processes named
actors. Two actors may communicate directly being run on different
servers. Actors do not create Unix threads. They are managed by OTP rather than
operation system.</p>

<p>With Haskell, you’ve got quite strong and flexible type system. Types are the
most important part of a typical Haskell program. Once it compiles, it will work
for sure.</p>

<p>Clojure, a modern Lisp dialect, provides immutable data structures and powerful
abstractions for concurrency.</p>

<p>Respectively, non-conceptual languages do not have such a global approach. They
try to implement as many features as possible to satisfy every domain: OOP,
anonymous functions (lambdas), lazy evaluation, etc. As a result, we’ve got
everything but nothing: each part of such a language is not as powerful as its
analogies form those ones I mentioned above.</p>

<p>Take Python, for example. Although it has such basic functional blocks as map,
reduce and lambdas, programming with it in a functional way would be a mess.</p>

<p>Every part of classical Javascript is just ugly.</p>

<p>Java, a language with static type system, allows you to pass Null instead of any
object and end up with NPE exception.</p>

<p>Although conceptual languages are not perfect, they seem to be easier for me to
learn because they have some common rules that could not be broken. Say, in
Haskell, you just do not have plain Null value. In Clojure, you cannot modify a
dictionary, and so on.</p>

<p>They cannot be substituted with other languages. Really, how can you substitute
Lisp or Erlang? There aren’t any alternatives for them.</p>

<p>I believe, the future is about conceptual languages. To develop AI or
distributed systems, we need something more sensible than yet another language
with classes and syntactic sugar.</p>

<p>I’m not sure it could be Lisp, but something that borrows most of its features.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/en/read-28/">Weekly links #28</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2017-07-31T00:00:00+00:00">
        Jul 31, 2017
    </time>

    <a href="/tag/read/" rel="tag">read</a>, <a href="/tag/life/" rel="tag">life</a>

</div>


            <div class="entry">
                
                    
<ul>
  <li>
    <p><a href="https://medium.freecodecamp.org/rest-apis-are-rest-in-peace-apis-long-live-graphql-d412e559d8e4">REST APIs are REST-in-Peace APIs. Long Live GraphQL.</a></p>

    <p>Well, although the title is provoking a bit, the main idea is true. We really
need something more suitable than REST. It has been great for the last decade,
but now it’s time to move on.</p>
  </li>
  <li>
    <p><a href="http://blog.korny.info/2014/03/08/xml-for-fun-and-profit.html">XML manipulation in Clojure</a></p>

    <p>Great article on XML, trees and zippers in Clojure. For a long time, I was
considering parsing XML as a sort of black magic. With Clojure, the process is
transparent and easy to understand.</p>
  </li>
  <li>
    <p><a href="https://www.scientificamerican.com/article/students-are-better-off-without-a-laptop-in-the-classroom/">Students are Better Off without a Laptop in the Classroom</a></p>

    <p>Thoughts on using laptops by students in a classroom. Again, the profit of IT
industry and “smart” devices is overestimated. As
I <a href="/en/edu-startups">mentioned it earlier</a>, books and people are the only way
to learn effectively.</p>
  </li>
  <li>
    <p><a href="http://martintrojer.github.io/beyond-clojure/2016/04/21/beyond-clojure-haskell">Beyond Clojure: Haskell</a></p>

    <p>Comparing Haskell to Clojure: syntax, types, code snippets, etc.</p>
  </li>
</ul>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/en/read-27/">Weekly links #27</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2017-07-23T00:00:00+00:00">
        Jul 23, 2017
    </time>

    <a href="/tag/read/" rel="tag">read</a>, <a href="/tag/life/" rel="tag">life</a>

</div>


            <div class="entry">
                
                    
<p>I’ve just returned from <a href="http://2017.euroclojure.org/">EuroClojure</a>, it was amazing! Thank you everybody
who brought it to us.</p>

<p>Here are some interesting links I found on Medium:</p>

<ul>
  <li>
    <p><a href="https://medium.com/ai-society/the-lisp-approach-to-ai-part-1-a48c7385a913">The Lisp approach to AI (Part 1)</a></p>

    <p>Some thoughts on role of Lisp in discovering AI systems.</p>
  </li>
  <li>
    <p><a href="https://m.signalvnoise.com/avoiding-not-solving-a1b37e46baaf">Show me a business problem and I’ll do my best to avoid it</a></p>

    <p>Jason Fried, a founder of Basecamp, shares his notes on dealing with problems.</p>
  </li>
  <li>
    <p><a href="https://notamonadtutorial.com/a-pythonist-finds-a-new-home-at-clojure-land-761ad8612b47">A Pythonist finds a new home at Clojure land</a></p>

    <p>The title shares the idea as well.</p>
  </li>
  <li>
    <p><a href="https://m.oursky.com/why-i-chose-clojure-over-javascript-24f045daab7e">Why I chose ClojureScript over JavaScript</a></p>

    <p>So do I.</p>
  </li>
</ul>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/berlin/">Берлин. Городские детали</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2017-07-23T00:00:00+00:00">
        Jul 23, 2017
    </time>

    <a href="/tag/berlin/" rel="tag">berlin</a>, <a href="/tag/city/" rel="tag">city</a>

</div>


            <div class="entry">
                
                    <p>Побывал на Евро-Кложе в Берлине и хочу рассказать про город. Я не ахти какой
путешественник: езжу мало, не особо наблюдателен. Читая Лебедева или Варламова,
я долгое время не понимал, зачем они без конца пишут про урны и
тротуары. Подумаешь, плитка лучше – и у нас можно пройти!</p>

<p>А в этот раз меня проперло на городскую среду. Гулял по городу и офигевал с
того, как классно устроен город. Еще больше я недоумевал, как раньше не понимал
разницы между плохой городской средой и хорошей. Видимо, после тридцати все-таки
проснулась черточка.</p>

<p>Прежде всего, великолепно уложены тротуары. Это может быть плитка, массивные
плиты, булыжник или мелкие камешки, но идти по ним и любоваться паттерном можно
бесконечно. Все детали пригнаны как в лего, все по паттерну. Когда плитка не
квадратная (или если ее кладут под углом), крайние плитки не режут, а
изготавливают специальной формы, чтобы стыковаться с соседними поверхностями.</p>

<p><img src="/assets/static/berlin/IMG_3292_2.JPG" alt="" /></p>

<p>Далее, нигде нет открытой земли. О вреде открытых клумб те же Варламов с
Лебедевым писали сто раз. Любой клочок земли, необходимый растениям, во-первых,
утоплен ниже уровня тротуара, а во-вторых, накрыт сеткой или замурован
галькой. У нас же с тротуаров и клумб круглый год сыпется грязь и песок, а
дворники соскребают обратно на клумбу.</p>

<p><img src="/assets/static/berlin/IMG_3320.JPG" alt="" /></p>

<p>Шокировало, что нет борюров. Тротуар полностью бесшовный. Меняется размер и
паттерн плитки, булыжник чередуется с плитами, но уровень нигде не
перепадает. На дорожных переходах, в выездах с прилегающих территорий, рядом с
подъездами, словом – нет бордюров. Я прошел в одном направлении восемь
кварталов и не встретил ни одного на пути.</p>

<p><img src="/assets/static/berlin/IMG_3283_2.JPG" alt="" /></p>

<p>Все дома вровень с землей. Я не знаю, в чем загадка, но в России не бывает
дверей без крыльца. Вход в любой магазин, офис или подъезд начинается со
ступеней. А рядом пандус с углом в 60 градусов. Почему нельзя вырыть котлован
еще на метр глубже? В каких стандартах прописано, что дверь должна быть в метре
от земли?</p>

<p>Это бизнес-центр:</p>

<p><img src="/assets/static/berlin/IMG_3317.JPG" alt="" /></p>

<p>А это жилой подъезд:</p>

<p><img src="/assets/static/berlin/IMG_3306.JPG" alt="" /></p>

<p>Если не ясно, в чем вред от бордюров, одолжите инвалидную коляску. Сядьте в нее
дома и попробуйте добраться до магазина. Или в обычную коляску уложите ребенка,
в нижнюю корзину продукты и вперед через подземный переход, я на вас посмотрю.</p>

<p>На фотографии ниже видно, что порой действительно случается перепад между
тротуаром и зданием. Но оцените, как плавно сделали переход! Высота в 20
сантиметров приходится на длину в 15 метров, угол градусов пять. И как красиво
получилось.</p>

<p><img src="/assets/static/berlin/IMG_3318.JPG" alt="" /></p>

<p>Это тот случай, когда инвалид <em>действительно</em> сможет заехать на коляске, а
человек с больным сердцем – подняться без учащения пульса.</p>

<p>Теперь урны. То ли меня Лебедев укусил, то ли что, но в каждой урне кроется сто
важных мелочей, теперь я это понял. В районе, где я жил, урны одинаковы, имеют
те же габариты и цвет. Срабатывает визуальное распознавание: чтобы найти урну,
достаточно окинуть взором пространство, и где-то обязательно мелькнет оранжевое
пятно. В каждой точке видна хотя бы одна урна. Ни разу не было так, чтобы мне
понадобилось, а вокруг нет.</p>

<p>Далее, урна не стоит на земле, а закреплена на столбе на уровне метра. Это
позволит увидеть урону на большом расстоянии или в толпе. Отверстие не как у
ведра, а меньше и под углом. Здесь тоже умыслел: в такое отверстие не затечет
дождь, невозможно заткнуть урну пакетом мусора, как у нас порой делают ленивые
уроды.</p>

<p><img src="/assets/static/berlin/IMG_3315.JPG" alt="" /></p>

<p>В такую урну невозможно что-то кидать, нужно подойти и положить. Это резко
снижает желание швырять окурки или бутылки ради понтов. У нас же как: офисный
планктон курит на высоком крыльце, где-то внизу ведро. Каждый бросает окурок,
это такой вид спорта. Вокруг урны Хи-квадрат-распределение бычков и плевков.</p>

<p>А попробуй кинь, когда урна на уровне груди. Можно попасть в кого-то и нарваться
на неприятности.</p>

<p>Урны очень аккуратны и чисты, покрашены в оранжевый. В первый раз я принял их за
почтовые ящики. Урны никогда не стоят рядом с лавочками, их всегда отделяет
метров десять минимум. Пример с автобусной остановкой:</p>

<p><img src="/assets/static/berlin/IMG_3319.JPG" alt="" /></p>

<p>Странные люди эти немцы, почему не хотят сидеть рядом с урной, как принято у
нас? Чтобы справа девушка, а слева мусорное ведро. Удобно же, все рядом.</p>

<p>В середине дорожных переходов островки безопасности, где пешеход может переждать
красный сигнал не рискуя быть сбитым. Островки огорожены бордюрами. Тот редкий
случай, когда они действительно нужны.</p>

<p><img src="/assets/static/berlin/IMG_3321.JPG" alt="" /></p>

<p>Люки преимущественно квадратные. Ливневые решетки спроектированы так, чтобы туда
не попало колесо велика или коляски. Направление щелей для воды перпендикулярно
движению на этом участке. Если место проходное, делают просто круглые дыры.</p>

<p><img src="/assets/static/berlin/IMG_3316.JPG" alt="" /></p>

<p>Везде велодорожки и велопарковки, на великах ездят от мала до велика, даже
беременные и пенсионеры. У меня нет статистики, но полагаю, это резко снижает
дорожный трафик. К примеру, на небольшом пятачке возле магазина припарковано 15
велосипедов. Теперь представим, что каждый приехал на машине. Сколько места
понадобиться? В десять раз больше, плюс трафик.</p>

<p>Дорожные пробки смехотворны по сравнению с нашими. 26 километров по городу от
центра до аэропорта – свободно, остановки только на светофорах. В будни после
обеда, Карл.</p>

<p>Многие женщины ходят без лифчика. Не поголовно, конечно, но больше, чем у
нас. Часто видно татуировки. Это не фрики с пирсингом, просто небольшие узоры
или надписи. Наряжаются кто как хочет, порой провакационно, всем пофиг.</p>

<p>И это я только про урны и про тратуары. А еще же парки, скверы, дворы и миллион
других вещей. Можно днями гулять и выпитывать. В плане городской среды Берлин на
высоте.</p>

                
            </div>

        </li>
        
        <li>

            <h2>
                <a class="post-link" href="/en/edu-startups/">Educational startups</a>
            </h2>

            
<div class="post-meta">

    <time class="post-time"
          datetime="2017-07-11T00:00:00+00:00">
        Jul 11, 2017
    </time>

    <a href="/tag/education/" rel="tag">education</a>, <a href="/tag/startups/" rel="tag">startups</a>

</div>


            <div class="entry">
                
                    <p>Today, educational startups are everywhere. The number of them is growing
daily. There hardly might be a week when no new HTML/CSS/Javascript educational
site appears on the Internet.</p>

<p>Sorry if I offend someone, but I don’t believe in remote education through
special sites that offer video lessons. More precisely, there might be some
effect of course but quite poorer than standard education with people and books.</p>

<p>About ten years ago, the Internet was full of paid video courses on DVDs. These
were home-made lessons made by students where they spoke on basics of
PHP+HTML. Today, the startups remind me those DVDs. The only difference is you
do not need to order a disk anymore but watch lessons online right after you
have paid.</p>

<p>I’m not running an educational site. I also don’t want to reduce someone’s
reputation or business. Let’s just discuss some points that seem important to
me.</p>

<p>Let’s switch to a browser right now and google for “educational startup”
phrase. For me, the first link
is <a href="https://www.forbes.com/sites/rodberger/2017/01/19/are-education-start-ups-the-new-dot-com/#35bdf8f01029">“Are Education Startups The New Dot Com?”</a> In that article,
there is another link titled <a href="https://techcrunch.com/2016/08/13/edtech-is-the-next-fintech/">“Edtech Is The Next Fintech”</a>. Read them,
they highlight my concerns.</p>

<p>Below, there is a bunch of list-like posts titled “N best educational startups”:</p>

<ul>
  <li><a href="https://www.inc.com/ilan-mochari/16-startups-that-will-disrupt-the-education-market.html">16 Startups Poised to Disrupt the Education Market</a></li>
  <li><a href="https://yourstory.com/2016/07/edtech-startup-competition-startedu-finalists/">10 emerging edtech startups of India - YourStory.com</a></li>
  <li><a href="www.iamwire.com/2017/01/10-indian-education-startups-2017/148036">10 Indian Education Startups to Look Out for in 2017</a></li>
  <li><a href="https://www.goodcall.com/news/techcrunch-disrupt-2016-7-edtech-startups-changing-education-industry-06688">TechCrunch Disrupt 2016 - 7 EdTech Startups</a></li>
  <li><a href="https://www.techinasia.com/26-edtech-startups-southeast-asia">29 edtech startups in Southeast Asia</a></li>
</ul>

<p>And so on. It was only the two first pages. Let’s check
for <a href="https://angel.co/education">Angel List</a> then:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>14,615 COMPANIES    2,646 INVESTORS    19,127 FOLLOWERS    2,675 JOBS
</code></pre></div></div>

<p>14615 companies. There are about 250 countries in the world. I’ll take rather
200 due to wars or lack of development in some of them. Dividing a number of
educational startups on the number of counties gives 14615 / 200 = 73 per
country.</p>

<p>Don’t you think it’s bit more than we need?</p>

<p>Look, we have about 3 search engines to find anything on the Internet. There are
probably 2-5 mobile operators in your country. We’ve got one Wikipedia. But
there are 14615 educational companies who want to make money on educational
market.</p>

<h1 id="i-really-doubt-they-are-about-real-education">I really doubt they are about real education</h1>

<p>In fact, there is one goal that a startup tries to reach. It forces users to buy
lessons making them think it could really raise their level. Site developers
bring challenging factors to manipulate users. These are top-ranked tables, a
scale of education decorated as a route with milestones and a crown or a goblet
in the end. Any startup brings a chat-room to let users share their success to
feel proud.</p>

<p>I’ve seen several educational sites and must confess they don’t bring any
revolutionary ideas. Yes, some of them provide smart environment when you have
an IDE into a browser. But the truth is there are only two ways of education
that really work. These are people and books.</p>

<p>Sometimes, people ask me how to improve their experience. Usually they’ve spent
some time solving educational tasks but they cannot start a real project. I
always answer the same: join a project where professionals work. Being in a team
of high-qualified people, you will grow up in a quite short term.</p>

<p>Reading books helps you to systematize fragments of random knowledge that you’ve
got from Twitter, StakOverflow, Wired and so on. Everything that educational
sites try to sell you has already been published in books. Really, there are
tons of books about PHP, HTML, Java, Python or whatever. You may borrow them for
free.</p>

<p>On the internet, you can by any used book for several dollars. A lesson is
usually paid for subscription. In a month, you will lose your access unless you
pay again. The book will be yours forever.</p>

<p>Yes, reading a book is a bit more difficult than watching a video. It’s hard and
boring. You even need to interpret code in mind. There is no widgets and chats.
Although, it really works.</p>

<p>A book is really important today since our knowledge is not arranged. We are
getting random fragments missing important details. I may compare a book with an
asphalt paver that moves slowly but removes any roughness and holes in your
mind.</p>

<h1 id="people-and-books-are-the-only-way-to-learn">People and books are the only way to learn</h1>

<p>Recently, I finished reading <a href="https://pragprog.com/book/dswdcloj2/web-development-with-clojure-second-edition">“Web-development with Clojure”</a>
book. Although I thought I knew Clojure pretty well, the book turned into
discovery for me. I’ve got plenty of hints and technics that I’m willing to try
in the future.</p>

<p>Education in wide meaning is hard process. Educational startups make you think
it has become easy. That is wrong.</p>

<p>Once I finished reading my first Clojure book, I could solve any primitive task
like sorting or finding min/max element in a list using recursion. But it took
huge effort to write an HTTP server that manages database connection, renders
templates, writes logs, calls Twitter API and so on.</p>

<p>The reason was all the lessons and tutorials miss some special knowledge about
how to manage with complexity. Hot to connect parts of your application
together.</p>

<p>A computer is not a best tool for education. It’s a great tool but also an
entertainment center. Ideally, you should turn off all the messagers, close
YouTube, Twitter… On your laptop, there a lot of things may interrupt
you. Being tired, your brain can always find a pretext to switch on something
funny.</p>

<p>IT-education is not about coding, it also includes negotiations. Sometimes, you
might be 100% right but would not be able to deliver your ideas. You may offend
your customer with non-suitable manner of speaking. Only people who work close
to you may correct that mistakes, not online lessons. By the way, I have never
seen a lesson that highlights anything from those mentioned above.</p>

<p>Of course, I do not blame startups for spreading across the Internet. The reason
it happens is a lack of professionals. This is reaction of market. Did you want
more programmers? Here you’ve got them. Young people know that IT companies are
interested in hiring more people. Oftenly, watching just several videos enough
to get PHP/Wordpress job paid in US dollars.</p>

<p>Universities are not in charge of your further employment. There is a common
situation when you’ve just finished the last course but cannot find a job
because the industry changes so fast. Nor the government will support
you. Education seems to be the last thing they are interested in. Today, my
country wages two wars, plays geopolitics and eradicates imported cheese while
education level goes down-wise year after year.</p>

<p>Educational sites might be a hope. But they devalue the real meaning of
education.</p>

<h1 id="the-process-of-self-education-is-hard-only-you-is-interested-in-it-not-startups">The process of self-education is hard. Only you is interested in it, not startups</h1>

<p>OK I’m about to finish and I’ve got a question. I heard, the most powerful
language is Lisp. At least Alan Kay said so (a guy who invented OOP). So did
Stallman, Dijkstra and other great programmers. Do you know any educational site
which offers Lisp lessons?</p>

<p>I googled for a bit to find any. Nothing on Coursera – the most known lesson
hub. Nothing on Netology. At least Hexlet has <a href="https://ru.hexlet.io/courses/sicp">SICP section</a> where they
retell it in Russian (see my note on books).</p>

<p>No, they won’t teach you the most powerful language. So what is the final goal
then?  Do we need more Python or Java programmers? We have already got lots of
them but we still suffer from weird interfaces and buggy applications. It won’t
work in such a way.</p>

<p>Let me summarize.</p>

<ol>
  <li>I’m not against someone’s business. I even believe some people who watched
those videos really made progress in their career. Maybe, they could not find
proper books or their brain feels good with such a way of education.</li>
  <li>But I’d like to name things properly. Educational startups are the business
by themselves. The goal of the business is to make money but not to make you
cleverer. Instead, the longer you keep your monthly subscription active, the
better a startup develops.</li>
  <li>There is definitely overheat on the educational market. It seems to be like a
bubble.</li>
  <li>Startups tell you the education is easy and funny. It’s not.</li>
  <li>People and books help a lot. Online lessons – well, yes but quite less.</li>
</ol>

                
            </div>

        </li>
        
    </ul>

    <h4>
        
        <a href="/page42" class="previous">&larr;</a>
        
        <span class="page_number ">Страница 43 из 75</span>
        
        <a href="/page44" class="next">&rarr;</a>
        
    </h4>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>Ivan Grishaev's blog</li>
          <li><a href="mailto:ivan@grishaev.me">ivan@grishaev.me</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
            <li><a href="https://github.com/igrishaev">GitHub</a></li>
            <li><a href="tg://resolve?domain=igrishaev_blog">Telegram</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>Writing on programming, education, books and negotiations.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
