<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Ivan Grishaev's blog</title>
    <description>Writing on programming, education, books and negotiations.
</description>
    <link>https://grishaev.me/</link>
    <atom:link href="https://grishaev.me/feed.xml" rel="self" type="application/rss+xml"/>
    <pubDate>Fri, 26 Dec 2025 15:28:58 +0000</pubDate>
    <lastBuildDate>Fri, 26 Dec 2025 15:28:58 +0000</lastBuildDate>
    <generator>Jekyll v4.2.0</generator>
    
      <item>
        <title>Полоса прокрутки (2)</title>
        <description>&lt;p&gt;&lt;a href=&quot;/youtube-top/&quot;&gt;Небольшое продолжение&lt;/a&gt; про Ютуб — и больше поднимать эту тему не
буду.&lt;/p&gt;

&lt;p&gt;Всякими махинациями я добился того, чтобы полоса была под видео, а не на
нем. Для этого классу &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ytp-chrome-bottom&lt;/code&gt; добавляется свойство &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bottom: -60px&lt;/code&gt;
или около того. Но проблема пришла откуда не ждали, и даже не одна.&lt;/p&gt;

&lt;p&gt;Дело в том, что тулбар появляется только когда наводишь курсор на плеер. Так
вот: если тулбар вне плеера, то наведение мыши на него ничего не дает — он
остается невидимым. Простыми словами, перестает работать.&lt;/p&gt;

&lt;p&gt;Я такой думаю: наверное, на тулбар вешается класс &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;hidden&lt;/code&gt; или похожий. Сейчас
поменяю этот класс, чтобы он был всегда видим и победю систему. Оказалось,
видимость определяется не классом, а средствами JavaScript.&lt;/p&gt;

&lt;p&gt;Тогда я сделал так: растянул плеер, чтобы он охватывал тублар даже после
смещения. Это помогло: при наведении на тулбар он появляется. Однако теперь не
работают кнопки. Ощущение, будто где-то есть невидимый div, который
перехватывает клики. Из-за смещения тулбара они идут мимо него, и ничего не
работает.&lt;/p&gt;

&lt;p&gt;Ну и в целом сложность: штук двадцать вложенных дивов &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;yt-player&lt;/code&gt; →
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;yt-main-container&lt;/code&gt; → &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;yt-main-inner&lt;/code&gt; → &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;yt-video-container&lt;/code&gt; →
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;yt-video-node&lt;/code&gt; и так далее. Каждый что-то перехватывает и наследует. Дебажить
этот цирк — то еще удовольствие.&lt;/p&gt;

&lt;p&gt;Так что переносом тулбара вверх я пока и ограничусь. Слишком напряжно этим
заниматься. Сложность Ютубного плеера колоссальная: там годы легаси и костылей,
чтобы работать во всех браузерах, трекать, показывать рекламу, плашки,
рекомендации и так далее. Задача мне не по зубам, признаю поражение.&lt;/p&gt;
</description>
        <pubDate>Fri, 26 Dec 2025 00:00:00 +0000</pubDate>
        <link>https://grishaev.me/youtube-top2/</link>
        <guid isPermaLink="true">https://grishaev.me/youtube-top2/</guid>
        
        <category>life</category>
        
        <category>youtube</category>
        
        
      </item>
    
      <item>
        <title>Полоса прокрутки</title>
        <description>&lt;p&gt;Некоторое время назад я жаловался на плеер Ютуба, мол, полоса прокрутки и кнопки
залезают на видео. На это можно повлиять при помощи своего css-файла. Для
Фаерфокса и его форков инструкция такая:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;Определить папку с профилем. Для этого нажать Help -&amp;gt; More Troubleshooting
Information -&amp;gt; Profile Folder -&amp;gt; Show in Finder&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Создать в ней папку chrome&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;В ней создать файл &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;userContent.css&lt;/code&gt; с таким содержанием:&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;@-moz-document domain(youtube.com) {
 .ytp-chrome-bottom {
     position: relative !important;
     bottom: -15px !important;
 }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;Зайти в &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;about:config&lt;/code&gt; и задать свойсво
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;toolkit.legacyUserProfileCustomizations.stylesheets&lt;/code&gt; в &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;true&lt;/code&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Перезапустить браузер.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;В результате тулбар окажется сверху с зазором в 15 пикселей. Картинку прилагаю:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/static/aws/youtube-top/1.jpeg&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Мысли следующие: пока настраивал папки-файлы, поразился этому дурдому. Почему
ради простой задачи нужно совершать пять шагов? Неужели нельзя сделать
примитивный textarea, куда вводишь текст и он сохраняется в файл? Почему браузер
нужно перезагружать? Почему папка называется “Хром”? При чем тут хром? Какая-то
жесть.&lt;/p&gt;

&lt;p&gt;В общем, когда стили заработали, я удивился как бухгалтер, у которого сошелся
годовой отчет.&lt;/p&gt;

&lt;p&gt;Впечатления от новой полосы интересные. Чувство такое, что вместо 90% контента
теперь видишь все 100%. Внезапно, надписи внизу читаются; у людей есть колени и
ноги; у ведущего в углу кадра есть лицо. Раньше ничего этого не было, а теперь —
пожалуйста.&lt;/p&gt;

&lt;p&gt;Могу спокойно читать субчики в “Зеленом слонике”, а раньше не мог. То-то же.&lt;/p&gt;

&lt;p&gt;Для Хрома и форков инструкции нет, но полагаю, найдутся расширения.&lt;/p&gt;

&lt;p&gt;Ни в коем случае не продавливаю свое решение — по-хорошему его надо улучить. Но
какую-то свежесть оно дает, попробуйте.&lt;/p&gt;
</description>
        <pubDate>Fri, 26 Dec 2025 00:00:00 +0000</pubDate>
        <link>https://grishaev.me/youtube-top/</link>
        <guid isPermaLink="true">https://grishaev.me/youtube-top/</guid>
        
        <category>life</category>
        
        <category>youtube</category>
        
        
      </item>
    
      <item>
        <title>Оружия черепашек-нинздя</title>
        <description>&lt;p&gt;Разговаривал с одним человеком и выяснил, что он не знает, какие оружия у
черепашек-нинздя. Это должен знать каждый, и я не сомневаюсь, что и вы
знаете. Просто на всякий случай повторю.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/static/aws/tmnt/1.jpeg&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Итак, первый уровень, изи: Леонардо, который в голубой повязке, владеет двумя
мечами. Это всем понятно.&lt;/p&gt;

&lt;p&gt;Второй уровень, нормал: что у Микеланджело, который в оранжевой повязке? Это
нунчаки: две палки на цепи, которыми проще убить себя, чем противника.&lt;/p&gt;

&lt;p&gt;Теперь третий уровень, хард: что у Донателло, который в фиолетовой повязке?
Простолюдин скажет, что у него палка, и от этого хочется плакать. Это бо! – или,
чтобы было понятнее, шест бо. Посох из металла или с его элементами, чтобы не
сломаться и сильнее бить противника. Бо полезен в бою, в быту, в походе, словом,
универсальная для Востока вещь.&lt;/p&gt;

&lt;p&gt;Последний уровень, найтмеар: что у Рафаэля, черепашки в красной повязке? Когда
говорят, что трезубец, хочется кататься по полу от отчаяния. Это саи. С-а-и!
Один сай, два сая, многое саев. Гугл-док не понимает и предлагает замену, но
вы-то понимаете! Такие кинжалы с двумя лепестками по краям. Идея в том, чтобы
принять меч противника между зубцами и резко повернуть. Твой рычаг больше, чем у
противника, и он теряет оружие.&lt;/p&gt;

&lt;p&gt;Все это я пишу по памяти безо всяких Википедий, и знал это лет с семи. А вот как
без этого можно жить – я не понимаю. Молодежь пошла не та, зумеры не хотят
работать и вообще все плохо.&lt;/p&gt;
</description>
        <pubDate>Fri, 26 Dec 2025 00:00:00 +0000</pubDate>
        <link>https://grishaev.me/tmnt/</link>
        <guid isPermaLink="true">https://grishaev.me/tmnt/</guid>
        
        <category>life</category>
        
        <category>tmnt</category>
        
        
      </item>
    
      <item>
        <title>Дизайн REST API</title>
        <description>&lt;p&gt;В Линкед-ине хвастает человек: мол, нейросеть задизайнила
рест-апишку. Прикладывает скриншот сваггера. Я смотрю на него и киваю: да, все
на месте, все как у современного разработчика. А еще я понимаю, что на
скриншоте, как в капле воды, собрано все то, за что я не люблю рестовые апишки.&lt;/p&gt;

&lt;p&gt;Во-первых, версия &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;v1&lt;/code&gt; в урле. Она всегда меня забавляла. Я работал во многих
стартапах, и ни один из них не сменил версию. Гораздо чаще стартапы закрываются
и продаются. Я считаю, апишка должна быть одна, и со временем какие-то методы
добавляются, какие-то снимаются с обслуживания. А в той нумерации, что на
скриншоте, слишком много пафоса. Примерно как объявить счетчик с шестью нулями
для значения, которое в лучшем случае достигнет двойки. Даже если предположить,
что появится новая апишка, просто сделай другой урл: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/api/grpc&lt;/code&gt; или
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/api/graphql&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Далее, иерархия. Те апишки, которые работают с матчем, требуют код
турнира. Нужно передать две айдишки: турнира и матча. Зачем? Разве может матч
относиться к разным турнирам? Это банальная избыточность, и делается она ради
красоты. Должен передаваться только матч, а по нему легко найти турнир и
проверить права.&lt;/p&gt;

&lt;p&gt;Еще одна забавная вещь: метод &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;PUT&lt;/code&gt; не может покрыть все изменения, поэтому в
ход идут костыли: частички &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;:report&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;:reopen&lt;/code&gt; на конце урла. Это некрасиво,
потому что по-хорошему операция определяется HTTP-методом, а тут урлы. Тот
случай, когда шубу заправляют в трусы, а она не лезет.&lt;/p&gt;

&lt;p&gt;Ну и расцветка Сваггера как у цыган: зеленый, голубой, оранжевый, красный… все
собрали.&lt;/p&gt;

&lt;p&gt;На мой взгляд, нормальная апишка должна быть по принципу RPC. Один урл с двумя
параметрами: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;action&lt;/code&gt; и &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;params&lt;/code&gt;. Метод один – POST. Внутри словарик с функциями
и схемами, по которому раскидываются запросы. Все. Документашка со схемами
строится одной командой.&lt;/p&gt;

&lt;p&gt;Апишка – довольно простая вещь. Она не должна быть сложной и требовать разного
тулинга. Тот REST, что имеем сегодня – это вавилонская башня на ровном
месте. Как и в библейской истории, разработчики сами не понимают друг друга. Но
продолжают и продолжают строить эту башню.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/static/aws/rest-api/1.jpeg&quot; /&gt;&lt;/p&gt;

</description>
        <pubDate>Fri, 26 Dec 2025 00:00:00 +0000</pubDate>
        <link>https://grishaev.me/rest-api/</link>
        <guid isPermaLink="true">https://grishaev.me/rest-api/</guid>
        
        <category>programming</category>
        
        <category>rest</category>
        
        <category>swagger</category>
        
        
      </item>
    
      <item>
        <title>Просто берите SQLite</title>
        <description>&lt;p&gt;Тезис к размышлению: при помощи Postgres и SQLite можно решить (почти) все
насущные задачи. Без распределенных кэшей, очередей, облачных паб-сабов и так
далее.&lt;/p&gt;

&lt;p&gt;Насчет Постгреса все ясно: &lt;a href=&quot;/just-use-postgres/&quot;&gt;я уже писал о нем отдельно&lt;/a&gt;. А
что SQLite?&lt;/p&gt;

&lt;p&gt;Замечаю одно и то же: иной раз требуется хранить в памяти какие-то
данные. Сначала это словарь вида id -&amp;gt; сущность. Потом нужен поиск по полю
сущности. Строится обратная мапа поле -&amp;gt; список сущностей. Потом нужная вторая
сущность и перекрестные ссылки. Код превращается в ад.&lt;/p&gt;

&lt;p&gt;Наблюдаю такое в трех сервисах. Ребята читают из файлов сущности, строят прямые
мапы, обратные, перекрестные… потом ходят по ним безо всяких проверок, ловят
нулы и странные результаты.&lt;/p&gt;

&lt;p&gt;А решение простое: запиши свое барахло в SQLite! Из коробки получишь индексы,
поддержку целостности, универсальный интерфейс, поддержку JSON и миллион
расширений. И появился SQLite не вчера, а старше иного разработчика. И тестов
под него написано чуть ли не сотня тысяч.&lt;/p&gt;

&lt;p&gt;SQLite отлично подходит, чтобы не шатать боевую базу. Забрал данные, сложил себе
и делаешь что хочешь. Можно делать ночную выгрузку, чтобы всякие отчеты
принимали SQLite, а не ходили в прод.&lt;/p&gt;

&lt;p&gt;Если данные не помещаются в памяти, можно скинуть их на диск. Красота же?&lt;/p&gt;

&lt;p&gt;Есть и другие рецепты использования SQLite, например использовать его для обмена
данными. Каждый, кто сталкивался с сериализацией, знает, какая это боль и
сколько в ней подводных камней. Один из способов их обойти – кидаться файлами
SQLite.&lt;/p&gt;

&lt;p&gt;За счет SQLite можно выкинуть просто нелепое количество кода и самописных
решений. Разумеется, не всегда – но по моему опыту, очень-очень часто.&lt;/p&gt;
</description>
        <pubDate>Fri, 26 Dec 2025 00:00:00 +0000</pubDate>
        <link>https://grishaev.me/pg-and-sqlite/</link>
        <guid isPermaLink="true">https://grishaev.me/pg-and-sqlite/</guid>
        
        <category>programming</category>
        
        <category>postgres</category>
        
        <category>sql</category>
        
        
      </item>
    
      <item>
        <title>О кложурных редьюсерах</title>
        <description>&lt;p&gt;В последнее время я немного подавлен работой. Делаю одну задачу уже много
месяцев, при этом она довольно тупая и бестолковая. Омрачает то, что в процессе
я нахожу баги, порой довольно серьезные. Чувствую себя так, словно заставили
идти через поле коровьих лепешек.&lt;/p&gt;

&lt;p&gt;Часть багов связана с инфраструктурой и очередями задач. Пересказывать их
довольно скучно, и вряд ли вам будут интересно. Но один бажок на тему Кложи и
параллельных вычислений мне запомнился, и сейчас его расскажу.&lt;/p&gt;

&lt;p&gt;Как вы знаете, Кложа хороша своими коллекциями – это прямо алмаз, одно из
немногих утешений в айти. Вместе с коллекциями прилагаются штук триста функций:
всякие &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;map&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;reduce&lt;/code&gt; и так далее, включая экзотику.&lt;/p&gt;

&lt;p&gt;Начиная с какой-то версии в Кложу завезли параллельные map и reduce. Пакет
называется &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;clоjure.core.reducers&lt;/code&gt;. Сигнатуры параллельных функций почти
идентичны оригиналам. Идея в том, что ты такой хоп – заменил &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;reduce&lt;/code&gt; на
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;r/reduce&lt;/code&gt;, и вычисления раскидались по ядрам. Нашлись коллеги, которые, не
читая документации, так и сделали – а я пожал их плоды.&lt;/p&gt;

&lt;p&gt;Есть огромных файл, где каждая строка – джейсончик. Нужно построить мапу &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;{id -&amp;gt;
entity}&lt;/code&gt;, чтобы быстро дергать из нее сущность по айдишке. Скажем, в Питоне это
делается так:&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;entity&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;id&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;entity&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;entity&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;read_lines&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;В Кложе это тоже решается тремя строчками. Но коллега использовал не простой
reduce, а который параллельный. Логика такова: коллекция большая, пусть
колбасится параллельно. И вот я вызываю функцию, которая строит эту мапу, и
замечаю – в ней нет половины ключей. Пропали. Что такое?&lt;/p&gt;

&lt;p&gt;Дебажил я передебажил и выяснил вот что.&lt;/p&gt;

&lt;p&gt;В документаци &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;clоjure.core.reducers&lt;/code&gt; написано, что коллекции не всегда
обрабатываются параллельно. Критериев несколько, например коллекция мала и нет
смысла ее делить. Но главный критерий таков: коллекция не должна быть ленивой. А
те коллекции, что коллеги читают из файла, ленивы. Это нормально, потому что
файл огромный и читать в память все разом нельзя. Но получается, что вся
параллельность идет псу под хвост – параллельные &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;r/map&lt;/code&gt; и &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;r/reduce&lt;/code&gt; сводятся к
последовательным аналогам.&lt;/p&gt;

&lt;p&gt;Другими словами, параллельной обработки никогда не было. Вызовы есть, но эффекта
нет. Никто этого не замерял и не проверял.&lt;/p&gt;

&lt;p&gt;Почему же у меня возникла ошибка? Дело в том, что я передал вектор – не ленивую
коллекцию. Она попадала под критерии параллельности, и произошло вот что. Пакет
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;clоjure.core.reducers&lt;/code&gt; использует подход &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ForkJoin&lt;/code&gt;. На этапе &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Fork&lt;/code&gt; коллекция
бьется на части, и каждая часть обрабатывается в своем потоке. Получаются,
скажем, два словаря &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;{id -&amp;gt; entity}&lt;/code&gt; для каждой части. Далее наступает фаза
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Join&lt;/code&gt; – их нужно объединить. Функция &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;r/reduce&lt;/code&gt; принимает дополнительную
функцию для сборки финального результата, но ее не передали. А если ее нет,
вызывается редуцирующая функция. Она приняла два словаря и неправильно их
обработала, в результате чего пропала половина данных. Нужно было передать туда
функцию merge, но никто не знал, для чего это в принципе.&lt;/p&gt;

&lt;p&gt;Когда я это исправил, нашел еще один косяк у себя самого. Когда записи
индексируют по &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;id&lt;/code&gt;, с объединением проблем нет, потому что ключи уникальны. Но
представим, что выполняется группировка по какому-то рейтингу. В этом случае
результат такой:&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;{&quot;a&quot; [1 2 3], &quot;b&quot; [5 4 1]}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Если дать эту задачу на параллельное вычисление, они могут вернуть что-то такое:&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;{&quot;a&quot; [1 2], &quot;b&quot; [5]}
{&quot;a&quot; [2 3], &quot;c&quot; [11]}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;То есть и в первом потоке был такой ключ, и во втором. Если тупо объединить
словари, получится вот что:&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;{&quot;a&quot; [2 3], &quot;b&quot; [5], &quot;c&quot; [11]}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;, то есть из “a” пропадет 1. Ошибки не будет, все пройдет молча, и догнать
причину будет сложно. Правильная функция объединения будет такой:&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;(partial merge-with into)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;С ней получим результат &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;{&quot;a&quot; [1 2 3], &quot;b&quot; [5], &quot;c&quot; [11]}&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Ради интереса прошелся по коду коллег: почти везде используются ленивые
коллекции. Это значит, что параллельные вычисления банально не работают. Я хотел
поправить, но плюнул: давайте-ка сами.&lt;/p&gt;

&lt;p&gt;В сухом остатке:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;человек подключил либу для параллельных вычислений&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;вычисления всегда протекали последовательно&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;при попытке вычислить что-то параллельно получали ошибочный
результат. Исключения нет, все тихо, ищи сам.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;В Гарри Поттере была фраза: “не доверяй тому, что мыслит, если не знаешь, где у
него мозги”. Я бы перефразировал: не доверяй быстрым библиотекам, если не
понимаешь, за счет чего достигается скорость. Реалии таковы, что в погоне за
скоростью срезают углы. Это ни хорошо ни плохо, это факт, который нужно знать.&lt;/p&gt;

&lt;p&gt;Внедряя параллельные вычисления, уделите хотя бы толику внимания тому, какие
сюрпризы вас ожидают.&lt;/p&gt;
</description>
        <pubDate>Fri, 26 Dec 2025 00:00:00 +0000</pubDate>
        <link>https://grishaev.me/on-reducers/</link>
        <guid isPermaLink="true">https://grishaev.me/on-reducers/</guid>
        
        <category>programming</category>
        
        
      </item>
    
      <item>
        <title>Обновление Ютуба</title>
        <description>&lt;p&gt;&lt;img src=&quot;/assets/static/aws/yt-player-2/1.jpeg&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Гугл грозился обновить плеер в Ютубе, и вот это случилось. До этого новый
интерфейс появлялся у меня пару раз, но быстро пропадал. Подозреваю, его
откатывали из-за ошибок. Но теперь все исправили, и он с нами надолго.&lt;/p&gt;

&lt;p&gt;Напомню, в чем проблема. Новая панель почти в два раза выше, чем
прежде. Приложил к экрану линейку: была сантиметр, стала 18 миллиметров. При
этом все кнопки старые, нет ни одной новой. Просто теперь они собраны в капсулы,
а еще им добавили отступы.&lt;/p&gt;

&lt;p&gt;Новый воздушный интерфейс на редкость уродский. Слева и справа группы кнопок, а
в центре — полоса перемотки. Она, словно барьер, режет видео пополам. Она
залезает на лица ведущих, которые по недоразумению поставили их снизу.&lt;/p&gt;

&lt;p&gt;Если когда-нибудь вы смотрели ролики по изучению языков, то знаете — субтитры
добавляют на этапе монтажа. Обычно их ставят внизу, чтобы не заслонять лица. Еще
во времена старой панели это было проблемой: поставил на паузу, чтобы прочитать
— но панель загораживает. Приходится двигать мышкой, кликать на посторонние
элементы, чтобы перенести фокус. А теперь панель стала еще выше!&lt;/p&gt;

&lt;p&gt;Я как-то смотрел видео одного человека (неважно о чем, не хочу раскрывать
увлечения). Судя по всему, он японец и не говорит по-английски, хотя читает и
пишет отлично. Он записывает ролики и добавляет в них текстовые комментарии. С
новой панелью прочитать их во время паузы невозможно. Полоса перечеркивает
буквы.&lt;/p&gt;

&lt;p&gt;Я не понимаю, почему панель должна налезать на видео? Кто сказал, что видео —
это область, где можно ставить кнопки, бегунки и прочее? Нельзя! Оставьте видео
в покое! На нем ничего не должно быть.&lt;/p&gt;

&lt;p&gt;Опять же, не понимаю, почему нельзя сделать опцию “панель снизу”? Это буквально
пара мест в CSS, чтобы сместить блок вниз.&lt;/p&gt;

&lt;p&gt;В общем, главная медиа-площадка планеты — отличный пример того, как делать не
нужно.&lt;/p&gt;
</description>
        <pubDate>Sun, 07 Dec 2025 00:00:00 +0000</pubDate>
        <link>https://grishaev.me/yt-player-2/</link>
        <guid isPermaLink="true">https://grishaev.me/yt-player-2/</guid>
        
        <category>youtube</category>
        
        <category>ui</category>
        
        
      </item>
    
      <item>
        <title>Postgres в Телеграме</title>
        <description>&lt;p&gt;Лишний раз убедился, что писать на чужих площадках — гиблое дело.&lt;/p&gt;

&lt;p&gt;Где-то три года назад я вступил в группу &lt;a href=&quot;https://telegram.me/pgsql&quot;&gt;Postgres в
Телеграме&lt;/a&gt;; там было 11 тысяч пользователей. Только
начал писать — какие-то тролли наставили кучу дизлайков. Я даже не понял: это
заговор или что? Вышел.&lt;/p&gt;

&lt;p&gt;Полгода назад снова вступил в эту группу, там уже 14 тысяч
пользователей. Отвечал на вопросы, помогал. Сегодня ответил на сообщение админа
— совершенно нейтрально, по существу — получил бан на час.&lt;/p&gt;

&lt;p&gt;Что ж, если не хотите меня, то так и быть. “Мэссадж понятен даже идиоту”
(с). Вышел, и третьему разу уже не бывать.&lt;/p&gt;

&lt;p&gt;Вот за этим и хорошо иметь свой блог или канал — можно писать все, что
хочешь. Поэтому я не вступаю в закрытые каналы, группы, клубы и прочие “илитные”
тусовки. Там ты всегда под кем-то, а это рано или поздно выйдет боком.&lt;/p&gt;
</description>
        <pubDate>Sun, 07 Dec 2025 00:00:00 +0000</pubDate>
        <link>https://grishaev.me/pg-group/</link>
        <guid isPermaLink="true">https://grishaev.me/pg-group/</guid>
        
        <category>life</category>
        
        
      </item>
    
      <item>
        <title>Записи в Джаве</title>
        <description>&lt;p&gt;Кажется, с версии 17 в Джаве появились рекорды — они же записи. Клевая вещь,
коротко про нее расскажу.&lt;/p&gt;

&lt;p&gt;Запись — это класс с набором барахла, которое раньше нужно было писать
руками. Только теперь это барахло производит компилятор. Например, если объявить
запись с двумя полями:&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;record&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;age&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;, то получим класс с полями &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;name&lt;/code&gt; и &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;int&lt;/code&gt;. Однако:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;все поля финальные, их можно задать лишь однажды и никогда — изменить;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;у класса готовый конструктор, в котором поля следуют в том порядке, что и в объявлении;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;у класса готовые методы &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.name()&lt;/code&gt; и &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.age()&lt;/code&gt;, которые ведут себя как геттеры;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;у класса свой метод &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.hash()&lt;/code&gt;, который учитывает все поля;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;свой метод &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.equals()&lt;/code&gt;, который сравнивает записи по значениям;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;удобный &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.toString()&lt;/code&gt;: напечатав запись, вы увидите значения полей, а не
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[foo.bar.User x00x0s0ds]&lt;/code&gt; (или что там печатает Джава по умолчанию).&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Есть и другие плюсы, не помню все досконально.&lt;/p&gt;

&lt;p&gt;Получается, на ровном месте появились нормальные неизменяемые классы. Всего-то двадцать лет прошло или около.&lt;/p&gt;

&lt;p&gt;Хорошая привычка: пока это возможно, везде использовать рекорды, а к классам
переходить, если состояние изменяется. В моем клиенте для Постгреса примерно так
и сделано. Из 150 классов почти все из них — записи, и только корневой класс
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Connection&lt;/code&gt; — обычный &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Object&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Чтобы вы не подумали, что все так хорошо, вот ложка дегтя. Когда классы
неизменяемы, часто нужен “такой же, но золотыми пуговицами”. Другими словами,
получить клон экземпляра с измененным полем. Кложуристы поймут без слов:&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;(let [user {:name &quot;Ivan&quot; :age 10}]
  (assoc user :name &quot;New&quot;))

;; {:name &quot;New&quot;, :age 10}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;На мой взгляд, было бы логичным, если бы компилятор генерил методы &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.withName&lt;/code&gt; и
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.withAge&lt;/code&gt;, которые принимают значение и возвращают клон с новым полем. Но их
нет, а прописывать вручную — скучно: это экраны кода, где, вдобавок, легко
ошибиться.&lt;/p&gt;

&lt;p&gt;Четыре года назад в Джаве сделали шаг в верном направлении. Хорошо, но мало. Не
пора ли сделать еще? Глядишь, так и придем в светлое будущее.&lt;/p&gt;

&lt;p&gt;Кстати, в Питоне тоже относительно недавно появились &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;data&lt;/code&gt;-классы. Неужели
адепты ООП стали что-то подозревать?&lt;/p&gt;
</description>
        <pubDate>Sun, 07 Dec 2025 00:00:00 +0000</pubDate>
        <link>https://grishaev.me/java-records/</link>
        <guid isPermaLink="true">https://grishaev.me/java-records/</guid>
        
        <category>programming</category>
        
        <category>java</category>
        
        <category>records</category>
        
        
      </item>
    
      <item>
        <title>Фронтендеры</title>
        <description>&lt;p&gt;Выскажу тезис в отношении фронтендеров. Может, он не самый приятный, но неплохо
упрощает дело. Тезис следующий: фронтендер мыслит npm-пакетами. В мире
фронтендера любая задача, любая проблема решаются одним способом — пакетом из
npm.&lt;/p&gt;

&lt;p&gt;У тезиса несколько следствий. Во-первых, когда есть несколько способов решить
задачу, фронтендер выбирает тот, для которого есть npm-пакет. При этом не важно,
насколько способ оптимален и удобен другим участникам, например бекенду или
пользователям. Есть пакет — дело в шляпе.&lt;/p&gt;

&lt;p&gt;Во-вторых, если нужного пакета нет, берется максимально близкий к нему и задача
подгоняется так, чтобы ему удовлетворять.&lt;/p&gt;

&lt;p&gt;Стоит только принять тезис и следствия, как многое становится
очевидным. Например, нелепые решения, особенности передачи данных, требования
коллег.&lt;/p&gt;

&lt;p&gt;Доказательств этому я повидал много, вот хотя бы одно.&lt;/p&gt;

&lt;p&gt;Есть SPA-приложение для сотрудников. По нажатию кнопки нужно скачать с бекенда
CSV-файл. Как его передать, если на сервере только REST и JSON? Как скачать
файл, чтобы он не открылся в текущей вкладке?&lt;/p&gt;

&lt;p&gt;Фронтендер загуглил “javascript csv on client” и нашел npm-пакет. Он принимает
массив словарей, записывает их в CSV-строку и заставляет браузер ее “скачать”,
то есть сохранить на диск. Бекендер пожал плечами, мол как скажешь — и отдал на
фронт список мап. Это не его дело, фронтендер так попросил, пусть и разбирается.&lt;/p&gt;

&lt;p&gt;Все это работало, пока строчек было сто-двести. Но однажды мне велели сделать
выгрузку на двести тысяч записей. Я сделал по образцу, и тут-то браузер
накрылся. Вкладка окирпичивается, ничего не работает.&lt;/p&gt;

&lt;p&gt;Далее, я был единственным, кто задался вопросом: что делают люди с этим файлом?
Оказалось, открывают в Экселе. Как я уже рассказывал, открывать CSV в Экселе —
это играть в русскую рулетку. Эксель вечно путает разделитель полей — запятую
или точку с запятой — и даже больше: эта опция зависит от локали. Поэтому
открывая файл, половина людей видели слипшиеся поля и матерились.&lt;/p&gt;

&lt;p&gt;У Экселя есть костыль: если в первой строке CSV написать &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sep=;&lt;/code&gt;, то будет
использоваться именно этот разделитель. Но оказалось, npm-пакет ничего про это
не знает. Нужно контрибьютить и пинать автора, чтобы принял изменение и выкатил
версию.&lt;/p&gt;

&lt;p&gt;Наконец, я спросил прямо: если пользователи открывают файл в Экселе, уж наверное
им нужен файл xlsx, а не CSV? Так-то да, но пакета в npm, чтобы собрать эксельку
на клиенте, нет, поэтому пролетаем.&lt;/p&gt;

&lt;p&gt;В итоге я сделал вот что. На бекенде пишу нормальный Эксель-файл. Кладу его в S3
и получаю подписанный урл, который действует 15 минут. В HTTP-ответ отдаю
джейсончик с этим урлом:&lt;/p&gt;

&lt;div class=&quot;language-json highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;url&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;https://acme.amazonaws.com/path/to/file.xlsx?...&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;expires_at&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;...&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;На клиенте: получаю джейсончик, достаю урл. Потом:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;создаю невидимый элемент &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&amp;lt;a href=&quot;...&quot;&amp;gt;&lt;/code&gt; с этим урлом&lt;/li&gt;
  &lt;li&gt;добавляю этот элемент в тело так, что его не видно&lt;/li&gt;
  &lt;li&gt;имитирую клик по нему методом &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.click()&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;В результате файл загружается автоматом. Ну или может появиться окно с вопросом,
что делать с файлом.&lt;/p&gt;

&lt;p&gt;Тот npm-пакет я к черту выбросил, потому что он банально не нужен.&lt;/p&gt;

&lt;p&gt;Как я и говорил, все упирается в тезис из начала заметки. Фронтендер не понимает
проблему, которую решает. Он не понимает в целом как обмениваться данными, как
делать удобно другим — коллегам, пользователям. Он мыслит npm-пакетами и
подгоняет условия задачи под те пакеты, которые нагуглил.&lt;/p&gt;

&lt;p&gt;Я, кстати, вообще считаю, что фронтенд — это не программирование. Современный
фронтендер занят тем, что передает результат из пакета А в пакет Б. Это не
хорошо и не плохо, это просто факт. Примерно как сборка изделия из готовых
частей.&lt;/p&gt;

&lt;p&gt;Знание этого принципа, на мой взгляд, полезно в следующем. Выбирая решение,
нужно проверить, что у фронта есть для него пакет. Нужно следить, чтобы коллеги
выбрали максимально адекватный их них. Такой, чтобы не повесил браузер, не
скачал 100 зависимостей вроде &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;is_number&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;leftpad&lt;/code&gt; и так далее.&lt;/p&gt;

&lt;p&gt;Короче, следить за ними, как за перспективными детьми, которые в любой момент
могут попасть в дурную компанию.&lt;/p&gt;

&lt;p&gt;Ну и порой подсказать фронтендерам, что задача решается не пакетом, а пятью
строчками на чистом js. Часто они этого не знают.&lt;/p&gt;
</description>
        <pubDate>Sun, 07 Dec 2025 00:00:00 +0000</pubDate>
        <link>https://grishaev.me/frontenders/</link>
        <guid isPermaLink="true">https://grishaev.me/frontenders/</guid>
        
        <category>ui</category>
        
        <category>frontend</category>
        
        
      </item>
    
  </channel>
</rss>
