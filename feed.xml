<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Ivan Grishaev's blog</title>
    <description>Writing on programming, education, books and negotiations.
</description>
    <link>https://grishaev.me/</link>
    <atom:link href="https://grishaev.me/feed.xml" rel="self" type="application/rss+xml"/>
    <pubDate>Thu, 10 Apr 2025 18:26:32 +0000</pubDate>
    <lastBuildDate>Thu, 10 Apr 2025 18:26:32 +0000</lastBuildDate>
    <generator>Jekyll v4.2.0</generator>
    
      <item>
        <title>Зарплата до налогов</title>
        <description>&lt;p&gt;Хоть я и не сталкивался, но предупреждаю вот о чем.&lt;/p&gt;

&lt;p&gt;Некоторые HR-ы практикуют гниловатый прием: называют зарплату, не договаривая,
что это ДО налогов. В итоге сотруднику платят меньше, а когда он спрашивает
“wtf?”, ему отвечают: это до налогов, дорогой! Как в лучших домах Европы.&lt;/p&gt;

&lt;p&gt;Такое случается не только в айти: слышал в том числе от стоматологов. Врача
переманивают лишней двадцаткой и потом вычитают ее налогами. А назад уже поздно:
взяли другого врача, да и ушел не совсем достойно.&lt;/p&gt;

&lt;p&gt;Ситуация, конечно, бредовая: русская фирма нанимает русского сотрудника, а
налоги у них как в Европе? Скорее, обычная русская жадность.&lt;/p&gt;

&lt;p&gt;Будете устраиваться во всякие ВК-Сберы-Яндексы – имейте в виду.&lt;/p&gt;
</description>
        <pubDate>Thu, 10 Apr 2025 00:00:00 +0000</pubDate>
        <link>https://grishaev.me/salary-tax/</link>
        <guid isPermaLink="true">https://grishaev.me/salary-tax/</guid>
        
        <category>life</category>
        
        <category>work</category>
        
        <category>salary</category>
        
        <category>tax</category>
        
        
      </item>
    
      <item>
        <title>Реляционная база данных</title>
        <description>&lt;p&gt;Повторюсь, до чего же это классно: иметь в распоряжении нормальную реляционную
базу данных. Не тридцать микросервисов с HTTP JSON API; не OpenSearch; не Монгу;
не черт знает что еще.&lt;/p&gt;

&lt;p&gt;Скажем, у меня условие: отправлять письмо, если у вложенных атрибутов такие-то
значения, плюс у сущностей, на которые ссылается эта сущность, тоже определенные
значения. Эти проверки выливаются в экраны быдлокода. Сначала собрали вложенные
куски, отфильтровали, построили индекс. Взяли айдишки. По ним выгребли другие
сущности, плюс надо следить, что их не 10 тысяч, иначе пляска с
пагинацией. Потом пробегаешь по этим сущностям, строишь индекс. И по двум
индексам находишь ответ: есть совпадения или нет.&lt;/p&gt;

&lt;p&gt;Даже на Кложе это приличный быдлокод, который через пару месяцев хрен поймешь:
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;map&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;map&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;filter&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;reduce&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;map&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;group-by&lt;/code&gt; – удачной отладки. В
какой-нибудь Джаве с доменами и слоями проще выйти в окно.&lt;/p&gt;

&lt;p&gt;А в SQL это запрос в 18 строчек. Функция &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;json_path_query&lt;/code&gt;, которая собирает
вложенные пути, один &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;left join&lt;/code&gt; и пара условий. Все декларативно, нет
переменных и циклов.&lt;/p&gt;

&lt;p&gt;Еще один момент: если придет человек и спросит, почему эта штука посчиталась
именно так, то с микросервисами я сосу лапу. Код отработал, и какие структуры
были в памяти, догнать уже невозможно. Раньше я дампил состояние в S3, чтобы
позже скачать его и воспроизвести расчеты. Но это долго! А теперь я выполнил
запрос в PGAdmin, и человек такой: все верно, это у нас надо поправить.&lt;/p&gt;

&lt;p&gt;Принцип простой: чтобы стало легче, нужно отстегнуть гири, которые сами же
привязали. Если нет легкого, произвольного доступа к данным, ни о какой удобной
работе нет речи.&lt;/p&gt;
</description>
        <pubDate>Thu, 10 Apr 2025 00:00:00 +0000</pubDate>
        <link>https://grishaev.me/pg-awesome/</link>
        <guid isPermaLink="true">https://grishaev.me/pg-awesome/</guid>
        
        <category>programming</category>
        
        <category>postgres</category>
        
        <category>sql</category>
        
        
      </item>
    
      <item>
        <title>Зависание окон в Экселе</title>
        <description>&lt;p&gt;Работал в Экселе и заметил одну вещь.&lt;/p&gt;

&lt;p&gt;В офисном пакете интерфейс устроен по принципу “один файл – одно окно”. Это
значит, если открыто пять файлов, то будет пять окон. А восприятие наше таково,
что каждое окно считается независимым. Технически много окон могут обслуживаться
одним процессом, да. Но когда я вижу окно во весь экран с менюшкой и табиками,
оно ощущается отдельной программой.&lt;/p&gt;

&lt;p&gt;Это приводит к странному поведению: во время долгого импорта виснут все окна
Экселя. Я рассуждал так: пока импортируется тяжелый файл, я поработаю с другим
файлом. Но Эксель в этом плане однопоточный: остальные окна тупо ждут, пока
отпустит первое. Может, такое только на Маке, а на Винде проблем нет, спорить не
буду.&lt;/p&gt;

&lt;p&gt;Интересно вот что. Сегодня все браузеры работают по принципу “одна вкладка –
один процесс”. Я смутно помню, что этого браузеры, в том числе Хром, часто
вылетали с ошибками, потому что вкладки были на тредах. Сегодня это редкость, а
лет 15 назад было в порядке вещей. Или браузер мог повиснуть на Ютубе или
какой-то упоротой верстке, заморозив все табы. А теперь, когда вкладке плохо, мы
этого даже не замечаем.&lt;/p&gt;

&lt;p&gt;Было бы забавно проверить эту модель в современном вебе. Иногда на звонках люди
шарят экран, и я вижу Хром с тремя десятками вкладок. Без преувеличения, не
менее тридцати, потому что табики сжаты до размера иконки. Десятки табов Джиры,
Конфлюэнса и прочей корпоративной жести. А каждая Джира – это, на минуточку, 50
мегабайтов скриптов и запросы на каждый клик. Мне кажется, если бы тридцать Джир
крутились в одном процессе, интернета мы бы вообще не увидели.&lt;/p&gt;

&lt;p&gt;И еще одна мысль, которую не знаю, куда приткнуть. Сервер PostgreSQL работает по
принципу “одно соединение – один процесс”. Никаких тредов там нет и в помине,
на каждое подключение делается форк главного процесса. Обмен данными происходит
через shared memory – участок памяти, доступный всем процессам. Что-то вроде
глобальной переменной, только в рамках процессов.&lt;/p&gt;

&lt;p&gt;Вроде топорно, но оказывается удобным на практике, потому и дожило до наших
дней.&lt;/p&gt;
</description>
        <pubDate>Thu, 10 Apr 2025 00:00:00 +0000</pubDate>
        <link>https://grishaev.me/excel-hangs/</link>
        <guid isPermaLink="true">https://grishaev.me/excel-hangs/</guid>
        
        <category>excel</category>
        
        
      </item>
    
      <item>
        <title>Зачем пароль?</title>
        <description>&lt;p&gt;Вот что меня удивляет. Когда логинишься в любой сервис, ввода пароля уже
недостаточно. Обязательно спросят код с телефона или почты. В какой-то степени я
с этим согласен, потому что телефон – физическое устройство, им трудно
завладеть, коды одноразовые, их сложнее перехватить.&lt;/p&gt;

&lt;p&gt;Хорошо, но зачем тогда вообще пароль? Если мы не доверяем тому, кто ввел пароль,
зачем он нужен? Вроде бы есть проверка, но она не точная как фильтр Блума.&lt;/p&gt;

&lt;p&gt;Коды из смс и всякие токены из приложения – все это буквально кричит о кризисе
системы паролей. И вместо того, чтобы закопать стюардессу и отменить пароли,
продолжают их использовать.&lt;/p&gt;

&lt;p&gt;Видимо, кто-то считает, что связка “пароль” + “код из смс” безопасней, чем оба
по отдельности, но я в это не верю. Это примерно как вызвать хэш-фукцию десять
раз вместо одного: доказано, что такой подход не приносит пользы.&lt;/p&gt;

&lt;p&gt;Телефон уже давно умеет в биометрию и может авторизировать человека где
угодно. Неужели лица и отпечатка пальца недостаточно, чтобы зайти в личный
кабинет? С какой стати человек должен помнить пароли вроде “не менее 8 символов,
не менее двух заглавных букв” и мусора вроде решеток и долларов? И так для
двадцати разных сервисов?&lt;/p&gt;

&lt;p&gt;Тем не менее, все бездумно лепят одну и ту же схему: пароль, которому никто не
верит, и коды с телефона. Тут явно нужно что-то менять.&lt;/p&gt;

&lt;p&gt;Самое смешное: сейчас вы повозмущаетесь в комментариях, а что потом? Пойдете
пилить форму авторизации с паролем.&lt;/p&gt;
</description>
        <pubDate>Thu, 03 Apr 2025 00:00:00 +0000</pubDate>
        <link>https://grishaev.me/why-password/</link>
        <guid isPermaLink="true">https://grishaev.me/why-password/</guid>
        
        <category>life</category>
        
        <category>ui</category>
        
        <category>password</category>
        
        
      </item>
    
      <item>
        <title>Перевод часов</title>
        <description>&lt;p&gt;Трудно поверить, но во многих странах до сих пор живодерский обычай переводить
время на час и обратно. Даже находятся те, кто утверждает, что это полезно для
экономики.&lt;/p&gt;

&lt;p&gt;Напомню, что сто пятьдесят лет назад какой-то бюрократ посчитал, что если
зажигать лампочку на час позже, это будет дешевле. О мелочах вроде сорванных
встреч, опозданий и нарушений биоритмов никто не думал.&lt;/p&gt;

&lt;p&gt;Поражаюсь, почему люди до сих пор живут с этим бредом? Было совсем другое время,
другое общество, только что вступившее в индустриальную фазу. Сегодня другие
приоритеты. Почему не пересмотреть вопрос, но на этот раз учесть все факторы, а
не только “экономию” нескольких тысяч долларов на всю страну?&lt;/p&gt;

&lt;p&gt;Согласен, что зимой нужно корректировать время, но делать это нужно по-другому.&lt;/p&gt;

&lt;p&gt;Зимой человек устает больше и спит больше. Поднять и собрать детей в школу зимой
– целый подвиг. А весной или ранней осенью, когда солнце уже показалось,
вставать легче. Отсюда вывод: нужно двигать не циферблат целиком, а распорядок
госучреждений. Например, начинать занятия в школах, садах и госконторах не в 8
утра, а в 9 или хотя бы в 8:30. То есть давать людям лишние 30 минут на сон.&lt;/p&gt;

&lt;p&gt;Это честно, потому что затрагивает только тех, кому это нужно. На офисных
работниках, у которых служба начинается в 10, это никак не отразится. У них не
поедет календарь, не придется опаздывать. У стариков не нарушится прием
лекарств. Что может быть лучше?&lt;/p&gt;

&lt;p&gt;Пока писал, вспомнил свою жизнь в Чите. Я тогда работал в Энергосбыте, где
служба начиналась в 8 утра, и за опозданиями следили строго. Пара опозданий –
выговор, три и более – лишают премии. Только одна женщина из соседнего отдела
могла приходить к 9 утра, но такую привилегию нужно было выслуживать годами.&lt;/p&gt;

&lt;p&gt;Так вот, Чита, зима, поднимаешься в 6:30. За окном ночь. Завтрак, подъем
ребенка, сбор в садик. Едем на санках по морозу -30. Машины нет, да и не каждая
машина заведется, постояв ночь при такой температуре. После сада нужно сесть на
маршрутку, а они все полные. Кое-как добраться до работы, чтобы пересечь
турникет за две минуты до 8 утра. Зайти в кабинет и полчаса отогреваться и
отпиваться чаем. Зато успел, премии не лишат.&lt;/p&gt;

&lt;p&gt;Блин, зачем так жить? Зачем рвать задницу ради 8 часов утра? Зачем переводить
часы глобально? Почему нельзя подвинуть распорядок тех контор, которые начинают
рано? То, что в мире сейчас – это какой-то идиотизм от начала до конца.&lt;/p&gt;
</description>
        <pubDate>Thu, 03 Apr 2025 00:00:00 +0000</pubDate>
        <link>https://grishaev.me/time-shift/</link>
        <guid isPermaLink="true">https://grishaev.me/time-shift/</guid>
        
        <category>time</category>
        
        
      </item>
    
      <item>
        <title>Книги не устаревают</title>
        <description>&lt;p&gt;Удивляюсь, когда говорят: айтишные книги устаревают. Это не так.&lt;/p&gt;

&lt;p&gt;Книги об алгоритмах, сетях или азах разработки не устаревают в силу своей
базы. Нет такого, что каждый день придумывают новую сортировку или топологию
дерева. Новый сетевой протокол выходит раз в несколько лет, а не дней. Поэтому
здесь волноваться не о чем.&lt;/p&gt;

&lt;p&gt;Если условный Rust меняется каждый день, и код из прошлогодней книги уже не
работает, то это проблема технологии, а не книги. Пусть читатель либо подождет,
пока язык стабилизируется, либо выберет что-то более надежное.&lt;/p&gt;

&lt;p&gt;Читая книгу, человек не просто что-то узнает. Он насыщает индекс, обучает свою
нейронную сеть. Даже если он сядет за новую версию технологии, сработает фактор
знакомства: это я уже видел, тут на 70% как в книжке.&lt;/p&gt;

&lt;p&gt;Читайте книги!&lt;/p&gt;
</description>
        <pubDate>Thu, 03 Apr 2025 00:00:00 +0000</pubDate>
        <link>https://grishaev.me/read-books/</link>
        <guid isPermaLink="true">https://grishaev.me/read-books/</guid>
        
        <category>books</category>
        
        
      </item>
    
      <item>
        <title>Телефонные боты</title>
        <description>&lt;p&gt;Замечаю еще один забавный паттерн. Звоню в разные фирмы, и как обычно, на входе
голосовое меню. Чтобы узнать то, нажми 1, чтобы это, нажми 2 и так далее. Либо
тыкаешь сразу 0, чтобы попасть на оператора, либо ждешь, пока меню отпустит и
сработает фолбек.&lt;/p&gt;

&lt;p&gt;Но когда скрипт переключает на оператора, включается ИИ-бот. “Я голосовой
помощник Иннокентий, какой у вас вопрос?” Говоришь “дай оператора”, и начинаются
расспросы: а по какому вопросу тебе нужен оператор? В точности пенсионер-вахтер.&lt;/p&gt;

&lt;p&gt;К чему я это пишу. Ребята, которые внедряют голосовых ботов: не кажется ли вам
странным оставлять голосовое меню из нулевых годов? У вас же вроде ИИ, который
знает и умеет все на свете, и который скоро всех заменит. Но прежде чем попасть
на бота, я должен кликать в голосовом меню? Как-то не сходится. Зачем боту такой
костыль?&lt;/p&gt;

&lt;p&gt;То, что голосовые помощники тупы как пробки, нет смысла говорить. Выделяют
ключевые слова и читают то, что уже есть на сайте. Например, спросишь: на какой
премиальный курс я могу рассчитывать, если сумма обмена больше N тысяч евро? И
он диктует текущий курс или расписание отделений.&lt;/p&gt;

&lt;p&gt;Беда.&lt;/p&gt;
</description>
        <pubDate>Thu, 03 Apr 2025 00:00:00 +0000</pubDate>
        <link>https://grishaev.me/phone-bots/</link>
        <guid isPermaLink="true">https://grishaev.me/phone-bots/</guid>
        
        <category>life</category>
        
        <category>ai</category>
        
        <category>bots</category>
        
        
      </item>
    
      <item>
        <title>Postgres как поисковый движок</title>
        <description>&lt;p&gt;Накину ссылку, которая очень мне помогла:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://habr.com/ru/companies/sravni/articles/888534/&quot;&gt;Postgres как поисковый движок&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Речь о том, как делать гибридный поиск в Посгресе. Это когда документы ищутся по
разным критериям, ранжируются, а потом объединяются в финальный набор. Как раз
то, над чем я работаю в текущем проекте.&lt;/p&gt;

&lt;p&gt;Статья полезна вот чем: до нее я не понимал, как объединять выборки с удалением
дублей. Бывает, один и тот же документ оказывается в разных выборках, и нужно
оставить ту, у которой больше ранг. Пытался сделать это при помощи &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;UNION&lt;/code&gt;, но
из-за ранга дубликаты не удалялись. Чистить их вторым проходом тяжело,
усложняется план.&lt;/p&gt;

&lt;p&gt;Так вот: автор предлагает объединение выборок при помощи full outer join и
coalesce среди айдишек прошлых результатов. Звучит непонятно, но если
разобраться, то получается как в примере ниже.&lt;/p&gt;

&lt;p&gt;Для сравнения, вот первый запрос, который выбирает документы по условиям и
сортирует по выражению с рангом:&lt;/p&gt;

&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;aggregate&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;some_aggregates&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;WHERE&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;aggregate&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;#&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ARRAY&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'state'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;':deleted'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;AND&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(((&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;aggregate&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;#&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ARRAY&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'attrs'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'code'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'hello'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;OR&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;aggregate&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@@&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'$.attrs.&quot;code-name&quot; == &quot;hello&quot;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;OR&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;aggregate&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;#&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ARRAY&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'attrs'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'code'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;ILIKE&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'%hello%'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;OR&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;aggregate&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;#&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ARRAY&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'attrs'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'code-name'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;ILIKE&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'%hello%'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;BY&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;CASE&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;WHEN&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;aggregate&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;#&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ARRAY&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'attrs'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'code'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'hello'&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;THEN&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;WHEN&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;aggregate&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@@&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'$.attrs.&quot;code-name&quot; == &quot;hello&quot;'&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;THEN&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;WHEN&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;aggregate&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;#&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ARRAY&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'attrs'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'code'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;ILIKE&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'%hello%'&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;THEN&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;WHEN&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;aggregate&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;#&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ARRAY&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'attrs'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'code-name'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;ILIKE&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'%hello%'&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;THEN&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;ELSE&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;999&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;END&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;ASC&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;LIMIT&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;51&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;OFFSET&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;На таблице с 1.5 миллионами записей метрики такие: execution=450ms, cost=90000,
что довольно много.&lt;/p&gt;

&lt;p&gt;А вот то же самое, но с подходом, который предлагает автор:&lt;/p&gt;

&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sub1&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;select&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rank&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;from&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;some_aggregates&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;where&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;aggregate&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;#&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ARRAY&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'state'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;':deleted'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;aggregate&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;#&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ARRAY&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'attrs'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'code'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'hello'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;limit&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;51&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;sub2&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;select&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rank&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;from&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;some_aggregates&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;where&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;aggregate&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;#&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ARRAY&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'state'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;':deleted'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;aggregate&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@@&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'$.attrs.&quot;code-name&quot; == &quot;hello&quot;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;limit&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;51&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;sub3&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;select&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rank&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;from&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;some_aggregates&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;where&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;aggregate&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;#&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ARRAY&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'state'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;':deleted'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;aggregate&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;#&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ARRAY&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'attrs'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'code'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;ILIKE&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'%hello%'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;limit&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;51&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;sub4&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;select&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rank&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;from&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;some_aggregates&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;where&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;aggregate&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;#&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ARRAY&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'state'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;':deleted'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;aggregate&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;#&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ARRAY&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'attrs'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'code-name'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;ILIKE&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'%hello%'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;limit&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;51&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;select&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;aggs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
 &lt;span class=&quot;n&quot;&gt;aggs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;aggregate&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;#&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ARRAY&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'attrs'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'code'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;
 &lt;span class=&quot;n&quot;&gt;aggs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;aggregate&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;#&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ARRAY&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'attrs'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'code-name'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;
 &lt;span class=&quot;n&quot;&gt;sub1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rank&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
 &lt;span class=&quot;n&quot;&gt;sub2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rank&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
 &lt;span class=&quot;n&quot;&gt;sub3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rank&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
 &lt;span class=&quot;n&quot;&gt;sub4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rank&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
 &lt;span class=&quot;n&quot;&gt;aggs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;aggregate&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;from&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sub1&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;full&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;outer&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;join&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sub2&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;on&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;coalesce&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sub1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sub2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;full&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;outer&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;join&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sub3&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;on&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;coalesce&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sub1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sub2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sub3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;full&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;outer&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;join&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sub4&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;on&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;coalesce&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sub1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sub2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sub3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sub4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;join&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;some_aggregates&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aggs&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;on&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;coalesce&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sub1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sub2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sub3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sub4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aggs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;order&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;by&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sub1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rank&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sub2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rank&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sub3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rank&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sub3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rank&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;asc&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;limit&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;51&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Хоть он и выглядит длинно, содержит CTE и джоины, но метрики такие:
execution=7ms, cost=15000. Гораздо быстрее первого варианта.&lt;/p&gt;

&lt;p&gt;Мораль в том, что короткий запрос не всегда значит быстрый. С помощью
правильного джоина можно отсечь огромную часть выборки, сведя ее нескольким
записям.&lt;/p&gt;

&lt;p&gt;Статья на Хабре – перевод вот этого блога:
https://anyblockers.com/posts/postgres-as-a-search-engine&lt;/p&gt;

&lt;p&gt;В свою очередь, автор взял идею из блога Supabase:
https://supabase.com/docs/guides/ai/hybrid-search&lt;/p&gt;

&lt;p&gt;Тем, кто ковыряеся с Посгресом, будет очень полезно изучить ссылки.&lt;/p&gt;
</description>
        <pubDate>Thu, 03 Apr 2025 00:00:00 +0000</pubDate>
        <link>https://grishaev.me/pg-search/</link>
        <guid isPermaLink="true">https://grishaev.me/pg-search/</guid>
        
        <category>programming</category>
        
        <category>postgres</category>
        
        
      </item>
    
      <item>
        <title>Настоящий гей</title>
        <description>&lt;p&gt;Встречаюсь с приятелем, и он рассказывает: водил жену в ресторан, и знаешь,
какой официант нас обслуживал? Настоящий гей! Или знакомый врач говорит:
представляешь, вчера на приеме был настоящий гомик! Разумеется, они используют
более резкие термины, но я не привожу, чтобы никого не обидеть.&lt;/p&gt;

&lt;p&gt;В такие моменты я оживляюсь и спрашиваю: как ты определил, что это гей? Он
оставил записку с предложением встретиться? Он погладил тебя за руку? Шлепнул по
заднице? Пристал в гардеробе?&lt;/p&gt;

&lt;p&gt;Все оказывается банально: этот “гей” был вычурно одет, пользовался косметикой,
говорил с другой интонацией. И все? “Божечки, а разговоров-то было…” (с)&lt;/p&gt;

&lt;p&gt;В городской среде сексуальная ориентация и внешность никак не связаны. Можно
спать с мужчинами и носить обычную одежду. Можно носить ошейник и кожаные штаны,
но не иметь связей в принципе.&lt;/p&gt;

&lt;p&gt;В случае с официантом причин может быть много. Когда у человека совсем плохо с
женщинами, он может притворяться геем, особенно если работает в женском
коллективе. Это старый прием, потому что к геям девушки относятся по-другому.&lt;/p&gt;

&lt;p&gt;Человеку может нравиться ролевая модель гея. Он изображает того, кто не
вписывается в рамки. Ему нравится эпатировать публику, ловить
взгляды. Провоцировать других и писать гневные посты в VK: а сегодня одно быдло
сказало мне… Отсюда прилизанные лаком волосы, мушка на щеке, брошь размером с
кулак.&lt;/p&gt;

&lt;p&gt;Не вижу разницы с неформалами, готами и другими ребятами. Везде, если копнуть,
сидит желание выделиться или уход от своих проблем.&lt;/p&gt;

&lt;p&gt;Отучайтесь делать выводы об ориентации по внешности. Иначе вы не лучше
деревенского гопника, который выучил, в каком ухе должна быть серьга, в какую
сторону приглаживать челку, и какой фасон джинсов “правильный”. Мир как бы
сложнее этих правил.&lt;/p&gt;
</description>
        <pubDate>Thu, 03 Apr 2025 00:00:00 +0000</pubDate>
        <link>https://grishaev.me/it-was-a-gay/</link>
        <guid isPermaLink="true">https://grishaev.me/it-was-a-gay/</guid>
        
        <category>life</category>
        
        
      </item>
    
      <item>
        <title>Палец в Фоллауте</title>
        <description>&lt;p&gt;&lt;img src=&quot;/assets/static/aws/fallout-thumb/1.jpeg&quot; /&gt;&lt;/p&gt;

&lt;p&gt;В детстве я увлекался Фоллаутом. Разумеется, двумя первыми играми с видом
сверху. Месяцами бродил по пустыням, выполнял квесты, а то и вовсе вырезал город
за городом. Тогда мне казалось это интересным.&lt;/p&gt;

&lt;p&gt;Не хочу наговаривать на последующие части, но Фоллауты с видом от первого лица
– это не мое. Абсолютно не понимаю их. По мне это как Doom в виде карточной
игры.&lt;/p&gt;

&lt;p&gt;Так вот, с опозданием в 25 лет я выяснил забавный факт. Помните Пип-боя, маскота
игры? Прикладываю картинку. Почему он вытянул руку, поднял палец и прищурился?
Это не просто так, здесь умысел.&lt;/p&gt;

&lt;p&gt;Дело вот в чем. Предположим, на горизонте образовался ядерный гриб. Как
проверить, безопасно ли расстояние до него? Нужно вытянуть руку и навести
большой палец на гриб. Если палец полностью закрывает его, значит расстояние
безопасно, и можно идти по своим делам. Если же гриб вылезает, нужно что-то
предпринять.&lt;/p&gt;

&lt;p&gt;Оказалось, все это время Пип-бой вымерял пальцем ядерный гриб, а я не знал. Он
че!&lt;/p&gt;
</description>
        <pubDate>Thu, 03 Apr 2025 00:00:00 +0000</pubDate>
        <link>https://grishaev.me/fallout-thumb/</link>
        <guid isPermaLink="true">https://grishaev.me/fallout-thumb/</guid>
        
        <category>fallout</category>
        
        
      </item>
    
  </channel>
</rss>
