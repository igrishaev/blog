<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Ivan Grishaev's blog</title>
    <description>Writing on programming, education, books and negotiations.
</description>
    <link>https://grishaev.me/</link>
    <atom:link href="https://grishaev.me/feed.xml" rel="self" type="application/rss+xml"/>
    <pubDate>Mon, 18 Sep 2023 09:53:48 +0000</pubDate>
    <lastBuildDate>Mon, 18 Sep 2023 09:53:48 +0000</lastBuildDate>
    <generator>Jekyll v4.2.0</generator>
    
      <item>
        <title>Скриншоты на винде</title>
        <description>&lt;p&gt;На винде есть утилита для скриншотов рабочего стола, называется “Ножницы” или
вроде того (clip). И надо сказать, программа люто, бешено тупая.&lt;/p&gt;

&lt;p&gt;Делаю скриншот и хочу сохранить — открывает диалог с именем “безымянный.PNG” (в
английской версии untitled.PNG). Не будем комментировать расширение капсом; но
блин, почему файл безымянный? Что мешало назвать его текущей датой с точность до
минуты?&lt;/p&gt;

&lt;p&gt;Далее, если в папке уже есть “безымянный” с прошлого раза, программа предложит
его перезаписать. Что мешает проверить, что такой файл уже есть и хотя бы
поставить единичку (двойку, тройку)?&lt;/p&gt;

&lt;p&gt;В итоге как дурак дописываешь в конец чушь вроде 123, чтобы сохранить скриншот и
куда-то отправить.&lt;/p&gt;

&lt;p&gt;Вот как на Маке: когда делаешь скриншот, он сперва улетает в угол, и в течении
10 секунд его можно куда-то перетащить без сохранения на диск. А если не успел,
он сохранится на рабочий стол с датой и временем в названии. Не нужно париться,
сохранил или нет, перезаписал или нет.&lt;/p&gt;

&lt;p&gt;Что мешало сделать также Микрософту? Они вообще своими программами пользуются?&lt;/p&gt;
</description>
        <pubDate>Mon, 18 Sep 2023 00:00:00 +0000</pubDate>
        <link>https://grishaev.me/windows-snapshots/</link>
        <guid isPermaLink="true">https://grishaev.me/windows-snapshots/</guid>
        
        <category>windows</category>
        
        <category>screenshot</category>
        
        
      </item>
    
      <item>
        <title>Мы заслужили</title>
        <description>&lt;p&gt;Выражение “X, который мы заслужили” стало затасканным штампом.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Киберпанк, который мы заслужили.&lt;/li&gt;
  &lt;li&gt;Футбол, который мы заслужили.&lt;/li&gt;
  &lt;li&gt;Релиз, который мы заслужили.&lt;/li&gt;
  &lt;li&gt;Пайплайн, который мы заслужили.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Блин, кто мы? Чем и как заслужили?&lt;/p&gt;

&lt;p&gt;Лет пять назад это было туда-сюда, но сегодня терпеть уже невозможно.&lt;/p&gt;
</description>
        <pubDate>Mon, 18 Sep 2023 00:00:00 +0000</pubDate>
        <link>https://grishaev.me/we-deserve/</link>
        <guid isPermaLink="true">https://grishaev.me/we-deserve/</guid>
        
        <category>mems</category>
        
        <category>stamps</category>
        
        
      </item>
    
      <item>
        <title>Картинки в Телеграме</title>
        <description>&lt;p&gt;&lt;img src=&quot;/assets/static/aws/tg-img/1.jpeg&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Телеграм бесит ещё одной вещью. Если добавить к тексту картинку, текст
поджимается под её ширину. Зачем, какой смысл? Текст превращается в мышиный
хвост, справа сплошная пустота. Половина полезного места уходит в унитаз. Всё
это ради чего? Чтобы что?&lt;/p&gt;
</description>
        <pubDate>Mon, 18 Sep 2023 00:00:00 +0000</pubDate>
        <link>https://grishaev.me/tg-img/</link>
        <guid isPermaLink="true">https://grishaev.me/tg-img/</guid>
        
        <category>telegram</category>
        
        
      </item>
    
      <item>
        <title>Пасхалки</title>
        <description>&lt;p&gt;Пожалуй, худшим фильмом, что я смотрел за последние годы, можно назвать “Петровы
в гриппе”. В двух словах его можно описать как бессвязный треш. В те времена я
читал Медузу, наслушался критика Долина и побежал на предпоказ как последний
дурачок.&lt;/p&gt;

&lt;p&gt;Фильм — набор флешбеков без какого-либо действия. Женщина убивает мужчину на
детской площадке. Это происходит во дворе девятиэтажки, но никто этого не
видит. Потом заболевает гриппом мальчик, ее сын. С работы приходит батя-алкаш. У
него начинаются приходы и флешбеки со снегурочкой. Потом фильм рассказывает про
снегурочку: нищета, театр, случайный секс, беременность. В конце сцена про
алкашей и оживший труп.&lt;/p&gt;

&lt;p&gt;Я не досидел до конца и ушел из зала, но потом вернулся за забытой вещью. К тому
времени свет включили, но люди не расходились. Оказалось, к фильму был
приставлен специально обученный человек, который после показа работал со
зрителями: отвечал на вопросы “что хотел сказать автор”.&lt;/p&gt;

&lt;p&gt;Вот оно, современное искусство: тебе не только продают говно, но ещё тратятся на
человека, который объяснит, что это не говно, а режиссёр — тонкий художник.&lt;/p&gt;

&lt;p&gt;Но пост не о плохом фильме — их и так хватает, — а о большом числе “пасхалок” в
нём. Каждые пять минут в кадре появляются какие-нибудь слова на заборе, которые
что-то значат. Это сделано столь топорно, что просто закрываешь глаза. Режиссёр
как будто тычет с экрана: смотри, это пасхалочка, скрытый смысл, понимаешь?
Улавливаешь?&lt;/p&gt;

&lt;p&gt;От одной из сцен захотелось просто выругаться. Парень и девушка идут вдоль
огромной инсталляции с буквами в человеческий рост. Буквы показаны наполовину,
но распознать их можно. И когда пара шла мимо них, я подумал: наверняка буквы
складываются в какой-то “мэссадж”, но читать было лень, потому что от пасхалок я
уже устал.&lt;/p&gt;

&lt;p&gt;И что вы думаете? Позже я прочёл в интернете, что те буквы складываются в “тебе
пизда”. Очень оригинально! Какой талант режиссёра! Наверное, много думал над
этой пасхалкой — больше, чем над сюжетом и персонажами.&lt;/p&gt;

&lt;p&gt;Если серьёзно, то непонятно, зачем эта пасхалка и все другие. Какую задачу они
решают? Фильм как был говном, так остался им со всеми пасхалками, разгаданными
или нет. Если накрыть говно бантиком, получится говно с бантиком, верно?&lt;/p&gt;

&lt;p&gt;Пожелаю режиссёру скорей понять это.&lt;/p&gt;
</description>
        <pubDate>Mon, 18 Sep 2023 00:00:00 +0000</pubDate>
        <link>https://grishaev.me/easter-eggs/</link>
        <guid isPermaLink="true">https://grishaev.me/easter-eggs/</guid>
        
        <category>movies</category>
        
        <category>easter</category>
        
        
      </item>
    
      <item>
        <title>Куки</title>
        <description>&lt;p&gt;К сожалению, нам не везёт с веб-дизайнерами. Я имею в виду нам всем, не только
мне. Открываешь любой сайт — и тебе стреляют плашкой, что сайт использует
куки. Даже если нажмёшь ОК, через пару дней сайт забудет, что ты согласился и
выстрелит опять. Или зайдешь с другого устройства и снова терпи. На телефоне
вообще беда: плашка занимает в лучшем случае полэкрана, в худшем — весь.&lt;/p&gt;

&lt;p&gt;Нам не повезло, потому что не нашлось дизайнера, который бы нормально встроил
сообщение о куках в дизайн. Под “нормально” я имею в виду, чтобы оно не
выскакивало, не выпадало, а было написано без анимаций и JavaScript.&lt;/p&gt;

&lt;p&gt;Я уже говорил, что хорошие дизайнеры должны начинать с печатного дизайна. Есть
лист бумаги, и нужно уместить на нём дизайн со всеми требованиями. Никаких тебе
выпадашек и анимашек.&lt;/p&gt;

&lt;p&gt;А требования бывают разные. Если алкоголь или табак — предупреждение Минздрава
занимает не менее 10% от площади макета. Если банк — генеральная лицензия кеглем
не менее стольки пунктов. Если кандидат на выборах — лицензия на участие, номер
и прочие вещи. В роликах то же самое: показываешь БАД — внизу должна быть
надпись “не является лекарством, проконсультируйтесь с врачом”. И не в первую
секунду, а на протяжении всего ролика.&lt;/p&gt;

&lt;p&gt;И дизайнеры как-то справляются с этим — выделяют площадь, увеличивают кегль,
согласуют с юристами и надзорными органами. И только веб-дизайнеры, эти
обезьянки с курсами HTTP/CSS/JavaScript, не могут доработать дизайн так, чтобы
требование чиновников (тоже обезьянок) выполнялось без выпадашки.&lt;/p&gt;

&lt;p&gt;Казалось бы: нужно уведомить посетителя, что сайт использует куки. Так напиши
чуть ниже шапки: “этот сайт использует куки”. И ссылку на отдельную страницу,
где подробно написано, что такое куки, а ниже форма с чекбоксами, какие куки
хранить. Что мешает так сделать?&lt;/p&gt;

&lt;p&gt;Но нет, дизайнер быдлокодит всплывающую форму, скрипты, стили. Получил
инструменты, а пользуется ими во вред.&lt;/p&gt;

&lt;p&gt;Чтоб у него в штанах что-нибудь выпало.&lt;/p&gt;
</description>
        <pubDate>Mon, 18 Sep 2023 00:00:00 +0000</pubDate>
        <link>https://grishaev.me/cookie-popups/</link>
        <guid isPermaLink="true">https://grishaev.me/cookie-popups/</guid>
        
        <category>web</category>
        
        <category>cookies</category>
        
        <category>design</category>
        
        <category>idiots</category>
        
        
      </item>
    
      <item>
        <title>Бан в XBox</title>
        <description>&lt;p&gt;&lt;img src=&quot;/assets/static/aws/xbox/1.jpeg&quot; /&gt;&lt;/p&gt;

&lt;p&gt;У меня нет приставки, и я почти ни во что не играю (разве что в старые игры на эмуляторе). Однако я не мог пройти мимо такой картинки в интернете. Это скриншот из интерфейса XBox, где написано, что вас забанили.&lt;/p&gt;

&lt;p&gt;Удивляет пиктограмма рукопожатия справа. Что было в голове у дизайнера, который ее добавил? Мало того, что забанили клиента без объяснения причины; так еще нарисовали рукопожатие, мол, дружище, без обид, держись там. Бан пройдет, и мы снова будем друзьями.&lt;/p&gt;

&lt;p&gt;Тупизна какого-то вселенского масштаба. В точности как все у Микрософта.&lt;/p&gt;
</description>
        <pubDate>Sun, 17 Sep 2023 00:00:00 +0000</pubDate>
        <link>https://grishaev.me/xbox-ban/</link>
        <guid isPermaLink="true">https://grishaev.me/xbox-ban/</guid>
        
        <category>xbox</category>
        
        <category>design</category>
        
        
      </item>
    
      <item>
        <title>Warn</title>
        <description>&lt;p&gt;Не допускайте, чтобы в коде встречались логи с уровнем warn(ing).&lt;/p&gt;

&lt;p&gt;Во-первых, warn, предупреждение, — это ни то, ни сё. Вроде важнее обычного info,
но и не ошибка. Что делать? Продолжать вести наблюдение?&lt;/p&gt;

&lt;p&gt;Во-вторых, warn — отличный способ отстрелить ногу. В текущем проекте много
фоновых задач, и для них используется библиотека-аналог крона. Каждую задачу она
оборачивает в try/catch, чтобы не падать, но при этом логирует исключение с
уровнем warn. Мол, тут что-то упало, но не беспокойся. Авось в следующий раз
повезёт.&lt;/p&gt;

&lt;p&gt;Наш логгер устроен так, что только error попадает в Sentry; остальное идёт в
файл, который никто не читает. В результате мы прошляпили кучу ошибок в фоновых
задачах — просто потому, что автор библиотеки не считает их чем-то важным. Крон
работает и хорошо. Подумаешь, половина задач валится, главное, что у меня всё в
порядке.&lt;/p&gt;

&lt;p&gt;Не надо так.&lt;/p&gt;
</description>
        <pubDate>Sun, 17 Sep 2023 00:00:00 +0000</pubDate>
        <link>https://grishaev.me/warn/</link>
        <guid isPermaLink="true">https://grishaev.me/warn/</guid>
        
        <category>logs</category>
        
        <category>programming</category>
        
        <category>warn</category>
        
        
      </item>
    
      <item>
        <title>Фрагментация Телеграма</title>
        <description>&lt;p&gt;Когда я пользовался VK, меня удивляла фрагментация сущностей. Заметка, пост, фотография, видео и прочее — всё уже не упомню. Были записи на стене, сама стена, группы, форум. Я никогда не мог запомнить, что и где создавать и удивлялся — почему нельзя свести этот зоопарк к “сообщению”? Да, пусть у него будет много полей: гео-теги, фото, видео, ссылки… но это лучше, чем дюжина разных сущностей! Причём не только для программистов, но и для пользователей, потому что заморочки бекенда не будут на них проецироваться.&lt;/p&gt;

&lt;p&gt;Ясно, что ВК был клоном Фейсбука (запрещенная организация) и унаследовал его родовые травмы. В свою очередь в Фейсбуке была та же фрагментация, потому что изначально это был закрытый форум. А на форумах до сих пор такая фигня: создать заметку, фотографию, видео.&lt;/p&gt;

&lt;p&gt;Учетку VK, ровно как и других соцсетей, я удалил лет семь назад и ни разу не пожалел.&lt;/p&gt;

&lt;p&gt;Удвиляет, что при всем идиотизме этой фрагментации она продолжает жить в мессенджерах. Скажем, я написал заметку на лист А4, она прекрасно помещается в Телеграме. Но стоит добавить картинку или видео — размер сокращается в разы, буквально 150 символов или около. Почему? Потому что это уже не “заметка”, а “картинка”. А в чём проблема показать и картинку, и текст? Очевидно, там какие-то заморочки на бекенде — Эрланг, Mnesia, — но какое они имеют значение для меня как пользователя? Никакого.&lt;/p&gt;

&lt;p&gt;Чтобы исправить этот косяк, Телеграм сделал Телеграф — сервис анонимных заметок, в котором текст чередуется с картинками. Телеграфные ссылки открываются в Телеграме без перехода в браузер, но в целом это костыль — решили симптом, проблема осталась.&lt;/p&gt;

&lt;p&gt;А с недавними сторисами вышел смех и грех. Совершенно бесполезная функция, которую нельзя отключить. Мало того, что это буквальное неуважение к пользователю, так еще чувствуется вторичность и запоздалое заимствование. Телеграм — хороший месаджер, при чём тут какие-то сторис? У нас что, Инстаграм? Полная нелепица.&lt;/p&gt;

&lt;p&gt;В итоге происходит следующее: люди уходят из соцсетей в месаджеры, потому что устали от фрагментации контента. Не хочется групп, стен, форумов. Хочется единого потока сообщений. Для некоторых целей это не подходит, но в целом удобно. И тут опять приходит фрагментация. Деление каналов на топики — как же они глючили и кувыркались в первые недели работы! — и сторизы.&lt;/p&gt;

&lt;p&gt;Конечно, найдется тот, кто скажет: не нравится — не пользуйся. Но так не работает. Уже построены связи, диалоги, люди стучатся в Телеграм, и слезть с него так просто не выйдет.&lt;/p&gt;

&lt;p&gt;Словом, Телеграм плавно становится комбайном, который “может все”, как китайский Ви-чат. Это немного, но огорчает: мне не нужно всё.&lt;/p&gt;

&lt;p&gt;Мне нужно чуть-чуть.&lt;/p&gt;
</description>
        <pubDate>Sun, 17 Sep 2023 00:00:00 +0000</pubDate>
        <link>https://grishaev.me/telegram-fram/</link>
        <guid isPermaLink="true">https://grishaev.me/telegram-fram/</guid>
        
        <category>telegram</category>
        
        <category>vk</category>
        
        
      </item>
    
      <item>
        <title>Parasite Eve</title>
        <description>&lt;p&gt;На первой PlayStation была замечательная игра Parasite Eve. И была там музыкальная шкатулка с красивой темой:&lt;/p&gt;

&lt;iframe width=&quot;897&quot; height=&quot;586&quot; src=&quot;https://www.youtube.com/embed/ENMEzmmWiKk&quot; title=&quot;13 - Parasite Eve OST Disc 2 - I Hear a Voice Asking Me to Awaken&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;

&lt;p&gt;Оказывается, &lt;a href=&quot;https://youtu.be/DqZE54i-muE?t=919&quot;&gt;это Бах&lt;/a&gt;. Всего-то 23 года прошло, прежде чем я это понял.&lt;/p&gt;

&lt;p&gt;Кто играл в эту замечательную игру, почтите ее прослушиванием саундтрека.&lt;/p&gt;
</description>
        <pubDate>Sun, 17 Sep 2023 00:00:00 +0000</pubDate>
        <link>https://grishaev.me/pe-music/</link>
        <guid isPermaLink="true">https://grishaev.me/pe-music/</guid>
        
        <category>parasiteeve</category>
        
        <category>playstation</category>
        
        <category>music</category>
        
        
      </item>
    
      <item>
        <title>PG docs, part 5. Notifications</title>
        <description>
&lt;p&gt;&lt;em&gt;(This is a new documentation chapter from the &lt;a href=&quot;https://github.com/igrishaev/pg&quot;&gt;PG project&lt;/a&gt;.)&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;ToC&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;/en/pg-docs/01/&quot;&gt;About &amp;amp; Installation&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;/en/pg-docs/02/&quot;&gt;The Client&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;/en/pg-docs/03/&quot;&gt;Connection Pool&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;/en/pg-docs/04/&quot;&gt;Arrays&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;/en/pg-docs/05/&quot;&gt;Notifications&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;notifications&quot;&gt;Notifications&lt;/h2&gt;

&lt;!-- toc --&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#introduction&quot;&gt;Introduction&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#usage&quot;&gt;Usage&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;!-- tocstop --&gt;

&lt;h3 id=&quot;introduction&quot;&gt;Introduction&lt;/h3&gt;

&lt;p&gt;Notifications are somewhat pub-sub message systems in Postgres. They can be
described in these simple steps:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;client B subscribes to a channel; the channel gets created if it doesn’t
exist.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;client A sends a message to that channel;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;every time client B interacts with the database, they receive messages sent to
this channel by other clients.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;To handle a message, the client invokes a special handler. This handler comes
from the configuration. The default handler just prints the notification
map. &lt;strong&gt;Pay attention&lt;/strong&gt; that the handler is called synchronously blocking the
interaction with a socket. To prevent the connection from hanging due to the
time-consuming handling of a notification, provide a handler that sends it to
some sort of channel, agent, or message queue system.&lt;/p&gt;

&lt;!-- more --&gt;

&lt;h3 id=&quot;usage&quot;&gt;Usage&lt;/h3&gt;

&lt;p&gt;Imagine you have two connections: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;conn1&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;conn2&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-clojure highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:host&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;127.0.0.1&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
   &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:port&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10150&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
   &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:user&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;test&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
   &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:password&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;test&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
   &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:database&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;test&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;conn1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;pg/connect&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;conn2&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;pg/connect&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Let &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;conn2&lt;/code&gt; listen for a random channel:&lt;/p&gt;

&lt;div class=&quot;language-clojure highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;channel&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;hello&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;pg/listen&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;conn2&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;channel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Let the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;conn1&lt;/code&gt; connection send something into that channel:&lt;/p&gt;

&lt;div class=&quot;language-clojure highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;pg/notify&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;conn1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;channel&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;test&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now, should &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;conn2&lt;/code&gt; interact with the database, it will handle the notification
by printing it to the console:&lt;/p&gt;

&lt;div class=&quot;language-clojure highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;pg/query&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;conn2&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;select&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;; PG notification: {:msg :NotificationResponse, :pid 11244, :channel &quot;hello&quot;, :message &quot;test&quot;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;A notification is a map which tracks the channel name, the number of the process
number (PID) of the connection that has emitted it and the string payload of the
notification.&lt;/p&gt;

&lt;p&gt;To override the default printing handler, first declare a function. In our
example, the function just stores the notifications in a global atom:&lt;/p&gt;

&lt;div class=&quot;language-clojure highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;notifications&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;atom&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;defn&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;my-handler&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;notification&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;swap!&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;notifications&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;conj&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;notification&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Let’s go through the pipeline again with a new handler. Open a connection with
the new hanlder and subscribe to the channel:&lt;/p&gt;

&lt;div class=&quot;language-clojure highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;conn2&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;pg/connect&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;assoc&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:fn-notification&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;my-handler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;pg/listen&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;conn2&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;channel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Send a couple of messages from another connection:&lt;/p&gt;

&lt;div class=&quot;language-clojure highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;pg/notify&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;conn1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;channel&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;test1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;pg/notify&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;conn1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;channel&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;test2&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Trigger receiving the messages and check out the atom:&lt;/p&gt;

&lt;div class=&quot;language-clojure highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;pg/query&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;conn2&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;select&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;notifications&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:msg&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:NotificationResponse,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:pid&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;11244&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:channel&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;hello&quot;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:message&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;test1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:msg&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:NotificationResponse,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:pid&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;11244&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:channel&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;hello&quot;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:message&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;test2&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Futures, thread executors or core.async/Manofold are your best friends to
organize background processing of notifications effectively.&lt;/p&gt;

&lt;p&gt;Keep in mind that the listenting connection is passive: you won’t get any of
pending messages unless you interact with the database somehow. Running an empty
query from time to time would solve the problem. Again, you may have a backgound
loop or a scheduled task that does it for you.&lt;/p&gt;

&lt;p&gt;To stop receiving notifications from a certain channel, call &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;unlisten&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-clojure highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;pg/unlisten&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;conn2&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;channel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
</description>
        <pubDate>Fri, 15 Sep 2023 00:00:00 +0000</pubDate>
        <link>https://grishaev.me/en/pg-docs/05/</link>
        <guid isPermaLink="true">https://grishaev.me/en/pg-docs/05/</guid>
        
        <category>clojure</category>
        
        <category>programming</category>
        
        <category>postgres</category>
        
        <category>sql</category>
        
        <category>notifications</category>
        
        
      </item>
    
  </channel>
</rss>
