<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Ivan Grishaev's blog</title>
    <description>Writing on programming, education, books and negotiations.
</description>
    <link>https://grishaev.me/</link>
    <atom:link href="https://grishaev.me/feed.xml" rel="self" type="application/rss+xml"/>
    <pubDate>Mon, 19 Jun 2023 08:49:38 +0000</pubDate>
    <lastBuildDate>Mon, 19 Jun 2023 08:49:38 +0000</lastBuildDate>
    <generator>Jekyll v4.2.0</generator>
    
      <item>
        <title>Запуск InDesign</title>
        <description>&lt;p&gt;Готовлю книжку к печати и поэтому вынужден иметь дело с Адобом. Избежать этого
шага невозможно — некоторые программы заменить нечем. Несмотря на то, что в
адобовских программах я работаю буквально 20 лет, поминутно матерюсь из-за их
косяков. Покажу серьезный прокол, который заслуживает отдельного поста.&lt;/p&gt;

&lt;p&gt;Перед вами видео, где я запускаю Индизайн. Обратите внимание, что приложение
стартует быстро: буквально пару секунд занимает сплеш-скрин, а дальше
распахивается окно. Это, кстати, не заслуга Адоба: просто в процессе записи я
несколько раз открывал и закрывал его, и поэтому оно прогрето. Холодный запуск
будет медленней.&lt;/p&gt;

&lt;video controls=&quot;&quot;&gt;
  &lt;source src=&quot;/assets/static/aws/indesign/1.mp4&quot; type=&quot;video/mp4&quot; /&gt;
&lt;/video&gt;

&lt;p&gt;Но дело не в этом. После того, как окно распахнется на весь экран, программа
вступает во вторую фазу: загружает внутренний экран с последними файлами и
рекламой новых фич. Эта загрузка длится десять
секунд. &lt;strong&gt;Целых. Десять. Секунд.&lt;/strong&gt; Пока он не просрется, не видно последних
файлов и кнопок создания нового документа.&lt;/p&gt;

&lt;p&gt;В итоге сидишь и тупишь в пустоту, пока что-то там не загрузится. Однако если
нажать Ctrl+O, откроется диалог выбора файла. Выходит, программа прекрасно
работает, даже если главный экран не загрузился! Если выбрать в диалоге файл с
проектом, он откроется мгновенно. Можно не ждать эти 10 секунд, а открыть файл
ручками и работать. Это подтверждает второе видео:&lt;/p&gt;

&lt;video width=&quot;1280&quot; height=&quot;720&quot; controls=&quot;&quot;&gt;
  &lt;source src=&quot;/assets/static/aws/indesign/2.mp4&quot; type=&quot;video/mp4&quot; /&gt;
&lt;/video&gt;

&lt;p&gt;Такие вот интересные программы Адоба.&lt;/p&gt;

&lt;p&gt;Чем-то это напоминает современные веб-приложения: программа загрузилось, но это
присказка, не сказка. Мы только загрузили скрипты инициализации, далее они
выгребут свое дерьмо с серверов и только затем покажут приложение. На
телевизорах такое постоянно: первый прогрес-бар показывает загрузку приложения
на уровне ОС, а приложение запускает второй прогресс-бар для загрузки своего
барахла.&lt;/p&gt;

&lt;p&gt;Печально, что эту ерунду нельзя объединить в один шаг, потому что как
пользователю мне эти фазы до одного места: пока не загрузилось все до конца,
программа не работает. Вдвойне печальней, что это зараза переходит на десктоп.&lt;/p&gt;

&lt;p&gt;Подозреваю, что упомянутый главный экран — ничто иное, как Хром + Node.js +
React. Это видно по косвенным признакам: он похож на Слак и прочие поделки,
которые не могут быть отрисованы частично, а только целиком. Возможно, скрипты
ломятся в сеть, но блокируются из-за санкций или бог знает чего. Ожидание в 10
секунд похоже на таймаут, заданный при отправке HTTP-запроса. Спасибо, что хотя
бы выставили его: по умолчанию он равен 30 секунд.&lt;/p&gt;

&lt;p&gt;Странно, что последние файлы отображаются внутри этого браузера, хотя никак не
связаны с ним. Это банальная глупость, деградация разработки. Надо сказать, я не
удивлен. В Адобе много что делают на Node.js, например, дашборд, из которого
ставятся приложения. Я как-то шарился по папкам и нашел ворох скриптов. Плюс
часто выскакивает диалог с текстом “приложение node хочет доступ к такому-то
сертификату.”&lt;/p&gt;

&lt;p&gt;В сотый раз повторю тезис: сапожник без сапог. Фирма, которая тридцать лет пишет
настольные программы под Винду и Мак, не может нормально показать последние
файлы. Для загрузки приложений делается поделка па Хроме и Js, глючная и
тормозная. Деградация софта в угоду менеджменту: сделать тяп-ляп, но зато быстро
и получить повышение.&lt;/p&gt;

&lt;p&gt;Хочется верить, что индустрия печати пересядет с иглы Адоба на что-то другое, но
пока что просвета не видно.&lt;/p&gt;
</description>
        <pubDate>Mon, 19 Jun 2023 00:00:00 +0000</pubDate>
        <link>https://grishaev.me/indesign-startup/</link>
        <guid isPermaLink="true">https://grishaev.me/indesign-startup/</guid>
        
        <category>video</category>
        
        <category>adobe</category>
        
        <category>indesign</category>
        
        
      </item>
    
      <item>
        <title>Avoid code you cannot debug</title>
        <description>&lt;p&gt;This is a small tip I’d like to share with Clojure programmers.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;In a project, avoid code you cannot debug.&lt;/strong&gt; It’s simple: if you can put a
tag like &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;#debug&lt;/code&gt; or similar somewhere in the middle, run a test and hang in a
debugging session, you’re good. But if you cannot, you’ll be in trouble one day.&lt;/p&gt;

&lt;p&gt;Thus, any kind of DSL or yet another “smart” solution is a source of potential
problems. Take Meander, for example. Imagine I have a map like this:&lt;/p&gt;

&lt;div class=&quot;language-clojure highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Ivan&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:address&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:city&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Chita&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and I want it to become this:&lt;/p&gt;

&lt;div class=&quot;language-clojure highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Ivan&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:city&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Chita&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;With Meander, I would write:&lt;/p&gt;

&lt;div class=&quot;language-clojure highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;m/match&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Ivan&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:address&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:city&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Chita&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;?name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:address&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:city&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;?city&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;?name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:city&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;?city&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and it works fine. But one day, my datasource suddenly returns a user without an
address:&lt;/p&gt;

&lt;div class=&quot;language-clojure highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Ivan&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:address&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;; or just {:name &quot;Ivan&quot;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;which is completely fine because a user might have no address associated with
them. By passing that map into &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;m/match&lt;/code&gt;, I expect it to return &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;{:name &quot;Ivan&quot;
:city nil}&lt;/code&gt; but no: there will be an exception:&lt;/p&gt;

&lt;div class=&quot;language-clojure highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;m/match&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
   &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Ivan&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:address&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
   &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;?name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:address&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:city&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;?city&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
   &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;?name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:city&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;?city&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Unhandled&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;clojure.lang.ExceptionInfo&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
   &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;non&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;exhaustive&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pattern&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;match&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
   &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The line “non exhaustive pattern match” tells nothing to me nor the ex-data
does. The message is fuzzy, there is no context, the ex-data has nothing useful
(it’s an empty map). Having such an entry in logs or Sentry would not help you
in a bit.&lt;/p&gt;

&lt;p&gt;Moreover, you cannot debug it. The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;m/match&lt;/code&gt; macro expands into a huge block of
code. Debugging it somewhere in the middle would be quite challenging.&lt;/p&gt;

&lt;p&gt;Now compare it with a plain function that splits the data step by step:&lt;/p&gt;

&lt;div class=&quot;language-clojure highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;defn&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;remap-user&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;entry&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;username&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
         &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:keys&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;address&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;entry&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:keys&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;city&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;address&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;username&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
     &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:city&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;city&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;First, it works with both maps:&lt;/p&gt;

&lt;div class=&quot;language-clojure highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;remap-user&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Ivan&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;=&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Ivan&quot;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:city&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;remap-user&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Ivan&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:address&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:city&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Chita&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}})&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;=&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Ivan&quot;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:city&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Chita&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Second, I can always put a debugging tag into that function and observe the
local variables, the state and even run some expressions. With Meander, it’s
just impossible or only possible with certain effort.&lt;/p&gt;

&lt;p&gt;Third, if a city is required, I’d put something like this:&lt;/p&gt;

&lt;div class=&quot;language-clojure highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;assert&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;city&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;The city is missing&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and get a clear exception I want.&lt;/p&gt;

&lt;p&gt;Vast Meander patterns are completely unmaintainable. Pass something weird and
you’ll get a “non exhaustive pattern match” message with no idea about what went
wrong.&lt;/p&gt;

&lt;p&gt;Finally, debugging is crucial. If you cannot hang in the middle of execution and
observe the state, that’s bad. Most Clojure programmers believe it’s a special
language liberating you from debugging errors, but it’s not true. Debugging has
not gone anywhere even with such a great language as Clojure.&lt;/p&gt;
</description>
        <pubDate>Tue, 13 Jun 2023 00:00:00 +0000</pubDate>
        <link>https://grishaev.me/en/clojure-debug/</link>
        <guid isPermaLink="true">https://grishaev.me/en/clojure-debug/</guid>
        
        <category>clojure</category>
        
        <category>programming</category>
        
        <category>debugging</category>
        
        
      </item>
    
      <item>
        <title>Пауза в Ютубе</title>
        <description>&lt;p&gt;Не помню, чтобы кто-то жаловался вот на что. Когда ставишь Ютуб на паузу,
появляется доселе невидимый бар управления, который ложится аккурат на субтитры.&lt;/p&gt;

&lt;p&gt;Речь идет о субтитрах в обучающих роликах, в основном языковых. Но это может
быть доклад, митап или сцена из фильма.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/static/aws/yt-pause/1.jpg&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Со своими субтитрами Ютуб решил ловко: в момент паузы они приподнимаются. Но не
могут же сдвинуться буквы на видео! Частично проблему можно решить, изменив
размеры окна, но это уловки для бедных.&lt;/p&gt;

&lt;p&gt;Спрашивается, почему бы вынести кнопки в отдельную полосу? Да, они займут место,
ну и что? Почему проблему интерфейса рашают за счет контента? Почему интерфейс
налазит на видео, вместо того чтобы быть снизу?&lt;/p&gt;

&lt;p&gt;То есть Гугл решил: внизу видео что-то не нужное, поставим туда кнопки. А там,
на минуточку, бывает текст, и его даже порой читают. Например я.&lt;/p&gt;

&lt;p&gt;В других сервисах бывает еще хуже. Поставил на паузу — и появляются темные
градиенты, жирные блямбы, выезжают скрытые кнопки, рекомендации и все прочее. Я
просто хочу что-то рассмотреть или прочитать, почему мне мешают? Дизайнер,
добавь в угол экрана две белые палочки — знак паузы. И не в центр, потому что в
центре самое нужное, а в угол. Этого хватит. Но нет, нужно загадить как можно
больше пространства.&lt;/p&gt;

&lt;p&gt;Кстати, один из способов решить эту проблему — &lt;a href=&quot;/youtube-desktop/&quot;&gt;смотреть Ютуб в VLC&lt;/a&gt;, о чем
я писал раньше. Слегка экстремально, но проблемы субтитров нет.&lt;/p&gt;
</description>
        <pubDate>Mon, 12 Jun 2023 00:00:00 +0000</pubDate>
        <link>https://grishaev.me/yt-pause/</link>
        <guid isPermaLink="true">https://grishaev.me/yt-pause/</guid>
        
        <category>youtube</category>
        
        <category>video</category>
        
        <category>subtitles</category>
        
        <category>pause</category>
        
        
      </item>
    
      <item>
        <title>Корректура в PDF</title>
        <description>&lt;p&gt;Если кто не знает, откуда столько ненависти к PDF, сейчас объясню.&lt;/p&gt;

&lt;p&gt;У PDF одно назначение — просмотр и печать документов. Это конечный артефакт,
который получают при компиляции проекта — будь то Индизайн, Латех, что
угодно. Править PDF после его получения — это то же самое, что править байтики в
exe-файле, вместо того, чтобы поправить код.&lt;/p&gt;

&lt;p&gt;Один раз &lt;a href=&quot;/preview/&quot;&gt;я даже писал&lt;/a&gt; про возможности Preview по работе с PDF, но все это уловки
для бедных, когда нет исходника.&lt;/p&gt;

&lt;p&gt;Тезис о том, что с PDF нельзя работать как с документом, подтверждает следующий
опыт: &lt;strong&gt;середина 2023 года, тридцать лет с момента появления PDF — и не найти
программы, которая бы работала с ним без ошибок&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Если конкретно, то я готовлю вторую книгу к печати. Заказал корректуру, говорю:
готов распечатать и прислать любой службой за мой счет. Нет, берем только
PDF. Ладно, выслал, получил обратно с комментариями.&lt;/p&gt;

&lt;p&gt;Теперь самое интересное. Внос правок сводится к шагам: перешел к очередному
комментарию, поправил исходник, удалил коммент. Что же пошло не так? А вот что.&lt;/p&gt;

&lt;p&gt;Preview на Mac M1 не может удалить некоторые комментарии. Те, что с типом
Highlight — да, а Note — нет. Специально проверил, старый Preview на Интеле
может, но поведение неочевидно. В целом работа с аннотациями в Preview глючная:
коммент может висеть еще долго после удаления. Иногда фокус смещается
произвольно и удаляется не тот коммент.&lt;/p&gt;

&lt;p&gt;Не все это можно передать в картинках, но например: слева у комментария есть
опция удаления, а справа у Note — нет.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/static/aws/pdf/1.jpeg&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Для демонстрации других косяков нужно записывать гифки, к чему я не готов.&lt;/p&gt;

&lt;p&gt;Вы скажете — браузер. Не вопрос, открыл в Хроме, а там такое:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/static/aws/pdf/2.jpeg&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Плюс комменты нельзя удалять, read-only.&lt;/p&gt;

&lt;p&gt;Может, Акробат наше все? Ну, уже сам факт, что установка требует sudo, внушает опасения. Ладно, поставил. Документ не открывается перетаскиванием в программу — только File -&amp;gt; Open, только хардкор. Удаление комментов работает, но если скопировать текст из PDF, получим такое:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Âòîðàÿ ãëàâà ïîñâÿùåíà ðåëÿöèîííûì áàçàì äàííûõ,
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Словом, кто вносил корректуру, тот в цирке не смеется.&lt;/p&gt;

&lt;p&gt;Повторю тезис из начала заметки: любая работа с PDF — это боль по
определению. Он специально сделан так, чтобы правки были максимально
затруднены. Бинарный формат, девять редакций, адское легаси. Любая программа,
которая предлагает редактирование PDF — это н…балово. Оно работает только в
примитивных случаях, а как что-то серьезней — сплошная беда.&lt;/p&gt;

&lt;p&gt;Поэтому, кстати, я считаю, что корректор, который не работает с бумагой — это
слабый корректор. Хороший как минимум не должен ее избегать.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;UPD&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Продолжение заметки. Добрые люди подсказали два варианта: PDF Expert и Master
PDF Editor. Первая не обслуживает пользователей из России, но ставится из
brew. Оказалось, она не работает без облачной учетной записи. Попап закрывает
интерфейс, хоть усрись, но создай учетку. Скриншот не сохранил, прогу удалил.
Поставил Master PDF Editor, на первый взгляд все отлично. Посидел два часа,
вносил корректуру. Сохранил файл и перекинул на другой комп. Открываю, а там:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/static/aws/pdf/3.jpeg&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Знаете, это уже не смешно. Похоже, на вопрос из прошлой заметки — есть ли в
природе программа, которая работает с PDF без ошибок — ответ все-таки
отрицательный.&lt;/p&gt;

&lt;p&gt;Эту работу я как-нибудь доделаю, но она стоила много нервов. &lt;em&gt;Очень, очень много
нервов.&lt;/em&gt;&lt;/p&gt;
</description>
        <pubDate>Sat, 10 Jun 2023 00:00:00 +0000</pubDate>
        <link>https://grishaev.me/pdf-correct/</link>
        <guid isPermaLink="true">https://grishaev.me/pdf-correct/</guid>
        
        <category>book</category>
        
        <category>pdf</category>
        
        
      </item>
    
      <item>
        <title>Строки по 80</title>
        <description>&lt;p&gt;Иной айтишник нет-нет да пожалуется на разбиение строк по 80 символов. Считаю
нужным прояснить ситуацию.&lt;/p&gt;

&lt;p&gt;Коротко: если это текст в системе контроля версий — код, readme или вроде того —
он должен быть разбит. Не обязательно по 80 символов, можно 90, 100
или 120. Главное выбрать число и следовать ему.&lt;/p&gt;

&lt;p&gt;Обыватель думает, что число 80 связано с перфокартой. Да, на них действительно
было столько дырок, потому что 80 символов умещалось в терминале. Но дело не
только в этом. Откройте любую книгу и посчитайте число знаков в строке. Их будет
от 60 до 80, в среднем 65. Почему?&lt;/p&gt;

&lt;p&gt;Ответ никак не связан с перфокартой. Эти 65-70 знаков в сочетании с 10 шрифтом
дают строку длиной 12 см. В свою очередь 12 см — та длина, которую глаз читает
на комфортном расстоянии без поворота головы.&lt;/p&gt;

&lt;p&gt;Как-то так:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/static/aws/strings80/1.jpeg&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Откройте любой журнал. Две колонки по 50 символов, потому что шрифт
меньше. Сделайте в одну — никто не прочтет.&lt;/p&gt;

&lt;p&gt;Теперь я растянул редактор на всю ширину. Как это читать? Вы будете крутить
головой, как лошадь на привязи:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/static/aws/strings80/2.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;А так нормально:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/static/aws/strings80/3.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Тут влетает бунтарь с криками: как так, за меня решили, задели хрупкие чувства!
Дайте свободу, я сам настрою. Мне не жалко, но есть проблема: редактор
приходится ужимать до такого состояния:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/static/aws/strings80/4.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;У меня так-то 400 файлов открыто, и под каждый менять размер окна — не много ль
чести? Можно вынести файл в отдельное окно, но опять же — заморочки.&lt;/p&gt;

&lt;p&gt;Далее — конфликты. Если параграф не нарезан на строки по 80 символов, исправить
конфликты невозможно. Пожалуйста, прочтите это предложение еще раз: &lt;strong&gt;исправить
конфликты невозможно&lt;/strong&gt;. Без нарезки параграф — это единая строка, и если Вася
исправил букву в начале, а Петя — в конце, это конфликт. Пишите претензии
создателям Git, CSV и другим системам контроля версий. Их рабочая единица —
строка, и других не предвидится.&lt;/p&gt;

&lt;p&gt;Подобные конфликты решаются вручную и больше никак. Продвинутые тузлы подсветят
изменения внутри строки, но что-то сложнее пары опечаток решить невозможно. У
нас уже было такое: вместе с коллегой поправили документацию в markdown. В итоге
я откатил свои правки и накладывал повторно на его мердж. Спасибо, больше не
надо.&lt;/p&gt;

&lt;p&gt;Наконец, в хорошем редакторе проблема нарезки не стоит в принципе. &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;C-x f&lt;/code&gt; задает
ширину колонки, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;M-q&lt;/code&gt; поджимает текущий абзац. Чтобы поджать весь документ, жмем
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;C-x h&lt;/code&gt; и &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;M-q&lt;/code&gt;. Занимает секунду.&lt;/p&gt;

&lt;p&gt;Кстати, принцип, когда подряд идущие строки объединяются в параграф, а пустая
строка отбивает параграфы, придумали не в markdown. Это сделал Кнут для своего
TeX, за что ему честь и хвала.&lt;/p&gt;

&lt;p&gt;Вот, пожалуй, все, что нужно знать про нарезку строк.&lt;/p&gt;
</description>
        <pubDate>Thu, 08 Jun 2023 00:00:00 +0000</pubDate>
        <link>https://grishaev.me/strings-80/</link>
        <guid isPermaLink="true">https://grishaev.me/strings-80/</guid>
        
        <category>programming</category>
        
        <category>git</category>
        
        
      </item>
    
      <item>
        <title>Гигиена в Git</title>
        <description>&lt;p&gt;Несколько правил, чтобы держать Git приличном виде.&lt;/p&gt;

&lt;p&gt;Одна задача — один коммит. Слияние ветки происходит только через squash, другие
методы запрещены.&lt;/p&gt;

&lt;p&gt;В сообщении к коммиту указан только номер задачи и ее заголовок, например
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[FOOBAR-123] Make some crap&lt;/code&gt;. Иная графомания нежелательна — идите за ней в
задачу.&lt;/p&gt;

&lt;p&gt;Перед слиянием коммиты переносят наверх с помощью rebase относительно
родителя. Так вы лишний раз убедитесь, что все в порядке.&lt;/p&gt;

&lt;p&gt;После слияния ветка удаляется автоматом.&lt;/p&gt;

&lt;p&gt;У каждого PR есть expire. Висит две недели — значит никому не нужен и удаляется
автоматом. В следующий раз команда будет расторопней.&lt;/p&gt;

&lt;p&gt;Чем больше веток — тем хуже. В идеале это master с тегами релизов и
feature-ветки. И больше ничего.&lt;/p&gt;

&lt;p&gt;Пуш в мастер запрещен всем, кроме одного человека (техдиректора).&lt;/p&gt;

&lt;p&gt;Слияние без апрува запрещено (а лучше двух).&lt;/p&gt;

&lt;p&gt;Kdiff3 — пожалуй, лучшее средство разрешения конфликтов:&lt;/p&gt;

&lt;div class=&quot;language-clojure highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;brew&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;install&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;--cask&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;kdiff3&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;/.gitconfig&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;merge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tool&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;kdiff3&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;diff&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tool&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;kdiff3&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mergetool&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;kdiff3&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;/Applications/kdiff3.app/Contents/MacOS/kdiff3&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;difftool&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;kdiff3&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;/Applications/kdiff3.app/Contents/MacOS/kdiff3&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;UPD&lt;/strong&gt; Ограничение на один коммит не касается локальной ветки, в которой вы
пилите задачу. Их может быть хоть два, хоть двести. Важно, что при слиянии
методом squash они объединяются, и в главной ветке остается один коммит с
номером задачи.&lt;/p&gt;

&lt;p&gt;Бывает, коллега делает задачу неделями и после аппрува жмет “Merge”. В истории
оказывается 50+ коммитов с подписями “working”, “fix tests”, “fix linter”,
“updated” и так далее. Спрашивается, зачем это команде? В своей ветке делай что
хочешь, а в общей соблюдай приличия.&lt;/p&gt;
</description>
        <pubDate>Wed, 07 Jun 2023 00:00:00 +0000</pubDate>
        <link>https://grishaev.me/git-pretty/</link>
        <guid isPermaLink="true">https://grishaev.me/git-pretty/</guid>
        
        <category>programming</category>
        
        <category>git</category>
        
        
      </item>
    
      <item>
        <title>Apple VR</title>
        <description>&lt;p&gt;В рекламе Эпла есть совершенно криповый момент. Дочки играют на полу, а батя
смотрит на них сквозь гарнитуру — снимает.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/static/aws/vr/1.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/static/aws/vr/2.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Выглядит он как Дарт Вейдер или инвалид, вынужденный таскать какой-то девайс. Уж
наверное игра с детьми — тот случай, когда нужно убрать гаджеты и предаться
живому общению. А батя напялил ведро на голову и стал похож на киборгов из
“Призрака в доспехах”, которым ставили бюджетные протезы вместо глаз.&lt;/p&gt;

&lt;p&gt;Я даже в телефон не смотрю при детях, чтобы не подавать плохой пример. А тут
такое, жесть.&lt;/p&gt;
</description>
        <pubDate>Tue, 06 Jun 2023 00:00:00 +0000</pubDate>
        <link>https://grishaev.me/apple-vr/</link>
        <guid isPermaLink="true">https://grishaev.me/apple-vr/</guid>
        
        <category>life</category>
        
        <category>apple</category>
        
        <category>vr</category>
        
        
      </item>
    
      <item>
        <title>Десять советов, которые я дал бы себе в молодости</title>
        <description>&lt;p&gt;Есть такой пошлый формат — кто-то успешный дает советы молодой аудитории. Заводи
знакомства, качай софт-скилы, фокусируйся, помни о главном. Вся эта олдовая
мудрость, поучение молодых, вы поняли.&lt;/p&gt;

&lt;p&gt;Каждый раз удивляюсь одной вещи. Почему-то никто не спросит докладчика:
милейший, а ты следовал своим советам в 20 лет? Ответ очевиден — конечно нет. Он
просто херачил, шел напролом к цели и вот пришел. Теперь его пригласили
выступать перед публикой.&lt;/p&gt;

&lt;p&gt;Как правило, человек плохо оценивает себя. Даже если он видит, что известней и
богаче других, то находит этому нелепые объяснения.  Это ошибка выжившего:
причины успеха вовсе не те, что ты несешь со сцены. Они могут быть сомнительными,
криминальными или вообще неизвестными. Это может быть совпадение времени и
места. Но что-то нужно сказать, и он говорит, хотя все это не имеет смысла.&lt;/p&gt;

&lt;p&gt;В самом деле: начните делать то, что советовали Стив Джобс и Билл Гейтс, и ни к
какому успеху вы не придете. Более того, вы же не пойдете с них догонять:
смотри, я делал как ты говорил, но не помогает. Зачем тогда слушать, если нет
гарантий?&lt;/p&gt;

&lt;p&gt;Советы успешных людей — это тьфу и растереть. Они пришли к цели без каких-либо
советов, а значит, вы можете так же. Вполне возможно, в зале сидит потенциальный
Билл Гейтс, но вместо того, чтобы идти к мечте, он слушает чью-то блажь.&lt;/p&gt;

&lt;p&gt;Сюда же относятся курсы успешного успеха, интервью Дудей, всякие блоггеры и
прочее. Пока вы их слушаете, вы не делаете свое и льете воду на чужую мельницу.&lt;/p&gt;

&lt;p&gt;Поэтому один совет, который я могу дать — поменьше слушать чужих мнений. Делай
то, что считаешь нужным и иди с этим правилом через всю жизнь.&lt;/p&gt;
</description>
        <pubDate>Mon, 05 Jun 2023 00:00:00 +0000</pubDate>
        <link>https://grishaev.me/successful-success/</link>
        <guid isPermaLink="true">https://grishaev.me/successful-success/</guid>
        
        <category>life</category>
        
        <category>success</category>
        
        
      </item>
    
      <item>
        <title>SQL и DISTINCT ON</title>
        <description>&lt;p&gt;Еще одна полезная штукенция в SQL — это оператор &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;DISTINCT ON&lt;/code&gt;. От обычного &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;DISTINCT&lt;/code&gt; он отличается тем, что определяет уникальность записей не по всем полям, а только указанным. Эта особенность позволяет писать интересные запросы.&lt;/p&gt;

&lt;p&gt;Предположим, мы ведем таблицу курсов валют относительно рубля. Вот ее структура:&lt;/p&gt;

&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;create&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;table&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rates&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;      &lt;span class=&quot;nb&quot;&gt;serial&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;primary&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;   &lt;span class=&quot;nb&quot;&gt;text&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;instant&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;timestamp&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;without&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;zone&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;now&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;cost&lt;/span&gt;    &lt;span class=&quot;nb&quot;&gt;bigint&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;и данные:&lt;/p&gt;

&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;insert&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;into&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rates&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cost&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;values&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'usd'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;7968&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;insert&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;into&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rates&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cost&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;values&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'usd'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;7988&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;insert&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;into&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rates&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cost&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;values&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'usd'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8031&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;insert&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;into&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rates&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cost&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;values&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'eur'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8623&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;insert&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;into&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rates&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cost&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;values&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'eur'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8581&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;insert&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;into&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rates&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cost&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;values&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'eur'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8699&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Величины хранятся целым числом в центах. Все запросы я специально ввел по одному, чтобы у курсов были разные даты.&lt;/p&gt;

&lt;p&gt;У подобных таблиц особенность: часто нужны их срезы по датам, например первые или последние на текущий момент. На первый взгляд не ясно, как это делать. До того, как я узнал про &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;DISTINCT ON&lt;/code&gt;, я делал весьма топорно: сперва группировал по валюте, чтобы получить максимальную дату:&lt;/p&gt;

&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;max&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;instant&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;instant&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rates&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;group&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;by&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

 &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;          &lt;span class=&quot;n&quot;&gt;instant&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;-------+----------------------------&lt;/span&gt;
 &lt;span class=&quot;n&quot;&gt;eur&lt;/span&gt;   &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2023&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;06&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;02&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;17&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;04&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;902392&lt;/span&gt;
 &lt;span class=&quot;n&quot;&gt;usd&lt;/span&gt;   &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2023&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;06&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;02&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;57&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;007947&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;, а затем оборачивал это в подзапрос и соединял с основной таблицей по валюте и дате:&lt;/p&gt;

&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rates&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rates&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;join&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;max&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;instant&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;instant&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rates&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;group&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;by&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sub&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;on&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;rates&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sub&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rates&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;instant&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sub&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;instant&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

 &lt;span class=&quot;n&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;          &lt;span class=&quot;n&quot;&gt;instant&lt;/span&gt;           &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cost&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;----+-------+----------------------------+------&lt;/span&gt;
  &lt;span class=&quot;mi&quot;&gt;6&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;usd&lt;/span&gt;   &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2023&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;06&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;02&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;57&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;007947&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8031&lt;/span&gt;
  &lt;span class=&quot;mi&quot;&gt;9&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;eur&lt;/span&gt;   &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2023&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;06&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;02&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;17&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;04&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;902392&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8699&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Это неуклюже и требует индексов для эффективного JOIN.&lt;/p&gt;

&lt;p&gt;Гораздо лучше смотрится с &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;DISTINCT ON&lt;/code&gt;. Укажем в запросе, что записи уникальны в разрезе валют. В этом случае в выборке останется одна запись с &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;usd&lt;/code&gt; и одна с &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;eur&lt;/code&gt;, а остальные будут пропущены. Остается отсортировать их так, чтобы первыми шли записи с максимальной датой или минимальной.&lt;/p&gt;

&lt;p&gt;Пример с минимальной датой:&lt;/p&gt;

&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;distinct&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;on&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rates&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;order&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;by&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;instant&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

 &lt;span class=&quot;n&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;          &lt;span class=&quot;n&quot;&gt;instant&lt;/span&gt;           &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cost&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;----+-------+----------------------------+------&lt;/span&gt;
  &lt;span class=&quot;mi&quot;&gt;7&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;eur&lt;/span&gt;   &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2023&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;06&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;02&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;59&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;46867&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8623&lt;/span&gt;
  &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;usd&lt;/span&gt;   &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2023&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;06&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;02&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;50&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;603444&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;7968&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;А это — с максимальной, потому что записи следуют по убываю &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;instant&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;distinct&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;on&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rates&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;order&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;by&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;instant&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;desc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

 &lt;span class=&quot;n&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;          &lt;span class=&quot;n&quot;&gt;instant&lt;/span&gt;           &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cost&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;----+-------+----------------------------+------&lt;/span&gt;
  &lt;span class=&quot;mi&quot;&gt;9&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;eur&lt;/span&gt;   &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2023&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;06&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;02&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;17&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;04&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;902392&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8699&lt;/span&gt;
  &lt;span class=&quot;mi&quot;&gt;6&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;usd&lt;/span&gt;   &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2023&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;06&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;02&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;57&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;007947&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8031&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Обратите внимание, что сортировка &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;order by&lt;/code&gt; начинается с того поля, которое указано в &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;distinct on&lt;/code&gt;. За счет этого база эффективно пропускает дубли без промежуточных списков.&lt;/p&gt;

&lt;p&gt;Если записей много, понадобится индекс на поле уникальности и критерий сортировки, в нашем случае &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;value&lt;/code&gt; и &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;instant&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-clojure highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;CREATE&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;INDEX&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rates_last_idx&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ON&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rates&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;value,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;instant&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;desc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Похоже решаются другие задачи, связанные со временем или версиями, например прогноз погоды, версионирование статей или сущностей.&lt;/p&gt;
</description>
        <pubDate>Sat, 03 Jun 2023 00:00:00 +0000</pubDate>
        <link>https://grishaev.me/sql-distinct-on/</link>
        <guid isPermaLink="true">https://grishaev.me/sql-distinct-on/</guid>
        
        <category>programming</category>
        
        <category>sql</category>
        
        <category>postgresql</category>
        
        <category>logs</category>
        
        
      </item>
    
      <item>
        <title>Логи SQL (2)</title>
        <description>&lt;p&gt;В последнее время я много занимаюсь SQL, поэтому вот еще пара приемов.&lt;/p&gt;

&lt;p&gt;Настройка &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;log_duration = on&lt;/code&gt; добавляет в лог длительность каждого запроса. Удобно, потому что избавляет от мусорного кода, который перед каждым запросом запоминает текущее время, выполняет его, находит новое время и печатает разницу в консоль. Postgres берет все это на себя:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;statement: create table table8855 (id integer)
duration: 11.607 ms
statement: BEGIN
duration: 0.046 ms
statement: insert into table8855 values (1), (2)
duration: 0.368 ms
statement: ROLLBACK
duration: 0.052 ms
statement: select * from table8855
duration: 0.414 ms
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Вторая настройка &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;log_line_prefix&lt;/code&gt; отвечает за информацию, которая показана в логе перед запросом. По умолчанию это время с точностью до миллисекунд и номер процесса:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;2023-06-02 14:45:52.395 MSK [57002] LOG:  statement: BEGIN
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Я предпочитаю вот что:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;log_line_prefix = '%t [%v]'
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;%t&lt;/code&gt; выводит время без миллисекунд, что короче;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;%v&lt;/code&gt; означает виртуальный номер транзакции. Виртуальный потому, что до ее завершения система не знает, какой номер будет в итоге. Поэтому выводится пара &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[tmin/tmax]&lt;/code&gt; — диапазон транзакций, доступный запросу в текущий момент.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Зачем это нужно? Бывают баги, когда разработчик ошибается с транзакциями, например открывает ее, но шлет запросы через старое соединение. Если что-то упадет в процессе, изменения будут частичными, что выливается проблемы на проде.&lt;/p&gt;

&lt;p&gt;С логами ниже легко понять, кто на ком стоял. Запросы с меткой &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[3/5]&lt;/code&gt; относятся к одной транзакции, а &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[4/2]&lt;/code&gt; — к другой.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[3/4]LOG: create table table8856 (id integer)
[3/5]LOG: BEGIN
[3/5]LOG: SET TRANSACTION ISOLATION LEVEL SERIALIZABLE
[3/5]LOG: insert into table8856 values (1), (2)
[3/5]LOG: select * from table8856
[4/2]LOG: select * from table8856
[3/5]LOG: COMMIT
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Заодно можно посчитать, сколько было транзакций, насколько они пересекаются и, возможно, разнести их по времени.&lt;/p&gt;
</description>
        <pubDate>Fri, 02 Jun 2023 00:00:00 +0000</pubDate>
        <link>https://grishaev.me/sql-logs-2/</link>
        <guid isPermaLink="true">https://grishaev.me/sql-logs-2/</guid>
        
        <category>programming</category>
        
        <category>sql</category>
        
        <category>postgresql</category>
        
        <category>logs</category>
        
        
      </item>
    
  </channel>
</rss>
